[{"content":"å‰ä¸€æ®µæ—¶é—´ä¸€ç›´å…³æ³¨çš„dapræ­£å¼å‘å¸ƒäº†v1.0ç‰ˆæœ¬(å®é™…ä¸Šæœ¬æ–‡å‘å¸ƒæ—¶è¿˜æ›´æ–°äº†v1.0.1)ï¼Œä»£è¡¨dapråœ¨æŸäº›ç¨‹åº¦ä¸Šè¿›å…¥ç¨³å®šçŠ¶æ€ï¼Œå¯ä»¥å°è¯•åœ¨å®é™…ä¸­è¿›è¡Œè¿ç”¨ã€‚ä½œä¸ºæˆ‘ä¸€ç›´å…³æ³¨çš„é¡¹ç›®ï¼Œåœ¨ç¬¬ä¸€æ—¶é—´ä¸­è¿›è¡Œäº†å°è¯•ï¼Œå¹¶è¯•å›¾å¼•å…¥å®é™…é¡¹ç›®ä¸­ï¼Œæœ¬æ–‡åˆ™æ˜¯é’ˆå¯¹è¿™äº›çš„ä¸€äº›å…ˆæœŸæµ‹è¯•å†…å®¹.\nä»€ä¹ˆæ˜¯daprï¼Ÿ Dapræœ€æ—©æ˜¯ç”±å¾®è½¯å¼€æºçš„(ä¸æ„§æ˜¯ä½ )ï¼Œä¸€ä¸ªå¯ç§»æ¤çš„ã€äº‹ä»¶é©±åŠ¨çš„ç¨‹åºè¿è¡Œæ—¶ï¼Œå®ƒä½¿ä»»ä½•å¼€å‘è€…éƒ½èƒ½è½»æ¾åœ°æ„å»ºè¿è¡Œåœ¨äº‘å’Œè¾¹ç¼˜çš„å¼¹æ€§ã€æ— çŠ¶æ€/æœ‰çŠ¶æ€çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”å¯ä»¥çµæ´»æ”¯æŒå¤šç§å¼€å‘è¯­è¨€ã€‚æ¢è€Œè¨€ä¹‹ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œdaprå¯ä»¥ä½œä¸ºä¸€ä¸ªServerlessè½åœ°æ–¹æ¡ˆçœ‹å¾…å’Œå¤„ç†ï¼Œå¯¹ç¨‹åºè€Œè¨€ï¼Œåªå…³æ³¨æä¾›çš„storeå’Œæ¶ˆæ¯é˜Ÿåˆ—æ¥å£ï¼Œæ— éœ€å…³å¿ƒæ¶æ„å±‚é¢æ›´å¤šå†…å®¹ã€‚\nä¸è¿‡åœ¨å®˜æ–¹çš„ç¤ºä¾‹æ•™ç¨‹ä¸­ï¼Œä½¿ç”¨çš„ç¯å¢ƒä¸ºå®¹å™¨ç¯å¢ƒéƒ¨ç½²å’Œç®¡ç†daprã€‚å®é™…ä¸Šï¼Œé™¤äº†åœ¨å®¹å™¨ç¯å¢ƒæˆ–è€…å®¹å™¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼ŒDaprå¯ä»¥é…ç½®ä¸ºåœ¨æœ¬åœ°æœºå™¨ä¸Šä»¥è‡ªæ‰˜ç®¡æ¨¡å¼è¿è¡Œã€‚\næœ¬åœ°å®‰è£… daprå®‰è£…å¯ä»¥é€šè¿‡å®˜æ–¹çš„dapr-cliå®ç°ï¼Œdapr-cliå¯ä»¥é€šè¿‡ä¸€é”®å®‰è£…å‘½ä»¤å¿«é€Ÿå®‰è£…ï¼š\n# wget -q https://raw.githubusercontent.com/dapr/cli/master/install/install.sh -O - | /bin/bash Your system is linux_amd64 Dapr CLI is detected: main: line 86: 43656 Segmentation fault $DAPR_CLI_FILE --version Reinstalling Dapr CLI - /usr/local/bin/dapr... Getting the latest Dapr CLI... Installing v1.0.0 Dapr CLI... Downloading https://github.com/dapr/cli/releases/download/v1.0.0/dapr_linux_amd64.tar.gz ... dapr installed into /usr/local/bin successfully. CLI version: 1.0.0 Runtime version: n/a To get started with Dapr, please visit https://docs.dapr.io/getting-started/ å¯ä»¥é€šè¿‡è¾“å…¥daprå‘½ä»¤ç¡®è®¤dapr-cliç¨‹åºæ˜¯å¦è¢«æ­£å¸¸å®‰è£…æˆåŠŸã€‚\næ¥ä¸‹æ¥ä½¿ç”¨dapr-cliå®‰è£…æ‰€æœ‰çš„runtimeç­‰åº”ç”¨ã€‚\n# dapr init --slim âŒ› Making the jump to hyperspace... â†˜ Downloading binaries and setting up components... Dapr runtime installed to /root/.dapr/bin, you may run the following to add it to your path if you want to run daprd directly: export PATH=$PATH:/root/.dapr/bin âœ… Downloaded binaries and completed components set up. â„¹ï¸ daprd binary has been installed to /root/.dapr/bin. â„¹ï¸ placement binary has been installed to /root/.dapr/bin. âœ… Success! Dapr is up and running. To get started, go here: https://aka.ms/dapr-getting-started # dapr --version CLI version: 1.0.0 Runtime version: 1.0.1 åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¦‚æœé€‰æ‹©ä½¿ç”¨initå‘½ä»¤åˆå§‹åŒ–ï¼Œdapr-cliå°†ä¼šè‡ªåŠ¨å°è¯•ä½¿ç”¨å®¹å™¨ç¯å¢ƒç®¡ç†ç›¸å…³ç¨‹åºï¼Œåªæœ‰æ·»åŠ --slimå‚æ•°æ‰ä¼šé€‰æ‹©æœ¬åœ°åŒ–è¿è¡Œã€‚æ›´å¤šç”¨æ³•å¯ä»¥å‚è€ƒdapr help initå¸®åŠ©ã€‚é»˜è®¤ç¨‹åºç›¸å…³å†…å®¹ä¼šå®‰è£…åœ¨$HOME/.daprç›®å½•ä¸‹ï¼Œè¿™é‡Œå› ä¸ºæˆ‘ä¸ºäº†ç®€ä¾¿ä½¿ç”¨äº†rootç”¨æˆ·ï¼Œå› æ­¤ç¨‹åºå‘½ä»¤æ‰€åœ¨ç›®å½•ä¸º/root/.dapr/binï¼Œå…±å®‰è£…äº†å¦‚ä¸‹å‘½ä»¤ï¼š\n# ls ~/.dapr/bin daprd dashboard placement web ä»æ–‡ä»¶åå¯ä»¥çœ‹å‡ºæ¥daprdæ˜¯deamonè¿›ç¨‹ï¼Œdashboardå°±æ˜¯ç®¡ç†é¢æ¿ï¼Œplacementæ˜¯ç”¨äºç®¡ç†actoråˆ†å¸ƒæ–¹æ¡ˆå’Œå¯†é’¥èŒƒå›´çš„å·¥å…·ã€‚å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°åœ¨å®‰è£…åä¼šä½¿ç”¨Reidsä½œä¸ºé»˜è®¤çš„å­˜å‚¨å’Œpub/subç»„ä»¶ï¼Œä½†æ˜¯æˆ‘å®é™…å®‰è£…ä¸‹æ¥å…¶å®æ˜¯å¹¶æ²¡æ²¡æœ‰çš„ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æ–‡æ¡£æœ‰äº›è¿‡æœŸå¯¼è‡´çš„ã€‚è¿™æ—¶å¦‚æœæŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„ä¾‹å­è¿›è¡Œæ“ä½œå¯åŠ¨ç¨‹åºå¹¶å°è¯•åœ¨å­˜å‚¨ä¸­ä¿å­˜æ•°æ®ï¼Œåˆ™ä¼šå‡ºç°æŠ¥é”™çš„æƒ…å†µï¼š\n// ç¬¬ä¸€ä¸ªsessionä¸­æ‰§è¡Œï¼š # dapr run --app-id myapp --dapr-http-port 3500 // ç¬¬äºŒä¸ªsessionä¸­æ‰§è¡Œï¼š # curl -X POST -H \u0026quot;Content-Type: application/json\u0026quot; -d '[{ \u0026quot;key\u0026quot;: \u0026quot;name\u0026quot;, \u0026quot;value\u0026quot;: \u0026quot;Bruce Wayne\u0026quot;}]' http://localhost:3500/v1.0/state/statestore {\u0026quot;errorCode\u0026quot;:\u0026quot;ERR_STATE_STORES_NOT_CONFIGURED\u0026quot;,\u0026quot;message\u0026quot;:\u0026quot;state store is not configured\u0026quot;} ä¸è¿‡å®é™…ä¸Šæ·»åŠ ç»„ä»¶åœ¨daprä¸­ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå¯ä»¥é€šè¿‡åœ¨$HOME/.dapr/componentsä¸‹æ·»åŠ å¯¹åº”yamlæ–‡ä»¶å®ç°ã€‚\næ·»åŠ Redisä½œä¸ºç»„ä»¶ æˆ‘ä»¬å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°ä¸€ä¸ªRedisç»„ä»¶é…ç½®æ¨¡ç‰ˆï¼Œå¯ä»¥å¿«é€Ÿä½¿ç”¨ï¼š\n# redis-store.yml apiVersion: dapr.io/v1alpha1 kind: Component metadata: name: redis-store namespace: default spec: type: state.redis version: v1 metadata: - name: redisHost value: 127.0.0.1:6379 - name: redisPassword value: \u0026#34;\u0026#34; å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨Redis StreamåŠŸèƒ½åšpub/subåŠŸèƒ½ï¼Œè™½ç„¶è¿™ä¸ªåŠŸèƒ½å·²ç»GAï¼Œä½†æ˜¯ä»‹äºRedis Streamçš„ç‰¹ç‚¹ï¼Œä½ éœ€è¦è°¨æ…ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œè¿™é‡Œåªæ˜¯å› ä¸ºæ˜¯æ¼”ç¤ºæ‰€ä»¥æ— æ‰€è°“ï¼š\n# redis-pubsub.yml apiVersion: dapr.io/v1alpha1 kind: Component metadata: name: redis-pubsub namespace: default spec: type: pubsub.redis version: v1 metadata: - name: redisHost value: 127.0.0.1:6379 - name: redisPassword value: \u0026#34;\u0026#34; - name: consumerID value: \u0026#34;myGroup\u0026#34; è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªstoreåå«åšredis-storeï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠä¸Šé¢çš„å‘½ä»¤ä¿®æ”¹ä¸€ä¸‹ï¼š\n# curl -X POST -H \u0026quot;Content-Type: application/json\u0026quot; -d '[{ \u0026quot;key\u0026quot;: \u0026quot;name\u0026quot;, \u0026quot;value\u0026quot;: \u0026quot;Bruce Wayne\u0026quot;}]' http://localhost:3500/v1.0/state/redis-store // è·å–å­˜å‚¨å†…å®¹ # curl http://localhost:3500/v1.0/state/redis-store/name \u0026quot;Bruce Wayne\u0026quot; åŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡redis-cliè·å–Redisä¸­å­˜å‚¨çš„å†…å®¹ï¼š\n# redis-cli 127.0.0.1:6379\u0026gt; keys * 1) \u0026quot;myapp||name\u0026quot; 127.0.0.1:6379\u0026gt; hgetall \u0026quot;myapp||name\u0026quot; 1) \u0026quot;data\u0026quot; 2) \u0026quot;\\\u0026quot;Bruce Wayne\\\u0026quot;\u0026quot; 3) \u0026quot;version\u0026quot; 4) \u0026quot;1\u0026quot; æˆ‘ä»¬åœ¨æ·»åŠ Redisä½œä¸ºå­˜å‚¨æ—¶è¿˜é¢å¤–æ·»åŠ äº†Redisæ”¯æŒå‘å¸ƒ/è®¢é˜…åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å¦‚ä½•å®ç°å‘¢ï¼Ÿè¿™é‡Œå¯èƒ½å°±éœ€è¦ç¼–å†™é¢å¤–ç¨‹åºå®ç°äº†ã€‚æˆ‘ä»¬è¿™é‡Œé‡‡ç”¨å®˜æ–¹çš„ä¾‹å­è¿›è¡Œã€‚è®¢é˜…åœ¨daprä¸­æœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ç§æ˜¯é‡‡ç”¨yamlå£°æ˜ç»„ä»¶å½¢å¼ï¼Œå¦å¤–ä¸€ç§åˆ™å¯ä»¥é€šè¿‡ç¼–å†™ä»£ç å½¢å¼å®ç°ã€‚å½“ç„¶ç¬¬ä¸€ç§æ–¹å¼å’Œç¬¬äºŒç§æ–¹å¼äº’æœ‰ä¼˜åŠ£ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºç›´è§‚æ€§ç›´æ¥é‡‡ç”¨äº†ç¼–å†™ä»£ç æ–¹å¼å®ç°ã€‚\npackage main import ( \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;github.com/gin-gonic/gin\u0026#34; ) func main() { r := gin.Default() r.GET(\u0026#34;/dapr/subscribe\u0026#34;, func(ctx *gin.Context) { ctx.JSON(http.StatusOK, []map[string]string{ { \u0026#34;pubsubname\u0026#34;: \u0026#34;redis-pubsub\u0026#34;, \u0026#34;topic\u0026#34;: \u0026#34;deathStarStatus\u0026#34;, \u0026#34;route\u0026#34;: \u0026#34;dsstatus\u0026#34;, }, }) }) r.POST(\u0026#34;/dsstatus\u0026#34;, func(c *gin.Context) { b, _ := io.ReadAll(c.Request.Body) defer c.Request.Body.Close() log.Println(string(b)) c.JSON(http.StatusOK, map[string]interface{}{\u0026#34;success\u0026#34;: true}) }) r.Run(\u0026#34;127.0.0.1:5000\u0026#34;) } ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨ç¼–è¯‘åçš„daprdemoï¼Œæ³¨æ„æŒ‡å®šæ–‡ä»¶åæ—¶éœ€è¦å¡«å†™è·¯å¾„æˆ–è€…åœ¨$PATHä¸­:\n# dapr --app-id subapp --app-port 5000 run ~/daprdemo åœ¨ç¨‹åºå¯åŠ¨æ—¥å¿—ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°daprä¼šå°è¯•è®¿é—®ä¸€äº›é»˜è®¤çš„endpointè¯»å–å¯èƒ½çš„é…ç½®ï¼š\nINFO[0000] application discovered on port 5000 app_id=subapp instance=127.0.0.1 scope=dapr.runtime type=log ver=1.0.1 == APP == [GIN] 2021/03/11 - 10:45:02 | 404 | 949ns | 127.0.0.1 | GET \u0026quot;/dapr/config\u0026quot; INFO[0000] application configuration loaded app_id=subapp instance=127.0.0.1 scope=dapr.runtime type=log ver=1.0.1 INFO[0000] actor runtime started. actor idle timeout: 1h0m0s. actor scan interval: 30s app_id=subapp instance=127.0.0.1 scope=dapr.runtime.actor type=log ver=1.0.1 == APP == [GIN] 2021/03/11 - 10:45:02 | 200 | 540.891Âµs | 127.0.0.1 | GET \u0026quot;/dapr/subscribe\u0026quot; INFO[0000] app is subscribed to the following topics: [deathStarStatus] through pubsub=redis-pubsub app_id=subapp instance=127.0.0.1 scope=dapr.runtime type=log ver=1.0.1 WARN[0000] redis streams: BUSYGROUP Consumer Group name already exists app_id=subapp instance=127.0.0.1 scope=dapr.contrib type=log ver=1.0.1 INFO[0000] dapr initialized. Status: Running. Init Elapsed 49.674504ms app_id=subapp instance=127.0.0.1 scope=dapr.runtime type=log ver=1.0.1 æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ä½¿ç”¨dapr-cliå¯¹æˆ‘ä»¬ä¹‹å‰å¯åŠ¨çš„myappå‘é€æ¶ˆæ¯ï¼š\ndapr publish --publish-app-id myapp --pubsub redis-pubsub --topic deathStarStatus --data '{\u0026quot;status\u0026quot;: \u0026quot;completed\u0026quot;}' åœ¨ç¨‹åºæ—¥å¿—ä¸­è·å–åˆ°çš„è¾“å‡ºä¸ºï¼š\n== APP == [GIN] 2021/03/11 - 10:45:05 | 200 | 122.15Âµs | 127.0.0.1 | POST \u0026quot;/dsstatus\u0026quot; == APP == 2021/03/11 10:45:05 {\u0026quot;id\u0026quot;:\u0026quot;9c237504-7cab-4a13-8582-92d9130fd016\u0026quot;,\u0026quot;source\u0026quot;:\u0026quot;myapp\u0026quot;,\u0026quot;pubsubname\u0026quot;:\u0026quot;redis-pubsub\u0026quot;,\u0026quot;traceid\u0026quot;:\u0026quot;00-fba669a086f84650e882e3cadc55082c-ea466c080e359e68-00\u0026quot;,\u0026quot;data\u0026quot;:{\u0026quot;status\u0026quot;:\u0026quot;completed\u0026quot;},\u0026quot;specversion\u0026quot;:\u0026quot;1.0\u0026quot;,\u0026quot;datacontenttype\u0026quot;:\u0026quot;application/json\u0026quot;,\u0026quot;type\u0026quot;:\u0026quot;com.dapr.event.sent\u0026quot;,\u0026quot;topic\u0026quot;:\u0026quot;deathStarStatus\u0026quot;} å½“ç„¶ï¼Œé™¤äº†pub/subæ–¹å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å€ŸåŠ©dapræä¾›çš„è·¯ç”±åŠŸèƒ½ï¼Œç›´æ¥è¿›è¡ŒæœåŠ¡è°ƒç”¨ï¼š\n# curl http://127.0.0.1:3500/v1.0/invoke/subapp/method/dsstatus -X POST {\u0026quot;success\u0026quot;:true} å…¶ä»–çš„ç»„ä»¶åŠŸèƒ½åˆ™å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ä¸­æè¿°è¿›è¡Œé…ç½®å³å¯ã€‚\næ€»ç»“ dapræ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„serverlessè¿è¡Œæ—¶ï¼Œé™¤äº†ä¸Šé¢æåˆ°çš„é¢å‘æ¶ˆæ¯å’Œè¯·æ±‚å­˜å‚¨çš„åŠŸèƒ½ä»¥å¤–ï¼Œè¿˜å¯ä»¥æ§åˆ¶ç¨‹åºçš„HTTPè¯·æ±‚ä¸gRPCè¯·æ±‚ç­‰ç­‰ã€‚é™¤äº†è¿™äº›åŠŸèƒ½å¤–ï¼Œè¿˜åŒ…å«äº†æœåŠ¡çš„ç®¡ç†ï¼Œè¿˜æœ‰å¯è§‚æµ‹æ€§æ”¯æŒç­‰åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªéå¸¸æœ‰æ½œåŠ›çš„è¿è¡Œæ—¶é€‰æ‹©ã€‚\n","date":"2021-03-11T18:38:00Z","permalink":"https://www.4async.com/2021/03/2021-03-11-running-dapr-without-container/","title":"åœ¨éå®¹å™¨(é›†ç¾¤)ç¯å¢ƒä¸‹è¿è¡Œdapr"},{"content":"åœ¨æˆ‘åæ§½äº†æ— æ•°æ¬¡ä¹‹åï¼ŒNATS JetStreamç»ˆäºç»“æŸäº†betaé˜¶æ®µæ­£å¼è¿›å…¥RCé˜¶æ®µã€‚ç»ˆäºå®˜æ–¹ä¹Ÿåœ¨æœ€è¿‘åˆšåˆšæ­£å¼å›å¤äº†æˆ‘æ­£å¼ç‰ˆæœ¬åœ¨å¤„ç†å‡ ä¸ªé—®é¢˜ä¹‹åå°±ä¼šæ­£å¼å‘å¸ƒã€‚é‚£ä¹ˆåœ¨è¿™ä¸ªæ¯”è¾ƒé‡è¦çš„NATS-Serverç‰¹æ€§å‘å¸ƒä¹‹é™…èŠä¸€ä¸‹NATSäº§å“æœ¬èº«åŒºåˆ«å’Œæ–°ç‰¹æ€§çš„ä½¿ç”¨ï¼Œè¿˜æœ‰æ›´å¤šçš„æ½œåœ¨çš„åŒºåˆ«ã€‚\næ¦‚å¿µåŒºåˆ†ï¼šNATS-Server / NATS Streaming Server / NATS JetStream NATS-Server NATS-Serverï¼ˆæˆ–è€…å«natsï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„ã€äº‘åŸç”Ÿçš„ã€é«˜æ€§èƒ½çš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œæ˜¯NATSçš„æœ€åŸºç¡€çš„äº§å“ã€‚å®ƒçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå‘å¸ƒ/è®¢é˜…ï¼ˆPub/Subï¼‰ç³»ç»Ÿï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨ä¸åŒé›†ç¾¤ä¸­çš„æœåŠ¡é—´natsè¿›è¡Œé€šè®¯ï¼Œè€Œä¸éœ€è¦å…³æ³¨å…·ä½“çš„æ¶ˆæ¯åœ¨å“ªä¸ªæœåŠ¡ä¸Šã€‚æ¢è€Œè¨€ä¹‹ï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨ä»»æ„ä¸€ä¸ªé›†ç¾¤çš„æœåŠ¡ç«¯ä¸Šå‘å¸ƒæ¶ˆæ¯ï¼ŒåŒæ—¶åœ¨ä»»æ„é›†ç¾¤å®¢æˆ·ç«¯ä¸Šå°è¯•è¯»å–æ¶ˆæ¯ã€‚åœ¨å®˜æ–¹ä¸å…¶ä»–åŒç±»æ¶ˆæ¯é˜Ÿåˆ—äº§å“åŠŸèƒ½å¯¹æ¯”ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç®¡çª¥ä¸€ä¸‹äº§å“çš„åŠŸèƒ½åˆ—è¡¨ã€‚natsæ”¯æŒå¤šæµå¤šæœåŠ¡è¿›è¡Œpub/subï¼Œè´Ÿè½½å‡è¡¡ï¼Œä¿éšœæ¶ˆæ¯æœ€å¤š/æœ€å°‘ä¸€æ¬¡é€è¾¾ï¼Œå¤šç§Ÿæˆ·å’Œç”¨æˆ·è®¤è¯ç­‰åŠŸèƒ½ã€‚è™½ç„¶çœ‹ä¸Šå»ä¼˜ç‚¹å¾ˆå¤šï¼Œä½†æ˜¯natsä¸æ˜¯ä¸€ä¸ªåº”ç”¨å¾ˆå¹¿çš„æ¶ˆæ¯é˜Ÿåˆ—çš„é‡è¦åŸå› æ˜¯ï¼Œå®ƒç¼ºå°‘äº†ä¸€äº›å¯¹æ¶ˆæ¯é˜Ÿåˆ—è€Œè¨€å¾ˆæœ€é‡è¦çš„äº§å“ç‰¹æ€§ï¼Œæ¯”å¦‚æŒä¹…åŒ–æ”¯æŒï¼Œæ¯”å¦‚æ¶ˆæ¯ç¡®ä¿ä¸€æ¬¡é€è¾¾ã€‚è¿™æ„å‘³ç€å½“ä½ çš„æ¶ˆæ¯å‘é€å‡ºå»ä¹‹åï¼Œä½ çš„æ¶ˆæ¯æ˜¯åœ¨å¤„ç†è¿‡ç¨‹ä¸­å¯èƒ½ä¸¢å¤±çš„ï¼Œç”šè‡³æ˜¯å¯èƒ½é€è¾¾ä¸åˆ°çš„ã€‚\nNATS Streaming Server NATS Streaming Serverï¼ˆæˆ–è€…å«stanï¼‰æ˜¯ç”¨äºå°è¯•è§£å†³ä¸Šé¢æåˆ°çš„natsçš„å·²å­˜åœ¨é—®é¢˜çš„ã€‚stanæ·»åŠ äº†æŒä¹…åŒ–åŠŸèƒ½å’Œæ¶ˆæ¯é€è¾¾ç­–ç•¥æ”¯æŒã€‚stanä¸­è‡ªå¸¦äº†natsæœåŠ¡ç«¯ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œnatså’Œstanä¸èƒ½è¿›è¡Œæ··ç”¨ã€‚åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæ˜¯è¿™ä¹ˆæè¿°stanå’Œnatsä¹‹é—´çš„å…³ç³»çš„ï¼š\n NATSå®¢æˆ·ç«¯å’ŒNATS Streaming Serverå®¢æˆ·ç«¯ä¹‹é—´ä¸èƒ½ç›¸äº’äº¤æ¢æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªNATS Streaming Serverå®¢æˆ·ç«¯åœ¨fooä¸Šå‘å¸ƒæ¶ˆæ¯ï¼Œåœ¨åŒä¸€ä¸»é¢˜ä¸Šè®¢é˜…çš„NATSå®¢æˆ·ç«¯å°†ä¸ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚NATS Streaming Serveræ¶ˆæ¯æ˜¯ç”±protobufç»„æˆçš„NATSæ¶ˆæ¯ã€‚NATS Streaming Serverè¦å‘ç”Ÿäº§è€…å‘é€ACKï¼Œå¹¶æ¥æ”¶æ¶ˆè´¹è€…çš„ACKã€‚å¦‚æœä¸NATSå®¢æˆ·ç«¯è‡ªç”±äº¤æ¢æ¶ˆæ¯ï¼Œå°±ä¼šå¼•èµ·é—®é¢˜ã€‚\n stançš„å…·ä½“æ¶æ„å¦‚ä¸‹å›¾ï¼š\nä½†æ˜¯stanè™½ç„¶æä¾›äº†æŒä¹…åŒ–å’Œæ¶ˆæ¯ä¼ é€’ç­–ç•¥æ”¯æŒï¼Œä½†æ˜¯åœ¨æ¶æ„è®¾è®¡ä¸Šå´å‡ºç°äº†é—®é¢˜ï¼Œå¯¼è‡´åœ¨æœ€å¼€å§‹è®¾è®¡æ—¶é—ç•™äº†å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚å½“ä½ ç¡®å®šstané›†ç¾¤æ˜¯å›ºå®šçš„ä¸èƒ½æ— é™åˆ¶æ°´å¹³æ‰©å®¹(#999)ï¼Œæ¯”å¦‚ä¸æ”¯æŒå¤šç§Ÿæˆ·åŠŸèƒ½(#1122)ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯æ— æ³•ä¸»åŠ¨æ‹‰å–æ¶ˆæ¯åªèƒ½è¢«æ¨é€ç­‰ç­‰\nNATS JetStream NATS JetStreamï¼ˆæˆ–è€…å«JetStreamï¼‰æ˜¯NATSåŸºäºRaftç®—æ³•å®ç°çš„æœ€æ–°çš„æ¶æ„è®¾è®¡å°è¯•è§£å†³ä¸Šè¿°é—®é¢˜çš„æ–°æ–¹æ¡ˆã€‚åœ¨åŒºåˆ«äºåŸæœ‰çš„stanåŠŸèƒ½ä¸Šï¼Œæä¾›äº†æ–°çš„æŒä¹…åŒ–åŠŸèƒ½å’Œæ¶ˆæ¯é€è¾¾ç­–ç•¥ï¼ŒåŒæ—¶æ”¯æŒæ°´å¹³æ‰©å®¹ã€‚åŒæ—¶ï¼Œæ–°çš„JetStreamä¹Ÿä¸ºå¤§æ¶ˆæ¯åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œä¸å†å°†è¿™ç‰¹æ€§åŠŸèƒ½ä½œä¸ºnatsçš„å®¢æˆ·ç«¯å­˜åœ¨è€Œæ˜¯åµŒå…¥NATS Serverä¸­ä½œä¸ºå…¶ä¸­çš„ä¸€ä¸ªåŠŸèƒ½å­˜åœ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨å¯¹è¿™å‡ é¡¹æŠ€æœ¯è¿›è¡Œé€‰æ‹©æ—¶ï¼ŒJetStreamåº”è¯¥æ˜¯æœ€åº”è¯¥è¢«é€‰æ‹©çš„æ–¹æ¡ˆã€‚æ›´å¤šè¯¦ç»†æƒ…å†µå…·ä½“å¯ä»¥æŸ¥çœ‹å®˜æ–¹çš„æŒ‡å¯¼æ–‡æ¡£ã€‚\nNATS JetStreamä½¿ç”¨ ç†è®ºä»‹ç»è¿‡äº†ï¼Œæ¥ä¸‹æ¥è¯´è¯´å®é™…ä½¿ç”¨çš„äº‹æƒ…ã€‚ç°åœ¨JetStreamè¿˜æ˜¯RCé˜¶æ®µï¼Œ\nç¼–è¯‘å’Œå¯åŠ¨å®¢æˆ·ç«¯ ä¸‹è½½nats-serveræºç ï¼Œè§£å‹ä¹‹åæ‰§è¡Œï¼š\ncd nats-server-master go build -o nats-server -ldflags=\u0026quot;-s -w -buildid=\u0026quot; . ./nats-server -js è¿™æ ·å°±å¯ä»¥å¯åŠ¨ä¸€ä¸ªæ”¯æŒJetStreamåŠŸèƒ½çš„æœåŠ¡ç«¯äº†ã€‚\n[54738] 2021/03/02 18:27:02.605197 [INF] Starting nats-server [54738] 2021/03/02 18:27:02.605236 [INF] Version: 2.2.0-RC.2 [54738] 2021/03/02 18:27:02.605238 [INF] Git: [not set] [54738] 2021/03/02 18:27:02.605239 [INF] Name: NAFWRGQTR2CHMBIKNPE6R3ZTW2BWV2FWPAZREMHI24IYVM6FVHMVIYLQ [54738] 2021/03/02 18:27:02.605240 [INF] ID: NAFWRGQTR2CHMBIKNPE6R3ZTW2BWV2FWPAZREMHI24IYVM6FVHMVIYLQ [54738] 2021/03/02 18:27:02.605658 [INF] Starting JetStream [54738] 2021/03/02 18:27:02.606062 [WRN] _ ___ _____ ___ _____ ___ ___ _ __ __ [54738] 2021/03/02 18:27:02.606076 [WRN] _ | | __|_ _/ __|_ _| _ \\ __| /_\\ | \\/ | [54738] 2021/03/02 18:27:02.606077 [WRN] | || | _| | | \\__ \\ | | | / _| / _ \\| |\\/| | [54738] 2021/03/02 18:27:02.606078 [WRN] \\__/|___| |_| |___/ |_| |_|_\\___/_/ \\_\\_| |_| [54738] 2021/03/02 18:27:02.606079 [WRN] [54738] 2021/03/02 18:27:02.606080 [WRN] _ _ [54738] 2021/03/02 18:27:02.606081 [WRN] | |__ ___| |_ __ _ [54738] 2021/03/02 18:27:02.606082 [WRN] | '_ \\/ -_) _/ _` | [54738] 2021/03/02 18:27:02.606083 [WRN] |_.__/\\___|\\__\\__,_| [54738] 2021/03/02 18:27:02.606084 [WRN] [54738] 2021/03/02 18:27:02.606084 [WRN] JetStream is a Beta feature [54738] 2021/03/02 18:27:02.606085 [WRN] https://github.com/nats-io/jetstream [54738] 2021/03/02 18:27:02.606092 [INF] [54738] 2021/03/02 18:27:02.606093 [INF] ----------- JETSTREAM ----------- [54738] 2021/03/02 18:27:02.606095 [INF] Max Memory: 12.00 GB [54738] 2021/03/02 18:27:02.606096 [INF] Max Storage: 35.79 GB [54738] 2021/03/02 18:27:02.606098 [INF] Store Directory: \u0026quot;/var/folders/5s/8rczg1gs4wb59y9s22nc3f_r0000gn/T/nats/jetstream\u0026quot; [54738] 2021/03/02 18:27:02.606099 [INF] --------------------------------- [54738] 2021/03/02 18:27:02.606399 [INF] Listening for client connections on 0.0.0.0:4222 [54738] 2021/03/02 18:27:02.606512 [INF] Server is ready ç¼–å†™JetStream DEMO æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨JetStreamè¿›è¡Œæ¶ˆæ¯å‘å¸ƒ/è®¢é˜…åŠŸèƒ½ï¼š\n// è¿æ¥åˆ°natsçš„æœåŠ¡å™¨ \tconn, err := nats.Connect(\u0026#34;nats://127.0.0.1:4222\u0026#34;) if err != nil { log.Panic(err) } defer conn.Close() // åˆå§‹åŒ–JetStreamåŠŸèƒ½ \tjs, err := conn.JetStream() if err != nil { log.Panic(err) } // åˆ¤æ–­Streamæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆéœ€è¦åˆ›å»ºè¿™ä¸ªStreamï¼Œå¦åˆ™ä¼šå¯¼è‡´pub/subå¤±è´¥ \tstream, err := js.StreamInfo(streamName) if err != nil { log.Println(err) // å¦‚æœä¸å­˜åœ¨ï¼Œè¿™é‡Œä¼šæœ‰æŠ¥é”™ \t} if stream == nil { log.Printf(\u0026#34;creating stream %q and subject %q\u0026#34;, streamName, subject) _, err = js.AddStream(\u0026amp;nats.StreamConfig{ Name: streamName, Subjects: []string{subject}, MaxAge: 3 * 24 * time.Hour, }) if err != nil { log.Panicln(err) } } // è®¢é˜…æ¶ˆæ¯ \tsub, err := js.Subscribe(subject, cbHandle, nats.AckAll(), nats.DeliverNew()) if err != nil { log.Panic(err) return } defer sub.Unsubscribe() // å‘é€æ¶ˆæ¯ \tjs.Publish(subject, []byte(\u0026#34;Hello World! \u0026#34;+time.Now().Format(time.RFC3339))) time.Sleep(5 * time.Second) log.Println(\u0026#34;Exiting...\u0026#34;) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰ä¸ªå€¼å¾—æ³¨æ„çš„åŠŸèƒ½éœ€è¦é¢å¤–å¼ºè°ƒä¸€ä¸‹ï¼Œåœ¨Subscribeæ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œç‰¹åˆ«å£°æ˜äº†nats.DeliverNew()è¿™ä¸ªé€‰é¡¹ã€‚å¦‚æœä¸å£°æ˜ï¼Œåˆ™é»˜è®¤ä¸ºnats.DeliverAll()ï¼›é™¤äº†è¿™ä¸¤ä¸ªå‚æ•°ï¼Œè¿˜æœ‰ä¸€ä¸ªnats.DeliverLast()å‚æ•°ï¼Œè¿™åˆ†åˆ«å¯¹åº”äº†3ç§å¼€å§‹è®¢é˜…æ—¶çš„æ–¹å¼ï¼šé»˜è®¤æ–¹å¼nats.DeliverAll()æ˜¯ä¼šè¯»å–æœ‰æ•ˆç”Ÿå‘½å‘¨æœŸå†…çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œç”šè‡³åŒ…å«å·²è¢«å¤„ç†çš„æ¶ˆæ¯ï¼›nats.DeliverLast()æ˜¯ä¼šåŒ…å«æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æœ€åä¸€æ¡æ¶ˆæ¯ï¼Œå³ä½¿è¢«å¤„ç†è¿‡çš„æ¶ˆæ¯ï¼›nats.DeliverNew()åˆ™åªå¤„ç†è®¢é˜…ä¹‹åçš„æ–°æ¶ˆæ¯ã€‚\n","date":"2021-03-02T18:38:00Z","permalink":"https://www.4async.com/2021/03/2021-03-02-nats-server-usage/","title":"NATS-Server(JetStream)å’ŒNATS Streaming Serverå¯¹æ¯”"},{"content":"åŸæ–‡åœ°å€ï¼šhttps://blog.golang.org/context-and-structs åŸæ–‡ä½œè€…ï¼šJean de Klerk, Matt T. Proud è¯‘è€…ï¼šKevin ä»‹ç´¹ åœ¨è®¸å¤šGo APIä¸­ï¼Œå°¤å…¶æ˜¯ç°ä»£çš„APIä¸­ï¼Œå‡½æ•°å’Œæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°é€šå¸¸æ˜¯context.Contextã€‚ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œç”¨äºè·¨APIè¾¹ç•Œå’Œè¿›ç¨‹ä¹‹é—´ä¼ è¾“æˆªæ­¢æ—¶é—´ã€è°ƒç”¨è€…å–æ¶ˆå’Œå…¶ä»–è¯·æ±‚èŒƒå›´çš„å€¼ã€‚å½“ä¸€ä¸ªåº“ä¸è¿œç¨‹æœåŠ¡å™¨ï¼ˆå¦‚æ•°æ®åº“ã€APIç­‰ï¼‰ç›´æ¥æˆ–é—´æ¥äº¤äº’æ—¶ï¼Œç»å¸¸ä¼šç”¨åˆ°å®ƒã€‚\nåœ¨contextçš„æ–‡æ¡£ä¸­å†™é“ã€‚\nä¸Šä¸‹æ–‡ä¸åº”è¯¥å­˜å‚¨åœ¨ç»“æ„ç±»å‹é‡Œé¢ï¼Œè€Œæ˜¯ä¼ é€’ç»™æ¯ä¸ªéœ€è¦å®ƒçš„å‡½æ•°ã€‚  æœ¬æ–‡å¯¹è¿™ä¸€å»ºè®®è¿›è¡Œäº†æ‰©å±•ï¼Œç”¨å…·ä½“ä¾‹å­è§£æä¸ºä»€ä¹ˆä¼ é€’ä¸Šä¸‹æ–‡è€Œä¸æ˜¯å°†å…¶å­˜å‚¨åœ¨å…¶ä»–ç±»å‹ä¸­å¾ˆé‡è¦ã€‚å®ƒè¿˜å¼ºè°ƒäº†ä¸€ç§ç½•è§çš„æƒ…å†µï¼Œå³åœ¨ç»“æ„ç±»å‹ä¸­å­˜å‚¨ä¸Šä¸‹æ–‡å¯èƒ½æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä»¥åŠå¦‚ä½•å®‰å…¨åœ°è¿™æ ·åšã€‚\nå€¾å‘äºå°†ä¸Šä¸‹æ–‡ä½œä¸ºå‚æ•°ä¼ é€’ ä¸ºäº†æ·±å…¥ç†è§£ä¸åœ¨ç»“æ„ä¸­å­˜å‚¨ä¸Šä¸‹æ–‡çš„å»ºè®®ï¼Œæˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸‹é¦–é€‰çš„ä¸Šä¸‹æ–‡ä½œä¸ºå‚æ•°çš„æ–¹æ³•ã€‚\ntype Worker struct { /* â€¦ */ } type Work struct { /* â€¦ */ } func New() *Worker { return \u0026amp;Worker{} } func (w *Worker) Fetch(ctx context.Context) (*Work, error) { _ = ctx // æ¯æ¬¡è°ƒç”¨ä¸­ctxç”¨äºå–æ¶ˆæ“ä½œï¼Œæˆªæ­¢æ—¶é—´å’Œå…ƒæ•°æ®ã€‚ } func (w *Worker) Process(ctx context.Context, w *Work) error { _ = ctx // Aæ¯æ¬¡è°ƒç”¨ä¸­ctxç”¨äºå–æ¶ˆæ“ä½œï¼Œæˆªæ­¢æ—¶é—´å’Œå…ƒæ•°æ®ã€‚ } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ(*Worker).Fetchå’Œ(*Worker).Processæ–¹æ³•éƒ½ç›´æ¥æ¥å—ä¸Šä¸‹æ–‡ã€‚é€šè¿‡è¿™ç§é€šè¿‡å‚æ•°ä¼ é€’çš„è®¾è®¡ï¼Œç”¨æˆ·å¯ä»¥è®¾ç½®æ¯æ¬¡è°ƒç”¨çš„æˆªæ­¢æ—¶é—´ã€å–æ¶ˆå’Œå…ƒæ•°æ®ã€‚è€Œä¸”ï¼Œå¾ˆæ¸…æ¥šä¼ é€’ç»™æ¯ä¸ªæ–¹æ³•çš„context.Contextå°†å¦‚ä½•è¢«ä½¿ç”¨ï¼šæ²¡æœ‰æœŸæœ›ä¼ é€’ç»™ä¸€ä¸ªæ–¹æ³•çš„context.Contextå°†è¢«ä»»ä½•å…¶ä»–æ–¹æ³•ä½¿ç”¨ã€‚è¿™æ˜¯å› ä¸ºä¸Šä¸‹æ–‡çš„èŒƒå›´è¢«é™å®šåœ¨äº†å°èŒƒå›´çš„å¿…é¡»æ“ä½œå†…ï¼Œè¿™å¤§å¤§å¢åŠ äº†è¿™ä¸ªåŒ…ä¸­ä¸Šä¸‹æ–‡çš„å®ç”¨æ€§å’Œæ¸…æ™°åº¦ã€‚\nå°†ä¸Šä¸‹æ–‡å­˜å‚¨åœ¨ç»“æ„ä¸­ä¼šå¯¼è‡´æ··ä¹± è®©æˆ‘ä»¬å†æ¬¡ä½¿ç”¨ä¸Šä¸‹æ–‡å­˜å‚¨åœ¨ç»“æ„ä½“ä¸­è¿™ç§æ–¹å¼å®¡è§†ä¸€ä¸‹ä¸Šé¢çš„Workerä¾‹å­ã€‚å®ƒçš„é—®é¢˜æ˜¯ï¼Œå½“ä½ æŠŠä¸Šä¸‹æ–‡å­˜å‚¨åœ¨ä¸€ä¸ªç»“æ„ä¸­æ—¶ï¼Œä½ ä¼šå‘è°ƒç”¨è€…éšè—å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œç”šè‡³å¯èƒ½çš„æ˜¯æŠŠä¸¤ä¸ªä¸åŒçš„ä½œç”¨åŸŸä»¥ä¸å¯é¢„æ–™çš„æ–¹å¼äº’ç›¸å¹²æ‰°ï¼š\ntype Worker struct { ctx context.Context } func New(ctx context.Context) *Worker { return \u0026amp;Worker{ctx: ctx} } func (w *Worker) Fetch() (*Work, error) { _ = w.ctx // å…±äº«çš„w.ctxç”¨äºå–æ¶ˆæ“ä½œï¼Œæˆªæ­¢æ—¶é—´å’Œå…ƒæ•°æ®ã€‚ } func (w *Worker) Process(w *Work) error { _ = w.ctx // å…±äº«çš„w.ctxç”¨äºå–æ¶ˆæ“ä½œï¼Œæˆªæ­¢æ—¶é—´å’Œå…ƒæ•°æ®ã€‚ } (*Worker).Fetchå’Œ(*Worker).Processæ–¹æ³•éƒ½ä½¿ç”¨å­˜å‚¨åœ¨Workerä¸­çš„ä¸Šä¸‹æ–‡ã€‚è¿™é˜²æ­¢äº†Fetchå’ŒProcessçš„è°ƒç”¨è€…ï¼ˆå®ƒä»¬æœ¬èº«å¯èƒ½æœ‰ä¸åŒçš„ä¸Šä¸‹æ–‡ï¼‰åœ¨æ¯æ¬¡è°ƒç”¨çš„åŸºç¡€ä¸ŠæŒ‡å®šæˆªæ­¢æ—¥æœŸã€è¯·æ±‚å–æ¶ˆå’Œé™„åŠ å…ƒæ•°æ®ã€‚ä¾‹å¦‚ï¼šç”¨æˆ·æ— æ³•åªä¸º(*Worker).Fetchæä¾›æˆªæ­¢æ—¥æœŸï¼Œä¹Ÿæ— æ³•åªå–æ¶ˆ(*Worker).Processçš„è°ƒç”¨ã€‚è°ƒç”¨è€…çš„ç”Ÿå‘½æœŸä¸å…±äº«ä¸Šä¸‹æ–‡äº¤ç»‡åœ¨ä¸€èµ·ï¼Œä¸Šä¸‹æ–‡çš„èŒƒå›´æ˜¯åˆ›å»ºWorkerçš„ç”Ÿå‘½å‘¨æœŸã€‚\nä¸ä¸Šä¸‹æ–‡ä½œä¸ºå‚æ•°çš„æ–¹æ³•ç›¸æ¯”ï¼Œè¯¥APIä¹Ÿæ›´å®¹æ˜“è®©ç”¨æˆ·æ„Ÿåˆ°ç–‘æƒ‘ã€‚ç”¨æˆ·å¯èƒ½ä¼šé—®è‡ªå·±ï¼š\n æ—¢ç„¶Newéœ€è¦ä¸€ä¸ªcontext.Contextï¼Œé‚£ä¹ˆæ„é€ å‡½æ•°æ˜¯å¦åœ¨åšå–æ¶ˆæˆ–æˆªæ­¢æ—¶é—´æ§åˆ¶çš„å·¥ä½œï¼Ÿ Newä¼ é€’è¿›æ¥çš„context.Contextæ˜¯å¦é€‚ç”¨äº(*Worker).Fetchå’Œ(*Worker).Processï¼Ÿéƒ½ä¸é€‚ç”¨ï¼Ÿæœ‰ä¸€ä¸ªè€Œæ²¡æœ‰å¦ä¸€ä¸ªï¼Ÿ  APIéœ€è¦å¤§é‡çš„æ–‡æ¡£æ¥æ˜ç¡®å‘Šè¯‰ç”¨æˆ·context.Contextåˆ°åº•æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ã€‚ç”¨æˆ·å¯èƒ½è¿˜éœ€è¦é˜…è¯»ä»£ç ï¼Œè€Œä¸æ˜¯èƒ½å¤Ÿä¾é APIç»“æ„è·å¾—ä¿¡æ¯ã€‚\næœ€åï¼Œå¦‚æœè®¾è®¡ä¸€ä¸ªç”Ÿäº§çº§æœåŠ¡å™¨ï¼Œå…¶æ¯ä¸ªè¯·æ±‚æ²¡æœ‰ä¸Šä¸‹æ–‡ï¼Œä»è€Œä¸èƒ½å……åˆ†é‡è§†å–æ¶ˆæ“ä½œï¼Œè¿™å¯èƒ½æ˜¯ç›¸å½“å±é™©çš„ã€‚å¦‚æœæ²¡æœ‰èƒ½åŠ›è®¾ç½®æ¯ä¸ªè°ƒç”¨çš„æˆªæ­¢æ—¥æœŸï¼Œä½ çš„è¿›ç¨‹å¯èƒ½ä¼šç§¯å‹èµ„æºå¹¶å¯¼è‡´èµ„æºè€—å°½ï¼ˆå¦‚å†…å­˜ï¼‰!\nè§„åˆ™çš„ä¾‹å¤–ï¼šä¿å­˜å‘åçš„å…¼å®¹æ€§ å½“å¼•å…¥context.Contextçš„Go 1.7å‘å¸ƒæ—¶ï¼Œå¤§é‡çš„ API å¿…é¡»ä»¥å‘åå…¼å®¹çš„æ–¹å¼æ·»åŠ ä¸Šä¸‹æ–‡æ”¯æŒã€‚ä¾‹å¦‚ï¼Œnet/httpçš„Clientæ–¹æ³•ï¼Œå¦‚Getå’ŒDoï¼Œå°±æ˜¯å¾ˆå¥½çš„ä¸Šä¸‹æ–‡å–æ¶ˆæ“ä½œçš„åº”ç”¨ã€‚æ¯ä¸€ä¸ªç”¨è¿™äº›æ–¹æ³•å‘é€çš„å¤–éƒ¨è¯·æ±‚éƒ½ä¼šå—ç›Šäºcontext.Contextå¸¦æ¥çš„æˆªæ­¢æ—¶é—´ã€å–æ¶ˆå’Œå…ƒæ•°æ®æ”¯æŒã€‚\næœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä»¥å‘åå…¼å®¹çš„æ–¹å¼æ·»åŠ å¯¹context.Contextçš„æ”¯æŒï¼šå°†ä¸Šä¸‹æ–‡åŒ…åœ¨ä¸€ä¸ªç»“æ„ä¸­ï¼Œæ­£å¦‚æˆ‘ä»¬ç¨åå°†çœ‹åˆ°çš„é‚£æ ·ï¼›å¤åˆ¶å‡½æ•°ï¼Œå¤åˆ¶çš„å‡½æ•°æ¥å—context.Contextä½œä¸ºå‚æ•°ï¼Œå¹¶å°†Contextä½œä¸ºå…¶å‡½æ•°åçš„åç¼€ã€‚å¤åˆ¶çš„æ–¹æ³•åº”è¯¥æ¯”åœ¨ç»“æ„ä½“ä¸­åµŒå…¥ä¸Šä¸‹æ–‡çš„æ–¹å¼æ›´å¯å–ï¼Œåœ¨ä¿æŒæ¨¡å—çš„å…¼å®¹æ€§ä¸­ä¼šè¿›ä¸€æ­¥è®¨è®ºã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸åˆ‡å®é™…çš„ï¼šä¾‹å¦‚ï¼Œå¦‚æœä½ çš„APIæš´éœ²äº†å¤§é‡çš„å‡½æ•°ï¼Œé‚£ä¹ˆå¤åˆ¶æ‰€æœ‰çš„å‡½æ•°å¯èƒ½æ˜¯ä¸å¯è¡Œçš„ã€‚\nnet/httpåŒ…é€‰æ‹©äº†ä¸Šä¸‹æ–‡å­˜å‚¨åœ¨ç»“æ„ä½“æ–¹å¼ï¼Œè¿™æä¾›äº†ä¸€ä¸ªæœ‰ç”¨çš„æ¡ˆä¾‹ç ”ç©¶ã€‚è®©æˆ‘ä»¬çœ‹çœ‹net/httpçš„Doæ–¹æ³•ã€‚åœ¨å¼•å…¥context.Contextä¹‹å‰ï¼ŒDoçš„å®šä¹‰å¦‚ä¸‹ï¼š\nfunc (c *Client) Do(req *Request) (*Response, error) åœ¨Go 1.7ä¹‹åï¼Œå¦‚æœä¸è€ƒè™‘ç ´åå‘åçš„å…¼å®¹æ€§çš„é—®é¢˜ï¼ŒDoå¯èƒ½çœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ï¼š\nfunc (c *Client) Do(ctx context.Context, req *Request) (*Response, error) ä½†æ˜¯ï¼Œä¿ç•™å‘åçš„å…¼å®¹æ€§ï¼Œéµå®ˆGo 1çš„å…¼å®¹æ€§æ‰¿è¯ºå¯¹äºæ ‡å‡†åº“æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ã€‚æ‰€ä»¥ï¼Œç»´æŠ¤è€…é€‰æ‹©åœ¨http.Requestç»“æ„ä¸Šæ·»åŠ ä¸€ä¸ªcontext.Contextï¼Œä»¥ä¾¿åœ¨ä¸ç ´åå‘åå…¼å®¹æ€§çš„æƒ…å†µä¸‹æ”¯æŒcontext.Contextï¼š\ntype Request struct { ctx context.Context // ... } func NewRequestWithContext(ctx context.Context, method, url string, body io.Reader) (*Request, error) { // ä¸ºäº†æœ¬æ–‡æ¼”ç¤ºéœ€è¦åšäº†ç®€åŒ–ã€‚  return \u0026amp;Request{ ctx: ctx, // ...  } } func (c *Client) Do(req *Request) (*Response, error) å½“æ”¹é€ ä½ çš„APIä»¥æ”¯æŒä¸Šä¸‹æ–‡æ—¶ï¼Œåƒä¸Šé¢é‚£æ ·åœ¨ä¸€ä¸ªç»“æ„ä¸­æ·»åŠ ä¸€ä¸ªcontext.Contextå¯èƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚ä½†æ˜¯ï¼Œä½ éœ€è¦é¦–å…ˆè€ƒè™‘å¤åˆ¶ä½ çš„å‡½æ•°ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸ç‰ºç‰²å®ç”¨æ€§å’Œç†è§£æ€§çš„å‰æä¸‹ï¼Œå‘åå…¼å®¹åœ°æ”¹é€ context.Contextã€‚ä¾‹å¦‚ï¼š\nfunc (c *Client) Call() error { return c.CallContext(context.Background()) } func (c *Client) CallContext(ctx context.Context) error { // ... } æ€»ç»“ ä¸Šä¸‹æ–‡ä½¿å¾—é‡è¦çš„è·¨åº“å’Œè·¨APIä¿¡æ¯å¾ˆå®¹æ˜“åœ¨è°ƒç”¨æ ˆä¸­ä¼ æ’­ã€‚ä½†æ˜¯ï¼Œä¸ºäº†ä¿æŒå¯ç†è§£æ€§ã€æ˜“è°ƒè¯•æ€§å’Œæœ‰æ•ˆæ€§ï¼Œå¿…é¡»ç»Ÿä¸€æ¸…æ™°åœ°ä½¿ç”¨å®ƒã€‚\nå½“ä½œä¸ºæ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°è€Œä¸æ˜¯å­˜å‚¨åœ¨ç»“æ„ç±»å‹ä¸­æ—¶ï¼Œç”¨æˆ·å¯ä»¥å……åˆ†åˆ©ç”¨å®ƒçš„å¯æ‰©å±•æ€§ï¼Œä»¥ä¾¿é€šè¿‡è°ƒç”¨æ ˆå»ºç«‹ä¸€ä¸ªå¼ºå¤§çš„å–æ¶ˆã€æˆªæ­¢æ—¥æœŸå’Œå…ƒæ•°æ®ä¿¡æ¯æ ‘ã€‚è€Œä¸”ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œå½“å®ƒä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’è¿›æ¥æ—¶ï¼Œå®ƒçš„èŒƒå›´è¢«æ¸…æ™°çš„ç†è§£ï¼Œä»è€Œå¯¼è‡´å †æ ˆä¸Šä¸‹çš„ç†è§£æ›´åŠ æ¸…æ™°å’Œè°ƒè¯•æ›´åŠ å®¹æ˜“ã€‚\nå½“è®¾è®¡ä¸€ä¸ªå¸¦æœ‰ä¸Šä¸‹æ–‡çš„APIæ—¶ï¼Œè¯·è®°ä½è¿™æ ·çš„å»ºè®®ï¼šå°†context.Contextä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’è¿›æ¥ï¼Œä¸è¦å°†å®ƒå­˜å‚¨åœ¨ç»“æ„ä½“ä¸­ã€‚\n","date":"2021-02-25T10:30:00Z","permalink":"https://www.4async.com/2021/02/2021-02-25-context-and-structs/","title":"ä¸Šä¸‹æ–‡Contextä¸ç»“æ„ä½“Struct"},{"content":"å…¶å®å¾ˆæ—©ä¹‹å‰å°±å¸Œæœ›åˆ‡æ¢è‡³Hugoå¼•æ“é©±åŠ¨åšå®¢äº†ï¼Œä½†æ˜¯ä½“éªŒä¸‹æ¥ä¸€åœˆï¼Œæœ€å¤§çš„æ„Ÿè§‰æ˜¯Hugoçš„ä¸»é¢˜éƒ½å¾ˆä¸€è¨€éš¾å°½\u0026hellip;æ‰€ä»¥æ‹–ç€ä¸€ç›´æ²¡æœ‰åˆ‡æ¢ã€‚ç»“æœä»Šå¤©æƒ³å‘å¸ƒæ–°æ–‡ç« æ—¶çªç„¶å‘ç°æˆ‘æ— æ³•æ­£å¸¸ç¼–è¯‘Hexoçš„é¡¹ç›®äº†ï¼Œäºæ˜¯å¹²è„†è¶æ­¤è‰¯æœºåˆ‡æ¢è‡³Hugoå¼•æ“äº†ã€‚\næœ¬ç«™ç›®å‰ä½¿ç”¨çš„ä¸»é¢˜æ˜¯stackä¸»é¢˜ï¼Œç›¸å½“ç®€æ´ï¼Œæ¨èæƒ³åˆ‡æ¢è‡³Hugoçš„å°ä¼™ä¼´äº†è§£ä¸€ä¸‹ã€‚\nå¦å¤–æä¾›ä¸€ä¸‹å¿«é€Ÿè¿›è¡ŒGithub Actionéƒ¨ç½²çš„æ–¹æ¡ˆï¼ˆç§æœ‰åŒ–ä»“åº“ä»£ç /å…¬æœ‰åŒ–ä»“åº“ç½‘ç«™å±•ç¤ºï¼‰ï¼ŒPERSONAL_TOKENæ˜¯ä¸ªäººtokenï¼Œéœ€è¦ä»ä¸ªäººè®¾ç½®é¡µé¢é‡Œè·å–å¡«å†™è‡³ä»“åº“Secretsä¸­ï¼š\nname: github pages on: push: branches: - master jobs: deploy: runs-on: ubuntu-20.04 steps: - uses: actions/checkout@v2 - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#39;latest\u0026#39; - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: personal_token: ${{ secrets.PERSONAL_TOKEN }} external_repository: ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“ publish_dir: ./public cname: ä½ çš„åŸŸå ","date":"2021-02-19T16:27:00Z","permalink":"https://www.4async.com/2021/02/2021-02-19-move-to-hugo/","title":"åˆ‡æ¢è‡³Hugoå¼•æ“é©±åŠ¨"},{"content":"åŸæ–‡åœ°å€ï¼šhttps://blog.golang.org/go116-module-changes åŸæ–‡ä½œè€…ï¼šJay Conrod è¯‘è€…ï¼šKevin å¸Œæœ›æ‚¨å–œæ¬¢Go 1.16! è¿™ä¸ªç‰ˆæœ¬æœ‰å¾ˆå¤šæ–°åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯å¯¹Moduleè€Œè¨€ã€‚å‘è¡Œè¯´æ˜ä¸­ç®€è¦ä»‹ç»äº†è¿™äº›å˜åŒ–ï¼Œä½†è®©æˆ‘ä»¬æ·±å…¥å‘æ˜ä¸€ä¸‹å…¶ä¸­çš„ä¸€äº›å˜åŒ–ã€‚\nModuleåŠŸèƒ½é»˜è®¤å¼€å¯ goå‘½ä»¤ç°åœ¨é»˜è®¤ä»¥module-awareæ¨¡å¼æ„å»ºåŒ…ï¼Œå³ä½¿æ²¡æœ‰go.modæ–‡ä»¶å­˜åœ¨ã€‚è¿™æ˜¯å‘åœ¨æ‰€æœ‰é¡¹ç›®ä¸­ä½¿ç”¨ModuleåŠŸèƒ½è¿ˆå‡ºçš„ä¸€å¤§æ­¥ã€‚\né€šè¿‡è®¾ç½®GO111MODULEç¯å¢ƒå˜é‡ä¸ºoffï¼Œä»ç„¶å¯ä»¥åœ¨GOPATHæ¨¡å¼ä¸‹æ„å»ºåŒ…ã€‚ä½ ä¹Ÿå¯ä»¥å°†GO111MODULEè®¾ç½®ä¸ºautoï¼Œåªæœ‰å½“å½“å‰ç›®å½•æˆ–ä»»ä½•çˆ¶ç›®å½•ä¸­å­˜åœ¨go.modæ–‡ä»¶æ—¶æ‰å¯ç”¨module-awareæ¨¡å¼ã€‚è¿™åœ¨ä»¥å‰æ˜¯é»˜è®¤çš„ã€‚è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨go env -wæ¥æ°¸ä¹…åœ°è®¾ç½®GO111MODULEå’Œå…¶ä»–å˜é‡ã€‚\ngo env -w GO111MODULE=auto æˆ‘ä»¬è®¡åˆ’åœ¨ Go 1.17 ä¸­æ”¾å¼ƒå¯¹GOPATHæ¨¡å¼çš„æ”¯æŒã€‚æ¢å¥è¯è¯´ï¼ŒGo 1.17å°†å¿½ç•¥GO111MODULEã€‚å¦‚æœæ‚¨çš„é¡¹ç›®æ²¡æœ‰ä»¥module-awareæ¨¡å¼æ„å»ºï¼Œç°åœ¨æ˜¯æ—¶å€™è¿ç§»äº†ã€‚å¦‚æœæœ‰é—®é¢˜å¦¨ç¢æ‚¨è¿ç§»ï¼Œè¯·è€ƒè™‘æäº¤é—®é¢˜æˆ–ä½“éªŒæŠ¥å‘Šã€‚\nä¸ä¼šè‡ªåŠ¨æ›´æ”¹ go.mod å’Œ go.sum åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå½“goå‘½ä»¤å‘ç°go.modæˆ–go.sumæœ‰é—®é¢˜æ—¶ï¼Œæ¯”å¦‚ç¼ºå°‘requireæŒ‡ä»¤æˆ–ç¼ºå°‘sumï¼Œå®ƒä¼šå°è¯•è‡ªåŠ¨ä¿®å¤é—®é¢˜ã€‚æˆ‘ä»¬æ”¶åˆ°äº†å¾ˆå¤šåé¦ˆï¼Œè®¤ä¸ºè¿™ç§è¡Œä¸ºæ˜¯å‡ºä¹å¤§å®¶æ„æ–™çš„ï¼Œå°¤å…¶æ˜¯å¯¹äºåƒgo listè¿™æ ·é€šå¸¸ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨çš„å‘½ä»¤ã€‚è‡ªåŠ¨ä¿®å¤å¹¶ä¸æ€»æ˜¯å¯å–çš„ï¼šå¦‚æœä¸€ä¸ªå¯¼å…¥çš„åŒ…æ²¡æœ‰è¢«ä»»ä½•éœ€è¦çš„Moduleæä¾›ï¼Œgoå‘½ä»¤ä¼šæ·»åŠ ä¸€ä¸ªæ–°çš„ä¾èµ–å…³ç³»ï¼Œå¯èƒ½ä¼šè§¦å‘æ™®é€šä¾èµ–å…³ç³»çš„å‡çº§ã€‚å³ä½¿æ˜¯æ‹¼å†™é”™è¯¯çš„å¯¼å…¥è·¯å¾„ä¹Ÿä¼šå¯¼è‡´ï¼ˆå¤±è´¥çš„ï¼‰ç½‘ç»œæŸ¥æ‰¾ã€‚\nåœ¨ Go 1.16 ä¸­ï¼Œmodule-awareå‘½ä»¤åœ¨å‘ç°go.modæˆ–go.sumä¸­çš„é—®é¢˜åä¼šæŠ¥å‘Šä¸€ä¸ªé”™è¯¯ï¼Œè€Œä¸æ˜¯å°è¯•è‡ªåŠ¨ä¿®å¤é—®é¢˜ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”™è¯¯ä¿¡æ¯å»ºè®®ä½¿ç”¨å‘½ä»¤æ¥ä¿®å¤é—®é¢˜ã€‚\n$ go build example.go:3:8: no required module provides package golang.org/x/net/html; to add it: go get golang.org/x/net/html $ go get golang.org/x/net/html $ go build å’Œä¹‹å‰ä¸€æ ·ï¼Œå¦‚æœå­˜åœ¨vendorç›®å½•ï¼Œgoå‘½ä»¤å¯èƒ½ä¼šä½¿ç”¨è¯¥ç›®å½•ï¼ˆè¯¦è§Vendoringï¼‰ã€‚åƒgo getå’Œgo mod tidyè¿™æ ·çš„å‘½ä»¤ä»ç„¶ä¼šä¿®æ”¹go.modå’Œgo.sumï¼Œå› ä¸ºå®ƒä»¬çš„ä¸»è¦ç›®çš„æ˜¯ç®¡ç†ä¾èµ–å…³ç³»ã€‚\nåœ¨ç‰¹å®šç‰ˆæœ¬ä¸Šå®‰è£…å¯æ‰§è¡Œæ–‡ä»¶ go installå‘½ä»¤ç°åœ¨å¯ä»¥é€šè¿‡æŒ‡å®š@versionåç¼€æ¥å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚\ngo install golang.org/x/tools/gopls@v0.6.5 å½“ä½¿ç”¨è¿™ç§è¯­æ³•æ—¶ï¼Œgo installå‘½ä»¤ä¼šä»è¯¥Moduleçš„åˆ¶å®šç‰ˆæœ¬å®‰è£…ï¼Œè€Œå¿½ç•¥å½“å‰ç›®å½•å’Œçˆ¶ç›®å½•ä¸­çš„ä»»ä½• go.mod æ–‡ä»¶ã€‚(å¦‚æœæ²¡æœ‰@versionåç¼€ï¼Œgo installä¼šåƒå¾€å¸¸ä¸€æ ·ç»§ç»­è¿è¡Œï¼Œä½¿ç”¨å½“å‰Moduleçš„go.modä¸­åˆ—å‡ºçš„ç‰ˆæœ¬è¦æ±‚å’Œæ›¿æ¢æ¥æ„å»ºç¨‹åºã€‚)\næˆ‘ä»¬æ›¾ç»æ¨èä½¿ç”¨go get -uç¨‹åºæ¥å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½†è¿™ç§ä½¿ç”¨æ–¹å¼å¯¹go.modä¸­æ·»åŠ æˆ–æ›´æ”¹Moduleç‰ˆæœ¬éœ€æ±‚çš„æ„ä¹‰é€ æˆäº†å¤ªå¤šçš„æ··æ·†ã€‚è€Œä¸ºäº†é¿å…æ„å¤–ä¿®æ”¹go.modï¼Œäººä»¬å¼€å§‹å»ºè®®ä½¿ç”¨æ›´å¤æ‚çš„å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š\ncd $HOME; GO111MODULE=on go get program@latest ç°åœ¨æˆ‘ä»¬éƒ½å¯ä»¥ç”¨go install program@latestæ¥ä»£æ›¿ã€‚è¯¦æƒ…è¯·çœ‹go installã€‚\nä¸ºäº†æ¶ˆé™¤ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„æ­§ä¹‰ï¼Œå½“ä½¿ç”¨è¿™ç§å®‰è£…è¯­æ³•æ—¶ï¼Œå¯¹ç¨‹åºçš„go.modæ–‡ä»¶ä¸­å¯èƒ½å­˜åœ¨çš„æŒ‡ä»¤æœ‰ä¸€äº›é™åˆ¶ã€‚ç‰¹åˆ«æ˜¯ï¼Œè‡³å°‘åœ¨ç›®å‰ï¼Œæ›¿æ¢å’Œæ’é™¤æŒ‡ä»¤æ˜¯ä¸å…è®¸çš„ã€‚ä»é•¿è¿œæ¥çœ‹ï¼Œä¸€æ—¦æ–°çš„go install program@versionåœ¨è¶³å¤Ÿå¤šçš„ç”¨ä¾‹ä¸­è¿è¡Œè‰¯å¥½ï¼Œæˆ‘ä»¬è®¡åˆ’è®©go getåœæ­¢å®‰è£…å‘½ä»¤äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¯¦æƒ…è¯·å‚è§issue 43684ã€‚\nModuleæ’¤å› æ‚¨æ˜¯å¦æ›¾ç»åœ¨Moduleç‰ˆæœ¬å‡†å¤‡å¥½ä¹‹å‰ä¸å°å¿ƒå‘å¸ƒè¿‡ï¼Ÿæˆ–è€…æ‚¨æ˜¯å¦åœ¨ç‰ˆæœ¬å‘å¸ƒåå°±å‘ç°äº†ä¸€ä¸ªéœ€è¦å¿«é€Ÿä¿®å¤çš„é—®é¢˜ï¼Ÿå‘å¸ƒçš„ç‰ˆæœ¬ä¸­çš„é”™è¯¯æ˜¯å¾ˆéš¾çº æ­£çš„ã€‚ä¸ºäº†ä¿æŒModuleæ„å»ºçš„ç¡®å®šæ€§ï¼Œä¸€ä¸ªç‰ˆæœ¬åœ¨å‘å¸ƒåä¸èƒ½è¢«ä¿®æ”¹ã€‚å³ä½¿ä½ åˆ é™¤æˆ–æ›´æ”¹äº†ç‰ˆæœ¬æ ‡ç­¾ï¼Œproxy.golang.orgå’Œå…¶ä»–ä»£ç†å¯èƒ½å·²ç»æœ‰äº†åŸå§‹ç‰ˆæœ¬çš„ç¼“å­˜ã€‚\nModuleä½œè€…ç°åœ¨å¯ä»¥ä½¿ç”¨go.modä¸­çš„retractæŒ‡ä»¤æ’¤å›Moduleç‰ˆæœ¬ã€‚æ’¤å›çš„ç‰ˆæœ¬ä»ç„¶å­˜åœ¨ï¼Œå¹¶ä¸”å¯ä»¥è¢«ä¸‹è½½ï¼ˆæ‰€ä»¥ä¾èµ–å®ƒçš„æ„å»ºä¸ä¼šä¸­æ–­ï¼‰ï¼Œä½†åœ¨è§£æ@latestè¿™æ ·çš„ç‰ˆæœ¬æ—¶ï¼Œgoå‘½ä»¤ä¸ä¼šè‡ªåŠ¨é€‰æ‹©å®ƒï¼Œgo getå’Œgo list -m -uä¼šæ‰“å°å…³äºç°æœ‰ä½¿ç”¨ç‰ˆæœ¬çš„è­¦å‘Šã€‚\nä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªæµè¡Œåº“example.com/libçš„ä½œè€…å‘å¸ƒäº†v1.0.5ï¼Œç„¶åå‘ç°äº†ä¸€ä¸ªæ–°çš„å®‰å…¨é—®é¢˜ã€‚ä»–ä»¬å¯ä»¥åœ¨ä»–ä»¬çš„go.modæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹æŒ‡ä»¤ã€‚\n// Remote-triggered crash in package foo. See CVE-2021-01234. retract v1.0.5 æ¥ä¸‹æ¥ï¼Œä½œè€…å¯ä»¥æ ‡è®°å¹¶æ¨é€v1.0.6ç‰ˆæœ¬ï¼Œå³æ–°çš„æœ€é«˜ç‰ˆæœ¬ã€‚åœ¨è¿™ä¹‹åï¼Œå·²ç»ä¾èµ–v1.0.5çš„ç”¨æˆ·åœ¨æ£€æŸ¥æ›´æ–°æˆ–å‡çº§ä¾èµ–çš„è½¯ä»¶åŒ…æ—¶ï¼Œå°±ä¼šè¢«é€šçŸ¥ç‰ˆæœ¬æ’¤å›ã€‚é€šçŸ¥ä¿¡æ¯å¯èƒ½ä¼šåŒ…å«æ¥è‡ªretractæŒ‡ä»¤ä¸Šæ–¹æ³¨é‡Šçš„æ–‡å­—ã€‚\n$ go list -m -u all example.com/lib v1.0.0 (retracted) $ go get . go: warning: example.com/lib@v1.0.5: retracted by module author: Remote-triggered crash in package foo. See CVE-2021-01234. go: to switch to the latest unretracted version, run: go get example.com/lib@latest å…³äºäº¤äº’å¼çš„ã€åŸºäºæµè§ˆå™¨çš„ä½¿ç”¨æŒ‡å—ï¼Œè¯·æŸ¥çœ‹play-with-go.devä¸Šçš„Retract Module Versionsã€‚å¯ä»¥æŸ¥çœ‹retractæŒ‡ä»¤æ–‡æ¡£ä»¥äº†è§£è¯­æ³•ç»†èŠ‚ã€‚\nç”¨GOVCSæ§åˆ¶ç‰ˆæœ¬ç®¡ç†å·¥å…· goå‘½ä»¤å¯ä»¥ä»proxy.golang.orgè¿™æ ·çš„é•œåƒä¸­ä¸‹è½½Moduleæºä»£ç ï¼Œæˆ–è€…ç›´æ¥ä»ä½¿ç”¨gitã€hgã€svnã€bzræˆ–fossilçš„ç‰ˆæœ¬ç®¡ç†ä»“åº“ä¸­ä¸‹è½½ã€‚ç›´æ¥çš„ç‰ˆæœ¬æ§åˆ¶è®¿é—®æ˜¯å¾ˆé‡è¦çš„ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé‚£äº›åœ¨ä»£ç†ä¸Šæ— æ³•ä½¿ç”¨çš„ç§æœ‰Moduleï¼Œä½†è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ½œåœ¨çš„å®‰å…¨é—®é¢˜ï¼šç‰ˆæœ¬æ§åˆ¶å·¥å…·ä¸­çš„ä¸€ä¸ªbugå¯èƒ½ä¼šè¢«æ¶æ„æœåŠ¡å™¨åˆ©ç”¨ï¼Œè¿è¡Œéé¢„æœŸçš„ä»£ç ã€‚\nGo 1.16å¼•å…¥äº†ä¸€ä¸ªæ–°çš„é…ç½®å˜é‡GOVCSï¼Œè®©ç”¨æˆ·å¯ä»¥æŒ‡å®šå“ªäº›Moduleå¯ä»¥ä½¿ç”¨ç‰¹å®šçš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ã€‚GOVCSæ¥å—ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„pattern:vcslistè§„åˆ™åˆ—è¡¨ã€‚patternæ˜¯ä¸€ä¸ªpath.Matchæ¨¡å¼ï¼ŒåŒ¹é…ä¸€ä¸ªModuleè·¯å¾„çš„ä¸€ä¸ªæˆ–å¤šä¸ªå‰ç¼€å…ƒç´ ã€‚ç‰¹æ®Šæ¨¡å¼publicå’ŒprivateåŒ¹é…å…¬å…±å’Œç§æœ‰Moduleï¼ˆprivateè¢«å®šä¹‰ä¸ºç”±GOPRIVATEä¸­çš„æ¨¡å¼åŒ¹é…çš„Moduleï¼›publicæ˜¯å…¶ä»–æ‰€æœ‰Moduleï¼‰ã€‚vcslistæ˜¯ä¸€ä¸ªä»¥ç®¡é“ç¬¦åˆ†éš”çš„å…è®¸çš„ç‰ˆæœ¬æ§åˆ¶å‘½ä»¤åˆ—è¡¨ï¼Œæˆ–å…³é”®å­—allæˆ–offã€‚\nä¾‹å¦‚\nGOVCS=github.com:git,evil.com:off,*:git|hg åœ¨æ­¤è®¾ç½®ä¸‹ï¼Œè·¯å¾„åœ¨github.comä¸Šçš„Moduleå¯ä»¥ä½¿ç”¨gitä¸‹è½½ï¼›è·¯å¾„åœ¨evil.comä¸Šçš„Moduleä¸èƒ½ä½¿ç”¨ä»»ä½•ç‰ˆæœ¬ç®¡ç†ç¨‹åºä¸‹è½½ï¼Œå…¶ä»–æ‰€æœ‰è·¯å¾„ï¼ˆ*åŒ¹é…æ‰€æœ‰ï¼‰å¯ä»¥ä½¿ç”¨gitæˆ–hgä¸‹è½½ã€‚\nå¦‚æœæ²¡æœ‰è®¾ç½®GOVCSï¼Œæˆ–è€…ä¸€ä¸ªModuleä¸ç¬¦åˆä»»ä½•æ¨¡å¼ï¼Œgoå‘½ä»¤å°±ä¼šä½¿ç”¨è¿™ä¸ªé»˜è®¤å€¼ï¼šå…¬å…±Moduleå…è®¸ä½¿ç”¨gitå’Œhgï¼Œç§æœ‰Moduleå…è®¸ä½¿ç”¨æ‰€æœ‰å·¥å…·ã€‚åªå…è®¸Gitå’ŒMercurialçš„ç†ç”±æ˜¯ï¼Œè¿™ä¸¤ä¸ªç³»ç»Ÿä½œä¸ºä¸å—ä¿¡ä»»çš„æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿è¡Œçš„é—®é¢˜æœ€å—å…³æ³¨ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒBazaarã€Fossilå’ŒSubversionä¸»è¦æ˜¯åœ¨å—ä¿¡ä»»çš„ã€ç»è¿‡è®¤è¯çš„ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä½œä¸ºæ”»å‡»é¢çš„å®¡æŸ¥ç¨‹åº¦ä¸é«˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤çš„è®¾ç½®æ˜¯\nGOVCS=public:git|hg,private:all æ›´å¤šç»†èŠ‚è¯·å‚è§ä½¿ç”¨GOVCSæ§åˆ¶ç‰ˆæœ¬ç®¡ç†å·¥å…·ã€‚\nä¸‹ä¸€æ­¥ï¼Ÿ æˆ‘ä»¬å¸Œæœ›æ‚¨è§‰å¾—è¿™äº›åŠŸèƒ½å¾ˆæœ‰ç”¨ã€‚æˆ‘ä»¬å·²ç»åœ¨åŠªåŠ›ä¸ºGo 1.17å¼€å‘æ–°çš„ModuleåŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯æ‡’æƒ°ModuleåŠ è½½ï¼Œè¿™å°†ä½¿ModuleåŠ è½½è¿‡ç¨‹æ›´å¿«ã€æ›´ç¨³å®šã€‚å’Œä»¥å¾€ä¸€æ ·ï¼Œå¦‚æœæ‚¨é‡åˆ°æ–°çš„bugï¼Œè¯·åœ¨é—®é¢˜è·Ÿè¸ªä¸Šå‘Šè¯‰æˆ‘ä»¬ã€‚Happy coding!\n","date":"2021-02-19T10:16:00Z","permalink":"https://www.4async.com/2021/02/2021-02-19-go116-module-changes/","title":"Go 1.16 ä¸­ModuleåŠŸèƒ½æ–°å˜åŒ–"},{"content":"ä»Šå¤©æ—©äº›æ—¶å€™ï¼ŒOpenTelemetryæ­£å¼è¿›å…¥Betaç‰ˆæœ¬é˜¶æ®µï¼Œè¿™æ ‡å¿—ç€OpenTelemetryçš„åŸºæœ¬æ¨¡å‹å·²ç»æ­£å¼ç¡®å®šï¼Œå¯ä»¥å¼€å§‹å°†OpenTelemetryé›†æˆåˆ°åº”ç”¨ç¨‹åºå’Œå®¢æˆ·ç«¯åº“ä¸­ï¼Œä»¥æ•è·åº”ç”¨ç¨‹åºçº§æŒ‡æ ‡å’Œåˆ†å¸ƒå¼è·Ÿè¸ªã€‚\nOpenTelemetryä»‹ç» æœ¬ç« èŠ‚ä¸»è¦ä»‹ç»ä»€ä¹ˆæ˜¯OpenTelemetryï¼Œå¦‚æœä½ å·²ç»äº†è§£ï¼Œåˆ™å¯ä»¥è·³è¿‡æœ¬èŠ‚ã€‚\nå¯¹äºè½¯ä»¶è€Œè¨€ï¼Œå¯è§‚æµ‹æ€§æ˜¯éå¸¸é‡è¦çš„æŒ‡æ ‡ä¹‹ä¸€ã€‚OpenTelemetryé¡¹ç›®æä¾›äº†ä¸€ç»„ç‰¹å®šäºè¯­è¨€çš„APIï¼ŒSDKï¼Œä»£ç†å’Œå…¶ä»–ç»„ä»¶ï¼Œå¯ç”¨äºä»åº”ç”¨ç¨‹åºä¸­æ”¶é›†åˆ†å¸ƒå¼è·Ÿè¸ªï¼Œmetricså’Œç›¸å…³åº”ç”¨Metadataã€‚å€ŸåŠ©OpenTelemetryï¼Œå¼€å‘äººå‘˜å‡ ä¹å¯ä»¥ä»é›¶å¼€å§‹ä»åº”ç”¨ç¨‹åºä¸­æ•è·å…³é”®çš„å¯è§‚å¯Ÿæ€§æ•°æ®ã€‚OpenTelemetryä¸ä»…ä»…æ˜¯å¯ä»¥ä½œä¸ºåˆ†å¸ƒå¼è¿½è¸ªå·¥å…·ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºmetricsæ”¶é›†çš„ç›¸å…³å·¥å…·ã€‚æ”¯æŒçš„åç«¯å­˜å‚¨åŒ…æ‹¬ï¼šPrometheusï¼ŒJaegerï¼ŒZipkinï¼ŒAzure Monitorï¼ŒDynatraceï¼ŒGoogle Cloud Monitoring + Traceï¼ŒHoneycombï¼ŒLightstepï¼ŒNew Relicå’ŒSplunkç­‰ã€‚\nOpenTelemetryé¡¹ç›®æ˜¯ä½œä¸ºOpenTracingå’ŒOpenCensusçš„èåˆé¡¹ç›®ï¼Œè¿›å…¥CNCF sandboxé¡¹ç›®ã€‚å¯¹äºOpenTelemetryé¡¹ç›®çš„ä¸€ä¸ªç›®æ ‡å°±æ˜¯ï¼Œå…¼å®¹OpenTracingå’ŒOpenCensusã€‚\nOpenTelemetryå®æˆ˜ æˆ‘ä»¬è¿™é‡Œæ¼”ç¤ºæœ€å¸¸ç”¨çš„è¿½è¸ªåŠŸèƒ½å¼€å§‹æ¼”ç¤ºã€‚OpenTelemetryæ”¯æŒå¤šç§åç«¯ï¼Œè¿™é‡Œä¸ºäº†ç®€åŒ–åŠŸèƒ½æ¼”ç¤ºï¼Œæˆ‘ä»¬æœ€å¼€å§‹é€‰æ‹©æœ€ä¸ºç®€å•çš„æ ‡å‡†è¾“å‡ºä½œä¸ºåç«¯è¾“å‡ºï¼Œä¾‹å­å‡é‡‡ç”¨Goè¯­è¨€å®ç°ã€‚\nå‡è®¾æˆ‘ä»¬å·²åˆ›å»ºä¸€ä¸ªåå«demoçš„åŸºäºGo Moduleçš„é¡¹ç›®ã€‚æ¥ä¸‹æ¥åˆ›å»ºå¯¹åº”çš„main.go:\npackage main import ( â€œcontextâ€ â€œlogâ€ â€œgo.opentelemetry.io/otel/api/globalâ€ â€œgo.opentelemetry.io/otel/exporters/trace/stdoutâ€ sdktrace â€œgo.opentelemetry.io/otel/sdk/traceâ€ ) func initTracer() { exporter, err := stdout.NewExporter(stdout.Options{PrettyPrint: true}) if err != nil { log.Fatal(err) } tp, err := sdktrace.NewProvider(sdktrace.WithConfig(sdktrace.Config{DefaultSampler: sdktrace.AlwaysSample()}), sdktrace.WithSyncer(exporter)) if err != nil { log.Fatal(err) } // è®¾ç½®å…¨å±€ \tglobal.SetTraceProvider(tp) } func main() { initTracer() tracer := global.Tracer(â€œ4async.com/demoâ€) tracer.WithSpan(context.Background(), â€œfooâ€, func(ctx context.Context) error { tracer.WithSpan(ctx, â€œbarâ€, func(ctx context.Context) error { tracer.WithSpan(ctx, â€œbazâ€, func(ctx context.Context) error { return nil }, ) return nil }, ) return nil }, ) } è¿è¡Œä¸Šé¢ç¨‹åºä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°æ ‡å‡†è¾“å‡ºä¸­è¾“å‡ºäº†å¯¹åº”çš„tracingä¿¡æ¯ï¼š\n{ \u0026#34;SpanContext\u0026#34;: { \u0026#34;TraceID\u0026#34;: \u0026#34;9495716100dbdd51e77edda2d39d8f28\u0026#34;, \u0026#34;SpanID\u0026#34;: \u0026#34;c9e68a06fbe116e0\u0026#34;, \u0026#34;TraceFlags\u0026#34;: 1 }, \u0026#34;ParentSpanID\u0026#34;: \u0026#34;e3e88597058566b3\u0026#34;, \u0026#34;SpanKind\u0026#34;: 1, \u0026#34;Name\u0026#34;: \u0026#34;baz\u0026#34;, \u0026#34;StartTime\u0026#34;: \u0026#34;2020-03-31T10:53:55.497818+08:00\u0026#34;, \u0026#34;EndTime\u0026#34;: \u0026#34;2020-03-31T10:53:55.497821142+08:00\u0026#34;, \u0026#34;Attributes\u0026#34;: null, \u0026#34;MessageEvents\u0026#34;: null, \u0026#34;Links\u0026#34;: null, \u0026#34;StatusCode\u0026#34;: 0, \u0026#34;StatusMessage\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;HasRemoteParent\u0026#34;: false, \u0026#34;DroppedAttributeCount\u0026#34;: 0, \u0026#34;DroppedMessageEventCount\u0026#34;: 0, \u0026#34;DroppedLinkCount\u0026#34;: 0, \u0026#34;ChildSpanCount\u0026#34;: 0, \u0026#34;Resource\u0026#34;: null } { \u0026#34;SpanContext\u0026#34;: { \u0026#34;TraceID\u0026#34;: \u0026#34;9495716100dbdd51e77edda2d39d8f28\u0026#34;, \u0026#34;SpanID\u0026#34;: \u0026#34;e3e88597058566b3\u0026#34;, \u0026#34;TraceFlags\u0026#34;: 1 }, \u0026#34;ParentSpanID\u0026#34;: \u0026#34;db446b6a4e579c04\u0026#34;, \u0026#34;SpanKind\u0026#34;: 1, \u0026#34;Name\u0026#34;: \u0026#34;bar\u0026#34;, \u0026#34;StartTime\u0026#34;: \u0026#34;2020-03-31T10:53:55.497817+08:00\u0026#34;, \u0026#34;EndTime\u0026#34;: \u0026#34;2020-03-31T10:53:55.498188044+08:00\u0026#34;, \u0026#34;Attributes\u0026#34;: null, \u0026#34;MessageEvents\u0026#34;: null, \u0026#34;Links\u0026#34;: null, \u0026#34;StatusCode\u0026#34;: 0, \u0026#34;StatusMessage\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;HasRemoteParent\u0026#34;: false, \u0026#34;DroppedAttributeCount\u0026#34;: 0, \u0026#34;DroppedMessageEventCount\u0026#34;: 0, \u0026#34;DroppedLinkCount\u0026#34;: 0, \u0026#34;ChildSpanCount\u0026#34;: 1, \u0026#34;Resource\u0026#34;: null } { \u0026#34;SpanContext\u0026#34;: { \u0026#34;TraceID\u0026#34;: \u0026#34;9495716100dbdd51e77edda2d39d8f28\u0026#34;, \u0026#34;SpanID\u0026#34;: \u0026#34;db446b6a4e579c04\u0026#34;, \u0026#34;TraceFlags\u0026#34;: 1 }, \u0026#34;ParentSpanID\u0026#34;: \u0026#34;0000000000000000\u0026#34;, \u0026#34;SpanKind\u0026#34;: 1, \u0026#34;Name\u0026#34;: \u0026#34;foo\u0026#34;, \u0026#34;StartTime\u0026#34;: \u0026#34;2020-03-31T10:53:55.497813+08:00\u0026#34;, \u0026#34;EndTime\u0026#34;: \u0026#34;2020-03-31T10:53:55.498301313+08:00\u0026#34;, \u0026#34;Attributes\u0026#34;: null, \u0026#34;MessageEvents\u0026#34;: null, \u0026#34;Links\u0026#34;: null, \u0026#34;StatusCode\u0026#34;: 0, \u0026#34;StatusMessage\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;HasRemoteParent\u0026#34;: false, \u0026#34;DroppedAttributeCount\u0026#34;: 0, \u0026#34;DroppedMessageEventCount\u0026#34;: 0, \u0026#34;DroppedLinkCount\u0026#34;: 0, \u0026#34;ChildSpanCount\u0026#34;: 1, \u0026#34;Resource\u0026#34;: null } è¿™é‡Œæˆ‘ä»¬å€ŸåŠ©TraceIDã€SpanIDå’ŒParentSpanIDå°±å¯ä»¥å¿«é€Ÿæ¢³ç†è°ƒç”¨é“¾è·¯ã€‚\nå½“ç„¶ï¼Œå®é™…ä¸Šåœ¨å®é™…é¡¹ç›®ä¸­ä¸å¯èƒ½ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œè¿½è¸ªï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¼šæœ‰ä¸“é—¨çš„ç³»ç»Ÿå­˜å‚¨å’Œå±•ç¤ºè¿½è¸ªé“¾è·¯ä¿¡æ¯ã€‚å› æ­¤å¯ä»¥é€šè¿‡ä¿®æ”¹ä¸Šé¢ç¨‹åºä¸­å¯¹åº”çš„go.opentelemetry.io/otel/exporters/trace/stdoutå†…å®¹å¿«é€Ÿæ›¿æ¢æˆä½ éœ€è¦çš„å¯¹åº”çš„åç«¯å­˜å‚¨ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨çº¿ä¸Šä½¿ç”¨çš„Jaegeråç«¯ï¼Œåˆ™å¼•ç”¨go.opentelemetry.io/otel/exporters/trace/jaegerï¼Œä¿®æ”¹initTracer()æ–¹æ³•å¿«é€Ÿæ›¿æ¢ï¼š\n// initTracer creates a new trace provider instance and registers it as global trace provider. func initTracer() func() { // Create and install Jaeger export pipeline \t_, flush, err := jaeger.NewExportPipeline( jaeger.WithCollectorEndpoint(â€œhttp://localhost:14268/api/tracesâ€), \tjaeger.WithProcess(jaeger.Process{ ServiceName: â€œtrace-demoâ€, Tags: []core.KeyValue{ key.String(â€œexporterâ€, â€œjaegerâ€), key.Float64(â€œfloatâ€, 312.23), }, }), jaeger.RegisterAsGlobal(), jaeger.WithSDK(\u0026amp;sdktrace.Config{DefaultSampler: sdktrace.AlwaysSample()}), ) if err != nil { log.Fatal(err) } return func() { flush() } } è‡³äºå…¶ä»–åç«¯æ”¯æŒï¼Œä½ å¯ä»¥ä»pkg.go.devä¸­è·å–åˆ°æ‰€æœ‰çš„æ”¯æŒåç«¯åˆ—è¡¨ã€‚\n","date":"2020-03-31T11:10:00Z","permalink":"https://www.4async.com/2020/03/2020-03-31-intro-opentelemetry/","title":"OpenTelemetryå…¥é—¨"},{"content":"åŸæ–‡ï¼šMoving Towards Domain Driven Design in Go\næœ¬æ–‡çš„ç›®çš„æ˜¯å¸®åŠ©æ¼”ç¤ºå½“åº”ç”¨ç¨‹åºéšç€æ—¶é—´ä¸æ–­æ¨ç§»ä¸æ–­æ¼”åŒ–æ—¶ï¼Œæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡å¸®æˆ‘ä»¬è§£å†³å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ä¸€ä¸ªçç¢çš„é¡¹ç›®ç ”ç©¶é¡¹ç›®æ˜¯å¦‚ä½•éšç€æ—¶é—´ä¸€æ­¥æ­¥æ¼”åŒ–çš„ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ï¼Œç¤ºä¾‹ä»£ç å¹¶ä¸èƒ½å¤Ÿç›´æ¥ç¼–è¯‘ï¼Œç”šè‡³æœ‰äº›å¯¼å…¥ä»¥æ¥æ²¡æœ‰å…¨éƒ¨åˆ—å‡ºã€‚è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½ å¯ä»¥éšæ—¶ä¸æˆ‘è”ç³»ï¼Œæˆ‘ä»¬å°†å¯¹é—®é¢˜è¿›è¡Œè°ƒæ•´æˆ–è€…ä½ çš„é—®é¢˜åŠæ—¶è§£ç­”ï¼ˆå¦‚æœå¯ä»¥çš„è¯ï¼‰ã€‚\né¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„èƒŒæ™¯ã€‚æƒ³è±¡ä¸€ä¸‹ä½ åœ¨å·¥ä½œï¼Œè€æ¿è¦æ±‚ä½ åˆ›å»ºä¸€ç§é€šè¿‡GitHub APIå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯çš„æ–¹æ³•ã€‚å…·ä½“ä¸Šè¯´ï¼Œä½ éœ€è¦åˆ©ç”¨ç”¨æˆ·ä¸ªäººè®¿é—®ä»¤ç‰Œï¼ŒæŸ¥æ‰¾è¯¥ç”¨æˆ·åŠå…¶æ‰€æœ‰ç»„ç»‡ã€‚ è¿™æ ·ï¼Œä½ ä»¥åå°±å¯ä»¥æ ¹æ®ä»–ä»¬æ‰€å±çš„ç»„ç»‡æ¥é™åˆ¶ä»–ä»¬çš„è®¿é—®ã€‚\næ³¨æ„ï¼šæˆ‘ä»¬è¿™é‡Œä½¿ç”¨è®¿é—®ä»¤ç‰Œæ¥ç®€åŒ–ç¤ºä¾‹ã€‚\nè¿™å¬èµ·æ¥å¾ˆå®¹æ˜“ï¼Œæ‰€ä»¥ä½ å¯åŠ¨ç¼–è¾‘å™¨å¹¶å®ç°æä¾›æ­¤åŠŸèƒ½çš„githubåŒ…ã€‚\npackage github type User struct { ID string Email string OrgIDs []string } type Client struct { Key string } func (c *Client) User(token string) (User, error) { // ä¸Github APIè¿›è¡Œäº¤äº’ï¼Œå¹¶è¿”å›ç”¨æˆ·ã€‚å¦‚æœä»–ä»¬åœ¨ä¸€ä¸ªç»„ç»‡ä¸­ï¼Œè¿”å›ç»„ç»‡çš„c.OrgID } æ³¨æ„ï¼šè¿™é‡Œä¸æ˜¯ä½¿ç”¨çœŸå®çš„Github API - è¿™åªæ˜¯ä¸€ä¸ªæ¼”ç¤ºä¾‹å­ã€‚\næ¥ä¸‹æ¥ï¼Œä½ éœ€è¦ç»™githubåŒ…ç¼–å†™ä¸€äº›ä¸­é—´ä»¶ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨éœ€è¦ä¿æŠ¤çš„HTTP handlerä¸­ä½¿ç”¨è¿™ä¸ªåŒ…ã€‚åœ¨ä¸­é—´ä»¶ä¸­ï¼Œä½ é€šè¿‡å¤´éƒ¨ä¸­çš„basic authä¸­è·å¾—ç”¨æˆ·çš„è®¿é—®ä»¤ç‰Œï¼Œç„¶åè°ƒç”¨Githubçš„ä»£ç æŸ¥æ‰¾ç”¨æˆ·ï¼Œæ£€æŸ¥ä»–ä»¬æ˜¯å¦æ˜¯æ‰€æä¾›ç»„ç»‡çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åç›¸åº”åœ°æˆäºˆæƒé™æˆ–æ‹’ç»è®¿é—®ã€‚\npackage mw func AuthMiddleware(client *github.Client, reqOrgID string, next http.Handler) http.Handler { return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { token, _, ok := r.BasicAuth() if !ok { http.Error(w, â€œUnauthorizedâ€, http.StatusUnauthorized) return } user, err := client.User(token) if err != nil { http.Error(w, â€œUnauthorizedâ€, http.StatusUnauthorized) return } permit := false for _, orgID := range user.OrgIDs { if orgId == reqOrgID { permit = true break } } if !permit { http.Error(w, â€œUnauthorizedâ€, http.StatusUnauthorized) return } // ç”¨æˆ·å·²è®¤è¯ï¼Œæ”¾ä»–ä»¬è¿›æ¥  next.ServeHTTP(w, r) }) } ä½ å°†è¿™äº›ä»£ç ç»™ä½ çš„åŒäº‹çœ‹ï¼Œä»–ä»¬æ‹…å¿ƒç¼ºä¹æµ‹è¯•ã€‚å…·ä½“çš„è¯´ï¼Œæ²¡æœ‰ä¸€ç§æ–¹æ³•èƒ½å¤ŸéªŒè¯AuthMiddlewareèƒ½å¦æŒ‰ç…§é¢„æœŸå·¥ä½œã€‚â€œæ²¡æœ‰é—®é¢˜â€ï¼Œä½ è¯´ï¼Œâ€œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨interfaceä¿è¯æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„æµ‹è¯•å®ƒï¼â€\npackage mw type UserService interface { User(token string) (github.User, error) } func AuthMiddleware(us UserService, reqOrgID string, next http.Handler) http.Handler { return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { token, _, ok := r.BasicAuth() if !ok { http.Error(w, â€œUnauthorizedâ€, http.StatusUnauthorized) return } user, err := us.User(token) if err != nil { http.Error(w, â€œUnauthorizedâ€, http.StatusUnauthorized) return } permit := false for _, orgID := range user.OrgIDs { if orgId == reqOrgID { permit = true break } } if !permit { http.Error(w, â€œUnauthorizedâ€, http.StatusUnauthorized) return } // user is authenticated, let them in  next.ServeHTTP(w, r) }) } ç°åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿç”¨æˆ·æœåŠ¡æµ‹è¯•æ­¤ä»£ç ã€‚\npackage mock type UserService struct { UserFn func(token string) (github.User, error) } func (us *UserService) Authenticate(token string) (github.User, error) { return us.UserFn(token) } åˆ›å»ºæ¨¡æ‹Ÿç”¨æˆ·æœåŠ¡æœ‰å¾ˆå¤šæ–¹å¼ï¼Œä½†æ˜¯è¿™ä¸ªé€šå¸¸éœ€è¦æµ‹è¯•è®¤è¯æ­£å¸¸é€šè¿‡æ—¶å’Œè®¤è¯å‡ºç°é—®é¢˜æ—¶çš„ä¸åŒæƒ…å†µã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬å¯¹è®¤è¯ä¸­é—´ä»¶å®Œæˆæµ‹è¯•ã€å‘å¸ƒï¼Œç”Ÿæ´»ä¼¼ä¹å¾ˆæ„‰å¿«ã€‚\nç„¶åï¼Œæ‚²å‰§å‘ç”Ÿäº†ã€‚ä½ çš„CEOå¬è¯´å“¥æ–¯æ‹‰ï¼ˆè¯‘è€…æ³¨ï¼šå“¥æ–¯æ‹‰æ¯ç­ä¸–ç•Œï¼Ÿï¼‰æ­£åœ¨å‰å¾€æ—§é‡‘å±±ï¼Œä½ çš„å…¬å¸æ— æ³•åœ¨æœªæ¥ä¸ç¡®å®šçš„æƒ…å†µä¸‹ç»§ç»­ä¾èµ–Githubã€‚å¦‚æœGithubæ•´ä¸ªåŠå…¬å®¤è¢«æ‘§æ¯äº†ï¼Œæ²¡æœ‰å·¥ç¨‹å¸ˆç»§ç»­ç»´æŠ¤è¯¥äº§å“æ€ä¹ˆåŠï¼Ÿä¸ï¼Œå®Œå…¨ä¸èƒ½æ¥å—ï¼\nå¹¸è¿çš„æ˜¯ï¼Œè¿˜æœ‰ä¸€å®¶åä¸ºGitLabçš„æ›¿ä»£å…¬å¸ï¼Œä¼¼ä¹åšäº†å¾ˆå¤šç±»ä¼¼GitHubçš„åŠŸèƒ½ï¼Œä¸åŒçš„æ˜¯ä»–ä»¬æ˜¯ä¸€ä¸ªè¿œç¨‹å·¥ä½œå›¢é˜Ÿã€‚è¿™æ„å‘³ç€å“¥æ–¯æ‹‰æ°¸è¿œæ— æ³•åŒæ—¶æ¶ˆç­æ‰€æœ‰å·¥ç¨‹å¸ˆï¼Œå¯¹å—ï¼Ÿ ğŸ‰\né«˜å±‚ä¼¼ä¹è®¤åŒè¿™ä¸ªé€»è¾‘ï¼Œä»–ä»¬å¼€å§‹è¿›è¡Œè¿ç§»ã€‚ä½ çš„å·¥ä½œï¼Ÿä½ çš„ä»»åŠ¡æ˜¯ä¿è¯æ‰€æœ‰è®¤è¯ä»£ç èƒ½å¤Ÿåœ¨æ–°ç³»ç»Ÿä¸Šæ­£å¸¸è¿è¡Œï¼\nä½ èŠ±äº†ä¸€äº›æ—¶é—´æŸ¥çœ‹GitLab APIæ–‡æ¡£ï¼Œå¥½æ¶ˆæ¯æ˜¯ï¼Œçœ‹èµ·æ¥ä»–ä»¬é‡‡ç”¨äº†å’ŒGithubç±»ä¼¼çš„ç­–ç•¥ã€‚GitLabåŒæ ·ä¹Ÿæœ‰ä¸ªäººè®¿é—®ä»¤ç‰Œï¼Œç»„ç»‡ï¼Œä½ åªéœ€è¦é‡æ–°å®ç°å®¢æˆ·ç«¯å³å¯ã€‚ä¸­é—´ä»¶ä¸­çš„ä»£ç å®Œå…¨ä¸éœ€è¦æ›´æ”¹ï¼Œå› ä¸ºä½ æ˜¯ä¸€ä¸ªèªæ˜äººï¼Œä½ ä½¿ç”¨äº†æ¥å£ï¼ ğŸ˜ ç°åœ¨ä½ åªéœ€è¦åˆ›å»ºä¸€ä¸ªGithubå®¢æˆ·ç«¯â€¦\npackage gitlab type User struct { ID string Email string OrgIDs []string } type Client struct { Key string } func (c *Client) User(token string) (User, error) { // ä¸Gitlab APIäº¤äº’ï¼Œè¿”å›ç”¨æˆ·å’Œå¯¹åº”çš„ç»„ç»‡c.OrgID } ç°åœ¨ï¼ŒæŠŠè¿™ä¸ªåŠŸèƒ½æ”¾å…¥AuthMiddlewareä¸­ï¼Œä½†æ˜¯ï¼Œå®ƒå´ä¸èƒ½æ­£å¸¸å·¥ä½œäº†ï¼\näº‹å®è¯æ˜ï¼Œå³ä½¿æ¥å£ä¹Ÿå¯èƒ½æˆä¸ºè€¦åˆçš„å—å®³è€…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ˜¯å› ä¸ºä½ çš„æ¥å£æœŸæœ›é€šè¿‡Useræ–¹æ³•è¿”å›github.User ã€‚\ntype UserService interface { User(token string) (github.User, error) ^^^^^^^^^^^ } æ€ä¹ˆåŠï¼Ÿè€æ¿å¸Œæœ›æ˜å¤©å°±è¦å‘å¸ƒäº†ï¼\nç°åœ¨ï¼Œä½ æœ‰å‡ ç§é€‰æ‹©ï¼š\n ä¿®æ”¹ä¸­é—´ä»¶ï¼Œä»¥ä¾¿UserServiceæ¥å£è¿”å›gitlab.Userè€Œä¸æ˜¯github.Userï¼› åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸“é—¨ç”¨äºGitLabçš„èº«ä»½éªŒè¯ä¸­é—´ä»¶ã€‚ åˆ›å»ºä¸€ä¸ªé€šç”¨çš„ç”¨æˆ·ç±»å‹ï¼Œèƒ½å¤Ÿåœ¨AuthMiddlewareä¸­å¯ä»¥è‡ªç”±åˆ‡æ¢ä½ çš„githubå’Œgitlabå®ç°ã€‚  å¦‚æœä½ ç¡®ä¿¡è‡ªå·±çš„å…¬å¸ä»¥åç»§ç»­ä½¿ç”¨GitLabï¼Œåˆ™æ–¹æ¡ˆ1å°±æœ‰æ„ä¹‰ã€‚å½“ç„¶ï¼Œä½ éœ€è¦åŒæ—¶æ›´æ”¹ç”¨æˆ·æœåŠ¡æ¥å£å’Œmockï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸€æ¬¡æ€§çš„ä¿®æ”¹ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ¡ˆå¹¶ä¸åã€‚\nå½“ç„¶ï¼Œä½ å¹¶ä¸çœŸæ­£çŸ¥é“ä½ ä»¬æ˜¯å¦ä¼šåšæŒä½¿ç”¨GitLabã€‚ä¹Ÿè®¸å“¥æ–¯æ‹‰ä¼šæ”¹å˜å®ƒçš„æ”»å‡»è®¡åˆ’ï¼Ÿ\nå¦‚æœç¨‹åºä¸­å¾ˆå¤šä»£ç éƒ½ä¾èµ–æ­¤ç¨‹åºåŒ…è¿”å›çš„github.Userç±»å‹ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¹Ÿä¼šå¸¦æ¥å¾ˆå¤šéº»çƒ¦ã€‚\næ–¹æ¡ˆ2ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å®ƒçœ‹èµ·æ¥æœ‰ç‚¹å‚»å‚»çš„ã€‚å½“é€»è¾‘ä¸å˜æ—¶ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é‡å†™ä¸€éæ‰€æœ‰çš„ä»£ç å’Œæµ‹è¯•ï¼Ÿå½“ç„¶ï¼Œä¸€å®šæœ‰ä¸€ç§æ¥å£å¯ä»¥æŒ‰ç…§ä½ æœ€åˆçš„æ„å›¾å®ç°åŠŸèƒ½ã€‚æ¯•ç«Ÿï¼Œä¸­é—´ä»¶ä¸å…³å¿ƒæŸ¥è¯¢çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬åªæ˜¯éœ€è¦å¤„ç†å…¶ä¸­ä¸€äº›é‡è¦ä¿¡æ¯ã€‚\nç°åœ¨ï¼Œä½ å†³å®šå°è¯•ä¸€ä¸‹æ–¹æ¡ˆ3ã€‚ä½ åˆ›å»ºäº†ä¸€ä¸ªmwåŒ…ï¼Œå®šä¹‰äº†ä¸€ä¸ªUserç±»å‹ï¼Œç„¶åå‡†å¤‡ç¼–å†™ä¸€ä¸ªé€‚é…å™¨å°†å…¶ä¸Githubå’ŒGitlabå®¢æˆ·ç«¯è¿æ¥ã€‚\npackage mw type User struct { OrgIDs []string } type UserService interface { User(token string) (User, error) } å½“ä½ ç¼–å†™ä»£ç æ—¶ï¼Œä½ æ„è¯†åˆ°ï¼Œä½ å®é™…ä¸Šå¹¶ä¸å…³å¿ƒç”¨æˆ·IDæˆ–è€…ç”µå­é‚®ä»¶ç­‰ç­‰å…¶ä»–ä¿¡æ¯ï¼Œå› æ­¤ä½ å®Œå…¨å¯ä»¥ä»mw.Userä¸­åˆ é™¤è¿™äº›å­—æ®µï¼Œä½ åªéœ€è¦åˆ¶å®šä½ å…³å¿ƒçš„å­—æ®µï¼Œè¿™æ ·å°±å¯ä»¥è®©ä»£ç æ›´å®¹æ˜“ç»´æŠ¤å’Œæµ‹è¯•ã€‚æ£’æäº†ï¼\næ¥ä¸‹æ¥ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªé€‚é…å™¨ï¼Œä»¥ä¾¿ä½ å¯ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œã€‚\n// Package adapter probably isnâ€™t a great package name, but this is a // demo so deal with it. package adapter type GitHubUserService struct { Client *github.Client } func (us *GitHubUserService) User(token string) (mw.User, error) { ghUser, err := us.Client.User(token) if err != nil { return mw.User{}, err } return mw.User{ OrgIDs: ghUser.OrgIDs, }, nil } type GitLabUserService struct { Client *gitlab.Client } func (us *GitLabUserservice) User(token string) (mw.User, error) { glUser, err := us.Client.User(token) if err != nil { return mw.User{}, err } return mw.User{ OrgIDs: glUser.OrgIDs, }, nil } ä½ ä¹Ÿéœ€è¦æ›´æ–°ä½ çš„mockï¼Œä¸è¿‡è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¿«çš„ä¿®æ”¹ã€‚\npackage mock type UserService struct { UserFn func(token string) (mw.User, error) } func (us *UserService) Authenticate(token string) (mw.User, error) { return us.UserFn(token) } ç°åœ¨ï¼Œå¦‚æœä½ æƒ³å°†æˆ‘ä»¬çš„AuthMiddlewareä¸GitHubæˆ–GitLabä¸€èµ·ä½¿ç”¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œæ“ä½œï¼š\nvar myHandler http.Handler var us mw.UserService us = \u0026amp;GitLabUserservice{ Client: \u0026amp;gitlab.Client{ Key: â€œabc-123â€, }, } // This protects your handler myHandler = mw.AuthMiddleware(us, â€œmy-org-idâ€, myHandler) æˆ‘ä»¬ç»ˆäºæœ‰äº†ä¸€ä¸ªå®Œå…¨è§£è€¦çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åœ¨GitHubå’ŒGitLabä¹‹é—´åˆ‡æ¢ï¼Œå¹¶ä¸”å½“æ–°çš„æºç ç®¡ç†å…¬å¸å‡ºç°æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå¿«è·Ÿä¸Šæ½®æµã€‚\nå¯»æ‰¾ä¸­é—´æ–¹æ¡ˆ åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥çœ‹åˆ°äº†ä»£ç ä»ç´§å¯†è€¦åˆåˆ°å®Œå…¨è§£è€¦çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬ä½¿ç”¨adapteråŒ…æ¥å®Œæˆå¤„ç†è¿™äº›è§£è€¦åçš„mwå’Œgithub/gitlabåŒ…ä¹‹é—´çš„è½¬æ¢ã€‚\nè¿™æ ·åšçš„ä¸»è¦å¥½å¤„æ˜¯æˆ‘ä»¬åœ¨æœ€åçš„æ—¶å€™çœ‹åˆ°çš„ï¼šæˆ‘ä»¬å¯ä»¥åœ¨è‡ªç”±é€‰æ‹©ä½¿ç”¨GitHubæˆ–GitLabè®¤è¯ç­–ç•¥ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹handlerså’Œè®¤è¯ä¸­é—´ä»¶ã€‚\nå°½ç®¡è¿™äº›å¥½å¤„éå¸¸æ£’ï¼Œä½†åœ¨ä¸è€ƒè™‘æˆæœ¬çš„æƒ…å†µä¸‹æ¢ç´¢è¿™äº›å¥½å¤„æ˜¯ä¸å…¬å¹³çš„ã€‚ æ‰€æœ‰è¿™äº›æ›´æ”¹æä¾›äº†è¶Šæ¥è¶Šå¤šçš„ä»£ç ï¼Œå¦‚æœä½ å›è¿‡å¤´å»æŸ¥çœ‹gitlabå’Œmwè½¯ä»¶åŒ…çš„åŸå§‹ç‰ˆæœ¬ï¼Œä½ ä¼šå‘ç°å®ƒä»¬æ¯”éœ€è¦ä½¿ç”¨adapterè½¯ä»¶åŒ…çš„æœ€ç»ˆç‰ˆæœ¬è¦ç®€å•å¾—å¤šã€‚è¿™æ ·ä¹Ÿä¼šä¹Ÿå¯èƒ½å¯¼è‡´æ›´å¤šçš„è®¾ç½®é¡¹ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬ä»£ç çš„æŸä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–æ‰€æœ‰è¿™äº›é€‚é…å™¨å¹¶å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ã€‚\nå¦‚æœæ²¿è¿™æ¡è·¯çº¿ç»§ç»­æ¼”è¿›ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¾ˆå¿«å‘ç°æˆ‘ä»¬ä¹Ÿéœ€è¦è®¸å¤šä¸åŒçš„Userç±»å‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨GitHubï¼ˆæˆ–GitLabï¼‰ç­‰æœåŠ¡ä¸­å°†å†…éƒ¨ç”¨æˆ·ç±»å‹ä¸å¤–éƒ¨ç”¨æˆ·IDå…³è”ã€‚ è¿™å¯èƒ½å¯¼è‡´åœ¨æˆ‘ä»¬çš„æ•°æ®åº“åŒ…ä¸­å®šä¹‰ä¸€ä¸ªExternalUser ï¼Œç„¶åç¼–å†™ä¸€ä¸ªé€‚é…å™¨å°†github.Userè½¬æ¢ä¸ºè¿™ç§ç±»å‹ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„æ•°æ®åº“ä»£ç ä¸æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„æœåŠ¡è§£è€¦ã€‚\nI actually tried doing this on one project with my HTTP handlers just to see how it turned out. Specifically, I isolated every endpoint in my web application to its own package with no external dependencies specific to my web application and ended up with packages like this: å®é™…ä¸Šï¼Œä¸ºäº†è¯æ˜è¿™ä¸ªç»“æœï¼Œæˆ‘åœ¨ä¸€ä¸ªé¡¹ç›®ä¸Šçš„HTTPå¤„ç†ç¨‹åºä¸Šè¿›è¡Œè¿‡å°è¯•ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘å°†Webåº”ç”¨ç¨‹åºä¸­çš„æ¯ä¸ªç«¯ç‚¹éš”ç¦»åˆ°å…¶è‡ªå·±çš„ç¨‹åºåŒ…ä¸­ï¼Œè€Œæ²¡æœ‰ç‰¹å®šäºWebåº”ç”¨ç¨‹åºçš„å¤–éƒ¨ä¾èµ–å…³ç³»ï¼Œæœ€ç»ˆå¾—åˆ°äº†åƒè¿™æ ·çš„ç¨‹åºåŒ…ï¼š\n// Package enroll provides HTTP handlers for enrolling a user into a new // course. // This package is entirely for demonstrative purposes and hasnâ€™t been tested, // but if you do see obvious bugs feel free to let me know and Iâ€™ll address // them. package enroll import ( â€œioâ€ â€œnet/httpâ€ â€œgithub.com/gorilla/schemaâ€ ) // Data defines the data that will be provided to the HTML template when it is // rendered. type Data struct { Form Form // Map of form fields with errors and their error message  Errors map[string]string User User License License } // License is used to show the user more info about what they are enrolling in. // Eg if they URL query params have a valid key, we might show them: // // â€œYou are about to enroll in Gophercises - FREE using the key `abc-123`â€ // ^ ^ ^ // Course Package Key // type License struct { Key string Course string Package string } // User defines a user that can be enrolled in courses. type User struct { ID string // Email is used when rendering a navbar with the userâ€™s email address, among  // other areas of an HTML page.  Email string Avatar string // â€¦ } // Form defines all of the HTML form fields. It assumes the Form will be // rendered using struct tags and a form package I created // (https://github.com/joncalhoun/form), but it isnâ€™t really mandatory as // long as the form field names match the `schema` part here. type Form struct { License string `form:\u0026#34;name=license;label=License key;footer=You can find this in an email sent over by Gumroad after purchasing a course. Or in the case of Gophercises it will be in an email from me (jon@calhoun.io).\u0026#34; schema:\u0026#34;license\u0026#34;` } // Handler provides GET and POST http.Handlers type Handler struct { // Interfaces and function types here serve roughly the same purpose. funcs  // just tend to be easier to write adapters for since you donâ€™t need a  // struct type with a method.  UserFn func(r *http.Request) (User, error) LicenseFn func(key string) (License, error) // Interface because this one is the least likely to need an adapter  Enroller interface { Enroll(userID, licenseKey string) error } // Typically satisfied with an HTML template  Executor interface { Execute(wr io.Writer, data interface{}) error } } // Get handles rendering the Form for a user to enroll in a new course. func (h *Handler) Get() http.HandlerFunc { return func(w http.ResponseWriter, r *http.Request) { user, err := h.UserFn(r) if err != nil { // redirect or render an error  return } var data Data data.User = user var form Form err := r.ParseForm() if err != nil { // maybe log this? We can still render  } dec := schema.NewDecoder() dec.IgnoreUnknownKeys(true) err = dec.Decode(\u0026amp;form, r.Form) if err != nil { // maybe log this? We can still render  } data.Form = form if form.License != â€œâ€ { lic, err := h.LicenseFn(form.License) data.License = lic if err != nil { data.Errors = map[string]string{ â€œlicenseâ€: â€œis not validâ€, } } } h.Executor.Execute(r, data) } } // Post handles processing the form and enrolling a user. func (h *Handler) Post() http.HandlerFunc { return func(w http.ResponseWriter, r *http.Request) { user, err := h.UserFn(r) if err != nil { // redirect or render an error  return } var data Data data.User = user var form Form err := r.ParseForm() if err != nil { // maybe log this? We can still render  } dec := schema.NewDecoder() dec.IgnoreUnknownKeys(true) err = dec.Decode(\u0026amp;form, r.Form) if err != nil { // maybe log this? We can still render  } data.Form = form err = h.Enroller.Enroll(user.ID, form.License) if err != nil { data.Errors = map[string]string{ â€œlicenseâ€: â€œis not validâ€, } // Re-render the form  h.View.Execute(r, data) return } http.Redirect(w, r, â€œ/coursesâ€, http.StatusFound) } } ä»ç†è®ºä¸Šè®²ï¼Œè¿™ä¸ªæƒ³æ³•å¬èµ·æ¥å¾ˆé…·ã€‚ ç°åœ¨ï¼Œæˆ‘å¯ä»¥å•ç‹¬å®šä¹‰æ‰€æœ‰HTTPå¤„ç†ç¨‹åºï¼Œä¸å¿…æ‹…å¿ƒåº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†çš„å½±å“ã€‚ æ¯ä¸ªåŒ…éƒ½å¯ä»¥è½»æ¾æµ‹è¯•ï¼Œå½“æˆ‘ç¼–å†™è¿™äº›ç‹¬ç«‹çš„ä½œå“æ—¶ï¼Œæˆ‘å‘ç°è‡ªå·±çš„å·¥ä½œæ•ˆç‡éå¸¸é«˜ã€‚ æˆ‘ç”šè‡³æœ‰ä¸€ä¸ªåä¸ºExecutorçš„æ¥å£ï¼Œè°ä¸æƒ³åœ¨ä»–ä»¬çš„ä»£ç ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„æ‰§è¡Œå™¨ï¼Ÿï¼\nåœ¨å®è·µä¸­ï¼Œè¿™ä¸ªæƒ³æ³•å¯¹æˆ‘çš„ç‰¹å®šç”¨ä¾‹è€Œè¨€å¤ªç³Ÿç³•äº†ã€‚æ˜¯çš„ï¼Œè¿™ç§æ–¹æ³•ç¡®å®æœ‰å¥½å¤„ï¼Œä½†æ˜¯å®ƒä»¬å¹¶æ²¡æœ‰è¶…è¿‡ç¼–å†™æ‰€æœ‰è¿™äº›ä»£ç çš„æˆæœ¬ã€‚ åœ¨åˆ›å»ºenrollå’Œç±»ä¼¼è½¯ä»¶åŒ…çš„å†…éƒ¨ç»„ä»¶æ—¶ï¼Œæˆ‘çš„å·¥ä½œæ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯æˆ‘èŠ±äº†å¾ˆå¤šæ—¶é—´ç¼–å†™é€‚é…å™¨å¹¶å°†å„ä¸ªéƒ¨åˆ†è¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™ä½¿æˆ‘çš„æ•´ä½“ç”Ÿäº§ç‡ä¸‹é™äº†ã€‚ æˆ‘æ‰¾ä¸åˆ°ä¸€ç§æ— éœ€ç¼–å†™è‡ªå®šä¹‰UserFn ï¼Œ LicenseFnçš„å¿«é€Ÿæ–¹æ³•å°±å¯ä»¥å°†å…¶å¼•å…¥åˆ°ä»£ç ä¸­çš„æ–¹æ¡ˆï¼Œè€Œä¸”æˆ‘å‘ç°è‡ªå·±ä¸ºå¸¦æœ‰HTTPå¤„ç†ç¨‹åºçš„æ¯ä¸ªç¨‹åºåŒ…ç¼–å†™äº†ä¸€å †å‡ ä¹ç›¸åŒçš„UserFnå˜ç§ã€‚\nè¿™å¼•å‡ºäº†æœ¬èŠ‚çš„ä¸»é¢˜- æ˜¯å¦æœ‰åŠæ³•å®ç°å¯æ¥å—çš„ä¸­é—´æ–¹æ¡ˆï¼Ÿ\næˆ‘å–œæ¬¢å°†æˆ‘çš„ä»£ç ä¸ç¬¬ä¸‰æ–¹ä¾èµ–é¡¹è§£è€¦ã€‚æˆ‘ä¹Ÿå–œæ¬¢ç¼–å†™å¯æµ‹è¯•çš„ä»£ç ã€‚ä½†æ˜¯æˆ‘ä¸å–œæ¬¢é€šè¿‡åŠ å€çš„ç¼–ç å·¥ä½œæ¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚å½“ç„¶ï¼Œè¿™é‡Œå¿…ç„¶æœ‰ä¸€ä¸ªä¸­é—´æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨æ²¡æœ‰æ‰€æœ‰é¢å¤–ä»£ç çš„æƒ…å†µä¸‹ä¸ºæˆ‘ä»¬æä¾›å¤§å¤šæ•°å¥½å¤„ï¼Œå¯¹å—ï¼Ÿ\næ˜¯çš„ï¼Œæ˜¯æœ‰ä¸­é—´æ–¹æ¡ˆçš„ï¼Œæ‰¾åˆ°å®ƒçš„å…³é”®ä¸æ˜¯æ¶ˆé™¤æ‰€æœ‰è€¦åˆï¼Œè€Œæ˜¯æœ‰æ„åœ°é€‰æ‹©ä»£ç æ‰€è€¦åˆçš„å†…å®¹ã€‚\nè®©æˆ‘ä»¬å›åˆ°githubå’ŒgitlabåŒ…çš„åŸå§‹ç¤ºä¾‹ã€‚åœ¨æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼ˆç´§å¯†è€¦åˆç‰ˆæœ¬ï¼‰ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªmwåŒ…æ‰€ä¾èµ–çš„github.Userç±»å‹ã€‚ å®ƒæ»¡è¶³ä½¿ç”¨ï¼Œå¹¶ä¸”æˆ‘ä»¬ç”šè‡³å¯ä»¥å›´ç»•å®ƒæ„å»ºæ¥å£ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶ä¸githubåŒ…ç´§å¯†è€¦åˆã€‚\nåœ¨ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼ˆè§£è€¦ç‰ˆæœ¬ï¼‰ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªgithub.User ï¼Œgitlab.Userå’Œmw.Userã€‚ è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè§£è€¦æ‰€æœ‰å†…å®¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»åˆ›å»ºå°†è¿™äº›è§£è€¦çš„ä»£ç è¿æ¥åœ¨ä¸€èµ·çš„é€‚é…å™¨ã€‚\nThe middle ground, and the third version we will explore, is to intentionally define a User type that every package is allowed to be tightly coupled to. By doing this, we are intentionally choosing where that coupling happens and can make that decision in a way that still makes it easy to test, swap implementations, and do everything else we desire from decoupled code. æˆ‘ä»¬å³å°†æ¢ç´¢çš„ç¬¬ä¸‰ç§ä¸­é—´æ–¹æ¡ˆï¼Œæ˜¯æœ‰æ„å…è®¸å®šä¹‰æ¯ä¸ªåŒ…ç´§å¯†è€¦åˆçš„Userç±»å‹ã€‚é€šè¿‡è¿™ç§æ“ä½œï¼Œæˆ‘ä»¬åˆ»æ„é€‰æ‹©å‘ç”Ÿè€¦åˆçš„ä½ç½®ï¼Œå¹¶ä¸”ä¿è¯æ˜“äºæµ‹è¯•ã€æ–¹ä¾¿å®ç°äº¤æ¢å’Œæ˜“äºå…¶ä»–ä¸ºè§£è€¦ä»£ç å®ç°çš„ä¸€åˆ‡æ–¹å¼ã€‚\né¦–å…ˆæ˜¯æˆ‘ä»¬çš„Userç±»å‹ã€‚ è¿™å°†åœ¨domainåŒ…ä¸­åˆ›å»ºï¼Œæˆ‘ä»¬åº”ç”¨ä¸­çš„ä»»ä½•å…¶ä»–åŒ…éƒ½å¯ä»¥å¯¼å…¥ã€‚\npackage domain type User struct { ID string Email string OrgIDs []string } æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é‡å†™githubå’Œgitlabè½¯ä»¶åŒ…ä»¥åˆ©ç”¨æ­¤domain.Userç±»å‹ã€‚ è¿™äº›åŸºæœ¬ç›¸åŒï¼Œå› ä¸ºæˆ‘å»é™¤äº†æ‰€æœ‰çš„çœŸå®é€»è¾‘ï¼Œåªå±•ç¤ºå…¶ä¸­ä¸€ä¸ªã€‚\npackage gitlab // github is the same basically  type Client struct { Key string } // Note the return type is domain.User here - this code is now coupled to our // domain. func (c *Client) User(token string) (domain.User, error) { // â€¦ interact with the gitlab API, and return a user if they are in an org with the c.OrgID } æœ€åï¼Œæˆ‘ä»¬æœ‰äº†mwè½¯ä»¶åŒ…ã€‚\npackage mw type UserService interface { User(token string) (domain.User, error) } func AuthMiddleware(us UserService, reqOrgID string, next http.Handler) http.Handler { // unchanged } æˆ‘ä»¬ç”šè‡³å¯ä»¥ä½¿ç”¨æ­¤ç¼–å†™ä¸€ä¸ªæ¨¡æ‹ŸåŒ…ã€‚\npackage mock type UserService struct { UserFn func(token string) (domain.User, error) } func (us *UserService) Authenticate(token string) (domain.User, error) { return us.UserFn(token) } é¢†åŸŸé©±åŠ¨è®¾è®¡ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä¸€ç›´åŠªåŠ›é¿å…ä½¿ç”¨ä»»ä½•ä»¤äººå›°æƒ‘çš„æœ¯è¯­ï¼Œå› ä¸ºæˆ‘å‘ç°å®ƒä»¬é€šå¸¸ä¼šä½¿é—®é¢˜å˜å¾—å¤æ‚è€Œä¸æ˜¯ç®€åŒ–å®ƒä»¬ã€‚å¦‚æœä½ ä¸ç›¸ä¿¡æˆ‘ï¼Œè¯·å°è¯•é˜…è¯»æœ‰å…³åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„ä»»ä½•æ–‡ç« ï¼Œä¹¦ç±æˆ–å…¶ä»–èµ„æºã€‚ä»–ä»¬å‡ ä¹æ€»æ˜¯ä½¿ä½ åœ¨ä»£ç ä¸­å®é™…å®ç°æƒ³æ³•å¸¦æ¥æ›´å¤šçš„ç–‘é—®å’Œæ›´å°‘çš„æ˜ç¡®ç­”æ¡ˆã€‚\næˆ‘ä¸æ˜¯åœ¨è¯´æ˜DDDæ²¡æœ‰ç”¨ï¼Œä¹Ÿä¸æ˜¯åœ¨å»ºè®®ä½ ä¸è¦è¯»é‚£äº›ä¹¦ã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œæˆ‘çš„å¾ˆå¤šï¼ˆå¤§å¤šæ•°ï¼‰è¯»è€…åœ¨è¿™é‡Œæ˜¯ä¸ºäº†å¯»æ±‚æœ‰å…³å¦‚ä½•æ”¹è¿›å…¶ä»£ç çš„æ›´å®ç”¨å»ºè®®ï¼Œè€Œä¸æ˜¯è®¨è®ºè½¯ä»¶å¼€å‘ç†è®ºã€‚\nä»å®é™…çš„æ‰§è¡Œè§’åº¦æ¥çœ‹ï¼Œé¢†åŸŸé©±åŠ¨è®¾è®¡çš„ä¸»è¦å¥½å¤„æ˜¯ç¼–å†™å¯ä»¥éšæ—¶é—´å˜åŒ–è€Œå˜åŒ–çš„è½¯ä»¶ã€‚æˆ‘å‘ç°åœ¨Goä¸­å®ç°æ­¤ç›®æ ‡çš„æœ€ä½³æ–¹æ³•æ˜¯æ¸…æ¥šåœ°å®šä¹‰ä½ çš„é¢†åŸŸç±»å‹ï¼Œç„¶åç¼–å†™ä¾èµ–äºè¿™äº›ç±»å‹çš„å®ç°ã€‚è¿™ä»ç„¶ä¼šå¯¼è‡´ä»£ç è€¦åˆï¼Œä½†æ˜¯ç”±äºä½ çš„é¢†åŸŸä¸é—®é¢˜ç´§å¯†ç›¸å…³ï¼Œå› æ­¤ä½ è§£å†³è¿™ç§è€¦åˆå¹¶ä¸å›°éš¾ã€‚å®é™…ä¸Šï¼Œæˆ‘ç»å¸¸å‘ç°ï¼Œéœ€è¦å¯¹é¢†åŸŸæ¨¡å‹è¿›è¡Œæ¸…æ™°çš„å®šä¹‰æ˜¯æœ‰å¯å‘æ€§çš„ï¼Œè€Œä¸æ˜¯éº»çƒ¦çš„ã€‚\næ³¨æ„ï¼šå®šä¹‰å…·ä½“é¢†åŸŸç±»å‹å¹¶å°†ä»£ç è€¦åˆåˆ°å®ƒä»¬çš„æƒ³æ³•å¹¶ä¸æ˜¯ç‹¬åˆ›çš„æˆ–æ–°é¢–çš„ã€‚æœ¬Â·çº¦ç¿°é€Šåœ¨2016å¹´æ’°å†™çš„ è¿™ç¯‡æ–‡ç« ï¼Œå¯¹äºä»»ä½•æ–°å…¥é—¨çš„Gopheræ¥è¯´ä»ç„¶æ˜¯éå¸¸æœ‰ä»·å€¼çš„æ–‡ç« ã€‚\nå›åˆ°å‰é¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨domainåŒ…ä¸­å®šä¹‰äº†æˆ‘ä»¬çš„é¢†åŸŸ ï¼š\npackage domain type User struct { ID string Email string OrgIDs []string } å†è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å¼€å§‹å®šä¹‰åŸºæœ¬çš„æ„å»ºå—ï¼Œè€Œæˆ‘ä»¬çš„å…¶ä½™åº”ç”¨å¯ä»¥å®ç°æˆ–è€…åœ¨ä¸ä¸å®ç°ç»†èŠ‚è€¦åˆçš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚ ä¾‹å¦‚æˆ‘ä»¬çš„UserService ï¼š\npackage domain type User struct { â€¦ } type UserService interface { User(token string) (User, error) } è¿™æ˜¯ç”±githubå’ŒgitlabåŒ…å®ç°çš„æ¥å£ï¼Œå¹¶åœ¨mwåŒ…ä¸­ä½¿ç”¨ã€‚ å®ƒä¹Ÿå¯ä»¥è¢«æˆ‘ä»¬ä»£ç ä¸­çš„å…¶ä»–è½¯ä»¶åŒ…æ‰€ä½¿ç”¨ï¼Œè€Œä¸ç”¨å…³å¿ƒå®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚è€Œä¸”ç”±äºå®ƒæ˜¯åœ¨é¢†åŸŸä¸­å®šä¹‰çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒæ¯ä¸ªå®ç°çš„è¿”å›ç±»å‹éƒ½ä¼šæœ‰æ‰€å˜åŒ–-å®ƒä»¬éƒ½åŸºäºä¸€ä¸ªé€šç”¨çš„å®šä¹‰å¯ä»¥æ„å»ºã€‚\néšç€åº”ç”¨ç¨‹åºçš„å‘å±•å’Œå˜åŒ–ï¼Œè¿™ç§å®šä¹‰é€šç”¨æ¥å£çš„æƒ³æ³•å˜å¾—æ›´åŠ å¼ºå¤§ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç¨å¾®å¤æ‚çš„UserService ï¼šä¹Ÿè®¸å®ƒä¼šå¤„ç†åˆ›å»ºç”¨æˆ·ï¼ŒéªŒè¯ç”¨æˆ·ï¼Œé€šè¿‡ä»¤ç‰ŒæŸ¥æ‰¾ç”¨æˆ·ï¼Œé€šè¿‡å¯†ç é‡ç½®ä»¤ç‰Œï¼Œæ›´æ”¹å¯†ç ç­‰æ“ä½œã€‚\npackage domain type UserStore interface { Create(NewUser) (*User, RememberToken, error) Authenticate(email, pw string) (*User, RememberToken, error) ByToken(RememberToken) (*User, error) ResetToken(email string) (ResetToken, error) UpdatePw(pw string, tok ResetToken) (RememberToken, error) } æˆ‘ä»¬å¯èƒ½é¦–å…ˆä½¿ç”¨çº¯SQLä»£ç å’Œæœ¬åœ°æ•°æ®åº“æ¥å®ç°ï¼š\npackage sql type UserStore struct { DB *sql.DB } func (us *UserStore) Create(newUser domain.NewUser) (*domain.User, domain.RememberToken, error) { // â€¦ } // â€¦ and more methods å³ä¾¿å½“æˆ‘ä»¬åªæœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œä½†æ˜¯ä¹Ÿè®¸æˆ‘ä»¬ä¼šæˆé•¿ä¸ºå¦ä¸€ä¸ªGoogleï¼Œæˆ‘ä»¬å†³å®šä¸€ä¸ªé›†ä¸­çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œè¿™æ ·æˆ‘ä»¬æ‰€æœ‰å•ç‹¬çš„åº”ç”¨éƒ½å¯ä»¥ä½¿ç”¨è¿™å¥—ç³»ç»Ÿã€‚\nå¦‚æœæˆ‘ä»¬å°†ä»£ç è€¦åˆåˆ°sqlå®ç°ï¼Œè¿™åŸºæœ¬å¾ˆéš¾å®ç°ï¼Œä½†æ˜¯ç”±äºå¤§å¤šæ•°ä»£ç éƒ½è€¦åˆåˆ°domain.UserServiceæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªæ–°çš„å®ç°å¹¶ä½¿ç”¨ã€‚\npackage userapi type UserStore struct { HTTPClient *http.Client } func (us *UserStore) Create(newUser domain.NewUser) (*domain.User, domain.RememberToken, error) { // interact with a third party API instead of a local SQL database } // â€¦ ä¸€èˆ¬è€Œè¨€ï¼Œè€¦åˆåˆ°é¢†åŸŸè€Œä¸æ˜¯ç‰¹å®šçš„å®ç°æ–¹å¼ä½¿æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒè¯¸å¦‚ä»¥ä¸‹çš„ç»†èŠ‚ï¼š\n æˆ‘ä»¬æ­£åœ¨ä¸å¾®æœåŠ¡æˆ–æœ¬åœ°æ•°æ®åº“è¿›è¡Œäº¤äº’å—ï¼Ÿ æ— è®ºæˆ‘ä»¬çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿæ˜¯æœ¬åœ°SQLæ•°æ®åº“è¿˜æ˜¯å¾®æœåŠ¡ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åœ¨åˆç†çš„æ—¶é—´å†…å®Œæˆä»£ç ç¼–å†™ã€‚ *æˆ‘ä»¬æ˜¯å¦é€šè¿‡JSONï¼ŒGraphQLï¼ŒgRPCæˆ–å…¶ä»–æ–¹å¼ä¸ç”¨æˆ·APIé€šä¿¡ï¼Ÿ å°½ç®¡æˆ‘ä»¬çš„å®ç°éœ€è¦çŸ¥é“å¦‚ä½•ä¸ç”¨æˆ·APIè¿›è¡Œé€šä¿¡ï¼Œä½†æ˜¯æ— è®ºæˆ‘ä»¬ä½¿ç”¨å“ªç§ç‰¹å®šæŠ€æœ¯ï¼Œæˆ‘ä»¬å…¶ä½™çš„ä»£ç éƒ½å°†ç»§ç»­ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œã€‚ å…¶ä»–æ›´å¤šâ€¦  ä»æ ¹æœ¬ä¸Šè®²ï¼Œè¿™å°±æ˜¯æˆ‘è®¤ä¸ºé¢†åŸŸé©±åŠ¨è®¾è®¡çš„ä¸»è¦å¥½å¤„ã€‚è¿™ä¸æ˜¯èŠ±å“¨çš„æœ¯è¯­ï¼Œè‰²å½©é²œè‰³çš„å›¾å½¢ï¼Œä¹Ÿä¸æ˜¯åœ¨åŒäº‹é¢å‰ç‚«è€€èªæ˜ã€‚çº¯ç²¹æ˜¯è®¾è®¡èƒ½å¤Ÿä¸æ–­å‘å±•ä»¥æ»¡è¶³ä¸æ–­å˜åŒ–çš„éœ€æ±‚çš„è½¯ä»¶ã€‚\nä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä»é¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å§‹ï¼Ÿ æ˜¾è€Œæ˜“è§çš„åç»­é—®é¢˜æ˜¯ï¼šâ€œå¦‚æœå®ƒæ˜¯å¦‚æ­¤å‡ºè‰²ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸åªæ˜¯ä»é¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å§‹å‘¢ï¼Ÿâ€\nä»»ä½•æœ‰ä½¿ç”¨æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰ç»éªŒçš„äººéƒ½ä¼šå‘Šè¯‰ä½ ï¼Œå®ƒå¾ˆå®¹æ˜“å‘ç”Ÿç´§å¯†è€¦åˆã€‚å‡ ä¹æˆ‘ä»¬æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½å°†éœ€è¦ä¾èµ–äºæˆ‘ä»¬çš„æ¨¡å‹ï¼Œè€Œæˆ‘ä»¬åªæ˜¯æ¢è®¨äº†è¿™å¯èƒ½ä¼šå¸¦æ¥é—®é¢˜ã€‚é‚£æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ\nä»å…¬ç”¨é¢†åŸŸè¿›è¡Œæ„å»ºè™½ç„¶å¾ˆæœ‰ç”¨ï¼Œä½†å¦‚æœæ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€åœºå™©æ¢¦ã€‚é¢†åŸŸé©±åŠ¨è®¾è®¡å…·æœ‰ç›¸å½“é™¡å³­çš„å­¦ä¹ æ›²çº¿ï¼šå¹¶ä¸æ˜¯å› ä¸ºè¿™äº›æƒ³æ³•ç‰¹åˆ«éš¾äºæŒæ¡ï¼Œè€Œæ˜¯å› ä¸ºåœ¨é¡¹ç›®å‘å±•åˆ°åˆç†è§„æ¨¡ä¹‹å‰ï¼Œä½ å¾ˆå°‘äº†è§£åœ¨åº”ç”¨è¿™äº›æƒ³æ³•æ—¶å“ªé‡Œå‡ºé”™äº†ã€‚ç»“æœæ˜¯å¯èƒ½è¦èŠ±å‡ å¹´çš„æ—¶é—´æ‰èƒ½çœŸæ­£æŒæ¡æ‰€æœ‰æ¶‰åŠçš„åŠ¨æ€æ¼”åŒ–ã€‚æˆ‘å·²ç»å†™äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„è½¯ä»¶äº†ï¼Œä½†æˆ‘ä»ç„¶æ„Ÿè§‰ä¸åˆ°æˆ‘å¯¹æ‰€æœ‰å¯èƒ½å‡ºé”™æˆ–å˜å¾—å¤æ‚çš„æ–¹å¼éƒ½æ‹¥æœ‰å®Œå…¨çš„äº†è§£ã€‚\n*æ³¨æ„ï¼šè¿™æ˜¯æˆ‘èŠ±è¿™ä¹ˆé•¿æ—¶é—´å‘å¸ƒæœ¬æ–‡çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚åœ¨å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»ç„¶å¯¹åˆ†äº«ä¿æœ‰ç–‘è™‘ï¼Œæˆ‘ä¸è§‰å¾—è‡ªå·±æ˜¯è¿™ä¸ªä¸»é¢˜çš„ä¸“å®¶ã€‚ä½†æ˜¯ï¼Œæˆ‘æœ€ç»ˆå†³å®šåˆ†äº«ï¼Œå› ä¸ºæˆ‘ç›¸ä¿¡å…¶ä»–äººå¯ä»¥ä»æˆ‘çš„æœ‰é™ç†è§£ä¸­å­¦åˆ°ä¸œè¥¿ï¼Œå¹¶ä¸”æˆ‘ç›¸ä¿¡éšç€ä¸å…¶ä»–å¼€å‘äººå‘˜è¿›è¡Œè®¨è®ºï¼Œæœ¬æ–‡ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå‘å±•å’Œæ”¹è¿›ã€‚å› æ­¤ï¼Œéšæ—¶æ¬¢è¿ä¸æˆ‘è¿›è¡Œè®¨è®º -jon@calhoun.io *\nMVCä¸ºä½ æä¾›äº†ç»„ç»‡ä»£ç çš„åˆç†èµ·ç‚¹ã€‚æ•°æ®åº“äº¤äº’åœ¨æ¨¡å‹å±‚ï¼Œhttpå¤„ç†ç¨‹åºåœ¨æ§åˆ¶å™¨å±‚ï¼Œæ¸²æŸ“ä»£ç åœ¨è§†å›¾å±‚ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ç´§å¯†è€¦åˆï¼Œä½†å¯ä»¥è®©ä½ å¿«é€Ÿå…¥é—¨ã€‚\nä¸MVCä¸åŒï¼Œé¢†åŸŸé©±åŠ¨è®¾è®¡ä¸ä¼šä¸ºä½ æä¾›ç»„ç»‡ä»£ç çš„åˆç†èµ·ç‚¹ã€‚å®é™…ä¸Šï¼Œä»DDDå¼€å§‹ä¸ä»MVCå¼€å§‹å‡ ä¹å®Œå…¨ç›¸åï¼šä¸æ˜¯ç›´æ¥è¿›å…¥æ„å»ºæ§åˆ¶å™¨å¹¶æŸ¥çœ‹æ¨¡å‹å¦‚ä½•å‘å±•ï¼Œç›¸åï¼Œä½ å¿…é¡»èŠ±å¤§é‡æ—¶é—´é¢„å…ˆç¡®å®šé¢†åŸŸåº”è¯¥æ˜¯ä»€ä¹ˆã€‚è¿™å¯èƒ½åŒ…æ‹¬æ¨¡æ‹Ÿä¸€äº›æƒ³æ³•å¹¶è®©åŒäº‹è¿›è¡Œå®¡æŸ¥ï¼Œè®¨è®ºä»€ä¹ˆæ˜¯æ­£ç¡®/ä¸æ­£ç¡®çš„ï¼Œå‡ ä¸ªè¿­ä»£å‘¨æœŸï¼Œç„¶åæ‰å¯ä»¥æŠ•å…¥åˆ°ç¼–å†™ä¸€äº›ä»£ç ä¸­ã€‚ ä½ å¯ä»¥åœ¨ Ben Johnsonçš„WTF Dialé¡¹ç›® ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ï¼Œä»–åœ¨è¯¥ é¡¹ç›® ä¸­åˆ›å»ºäº†PRï¼Œå¹¶ä¸Peter Bourgonï¼ŒEgon Elbreå’ŒMarcus Olssonè®¨è®ºäº†é¢†åŸŸç›¸å…³å†…å®¹ã€‚\nè¿™å¹¶ä¸æ˜¯ä¸€ä»¶åäº‹ï¼Œä½†æ­£ç¡®èµ·æ¥ä¹Ÿä¸å®¹æ˜“ï¼Œå®ƒéœ€è¦å¤§é‡çš„å‰æœŸå·¥ä½œã€‚ å› æ­¤ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæ›´å¤§çš„å›¢é˜Ÿï¼Œæ¯ä¸ªäººéƒ½éœ€è¦åœ¨æŸä¸ªå…±åŒé¢†åŸŸä¸Šè¾¾æˆå…±è¯†ï¼Œç„¶åæ‰èƒ½å¼€å§‹å¼€å‘ï¼Œé‚£ä¹ˆæˆ‘é€šå¸¸ä¼šå‘ç°è¿™ç§æ–¹æ³•æœ€æœ‰æ•ˆã€‚\né‰´äºæˆ‘ç»å¸¸åœ¨è¾ƒå°çš„å›¢é˜Ÿä¸­ï¼ˆæˆ–ç”±æˆ‘è‡ªå·±ï¼‰è¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥æˆ‘å‘ç°ï¼Œå¦‚æœæˆ‘ä»ç®€å•çš„äº‹æƒ…å¼€å§‹ï¼Œæˆ‘çš„é¡¹ç›®å°±ä¼šè‡ªç„¶å‘å±•ã€‚ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ª å¹³é“ºç»“æ„ ï¼Œä¹Ÿè®¸æ˜¯ ä¸€ä¸ªmvcç»“æ„ ï¼Œæˆ–è€…ä¹Ÿè®¸å®Œå…¨æ˜¯å…¶ä»–ä¸œè¥¿ã€‚ åªè¦æˆ‘å¯¹ä»£ç çš„å‘å±•ä¿æŒå¼€æ”¾çš„æ€åº¦ï¼Œæˆ‘å°±ä¸ä¼šå¤ªç€è¿·äºé‚£äº›ç»†èŠ‚ã€‚è¿™ä½¿å®ƒæœ€ç»ˆå¯ä»¥é‡‡ç”¨DDDä¹‹ç±»çš„å½¢å¼ï¼Œä½†æ˜¯ä¸éœ€è¦æˆ‘ä»é‚£é‡Œå¼€å§‹ã€‚å¦‚å‰æ‰€è¿°ï¼Œå¯¹äºå¤§å‹ç»„ç»‡ï¼ˆæ¯ä¸ªäººéƒ½ä¸€èµ·å¼€å‘åŒä¸€åº”ç”¨ç¨‹åºï¼‰è€Œè¨€ï¼Œè¿™æ ·åšå¯èƒ½ä¼šæ¯”è¾ƒå›°éš¾ï¼Œå› æ­¤é€šå¸¸éœ€è¦è¿›è¡Œæ›´å¤šçš„å‰æœŸè®¾è®¡è®¨è®ºã€‚\nåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬åšäº†ä¸â€œè®©å®ƒä¸æ–­å‘å±•â€çš„æ¦‚å¿µéå¸¸ç›¸ä¼¼çš„äº‹æƒ…ã€‚æ¯ä¸€æ­¥éƒ½æ˜¯ä¸ºç‰¹å®šç›®çš„è€Œé‡‡å–çš„ï¼šæˆ‘ä»¬æ·»åŠ äº†UserServiceæ¥å£ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æµ‹è¯•èº«ä»½éªŒè¯ä¸­é—´ä»¶ã€‚ å½“æˆ‘ä»¬å¼€å§‹ä»GitHubè¿ç§»åˆ°GitLabæ—¶ï¼Œæˆ‘ä»¬æ„è¯†åˆ°æˆ‘ä»¬çš„æ¥å£ä¸å¤Ÿç”¨ï¼Œå› æ­¤æˆ‘ä»¬æ¢ç´¢äº†å…¶ä»–é€‰æ‹©ã€‚ å›´ç»•è¿™ä¸€ç‚¹ï¼Œæˆ‘è®¤ä¸ºä¸€ç§è®©å˜å¾—æœ‰æ„ä¹‰DDDçš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯çŒœæµ‹Userå’ŒUserServiceæ¥å£ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸€äº›å®é™…çš„å®ç°åŸºç¡€è¿›è¡ŒéªŒè¯ã€‚\nä»¥DDDå¼€å¤´çš„å¦ä¸€ä¸ªæ½œåœ¨é—®é¢˜æ˜¯ç±»å‹å®šä¹‰ä¸è¶³ï¼Œå› ä¸ºæˆ‘ä»¬ç»å¸¸åœ¨æ‹¥æœ‰å…·ä½“ç”¨ä¾‹ä¹‹å‰å°±å®šä¹‰å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½å†³å®šå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å¦‚ä¸‹æ‰€ç¤ºï¼š\ntype UserAuthenticator interface { Authenticate(email, pw string) (error) } ä½†æ˜¯åæ¥ï¼Œæˆ‘ä»¬æ„è¯†åˆ°ï¼Œå®é™…ä¸Šï¼Œæ¯å½“æˆ‘ä»¬å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œæˆ‘ä»¬ç¡®å®å¸Œæœ›è¿”å›è¯¥ç”¨æˆ·ï¼ˆæˆ–è®°ä½çš„ä»¤ç‰Œï¼‰ï¼Œå¹¶ä¸”é€šè¿‡é¢„å…ˆå®šä¹‰æ­¤æ¥å£ï¼Œè€Œä¹‹å‰æˆ‘ä»¬é”™è¿‡äº†è¿™ä¸€ç»†èŠ‚ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ç¬¬äºŒç§æ–¹æ³•æ¥æ£€ç´¢æ­¤ä¿¡æ¯ï¼Œæˆ–è€…æˆ‘ä»¬éœ€è¦æ›´æ”¹UserAuthenticatorç±»å‹å¹¶é‡æ„å®ç°åˆ©ç”¨æ­¤åŠŸèƒ½çš„ä»»ä½•ä»£ç ã€‚\nåŒæ ·çš„æƒ…å†µé€‚ç”¨äºä½ çš„æ¨¡å‹ã€‚åœ¨å®é™…å®ç°githubå’Œgitlabè½¯ä»¶åŒ…ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè®¤ä¸ºï¼Œæˆ‘ä»¬åœ¨Useræ¨¡å‹ä¸Šå”¯ä¸€éœ€è¦çš„è¯†åˆ«ä¿¡æ¯æ˜¯Emailå­—æ®µï¼Œä½†æ˜¯æˆ‘ä»¬ç¨åå¯èƒ½ä¼šåœ¨å®ç°è¿™äº›æœåŠ¡æ—¶æ„è¯†åˆ°ç”µå­é‚®ä»¶åœ°å€å¯ä»¥æ›´æ”¹çš„ï¼Œè€Œæˆ‘ä»¬è¿˜éœ€è¦IDå­—æ®µç”¨äºå”¯ä¸€æ ‡è¯†ç”¨æˆ·ã€‚\nåœ¨ä½¿ç”¨é¢†åŸŸæ¨¡å‹ä¹‹å‰å®šä¹‰æ˜¯ä¸€é¡¹æŒ‘æˆ˜ã€‚é™¤éæˆ‘ä»¬å·²ç»éå¸¸äº†è§£æˆ‘ä»¬æ­£åœ¨ç ”ç©¶çš„é¢†åŸŸï¼Œå¦åˆ™æˆ‘ä»¬æä¸å¯èƒ½çŸ¥é“æˆ‘ä»¬éœ€è¦åšä»€ä¹ˆå’Œä¸éœ€è¦åšä»€ä¹ˆã€‚æ˜¯çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»åœ¨ä»¥åé‡æ„ä»£ç ï¼Œä½†æ˜¯å¦‚æœä½ é”™è¯¯å®šä¹‰äº†é¢†åŸŸï¼Œä¸ä½¿ç”¨DDDä¼šå¾ˆå¤šæ¯”é‡æ„æ•´ä¸ªä»£ç åº“æ›´å®¹æ˜“ã€‚ è¿™æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¸ä»‹æ„ä»ç´§å¯†è€¦åˆçš„ä»£ç å¼€å§‹å¹¶åœ¨ä»¥åè¿›è¡Œé‡æ„çš„å¦ä¸€ä¸ªåŸå› ã€‚\næœ€åï¼Œå¹¶éæ‰€æœ‰ä»£ç éƒ½éœ€è¦è¿™ç§è§£è€¦ï¼Œå®ƒå¹¶ä¸èƒ½æ€»æ˜¯èƒ½å¤Ÿå¸¦æ¥å¥½å¤„ï¼Œå¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚DBï¼‰ï¼Œæˆ‘ä»¬å¾ˆå°‘åˆ©ç”¨è¿™ç§è§£è€¦ã€‚\nå¯¹äºä¸ç»§ç»­ç ”å‘çš„é¡¹ç›®ï¼Œä½ å¯èƒ½ä¸éœ€è¦èŠ±è´¹æ‰€æœ‰æ—¶é—´æ¥è§£è€¦ä»£ç ã€‚å¦‚æœä»£ç æ²¡æœ‰ç»§ç»­ç ”å‘ï¼Œé‚£ä¹ˆæ›´æ”¹çš„å¯èƒ½æ€§å°†å¤§å¤§é™ä½ï¼Œè€Œä¸ºä»£ç åšå‡†å¤‡è€Œä»˜å‡ºçš„é¢å¤–åŠªåŠ›å¯èƒ½åªæ˜¯æµªè´¹äº†ã€‚\næ­¤å¤–ï¼Œè§£è€¦å¹¶ä¸æ€»æ˜¯èƒ½æä¾›å®ƒæ‰€æ‰¿è¯ºçš„å¥½å¤„ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šæ€»æ˜¯åˆ©ç”¨è¿™ç§è§£è€¦çš„ä¼˜åŠ¿ã€‚ æ­£å¦‚Mat Ryeræ‰€æŒ‡å‡ºçš„é‚£æ · ï¼Œæˆ‘ä»¬å¾ˆå°‘ä¼šæ¢æ‰æ•°æ®åº“å®ç°ã€‚ å³ä½¿æˆ‘ä»¬ç¡®å®å®ç°äº†æ‰€æœ‰åŠŸèƒ½çš„åˆ†ç¦»ï¼Œå³ä½¿æˆ‘ä»¬ç¢°å·§åªåœ¨å°‘æ•°æ­£åœ¨è¿ç§»æ•°æ®åº“çš„åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™ç§è¿ç§»é€šå¸¸ä¹Ÿéœ€è¦å½»åº•é‡æ–°è€ƒè™‘æˆ‘ä»¬ä¸æ•°æ®å­˜å‚¨ä¹‹é—´çš„äº¤äº’æ–¹å¼ã€‚ æ¯•ç«Ÿï¼ŒNoSQLæ•°æ®åº“çš„è¡Œä¸ºä¸SQLæ•°æ®åº“å®Œå…¨ä¸åŒï¼Œè¦çœŸæ­£åˆ©ç”¨ä¸¤è€…ï¼Œæˆ‘ä»¬å¿…é¡»ç¼–å†™æ‰€ä½¿ç”¨æ•°æ®åº“çš„ç‰¹å®šä»£ç ã€‚æœ€ç»ˆç»“æœæ˜¯è¿™äº›æŠ½è±¡å¹¶ä¸æ€»æ˜¯ä¸ºæˆ‘ä»¬æä¾›æˆ‘ä»¬æƒ³è¦çš„ç¥å¥‡çš„â€œå®ç°æ— å…³â€çš„ç»“æœã€‚\nè¿™å¹¶ä¸æ„å‘³ç€DDDä¸èƒ½æä¾›ä¼˜åŠ¿ï¼Œè€Œæ˜¯æ„å‘³ç€æˆ‘ä»¬ä¸åº”è¯¥ç®€å•åœ° é¡¶ç¤¼è†œæ‹œ å¹¶æœŸå¾…ç¥å¥‡æ•ˆæœã€‚æˆ‘ä»¬éœ€è¦åœä¸‹æ¥è‡ªæˆ‘åæ€ã€‚\nç»¼ä¸Šæ‰€è¿° åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ç ”ç©¶äº†ä»£ç ç´§å¯†è€¦åˆæ—¶é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶æ¢è®¨äº†å®šä¹‰é¢†åŸŸç±»å‹å’Œæ¥å£å¦‚ä½•å¸®åŠ©æ”¹å–„è¿™ç§è€¦åˆã€‚ æˆ‘ä»¬è¿˜è®¨è®ºäº†ä¸ºä»€ä¹ˆè®©æˆ‘ä»¬çš„ä»£ç éšç€æ—¶é—´çš„æ¨ç§»è€Œå‘å±•ï¼Œè€Œä¸æ˜¯ä»å¼€å§‹è¿›è¡Œè¿™ç§åˆ†ç¦»çš„è®¾è®¡çš„åŸå› ã€‚\nåœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å¸Œæœ›å±•å¼€è®²è§£ä½¿ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡ç¼–å†™Goä»£ç çš„æƒ³æ³•ã€‚ å…·ä½“æ¥è¯´ï¼Œæˆ‘æƒ³è®¨è®ºï¼š\n æ¥å£æµ‹è¯•å¦‚ä½•å¸®åŠ©ç¡®ä¿å®ç°å¯ä»¥æ¯«æ— é—®é¢˜åœ°äº’æ¢ã€‚ å­åŸŸå¦‚ä½•è¡ç”Ÿè‡ªä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚ ä½¿ç”¨ä¼ ç»Ÿçš„DDDå…­è¾¹å½¢æ¥å½¢è±¡åŒ–è¿™ä¸€åˆ‡ï¼Œä»¥åŠåƒç¬¬ä¸‰æ–¹åº“è¿™æ ·çš„ä»£ç å¦‚ä½•é€‚é…ã€‚  æˆ‘è¿˜æƒ³å¼ºè°ƒï¼Œæœ¬æ–‡ç»ä¸æ˜¯ç¡¬æ€§è§„å®šã€‚è¿™åªæ˜¯æˆ‘å¾®è–„çš„å°è¯•ï¼Œè¯•å›¾åˆ†äº«ä¸€äº›å¸®åŠ©æˆ‘æ”¹è¿›Goè½¯ä»¶çš„è§è§£å’Œæƒ³æ³•ã€‚\næˆ‘ä¹Ÿä¸æ˜¯ç¬¬ä¸€ä¸ªåœ¨Goä¸­è®¨è®ºæˆ–æ¢ç´¢DDDå’Œè®¾è®¡æ¨¡å¼çš„äººã€‚ ä½ åº”è¯¥æŸ¥çœ‹ä»¥ä¸‹å†…å®¹ä»¥è·å¾—æ›´å…¨é¢çš„ç†è§£ï¼š\n GoDDD by Marcus Olsen - è¿™æ˜¯ä¸€ä¸ªGitHubå­˜å‚¨åº“ï¼Œå…¶ä¸­åŒ…å«æ–‡ç« å’Œæ¼”è®²ï¼ŒMarcus Olsenè¯•å›¾å°†ä¼ ç»Ÿçš„DDD Javaç¤ºä¾‹åº”ç”¨ç¨‹åºç§»æ¤åˆ°Goä¸­ã€‚ WTF Dial by Ben Johnson - æˆ‘åœ¨æ–‡ä¸­é“¾æ¥äº†Bençš„Standard Pacakage Layoutæ–‡ç« ï¼› æœ¬ç³»åˆ—åº”ç”¨äº†Benåœ¨è¯¥æ–‡ç« ä¸­è®¨è®ºçš„å†…å®¹ã€‚æˆ‘è¿˜å»ºè®®æŸ¥çœ‹é™„å¸¦çš„PRï¼Œå¹¶ä»”ç»†é˜…è¯»è¯„è®ºã€‚ How Do You Structure Your Go Apps by Kat Zien - åœ¨æ¼”è®²ä¸­ï¼ŒKaté€šè¿‡å¤šç§æ–¹æ³•æ„å»ºäº†Goåº”ç”¨ç¨‹åºã€‚é™„å¸¦äº†æ¼”è®²çš„ä»£ç ä»“åº“å’Œå¹»ç¯ç‰‡ã€‚ Design Philosophy On Packaging by Bill Kennedy - è™½ç„¶ä¸ä¸“é—¨æ¶‰åŠç»“æ„åŒ–åº”ç”¨ç¨‹åºï¼Œä½†æœ¬ç³»åˆ—è®¨è®ºäº†ä¸ç»“æ„ç´§å¯†è”ç³»çš„åŒ…è®¾è®¡ã€‚ ","date":"2020-02-16T21:52:00Z","permalink":"https://www.4async.com/2020/02/2020-02-16-moving-towards-domain-driven-design-in-go/","title":"è¯‘ï¼šåœ¨Goä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡"},{"content":"æˆ‘ä»¬é€šå¸¸ä¼šé‡åˆ°çº¿ä¸Šç”šè‡³æµ‹è¯•ä¸­ä»£ç å‡ºç°é—®é¢˜ï¼Œè¿™äº›é—®é¢˜å¯èƒ½æ¥è‡ªäºæˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­çš„å¼•å…¥çš„BUGï¼Œæœ‰äº›æ¥è‡ªäºæˆ‘ä»¬çš„åŠŸèƒ½æœªå¾—åˆ°ç†æƒ³ç»“æœçš„ï¼Œç”šè‡³æœ‰ä¸€äº›é—®é¢˜æ¥è‡ªäºè¿è¡Œç¯å¢ƒçš„ã€‚å¾ˆå¤šäº‹æƒ…å¯èƒ½æœªå¿…èƒ½å¤Ÿè¶³å¤Ÿå¯æ§ï¼Œå°¤å…¶æ˜¯ä¸Šçº¿ä¹‹åæ‰å‘ç°å‡ºç°äº†é—®é¢˜ã€‚é™¤äº†æˆ‘ä»¬å‰é¢ä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†ä¸€äº›æµ‹è¯•ç›¸å…³çš„å†…å®¹ï¼Œè™½ç„¶å¯ä»¥è§£å†³ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œä½†æ˜¯è¿™äº›å¹¶ä¸èƒ½å®Œå…¨æœç»æ‰€æœ‰é—®é¢˜åœ¨çº¿ä¸Šä¸€å®šä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å»ºç«‹å¯¹å‘å¸ƒ/é¢„å‘ç¯å¢ƒä¸€å¥—ç›¸å¯¹å®Œå–„çš„ç›‘æ§ã€è¯Šæ–­æœºåˆ¶ï¼Œä¿è¯æˆ‘ä»¬å¯ä»¥å°½å¿«è¿›è¡Œæ•…éšœçš„åˆ†æå’Œæº¯æºã€‚\nç³»ç»Ÿçš„å¯è§‚å¯Ÿæ€§ ä¸ºäº†åº”å¯¹ç›®å‰è½¯ä»¶å¼€å‘çš„å¤æ‚åº¦å¸¦æ¥çš„ç›¸å…³é—®é¢˜ï¼Œå¯è§‚å¯Ÿæ€§(Observability) è¿™ä¸ªæ¦‚å¿µè¢«å¼•å…¥è½¯ä»¶é¢†åŸŸã€‚ä¼ ç»Ÿçš„ç›‘æ§å’ŒæŠ¥è­¦ä¸»è¦å…³æ³¨ç³»ç»Ÿçš„å¼‚å¸¸æƒ…å†µå’Œå¤±è´¥å› ç´ ï¼Œå¯è§‚å¯Ÿæ€§æ›´å…³æ³¨çš„æ˜¯ä»ç³»ç»Ÿè‡ªèº«å‡ºå‘ï¼Œå»å±•ç°ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µï¼Œæ›´åƒæ˜¯ä¸€ç§å¯¹ç³»ç»Ÿçš„è‡ªæˆ‘å®¡è§†ã€‚ä¸€ä¸ªå¯è§‚å¯Ÿçš„ç³»ç»Ÿä¸­æ›´å…³æ³¨åº”ç”¨æœ¬èº«çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯æ‰€å¤„çš„æœºå™¨æˆ–è€…ç½‘ç»œè¿™æ ·çš„é—´æ¥è¯æ®ã€‚æˆ‘ä»¬å¸Œæœ›ç›´æ¥å¾—åˆ°åº”ç”¨å½“å‰çš„ååå’Œå»¶è¿Ÿä¿¡æ¯ï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬å°±éœ€è¦åˆç†ä¸»åŠ¨æš´éœ²æ›´å¤šåº”ç”¨è¿è¡Œä¿¡æ¯ã€‚åœ¨å½“å‰çš„åº”ç”¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œé¢å¯¹å¤æ‚ç³»ç»Ÿæˆ‘ä»¬çš„å…³æ³¨å°†é€æ¸ç”±ç‚¹åˆ°ç‚¹çº¿é¢ä½“çš„ç»“åˆï¼Œè¿™èƒ½è®©æˆ‘ä»¬æ›´å¥½çš„ç†è§£ç³»ç»Ÿï¼Œä¸ä»…çŸ¥é“Whatï¼Œæ›´èƒ½å›ç­”Whyã€‚\nå¯è§‚å¯Ÿæ€§ç›®å‰ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰å¤§æ”¯æŸ±ï¼š\n  åº¦é‡(Metrics)ï¼šMetric å¾€å¾€æ˜¯ä¸€äº›èšåˆçš„ä¿¡æ¯ï¼Œç›¸æ¯” Logging ä¸§å¤±äº†ä¸€äº›å…·ä½“ä¿¡æ¯ï¼Œä½†æ˜¯å ç”¨çš„ç©ºé—´è¦æ¯”å®Œæ•´æ—¥å¿—å°çš„å¤šï¼Œå¯ä»¥ç”¨äºç›‘æ§å’ŒæŠ¥è­¦ã€‚\n  åˆ†å¸ƒå¼è¿½è¸ª(Tracing)ï¼šTracing ä»‹äº Logging å’Œ Metric ä¹‹é—´ï¼Œ ä»¥è¯·æ±‚çš„ç»´åº¦ï¼Œä¸²è”æœåŠ¡é—´çš„è°ƒç”¨å…³ç³»å¹¶è®°å½•è°ƒç”¨è€—æ—¶ï¼Œå³ä¿ç•™äº†å¿…è¦çš„ä¿¡æ¯ï¼Œåˆå°†åˆ†æ•£çš„æ—¥å¿—äº‹ä»¶é€šè¿‡ Span ä¸²è”ï¼Œ å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ç†è§£ç³»ç»Ÿçš„è¡Œä¸ºã€è¾…åŠ©è°ƒè¯•å’Œæ’æŸ¥æ€§èƒ½é—®é¢˜ã€‚\n  æ—¥å¿—(Logging)ï¼šLogging ä¸»è¦è®°å½•ä¸€äº›ç¦»æ•£çš„äº‹ä»¶ï¼Œåº”ç”¨å¾€å¾€é€šè¿‡å°†å®šä¹‰å¥½æ ¼å¼çš„æ—¥å¿—ä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œç„¶åç”¨æ—¥å¿—æ”¶é›†ç¨‹åºæ”¶é›†èµ·æ¥ç”¨äºåˆ†æå’Œèšåˆã€‚\n  æ•…éšœå‘ç°ï¼šç›‘æ§è®¾æ–½ ç›‘æ§è®¾æ–½è™½ç„¶å¯¹ç¨‹åºè€Œè¨€å„ç§å„æ ·ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬å®é™…è½åœ°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¼šå¯¹ç½‘ç»œç¯å¢ƒ/ç‰©ç†è®¾å¤‡/ä¸šåŠ¡ç³»ç»Ÿç­‰ç­‰å„ç§å¯èƒ½å­˜åœ¨æ½œåœ¨é—®é¢˜çš„ç³»ç»Ÿè¿›è¡Œç›‘æ§å’ŒæŠ¥è­¦ã€‚è¿™é‡Œç›‘æ§ç³»ç»Ÿå’ŒæŠ¥è­¦ç³»ç»Ÿä¸€èˆ¬æ˜¯å±äºç›‘æ§è®¾æ–½éƒ¨åˆ†ï¼Œè¿™ä¸€éƒ¨åˆ†çš„é€‰å‹ä¸€èˆ¬æ˜¯å…¬å¸æ•´ä½“é€‰å‹è®¾è®¡çš„ï¼Œè¿™é‡Œä¸é¢å¤–è®¨è®ºã€‚è¿™é‡Œè®¨è®ºçš„å…·ä½“äº‹é¡¹å¯èƒ½éœ€è¦æ ¹æ®å„å…¬å¸æƒ…å†µè‡ªè¡Œåˆ¤å®šã€‚\næˆ‘ä»¬é€‰å‹æ—¶åˆ™æ˜¯é€‰æ‹©äº†åŸºäºPrometheus+Grafanaè¿›è¡Œä¸šåŠ¡ç³»ç»Ÿç›‘æ§ï¼Œå› æ­¤éœ€è¦å¯¹åº”çš„å®¢æˆ·ç«¯è¿›è¡Œè¾“å‡ºç»“æœã€‚Prometheusé‡‡ç”¨äº†pullæ¨¡å¼ï¼Œéœ€è¦å¼€å¯å¯¹åº”çš„HTTPç«¯å£æ–¹ä¾¿è¿›è¡Œé‡‡é›†ã€‚å®˜æ–¹æœ‰ä¸€ä¸ªåŸºç¡€çš„å…¥é—¨æ•™ç¨‹ï¼Œå¯ä»¥ç”¨ä»¥å‚è€ƒã€‚\næ•…éšœè¿½æº¯ï¼šåˆ†å¸ƒå¼è¿½è¸ª åˆ†å¸ƒå¼è¿½è¸ªæˆ‘ä»¬ç›®å‰é‡‡ç”¨çš„æ˜¯Jaegerç³»ç»Ÿä½œä¸ºåˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç”¨æˆ·åé¦ˆæŸ¥çœ‹å¯¹åº”ç³»ç»Ÿçš„è¯·æ±‚ï¼Œå‘ç°è¯·æ±‚æµç»çš„ç³»ç»Ÿå’Œå¯¹åº”çš„å¤„ç†æ—¶é—´ã€‚\nJaegeræä¾›äº†å„ç§è¯­è¨€çš„ä¸°å¯Œå®¢æˆ·ç«¯æ ¼å¼ï¼Œä½œä¸ºGoç¼–å†™çš„åº”ç”¨ï¼Œè‡ªç„¶ä¹Ÿæä¾›äº†Goè¯­è¨€çš„å®¢æˆ·ç«¯åº“ã€‚\næ•…éšœè¿½æº¯ï¼šæ—¥å¿— æ—¥å¿—é‡‡é›†ç³»ç»Ÿå¤§å®¶å¸¸è§çš„åŒ…å«ELK(EFK)ï¼Œåé¢æ›´æœ‰æ€§èƒ½æ›´å¼ºèµ„æºå ç”¨æ›´å°‘çš„ClickHouseç­‰ç­‰ä½œä¸ºé€‰æ‹©ã€‚è¿™é‡Œæˆ‘ä»¬é‡ç‚¹ä¸è®¨è®ºå¤–éƒ¨ç³»ç»Ÿçš„é€‰æ‹©ï¼Œæ›´é‡è¦çš„å°†æ ¸å¿ƒé›†ä¸­äºå¸¸è§åº“çš„é€‰æ‹©ä¸­ã€‚\nåœ¨å¸¸è§æ—¥å¿—è®°å½•ä¸­ï¼ŒåŒåˆ†å¸ƒå¼è¿½è¸ªç›¸åŒï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å¯¹è¯·æ±‚çš„ç›¸å…³IDè¿›è¡Œè®°å½•ï¼Œä¿è¯åœ¨å¯¹å¯¹åº”æ•°æ®è¿›è¡Œåˆ†ææ—¶ï¼Œèƒ½å¤Ÿå°½å¿«ç­›é€‰å¯¹åº”çš„è¯·æ±‚å’Œç›¸å…³æ•°æ®å†…å®¹ã€‚è¿™é‡Œæˆ‘æ¨èä½¿ç”¨rs/zerologä½œä¸ºæ—¥å¿—è®°å½•çš„æ—¥å¿—åº“ã€‚è™½ç„¶æˆ‘ä»¬å†å²ç³»ç»Ÿä¸­å¤§é‡çš„ä½¿ç”¨äº†zapä½œä¸ºæ—¥å¿—è¾“å‡ºé©±åŠ¨ï¼Œä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œå€ŸåŠ©zerologæä¾›çš„WithContextæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰é’ˆå¯¹æ€§çš„ï¼Œå¯¹æ¯æ¬¡è¯·æ±‚ï¼Œéƒ¨åˆ†è¯·æ±‚ã€è¯·æ±‚å†…å‚æ•°ç­‰å„æ–¹é¢è¿›è¡Œè¯¦ç»†å®šåˆ¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬åœ¨è¯Šæ–­å…·ä½“å†…å®¹æ—¶åŠ¨æ€è°ƒæ•´æ—¥å¿—çº§åˆ«ã€é™„å¸¦æ¯æ¬¡è¯·æ±‚IDç­‰ç­‰çš„éœ€æ±‚ã€‚\nä»¥å¸¸è§Webæ¡†æ¶Ginä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€äº›å…·ä½“çš„è¯·æ±‚æ•°æ®ä¿å­˜è‡³context.Contextä¸­ï¼Œæ–¹ä¾¿æˆ‘ä»¬åç»­ä½¿ç”¨ï¼š\nfunc RequestID(logger zerolog.Logger) gin.HandlerFunc { return func(c *gin.Context) { var reqID string // å¯æ¥å—å¤–éƒ¨RequestIDï¼Œå¸¸è§äºç³»ç»Ÿé—´äº’ç›¸è°ƒç”¨ \tif c.Request.Header.Get(\u0026#34;X-Request-Id\u0026#34;) == \u0026#34;\u0026#34; { reqID = uuid.New().String() } else { reqID = c.Request.Header.Get(\u0026#34;X-Request-Id\u0026#34;) } ctx := c.Request.Context() logger = logger.With().Str(\u0026#34;requestID\u0026#34;, reqID).Logger() // ç»‘å®šåˆ°context.Context \tctx = logger.WithContext(ctx) c.Request = c.Request.WithContext(ctx) c.Next() c.Header(\u0026#34;X-Request-Id\u0026#34;, reqID) } } åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åŠ¨æ€è°ƒèŠ‚æ—¥å¿—ç­‰çº§ï¼Œå¯ä»¥é€šè¿‡ä¸­é—´ä»¶æˆ–è€…å…¶ä»–å½¢å¼æ§åˆ¶ï¼š\nfunc DebugLevel(config *viper.Viper) gin.HandlerFunc { return func(c *gin.Context) { if config.GetBool(\u0026#34;debug\u0026#34;) { logger := log.Ctx(c.Request.Context()).Level(zerolog.DebugLevel) ctx := logger.WithContext(c.Request.Context()) c.Request = c.Request.WithContext(ctx) } c.Next() } } ","date":"2020-02-05T18:30:00Z","permalink":"https://www.4async.com/2020/02/2020-02-05-golang-debug-instrumental/","title":"ä» Go è¯­è¨€çš„ä¾èµ–åº“è®²èµ·ï¼ˆ2ï¼‰ç›‘æ§ã€åˆ†å¸ƒå¼è¿½è¸ªå’Œæ—¥å¿—"},{"content":"å¯¹å¼€å‘è€Œè¨€ï¼Œæµ‹è¯•çš„é‡è¦æ€§ç›¸ä¿¡å¯¹æ¯ä¸ªå¼€å‘è€…è€Œè¨€æ˜¯è€ç”Ÿå¸¸è°ˆçš„äº‹æƒ…ã€‚è™½ç„¶æˆ‘ä»¬å¾ˆæœ‰å¯èƒ½åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç”±äºå„ç§åŸå› ä¼šå¸Œæœ›åç»­è¡¥å…¨ï¼Œç„¶è€Œäº‹å®ä¸Šæˆ‘æ›´å»ºè®®é‡‡ç”¨â€œTests that fail then passâ€åŸåˆ™å»å¤„ç†åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚\nåœ¨æˆ‘ä»¬å¼€å‘è¿‡ç¨‹çš„åˆæœŸé˜¶æ®µï¼Œå¼€å‘è´¨é‡çš„ä¿æŒæ›´å¤šä¾èµ–å¼€å‘äººå‘˜è‡ªèº«ç´ è´¨ä¿æŒã€‚ä½†æ˜¯å¯¹ä¸€ä¸ªå›¢é˜Ÿè€Œè¨€ï¼Œæœªå¿…èƒ½å¤Ÿä¸€ç›´ä¿æŒäººå‘˜çš„é«˜ç´ è´¨å¼€å‘ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œäººå‘˜çš„å˜åŠ¨ï¼Œæ–°è€ç¼–ç ä¹ æƒ¯çš„å†²çªï¼Œäººå‘˜èƒ½åŠ›çš„æ®‹æ¬¡ä¸é½éƒ½æœ‰å¯èƒ½å¯¼è‡´ä»£ç çš„è…åŒ–ã€‚åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©å¼•å…¥æµ‹è¯•ä¿éšœä»£ç çš„è´¨é‡\nGoæœ¬èº«æä¾›äº†åŸºç¡€çš„æµ‹è¯•åŠŸèƒ½ï¼Œä½†æ˜¯è¿™ä¸ªåŠŸèƒ½åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ä»æœ‰ä½¿ç”¨èµ·æ¥åŠŸèƒ½è¾ƒå¼±çš„é—®é¢˜ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä½¿ç”¨é¢å¤–çš„åº“è®©æµ‹è¯•ä»£ç æ›´ä½³é«˜æ•ˆã€‚åœ¨å®é™…å®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘æ¨èä½¿ç”¨Ginkgoã€testifyå’ŒGoMockå·¥å…·ã€‚\nGoMock GoMockå·¥å…·æ˜¯Golangå®˜æ–¹æä¾›çš„é’ˆå¯¹æ¥å£çš„ä»£ç ç”Ÿæˆæµ‹è¯•å·¥å…·ã€‚åœ¨å®é™…çš„å•å…ƒæµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šé€‰æ‹©Mockæ‰æ•°æ®åº“ï¼ˆDB/KVï¼‰ã€å¤–éƒ¨æœåŠ¡è°ƒç”¨æ“ä½œéƒ¨åˆ†ï¼Œå°†è¿™éƒ¨åˆ†åŠŸèƒ½ç•™åœ¨é›†æˆæµ‹è¯•ä¸­å®Œæˆã€‚\næ¯”å¦‚æˆ‘ä»¬å°†æ•°æ®æ“ä½œç±»å‹æŠ½è±¡æˆæ¥å£Creatorã€Updaterã€Deleterç­‰ï¼Œå€ŸåŠ©æ¥å£çš„ç»„åˆåŠŸèƒ½ï¼Œé’ˆå¯¹æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½è¿›è¡Œç»„åˆå¼€å‘ã€‚åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©GoMockå·¥å…·ç”Ÿæˆå¯¹åº”çš„æµ‹è¯•è¾…åŠ©ä»£ç ã€‚\nä»¥å¯¹æœ€ç®€å•çš„io.ReadeCloserä½¿ç”¨ä»£ç ä¸ºä¾‹ï¼š\npackage tdd import \u0026#34;io\u0026#34; func Read(r io.ReadCloser, buf []byte) (n int, err error) { n, err = io.ReadFull(r, buf) return } ç”Ÿæˆå¯¹åº”çš„mockæ–¹æ³•ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨-packageå‚æ•°å®šä¹‰åŒ…åï¼Œä¸ºäº†åŒºåˆ†ç”Ÿæˆæ–‡ä»¶ï¼Œæ·»åŠ äº†_ten_test.goåç¼€ã€‚\n# æŒ‡å®šç”Ÿæˆio.ReadCloserçš„mockæ–¹æ³• # å¦‚æœæœ‰ä¸“é—¨çš„æ–‡ä»¶å®šä¹‰å¯¹åº”æ¥å£å®šä¹‰ï¼Œåˆ™å¯ä»¥é€šè¿‡-sourceæ–¹æ³•æŒ‡å®šä¸€æ¬¡æ€§æå–æ‰€æœ‰æ¥å£ mockgen -package tdd io ReadCloser \u0026gt; reader_gen_test.go æ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œæ“ä½œäº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨reader_test.goæ–‡ä»¶ä¸­è¿›è¡Œï¼š\npackage tdd import ( \u0026#34;io\u0026#34; \u0026#34;reflect\u0026#34; \u0026#34;testing\u0026#34; \u0026#34;github.com/golang/mock/gomock\u0026#34; ) func TestRead(t *testing.T) { ctrl := gomock.NewController(t) defer ctrl.Finish() r := NewMockReadCloser(ctrl) r.EXPECT(). Read(gomock.AssignableToTypeOf([]byte{})). SetArg(0, []byte{0x0, 0x1, 0x2, 0x3, 0x4}). // è®¾ç½®å‚æ•°å€¼ \tReturn(5, io.EOF). // è®¾ç½®è¿”å›å€¼ \tAnyTimes() // æ‰§è¡Œæ¬¡æ•°  buf := make([]byte, 5) Read(r, buf) want := []byte{0x0, 0x1, 0x2, 0x3, 0x4} if !reflect.DeepEqual(want, buf) { t.Errorf(\u0026#34;Read() failed. want=%v, got=%v.\u0026#34;, want, buf) } } testify æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¼šå‘ç°ä½¿ç”¨reflect.DeepEqualæ–¹å¼å¯¹æ¯”ï¼Œç„¶åè°ƒç”¨t.Errorfæ–¹å¼è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ä½†æ˜¯è¿™é‡Œé¢å…¶å®ç›¸å¯¹æ¥è¯´è¦éº»çƒ¦ä¸€ç‚¹ï¼Œå¦å¤–ä¸€ä¸ªåˆ™æ˜¯å¯¹æ•°æ®è€Œè¨€ï¼Œå¦‚æœå†…å®¹è¾ƒå¤šï¼Œæˆ‘ä»¬æ²¡åŠæ³•ä¸€ä¸€å¯¹æ¯”å¯èƒ½å‡ºç°çš„å†…å®¹ï¼Œè¿™ç§æƒ…å†µä¸‹testifyå·¥å…·åˆ™å¯ä»¥æä¾›ä¸€ç§æ›´ä¾¿æ·çš„æ–¹å¼å¸®åŠ©æˆ‘ä»¬è¿›è¡Œæµ‹è¯•çš„ç®¡ç†ã€‚\nä¸ºäº†æ–¹ä¾¿å¯¹æ¯”è¿™ä¸ªæµ‹è¯•å†…å®¹ï¼Œæˆ‘ä»¬æŠŠä¸Šé¢DeepEqualçš„åˆ¤æ–­æ¡ä»¶å–åï¼Œè·å–çš„é”™è¯¯çš„å†…å®¹å¯¹æ¯”éªŒè¯ä¸€ä¸‹ï¼š\n# DeepEqual === RUN TestRead --- FAIL: TestRead (0.00s) /Users/kevin/Desktop/tdd/reader_test.go:26: Read() failed. want=[0 1 2 3 4], got=[0 1 2 3 4]. FAIL ç°åœ¨ï¼Œæˆ‘ä»¬å°†æµ‹è¯•æ–‡ä»¶æ›¿æ¢ä¸ºtestifyæ–¹å¼è¿›è¡Œï¼š\npackage tdd import ( \u0026#34;io\u0026#34; \u0026#34;testing\u0026#34; \u0026#34;github.com/golang/mock/gomock\u0026#34; \u0026#34;github.com/stretchr/testify/assert\u0026#34; ) func TestRead(t *testing.T) { ctrl := gomock.NewController(t) defer ctrl.Finish() r := NewMockReadCloser(ctrl) r.EXPECT(). Read(gomock.AssignableToTypeOf([]byte{})). SetArg(0, []byte{0x0, 0x1, 0x2, 0x3, 0x4}). // è®¾ç½®å‚æ•°å€¼ \tReturn(5, io.EOF). // è®¾ç½®è¿”å›å€¼ \tAnyTimes() // æ‰§è¡Œæ¬¡æ•°  buf := make([]byte, 5) Read(r, buf) want := []byte{0x0, 0x1, 0x2, 0x3} if !assert.Equal(t, want, buf, \u0026#34;Read failed\u0026#34;) { return } } è·å–æµ‹è¯•ç»“æœï¼š\n=== RUN TestRead --- FAIL: TestRead (0.00s) /Users/kevin/Desktop/tdd/reader_test.go:25: Error Trace:\treader_test.go:25 Error: Not equal: expected: []byte{0x0, 0x1, 0x2, 0x3} actual : []byte{0x0, 0x1, 0x2, 0x3, 0x4} Diff: --- Expected +++ Actual @@ -1,3 +1,3 @@ -([]uint8) (len=4) { - 00000000 00 01 02 03 |....| +([]uint8) (len=5) { + 00000000 00 01 02 03 04 |.....| } Test: TestRead Messages: Read failed FAIL coverage: 100.0% of statements å¦å¤–ï¼Œåœ¨testifyå·¥å…·ä¸­ï¼Œè¿˜æä¾›äº†assert.JSONEqç­‰ç­‰éå¸¸æœ‰ç”¨çš„å‡½æ•°ï¼Œå¯ä»¥è‡ªè¡Œç ”ç©¶ä¸€ä¸‹ã€‚åŒæ—¶ï¼Œtestifyå·¥å…·è¿˜æä¾›äº†TestsuiteåŠŸèƒ½ï¼Œç”¨äºæ–¹ä¾¿çš„è®¾ç½®Setupå’ŒTeardownå‡½æ•°ã€‚\nä½ ä¼šå‘ç°testifyå·¥å…·è¿˜æä¾›äº†mockåŠŸèƒ½ï¼Œä¸è¿‡åœ¨å®é™…è¿‡ç¨‹ä¸­ï¼Œä¸å¤ªå»ºè®®ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚\nGinkgo Ginkgoæ˜¯é’ˆå¯¹Goç¨‹åºè¿›è¡ŒBDDå¼€å‘çš„å·¥å…·ï¼Œè™½ç„¶å®ƒé»˜è®¤æ­é…ä½¿ç”¨gomegaå·¥å…·ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯å»ºè®®ä½ é€‰æ‹©testifyå·¥å…·ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•å¿«é€Ÿæ¥å…¥testifyï¼š\npackage foo_test import ( . \u0026#34;github.com/onsi/ginkgo\u0026#34; \u0026#34;github.com/stretchr/testify/assert\u0026#34; ) var _ = Describe(func(\u0026#34;foo\u0026#34;) { It(\u0026#34;should testify to its correctness\u0026#34;, func(){ assert.Equal(GinkgoT(), foo{}.Name(), \u0026#34;foo\u0026#34;) }) }) Ginkgoå·¥å…·æä¾›äº†å®Œå–„çš„æ–‡æ¡£ä»‹ç»ï¼Œä½ å¯ä»¥å‚è€ƒå·¥å…·å®˜æ–¹æ–‡æ¡£äº†è§£å…·ä½“çš„ä½¿ç”¨ã€‚å¦å¤–ä¸€ä¸ªGinkgoéå¸¸æœ‰ç”¨çš„æ˜¯å®ƒå¯ä»¥æ–¹ä¾¿æ¥å…¥å·²æœ‰çš„æµ‹è¯•æ—¥å¿—æ•è·ç¨‹åºï¼Œæ¯”å¦‚ä½ æ˜¯JUnitçš„ç”¨æˆ·ï¼Œä½ å¯ä»¥é€‰æ‹©å°†æ—¥å¿—æ ¼å¼è¾“å‡ºæˆJUnit XMLæ ¼å¼ï¼š\npackage foo_test import ( . \u0026#34;github.com/onsi/ginkgo\u0026#34; . \u0026#34;github.com/onsi/gomega\u0026#34; \u0026#34;github.com/onsi/ginkgo/reporters\u0026#34; \u0026#34;testing\u0026#34; ) func TestFoo(t *testing.T) { RegisterFailHandler(Fail) junitReporter := reporters.NewJUnitReporter(\u0026#34;junit.xml\u0026#34;) RunSpecsWithDefaultAndCustomReporters(t, \u0026#34;Foo Suite\u0026#34;, []Reporter{junitReporter}) } æ€»ç»“ æ–‡ç« æ€»ç»“äº†ä¸€äº›å¸¸è§çš„æ¶‰åŠæµ‹è¯•çš„å·¥å…·ï¼Œå¸Œæœ›å¯¹ä½ åœ¨å®è·µè¿‡ç¨‹ä¸­æœ‰æ‰€å¸®åŠ©ã€‚é¡ºå¸¦ï¼Œæˆ‘è¿˜æ²¡å¿˜è®°è¦å®Œæˆè¿™ä¸ªç³»åˆ—ã€‚:D\n","date":"2020-01-10T17:30:00Z","permalink":"https://www.4async.com/2020/01/2020-01-10-golang-test-driven-toolkit/","title":"ä» Go è¯­è¨€çš„ä¾èµ–åº“è®²èµ·ï¼ˆ1ï¼‰Ginkgoã€testifyå’ŒGoMock"},{"content":"ç¼˜èµ· ä»Šå¹´æ˜¯Goè¯­è¨€çš„10å¹´ç”Ÿæ—¥ï¼Œå‡†ç¡®çš„è¯´åº”è¯¥æ˜¯Goå¼€æ”¾äº2009å¹´ï¼Œå½“æ—¶è™½ç„¶å…¬å¼€äº†ï¼Œä½†æ˜¯å…¶å®çœŸæ­£çš„å¯ç”¨æ€§å¹¶ä¸æ˜¯å¾ˆå¥½ã€‚ç”šè‡³Windowsçš„æ”¯æŒéƒ½æ²¡æœ‰ã€‚å½“æ—¶æˆ‘çš„ä¸»è¦ç¯å¢ƒè¿˜æ˜¯åœ¨Windowså¹³å°ï¼Œå› æ­¤æ²¡æœ‰å¤ªå…³æ³¨Goè¯­è¨€ã€‚åœ¨2012å¹´Goè¯­è¨€æ­£å¼å‘å¸ƒ1.0ç‰ˆæœ¬ä¹‹åï¼Œæˆ‘å½“æ—¶å·¥ä½œç¯å¢ƒè½¬ç§»åˆ°äº†Linux/macOS/iOSç›¸å…³çš„äº§å“ä¸Šï¼Œå› æ­¤é‡æ–°å­¦ä¹ äº†ä¸€ä¸‹Goè¯­è¨€ã€‚\nåæ¥åœ¨Goçš„1.3ç‰ˆæœ¬å‘å¸ƒåï¼Œæˆ‘åœ¨æ”¯ä»˜å®çš„å†…éƒ¨ç³»ç»Ÿä¸­ç¬¬ä¸€æ¬¡ä¸Šçº¿äº†ä¸€ä¸ªåŸºäºGoè¯­è¨€çš„è¾¹ç¼˜æœåŠ¡ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å°†Goè¯­è¨€åº”ç”¨åˆ°äº†å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ã€‚åæ¥åœ¨äº‘æŸšç§‘æŠ€åˆ›ä¸šè¿‡ç¨‹ä¸­ï¼Œæ­£å¼å°†Goè¯­è¨€ä½œä¸ºæˆ‘ä»¬ç‰©è”ç½‘ç¯å¢ƒçš„ç¬¬ä¸€ä¼˜é€‰è¯­è¨€ï¼ˆä¹ŸåŸºæœ¬ä¸Šæ˜¯å”¯ä¸€è¯­è¨€ï¼‰ï¼Œå¤§è§„æ¨¡çš„æ‰¹é‡éƒ¨ç½²Goè¯­è¨€é¡¹ç›®å’Œä»£ç ã€‚\nèŠèŠå¦‚ä½•å¼€å‘æ›´æ–¹ä¾¿ç»´æŠ¤çš„Goè¯­è¨€ç¨‹åº å¯¹Goè¯­è¨€è€Œè¨€ï¼Œå¼€å‘ä¼¼ä¹æ˜¯ç®€å•çš„äº‹æƒ…ï¼šGoæœ¬èº«çš„è¯­æ³•æ¯”è¾ƒç®€å•ï¼Œå…³é”®è¯ä¸å¤šï¼Œå¯ä»¥å¿«é€Ÿä¸Šæ‰‹ã€‚å¦‚æœåŸºæœ¬åŠŸèƒ½è€Œè¨€ï¼Œèƒ½é‡‡ç”¨çš„èŠ±å¼è§£æ³•ä¸å¤šï¼Œå¯¼è‡´Goè¯­è¨€çš„ä¸Šæ‰‹æ¯”è¾ƒç®€å•ï¼Œå¯¹æˆ‘ä»¬åˆ›ä¸šæœŸé—´çš„å…¬å¸è€Œè¨€ï¼Œäº«å—åˆ°äº†å¾ˆå¤šè¿™ç§æ–¹é¢å¸¦æ¥çš„å¾ˆå¤šçº¢åˆ©ï¼šæˆ‘ä»¬å·¥ç¨‹å¸ˆåŸºæœ¬ä¸Šéƒ½æ˜¯å…¶ä»–è¯­è¨€/å²—ä½è½¬å‹è¿‡æ¥çš„å…¨(quan)æ ˆ(gan)å·¥ç¨‹å¸ˆï¼Œä»–ä»¬ä¹Ÿä¸ºæˆ‘ä»¬ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•æä¾›äº†åŸç”Ÿçš„åŠ¨åŠ›ã€‚\nç„¶è€Œï¼Œå½“æˆ‘ä»¬æŠŠæ—¶é—´ç¨å¾®æ”¾é•¿ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¼šå‘ç°å½“æ—¶æˆ‘ä»¬ä»æ—§é—ç•™ä¸‹äº†å¾ˆå¤šå†å²æ€§çš„æŠ€æœ¯å€ºï¼Œè¿™äº›å†…å®¹åŒ…å«äº†æˆ‘ä»¬å½“æ—¶å¯¹äºä»£ç è´¨é‡çš„å¦¥åï¼Œç”±å…¶ä»–è¯­è¨€ä¹ æƒ¯å¸¦è¿‡æ¥çš„æ´‹ç©æ„ä½†æœ‰ç‚¹æ°´åœŸä¸æœï¼Œä¸€äº›è¿‡åº¦çš„è®¾è®¡ï¼Œä¸€äº›åº“é€‰æ‹©ä¸Šå’Œæˆ‘ä»¬åç»­çš„æœ€ä½³å®è·µç›¸è¿èƒŒç­‰ç­‰é—®é¢˜ã€‚\nè¿™é‡Œé¢ï¼Œä¸€äº›è½¯æ€§çš„ä¸œè¥¿å…¶å®æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›éç¼–ç ç¯èŠ‚å»è§£å†³ï¼šå¯¹å¼€å‘è¿‡çš„ä»£ç è¦æ±‚æä¾›å•å…ƒæµ‹è¯•å’Œå¼€å‘åçš„Code Reviewï¼›åœ¨æŠ€æœ¯å¼€å‘ä¹‹å‰è¿›è¡Œæ²Ÿé€šï¼Œè§„é¿å¯èƒ½å‡ºç°çš„è¿‡åº¦è®¾è®¡é—®é¢˜ç­‰ç­‰ã€‚ä¸è¿‡ï¼Œæˆ‘æƒ³äº†æƒ³ï¼Œè¿™äº›æ›´å¤šå±äºè§„èŒƒæ€§çš„é—®é¢˜ï¼Œå„ä¸ªå…¬å¸è‡ªæœ‰è‡ªèº«çš„ç‰¹è‰²åœ¨ï¼Œé‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆå†…å®¹å¯ä»¥æ›´é€‚åˆåˆä¸­çº§å¼€å‘ä¸€å—èŠä¸€èŠçš„å‘¢ï¼Ÿ\né‚£ä¹ˆæ¯«æ— ç–‘é—®å°±æ˜¯å¯¹ä¾èµ–åº“çš„é€‰æ‹©ã€‚è¿™éƒ¨åˆ†çš„å†…å®¹ç›´æ¥ä¸æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¼šé‡‡ç”¨çš„å®é™…æœ€ä½³å®è·µç›¸å…³ï¼Œæ— è®ºæ˜¯å¤šäººåˆä½œé¡¹ç›®ï¼Œè¿˜æ˜¯å•æªåŒ¹é©¬çš„å¼€æºé¡¹ç›®å¼€å‘ï¼Œå„ç§ä¾èµ–åº“æ— æ³•é¿å…ï¼šå®ƒä»¬å¯ä»¥å¸®æˆ‘ä»¬æœ‰æ•ˆæå‡å¼€å‘æ•ˆç‡ï¼Œå¸®æˆ‘ä»¬è½åœ°æœ€ä½³å®è·µï¼Œè®©æˆ‘ä»¬æ›´å¿«çš„æ›´é«˜æ•ˆçš„å®Œæˆå·¥ä½œã€‚å› æ­¤ï¼Œæˆ‘æ‰“ç®—ä»è¿™ä¸ªç³»åˆ—ä¸­ï¼Œä¸€æ–¹é¢å»èŠèŠæˆ‘ä»¬æœªæ¥ä¼šä»‹ç»çš„ä¾èµ–åº“çš„ä½¿ç”¨ï¼›å¦å¤–ä¸€æ–¹é¢ï¼Œä¹Ÿæƒ³é€šè¿‡è¿™ä¸ªç³»åˆ—ï¼ŒèŠèŠå¦‚ä½•æ˜¯ä½¿ç”¨ä¾èµ–åº“çš„è¿‡ç¨‹ä¸­ï¼Œå°†å„ç§æœ€ä½³å®è·µä¸€ä¸€è½åœ°ã€‚æˆ‘ä»¬å¯èƒ½ä¼šä»‹ç»ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªä¾èµ–åº“ï¼Œè¿™ä¸ªä¾èµ–åº“ä¼šå¸¦ç»™æˆ‘ä»¬çš„å®è·µä¼šæ˜¯æ€ä¹ˆæ ·çš„ã€‚\nä¸è¿‡åœ¨è¿™é‡Œä»æ—§æé†’ä¸€å¥ï¼Œè¿™é‡Œæåˆ°çš„æ‰€æœ‰çš„åŠŸèƒ½å’Œå®è·µå‡ä¸ºåœ¨å®é™…é¡¹ç›®ä¸­æ€»ç»“çš„å†…å®¹ï¼Œéƒ¨åˆ†å®è·µåˆ™å¯æ ¹æ®ä¸ªäººæƒ…å†µè¿›è¡Œå®é™…é€‰æ‹©ã€‚æ‰€æœ‰çš„å®è·µå¹¶éå…¨éƒ¨éƒ½æ˜¯æœ€ä¼˜è§£ï¼Œä»éœ€æ ¹æ®å®é™…é¡¹ç›®æƒ…å†µè¿›è¡Œå¯¹åº”çš„è°ƒæ•´å’ŒæŠ‰æ‹©ã€‚\næœ€åï¼Œå¸Œæœ›ä½ ä»¬èƒ½å¤Ÿå–œæ¬¢è¿™ä¸ªç³»åˆ—ã€‚ï¼šï¼‰\n","date":"2019-11-23T22:43:00Z","permalink":"https://www.4async.com/2019/11/2019-11-23-learning-go-from-3rd-library/","title":"ä»Goè¯­è¨€çš„ä¾èµ–åº“è®²èµ·ï¼ˆ0ï¼‰ï¼šè®©æˆ‘ä»¬èŠèŠå¦‚ä½•å¼€å‘æ›´æ–¹ä¾¿ç»´æŠ¤çš„Goè¯­è¨€ç¨‹åº"},{"content":"åŸæ–‡ï¼šUsing Go Modules ä½œè€…ï¼šTyler Bui-Palsulichã€Eno Compton\nä»‹ç» Go 1.11å’Œ1.12åŒ…å«äº†åˆæ­¥çš„modulesæ”¯æŒï¼ŒGoçš„æ–°ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿç”¨äºä¾èµ–ç‰ˆæœ¬ä¿¡æ¯æè¿°å’Œæ›´æ–¹ä¾¿çš„ç®¡ç†ã€‚è¿™ç¯‡åšå®¢æ˜¯ä¸€ä¸ªå…³äºå¼€å§‹ä½¿ç”¨modulesçš„åŸºç¡€æ“ä½œæŒ‡å¼•æ•™ç¨‹ã€‚åç»­æ–‡ç« ä¼šä»‹ç»å‘å¸ƒä¸€ä¸ªå…¶ä»–äººå¯ä»¥ä½¿ç”¨çš„modulesã€‚\nmodulesæ˜¯GoåŒ…çš„é›†åˆï¼Œä¿å­˜åœ¨é¡¶å±‚ç›®å½•ä¸€ä¸ªåå«go.modçš„æ–‡ä»¶ä¸­ã€‚go.modæ–‡ä»¶å®šä¹‰äº†æ¨¡å—çš„è·¯å¾„ï¼Œè¿™ä¸ªä¼šä½œä¸ºæ ¹ç›®å½•å¼•ç”¨è·¯å¾„ï¼›åŒæ—¶æ–‡ä»¶ä¸­ä¹ŸåŒ…å«äº†èƒ½å¤Ÿæ­£å¸¸æ„å»ºçš„å…¶ä»–åŒ…ä¾èµ–éœ€æ±‚ã€‚æ¯ä¸ªä¾èµ–éœ€æ±‚åŒæ ·ä»¥æ¨¡å—è·¯å¾„æ–¹å¼æ ‡ç¤ºï¼ŒåŒæ—¶æ ¹æ®è¯­ä¹‰åŒ–ç‰ˆæœ¬æ–¹å¼è¿›è¡Œæ ‡è®°ã€‚\nåœ¨Go 1.11å¼€å§‹ï¼Œgoå‘½ä»¤è¡Œä¼šå†å½“å‰ç›®å½•æˆ–è€…ä¸Šå±‚ç›®å½•ä¸­å­˜åœ¨go.modæ–‡ä»¶å¹¶ä¸”åœ¨ $GOPATH/srcç›®å½•å¤–æ—¶è‡ªåŠ¨å¯ç”¨modulesåŠŸèƒ½ã€‚ï¼ˆå½“ç›®å½•ä½äº$GOPATH/srcä¸­æ—¶ï¼Œå‡ºäºå…¼å®¹æ€§è€ƒè™‘ï¼Œgoå‘½ä»¤ä»æ—§é‡‡ç”¨GOPATHæ¨¡å¼ï¼Œå³ä¾¿å­˜åœ¨go.modæ–‡ä»¶ã€‚å…·ä½“è¯·å‚è€ƒGoå‘½ä»¤è¡Œæ–‡æ¡£ï¼‰ã€‚ä»Go 1.13ç‰ˆæœ¬å¼€å§‹ï¼ŒmodulesåŠŸèƒ½å°†ä¼šåœ¨æ‰€æœ‰å¼€å‘è¿‡ç¨‹ä¸­é»˜è®¤å¼€å¯ã€‚\nè¿™ç¯‡åšå®¢ä¼šæ¼”ç¤ºä½¿ç”¨moduleså¼€å‘Goä»£ç çš„ä¸€ç³»åˆ—çš„å¸¸ç”¨æ“ä½œï¼š\n åˆ›å»ºä¸€ä¸ªæ¨¡å— æ·»åŠ ä¾èµ– å‡çº§ä¾èµ– æ·»åŠ ä¸€ä¸ªä¾èµ–çš„æ–°ä¸»ç‰ˆæœ¬ å‡çº§ä¸€ä¸ªä¾èµ–åˆ°æ–°ä¸»ç‰ˆæœ¬ ç§»é™¤æ— ç”¨ä¾èµ–  åˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å— è®©æˆ‘é—¨ä»åˆ›å»ºä¸€ä¸ªæ–°æ¨¡å—å¼€å§‹ã€‚\nåœ¨$GOPATH/srcå¤–åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºæ–‡ä»¶å¤¹ï¼Œä½¿ç”¨cdåˆ‡æ¢è¿›å…¥è¿™ä¸ªç›®å½•ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªåå«hello.goçš„æ–°æºç æ–‡ä»¶ï¼š\npackage hello func Hello() string { return \u0026#34;Hello, world.\u0026#34; } è®©æˆ‘ä»¬åŒæ ·åˆ›å»ºä¸€ä¸ªåå«hello_test.goçš„æµ‹è¯•æ–‡ä»¶ï¼š\npackage hello import \u0026#34;testing\u0026#34; func TestHello(t *testing.T) { want := \u0026#34;Hello, world.\u0026#34; if got := Hello(); got != want { t.Errorf(\u0026#34;Hello() = %q, want %q\u0026#34;, got, want) } } ç°åœ¨ï¼Œè¿™ä¸ªç›®å½•åŒ…å«äº†ä¸€ä¸ªåŒ…ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå› ä¸ºè¿˜æ²¡æœ‰go.modæ–‡ä»¶ã€‚å¦‚æœä½ æ–‡ä»¶åˆ›å»ºåœ¨ /home/gopher/helloç›®å½•ä¸‹ï¼Œæ‰§è¡Œgo testå‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»“æœï¼š\n\t$ go test PASS ok _/home/gopher/hello\t0.020s $ æœ€åä¸€è¡Œè¡¨ç¤ºäº†æ•´ä¸ªåŒ…æµ‹è¯•çš„æ±‡æ€»ä¿¡æ¯ã€‚å› ä¸ºæˆ‘ä»¬ç°åœ¨åœ¨ $GOPATHå¤–ï¼Œå¹¶ä¸”ä¸å±äºä»»ä½•æ¨¡å—ï¼Œå› æ­¤ goå‘½ä»¤ä¸çŸ¥é“å½“å‰ç›®å½•çš„å¼•ç”¨è·¯å¾„ï¼Œå› æ­¤é‡‡ç”¨å½“å‰æ–‡ä»¶å¤¹åç”Ÿæˆäº†ä¸€ä¸ªä¼ªè·¯å¾„ã€‚\nç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨go mod initå‘½ä»¤å°†å½“å‰ç›®å½•è®¾ç½®æˆä¸ºæ¨¡å—çš„æ ¹ç›®å½•ï¼Œç„¶åé‡æ–°è¯•è¯•go testå‘½ä»¤ï¼š\n\t$ go mod init example.com/hello go: creating new go.mod: module example.com/hello $ go test PASS ok example.com/hello\t0.020s $ æ­å–œä½ ï¼ä½ å·²ç»ç¼–å†™å’Œæµ‹è¯•äº†ä½ çš„ç¬¬ä¸€ä¸ªæ¨¡å—ã€‚\ngo mod initå‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªgo.modæ–‡ä»¶ï¼š\n\t$ cat go.mod module example.com/hello go 1.12 $ go.modæ–‡ä»¶ä»…å‡ºç°åœ¨æ¨¡å—çš„æ ¹ç›®å½•ä¸‹ã€‚å­ç›®å½•ä¸­çš„åŒ…å¼•ç”¨è·¯å¾„ä¼šä½¿ç”¨æ¨¡å—çš„å¼•ç”¨è·¯å¾„åŠ ä¸Šå­ç›®å½•è·¯å¾„çš„å½¢å¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåå«worldçš„å­ç›®å½•ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨å­ç›®å½•ä¸­ä½¿ç”¨go mod initå‘½ä»¤ã€‚åŒ…ä¼šè‡ªåŠ¨è¯†åˆ«ä½œä¸ºexample.com/hello ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¼•ç”¨è·¯å¾„ä¸ºexample.com/hello/worldã€‚\næ·»åŠ ä¸€ä¸ªä¾èµ– Go modules åŠŸèƒ½çš„ä¸»è¦åŠ¨æœºå°±æ˜¯æå‡ä½¿ç”¨å…¶ä»–å¼€å‘è€…ä»£ç (æˆ–è€…è¯´æ·»åŠ ä¸€ä¸ªä¾èµ–é¡¹)æ—¶çš„ä½“éªŒã€‚\nè®©æˆ‘ä»¬æ›´æ–°ä¸€ä¸‹hello.goï¼Œå¼•å…¥rsc.io/quoteå¹¶ä¸”ä½¿ç”¨å®ƒå®ç°Helloï¼š\npackage hello import \u0026#34;rsc.io/quote\u0026#34; func Hello() string { return quote.Hello() } ç°åœ¨è®©æˆ‘ä»¬å†æ¬¡æ‰§è¡Œæµ‹è¯•ï¼š\n\t$ go test go: finding rsc.io/quote v1.5.2 go: downloading rsc.io/quote v1.5.2 go: extracting rsc.io/quote v1.5.2 go: finding rsc.io/sampler v1.3.0 go: finding golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c go: downloading rsc.io/sampler v1.3.0 go: extracting rsc.io/sampler v1.3.0 go: downloading golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c go: extracting golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c PASS ok example.com/hello\t0.023s $ goå‘½ä»¤ä¼šè‡ªåŠ¨å¤„ç†go.modä¸­åˆ¶å®šçš„ä¾èµ–ç‰ˆæœ¬ã€‚å½“åŒ…ä¸­importæŒ‡å‘çš„æ¨¡å—æ²¡æœ‰åœ¨ go.modæ–‡ä»¶ä¸­ï¼Œ goå‘½ä»¤ä¼šè‡ªåŠ¨æœç´¢è¿™ä¸ªæ¨¡å—ï¼Œå¹¶ä¸”å°†æœ€æ–°ç‰ˆæœ¬æ·»åŠ åˆ° go.modæ–‡ä»¶ä¸­ã€‚ï¼ˆâ€œæœ€æ–°ç‰ˆæœ¬â€æ˜¯æŒ‡æœ€æ–°çš„æ ‡ç­¾éé¢„å‘å¸ƒçš„ç¨³å®šç‰ˆæœ¬ã€‚ï¼‰åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œgo testè§£æäº†æ–°çš„å¼•ç”¨è·¯å¾„rsc.io/quoteä¸ºå¯¹åº”çš„æ¨¡å—ï¼Œç‰ˆæœ¬ä¸ºv1.5.2ã€‚å®ƒåŒæ ·ä¸‹è½½äº†rsc.io/quoteä¸­ä½¿ç”¨çš„ä¸¤ä¸ªä¾èµ–ï¼Œåä¸ºrsc.io/samplerå’Œgolang.org/x/textã€‚ä¸è¿‡ï¼Œåªæœ‰ç›´æ¥ä½¿ç”¨çš„ä¾èµ–ä¼šè¢«è®°å½•åœ¨go.modæ–‡ä»¶ä¸­ã€‚\n\t$ cat go.mod module example.com/hello go 1.12 require rsc.io/quote v1.5.2 $ ç¬¬äºŒæ¬¡æ‰§è¡Œgo testå‘½ä»¤æ—¶ä¸ä¼šé‡å¤è¿™ä¸ªå·¥ä½œï¼Œå› ä¸º go.mod å·²ç»æœ€æ–°å¹¶ä¸”æ‰€æœ‰çš„ä¸‹è½½æ¨¡å—éƒ½ä¼šç¼“å­˜åˆ°æœ¬åœ°ï¼ˆä¿å­˜åœ¨$GOPATH/pkg/modç›®å½•ä¸­ï¼‰ï¼š\n\t$ go test PASS ok example.com/hello\t0.020s $ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶goå‘½ä»¤æ·»åŠ æ–°ä¾èµ–ç®€å•ä¾¿æ·ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯æ²¡æœ‰æˆæœ¬çš„ã€‚ä½ çš„æ¨¡å—é€’å½’ä¾èµ–æ–°çš„ä¾èµ–æ—¶å¯èƒ½ä¼šæœ‰æ­£ç¡®æ€§ã€å®‰å…¨æ€§å’Œéæ­£å½“æˆæƒç­‰ç­‰é—®é¢˜ã€‚æ›´å¤šçš„æ€è€ƒï¼Œå¯ä»¥å‚è€ƒRuss Coxçš„åšå®¢æˆ‘ä»¬çš„è½¯ä»¶ä¾èµ–é—®é¢˜ã€‚\nå¦‚åŒæˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„é‚£æ ·ï¼Œæ·»åŠ ä¸€æ–°çš„ä¾èµ–é€šå¸¸ä¼šå¸¦æ¥æ–°çš„é—´æ¥ä¾èµ–ã€‚å‘½ä»¤go list -m allä¼šåˆ—å‡ºè™½æœ‰çš„å½“å‰ä¾èµ–å’Œä»–ä»¬çš„ä¾èµ–\n\t$ go list -m all example.com/hello golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c rsc.io/quote v1.5.2 rsc.io/sampler v1.3.0 $ åœ¨go listè¾“å‡ºä¸­ï¼Œå½“å‰æ¨¡å—ï¼Œæˆ–è€…å«åšä¸»æ¨¡å—ï¼Œé€šå¸¸æ˜¯ç¬¬ä¸€è¡Œï¼Œæ¥ä¸‹æ¥æ˜¯æ ¹æ®ä¾èµ–è·¯å¾„æ’åºçš„ä¾èµ–ã€‚\ngolang.org/x/textçš„ç‰ˆæœ¬v0.0.0-20170915032832-14c0d48ead0cæ˜¯ä¼ªç‰ˆæœ¬çš„ä¾‹å­ï¼Œæ˜¯goå‘½ä»¤çš„ç‰ˆæœ¬è¯­æ³•ç”¨äºæ ‡è®°æœªæ‰“æ ‡ç­¾çš„æäº¤ã€‚\nåŒæ—¶ï¼Œgo.modå’Œgoå‘½ä»¤ç»´æŠ¤äº†ä¸€ä¸ªåå«go.sumçš„æ–‡ä»¶åŒ…å«äº†æŒ‡å®šæ¨¡å—ç‰ˆæœ¬çš„æœŸæœ›çš„åŠ å¯†hashï¼š\n\t$ cat go.sum golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c h1:qgOY6WgZO... golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c/go.mod h1:Nq... rsc.io/quote v1.5.2 h1:w5fcysjrx7yqtD/aO+QwRjYZOKnaM9Uh2b40tElTs3... rsc.io/quote v1.5.2/go.mod h1:LzX7hefJvL54yjefDEDHNONDjII0t9xZLPX... rsc.io/sampler v1.3.0 h1:7uVkIFmeBqHfdjD+gZwtXXI+RODJ2Wc4O7MPEh/Q... rsc.io/sampler v1.3.0/go.mod h1:T1hPZKmBbMNahiBKFy5HrXp6adAjACjK9... $ goå‘½ä»¤ä½¿ç”¨go.sumæ–‡ä»¶ä¿è¯ä¹‹åçš„æ¨¡å—ä¸‹è½½ä¼šä¸‹è½½åˆ°è·Ÿç¬¬ä¸€æ¬¡ä¸‹è½½ç›¸åŒçš„æ–‡ä»¶å†…å®¹ï¼Œä¿è¯ä½ çš„é¡¹ç›®ä¾èµ–ä¸ä¼šå‘ç”Ÿé¢„æœŸå¤–çš„æ¶æ„ä¿®æ”¹ã€æ„å¤–é—®é¢˜å’Œå…¶ä»–é—®é¢˜ã€‚go.mod å’Œ go.suméƒ½éœ€è¦æ”¾è¿›ç‰ˆæœ¬ç®¡ç†ä¸­ã€‚\nå‡çº§ä¾èµ– åœ¨Go modulesä¸­ï¼Œç‰ˆæœ¬é‡‡ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ ‡ç­¾æ ‡è®°ç‰ˆæœ¬ã€‚è¯­ä¹‰åŒ–ç‰ˆæœ¬åŒ…å«ä¸‰éƒ¨åˆ†ï¼šä¸»è¦ç‰ˆæœ¬ã€æ¬¡è¦ç‰ˆæœ¬å’Œä¿®è®¢ç‰ˆæœ¬ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ï¼Œv0.1.2ï¼Œä¸»è¦ç‰ˆæœ¬ä¸º0ï¼Œæ¬¡è¦ç‰ˆæœ¬ä¸º1ï¼Œä¿®è®¢ç‰ˆæœ¬ä¸º2.\nè®©æˆ‘ä»¬åœ¨è¿™ä¸€èŠ‚ä¸­å…ˆå‡çº§ä¸€ä¸‹æ¬¡è¦ç‰ˆæœ¬ï¼Œä¸‹ä¸€èŠ‚ä¸­æˆ‘ä»¬å†å°è¯•å‡çº§ä¸€ä¸‹ä¸»è¦ç‰ˆæœ¬ã€‚\nä»go list -m allçš„è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä½¿ç”¨äº† golang.org/x/textçš„ä¸€ä¸ªæ²¡æœ‰æ ‡ç­¾çš„ç‰ˆæœ¬ï¼Œè®©æˆ‘ä»¬å§è¿™ä¸ªç‰ˆæœ¬å‡çº§æˆæœ€æ–°ç‰ˆæœ¬ï¼Œç„¶åæµ‹è¯•ä¸€ä¸‹æ‰€æœ‰çš„åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š\n\t$ go get golang.org/x/text go: finding golang.org/x/text v0.3.0 go: downloading golang.org/x/text v0.3.0 go: extracting golang.org/x/text v0.3.0 $ go test PASS ok example.com/hello\t0.013s $ å“‡å“¦ï¼Œæ‰€æœ‰çš„åŠŸèƒ½éƒ½æ­£å¸¸å·¥ä½œã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹go list -m allå’Œgo.modæ–‡ä»¶ï¼š\n\t$ go list -m all example.com/hello golang.org/x/text v0.3.0 rsc.io/quote v1.5.2 rsc.io/sampler v1.3.0 $ cat go.mod module example.com/hello go 1.12 require ( golang.org/x/text v0.3.0 // indirect rsc.io/quote v1.5.2 ) $ golang.org/x/textæ–‡ä»¶è¢«æ›´æ–°åˆ°äº†æœ€æ–°çš„æ ‡ç­¾ç‰ˆæœ¬v0.3.0ã€‚ go.modæ–‡ä»¶ä¸­çš„è®°å½•ä¹Ÿè¢«æ›´æ–°æˆäº†v0.3.0ã€‚indirect æ³¨é‡Šæ ‡è®°äº†ä¾èµ–ä¸æ˜¯è¢«å½“å‰æ¨¡å—ç›´æ¥ä½¿ç”¨çš„ï¼Œåªæ˜¯åœ¨å…¶ä»–ä¾èµ–é¡¹ä¸­è¢«é—´æ¥å¼•ç”¨ã€‚å…·ä½“å†…å®¹å¯ä»¥é€šè¿‡go help modulesæŸ¥çœ‹æ›´å¤šä»‹ç»ã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å‡çº§rsc.io/samplerçš„å°ç‰ˆæœ¬ï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨go getæŒ‡ä»¤åæ‰§è¡Œæµ‹è¯•ï¼š\n\t$ go get rsc.io/sampler go: finding rsc.io/sampler v1.99.99 go: downloading rsc.io/sampler v1.99.99 go: extracting rsc.io/sampler v1.99.99 $ go test --- FAIL: TestHello (0.00s) hello_test.go:8: Hello() = \u0026quot;99 bottles of beer on the wall, 99 bottles of beer, ...\u0026quot;, want \u0026quot;Hello, world.\u0026quot; FAIL exit status 1 FAIL\texample.com/hello\t0.014s $ å™¢ï¼Œä¸ï¼æµ‹è¯•æ˜¾ç¤ºæœ€æ–°ç‰ˆçš„ rsc.io/samplerä¸å…¼å®¹æˆ‘ä»¬çš„ä½¿ç”¨æ–¹å¼ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªæ¨¡å—æ‰€æœ‰å¯ç”¨çš„æ ‡ç­¾ç‰ˆæœ¬ï¼š\n\t$ go list -m -versions rsc.io/sampler rsc.io/sampler v1.0.0 v1.2.0 v1.2.1 v1.3.0 v1.3.1 v1.99.99 $ æˆ‘ä»¬åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯v1.3.0ï¼Œçœ‹ä¸Šå»v1.99.99æ˜æ˜¾ä¸èƒ½ä½¿ç”¨ï¼Œæˆ–è®¸æˆ‘ä»¬å¯ä»¥ä½¿ç”¨v1.3.1ç‰ˆæœ¬ï¼š\n\t$ go get rsc.io/sampler@v1.3.1 go: finding rsc.io/sampler v1.3.1 go: downloading rsc.io/sampler v1.3.1 go: extracting rsc.io/sampler v1.3.1 $ go test PASS ok example.com/hello\t0.022s $ æ³¨æ„go getå‘½ä»¤ä¸­æˆ‘ä»¬ä½¿ç”¨äº†@v1.3.1ä½œä¸ºå‚æ•°ã€‚é€šå¸¸æƒ…å†µä¸‹go getå¯ä»¥æŒ‡å®šå‚æ•°æ ‡è®°ä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªé»˜è®¤å€¼ä¸º@latestï¼Œå¯¹åº”ä¼šå°è¯•ä½¿ç”¨æœ€æ–°çš„ç‰ˆæœ¬ã€‚\næ·»åŠ ä¸€ä¸ªä¾èµ–çš„ä¸»è¦ç‰ˆæœ¬ è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ–°çš„å‡½æ•°åˆ°æˆ‘ä»¬çš„åŒ…ä¸­ï¼šfunc Proverb ä¼šè¿”å›Goçš„å¹¶å‘ç®´è¨€ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨rsc.io/quote/v3æ¨¡å—ä¸­é€šè¿‡è°ƒç”¨ quote.Concurrencyå®ç°çš„ã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ›´æ–°hello.go æ·»åŠ æ–°çš„å‡½æ•°ï¼š\npackage hello import ( \u0026#34;rsc.io/quote\u0026#34; quoteV3 \u0026#34;rsc.io/quote/v3\u0026#34; ) func Hello() string { return quote.Hello() } func Proverb() string { return quoteV3.Concurrency() } ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ·»åŠ å¯¹åº”çš„æµ‹è¯•ï¼š\nfunc TestProverb(t *testing.T) { want := \u0026#34;Concurrency is not parallelism.\u0026#34; if got := Proverb(); got != want { t.Errorf(\u0026#34;Proverb() = %q, want %q\u0026#34;, got, want) } } ç°åœ¨è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š\n\t$ go test go: finding rsc.io/quote/v3 v3.1.0 go: downloading rsc.io/quote/v3 v3.1.0 go: extracting rsc.io/quote/v3 v3.1.0 PASS ok example.com/hello\t0.024s $ æ³¨æ„ï¼Œæˆ‘ä»¬åŒæ—¶ä½¿ç”¨äº†rsc.io/quoteå’Œrsc.io/quote/v3ï¼š\n\t$ go list -m rsc.io/q... rsc.io/quote v1.5.2 rsc.io/quote/v3 v3.1.0 $ æ¯ä¸ªä¸åŒä¸»è¦ç‰ˆæœ¬ï¼ˆv1, v2ç­‰ç­‰ï¼‰å¯ä»¥ä½¿ç”¨ä¸ç”¨çš„å¼•ç”¨è·¯å¾„ï¼šè·¯å¾„é‡‡ç”¨ä¸»è¦ç‰ˆæœ¬ç»“å°¾ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„rsc.io/quoteçš„v3 ç‰ˆæœ¬ä¸å†æ˜¯rsc.io/quoteï¼Œè€Œæ˜¯rsc.io/quote/v3ã€‚è¿™ä¸ªå«åšè¯­ä¹‰åŒ–å¼•ç”¨ç‰ˆæœ¬ï¼Œå¯ä»¥è®©ä¸å…¼å®¹çš„åŒ…ï¼ˆé€šå¸¸æ˜¯ä¸åŒä¸»ç‰ˆæœ¬ï¼‰æ‹¥æœ‰ä¸åŒçš„è·¯å¾„ã€‚åœ¨å·®å¼‚ä¸­rsc.io/quoteçš„v1.6.0ç‰ˆæœ¬éœ€è¦å‘å‰å…¼å®¹v1.5.2ï¼Œè¿™æ ·å°±å¯ä»¥é‡ç”¨rsc.io/quoteåç§°ã€‚ï¼ˆåœ¨å‰ä¸€èŠ‚ä¸­ï¼Œ rsc.io/samplerçš„v1.99.99åº”è¯¥éœ€è¦å…¼å®¹rsc.io/samplerçš„v1.3.0ç‰ˆæœ¬ï¼Œä½†æ˜¯Bugæˆ–è€…å…¶ä»–åŸå› éƒ½å¯èƒ½å¯¼è‡´è¿™ç§é—®é¢˜çš„å‡ºç°ã€‚ï¼‰\ngoå‘½ä»¤å…è®¸ä¸€ä¸ªæ„å»ºåŒ…å«ä¸€ä¸ªæŒ‡å®šæ¨¡å—è·¯å¾„çš„æœ€å¤šä¸€ä¸ªç‰ˆæœ¬ï¼Œä»¥ä¸ºç€æ¯ä¸ªä¸»è¦ç‰ˆæœ¬éƒ½å¯ä»¥åŒ…å«æœ€å¤šä¸€ä¸ªç‰ˆæœ¬ï¼šä¸€ä¸ªrsc.io/quoteï¼Œä¸€ä¸ªrsc.io/quote/v2å’Œä¸€ä¸ªrsc.io/quote/v3ç­‰ç­‰ã€‚\nè¿™è§„å®šäº†æ¨¡å—ä½œè€…ä¸€ä¸ªæ¸…æ™°çš„å•ä¸€æ¨¡å—è·¯å¾„çš„è§„åˆ™ï¼šå¯ä»¥ä¸€ä¸ªç¨‹åºæ—¢å¯ä»¥åœ¨rsc.io/quoteçš„v1.5.2å’Œv1.6.0ç‰ˆæœ¬ä¸‹æ„å»ºé€šè¿‡ã€‚åŒæ—¶ï¼Œå…è®¸ä¸åŒçš„æ¨¡å—ä¸»ç‰ˆæœ¬ï¼ˆå› ä¸ºæœ‰ä¸åŒè·¯å¾„ï¼‰è®©æ¨¡å—çš„æ¶ˆè´¹è€…èƒ½å¤Ÿå¢é‡å‡çº§è‡³æ–°ä¸»ç‰ˆæœ¬ä¸­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨rsc/quote/v3 v3.1.0ä¸­çš„quote.Concurrencyï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡åšå¥½åˆå¹¶æˆ‘ä»¬rsc.io/quote v1.5.2çš„ä½¿ç”¨æ–¹å¼æ—¶ï¼Œè¿™ä¸ªèƒ½åŠ›å¯ä»¥å¸®åŠ©åˆ°æˆ‘ä»¬ã€‚è¿™ä¸ªèƒ½åŠ›åœ¨å¤§å‹ä»£ç çš„é¡¹ç›®ä¸­çš„å¢é‡æ›´æ–°ä¸­å°¤ä¸ºé‡è¦ã€‚\nå‡çº§ä¸€ä¸ªä¾èµ–åˆ°æ–°ä¸»ç‰ˆæœ¬ ç°åœ¨ï¼Œè®©æˆ‘ä»¬å®Œæˆå°†ä½¿ç”¨rsc.io/quoteè½¬æ¢ä¸ºä»…ä½¿ç”¨rsc.io/quote/v3ã€‚å› ä¸ºä¸»ç‰ˆæœ¬çš„å˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥é¢„è®¡åˆ°ä¸€äº›APIå·²ç»åˆ é™¤ï¼Œæ”¹åæˆ–è€…å‘ç”Ÿäº†ä¸€äº›ä¸å…¼å®¹çš„å˜åŒ–ã€‚é˜…è¯»ä¸€ä¸‹æ–‡æ¡£æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒHelloç°åœ¨å·²ç»å˜ä¸ºäº†HelloV3ï¼š\n\t$ go doc rsc.io/quote/v3 package quote // import \u0026quot;rsc.io/quote\u0026quot; Package quote collects pithy sayings. func Concurrency() string func GlassV3() string func GoV3() string func HelloV3() string func OptV3() string $ ï¼ˆè¿™é‡Œè¾“å‡ºä¸­æœ‰ä¸€ä¸ªå·²çŸ¥BUGï¼Œæ˜¾ç¤ºå†…å®¹ä¸­å¼•ç”¨è·¯å¾„é”™è¯¯çš„ä¸¢å¼ƒäº†/v3ã€‚ï¼‰\næˆ‘ä»¬å¯ä»¥æ›´æ–°æˆ‘ä»¬hello.goæ–‡ä»¶ä¸­çš„quote.Hello()ä¸ºquoteV3.Hello()ï¼š\npackage hello import quoteV3 \u0026#34;rsc.io/quote/v3\u0026#34; func Hello() string { return quoteV3.Hello() } func Proverb() string { return quoteV3.Concurrency() } è¿™æ—¶ï¼Œæˆ‘ä»¬å·²ç»ä¸å†éœ€è¦é‡å‘½åå¼•ç”¨äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç§»é™¤æ‰è¿™äº›ï¼š\npackage hello import \u0026#34;rsc.io/quote/v3\u0026#34; func Hello() string { return quote.Hello() } func Proverb() string { return quote.Concurrency() } ç°åœ¨æˆ‘ä»¬é‡æ–°è¿è¡Œä¸€ä¸‹æµ‹è¯•ï¼Œç¡®ä¿æ‰€æœ‰çš„åŠŸèƒ½éƒ½èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚\n\t$ go test PASS ok example.com/hello 0.014s ç§»é™¤æ— ç”¨ä¾èµ– æˆ‘ä»¬å·²ç»ç§»é™¤äº†æ‰€æœ‰rsc.io/quoteçš„ä½¿ç”¨ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æ‰§è¡Œgo list -m allå‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬ä»æ—§å¯ä»¥çœ‹åˆ°å®ƒå‡ºç°åœ¨æˆ‘ä»¬çš„go.modæ–‡ä»¶ä¸­ã€‚\n\t$ go list -m all example.com/hello golang.org/x/text v0.3.0 rsc.io/quote v1.5.2 rsc.io/quote/v3 v3.1.0 rsc.io/sampler v1.3.1 $ cat go.mod module example.com/hello go 1.12 require ( golang.org/x/text v0.3.0 // indirect rsc.io/quote v1.5.2 rsc.io/quote/v3 v3.0.0 rsc.io/sampler v1.3.1 // indirect ) $ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºå½“æˆ‘ä»¬æ„å»ºä¸€ä¸ªå•ç‹¬çš„åŒ…æ—¶ï¼Œå¦‚æ‰§è¡Œgo buildæˆ–è€…go testæ—¶ï¼Œå¾ˆå®¹æ˜“å¾—çŸ¥å“ªäº›åŒ…é—å¤±äº†æˆ–è€…éœ€è¦è¢«æ·»åŠ ï¼Œä½†æ˜¯å¾ˆéš¾ç¡®è®¤å“ªäº›åŒ…å¯ä»¥è¢«å®‰å…¨ç§»é™¤ã€‚åªæœ‰åœ¨æ£€æŸ¥å®Œæ¨¡å—æ‰€æœ‰çš„åŒ…å’Œå¯èƒ½çš„æ„å»ºæ ‡ç­¾ç»„åˆä¹‹åï¼Œæ‰èƒ½ç§»é™¤ä¸€ä¸ªä¾èµ–ã€‚æ™®é€šçš„æ„å»ºå‘½ä»¤ä¸ä¼šå¤¹åœ¨è¿™äº›ä¿¡æ¯ï¼Œå› æ­¤æ— æ³•å®‰å…¨çš„ç§»é™¤ä¾èµ–ã€‚\ngo mod tidyå‘½ä»¤åˆ™å¯ä»¥å¸®åŠ©æ¸…ç†æ— ç”¨ä¾èµ–ï¼š\n\t$ go mod tidy $ go list -m all example.com/hello golang.org/x/text v0.3.0 rsc.io/quote/v3 v3.1.0 rsc.io/sampler v1.3.1 $ cat go.mod module example.com/hello go 1.12 require ( golang.org/x/text v0.3.0 // indirect rsc.io/quote/v3 v3.1.0 rsc.io/sampler v1.3.1 // indirect ) $ go test PASS ok example.com/hello\t0.020s $ æ€»ç»“ Go modulesåŠŸèƒ½æ˜¯Goä¸­ä¾èµ–ç®¡ç†çš„æœªæ¥ã€‚æ¨¡å—åŠŸèƒ½ç°åœ¨å·²ç»åœ¨ç›®å‰å—æŠ€æœ¯æ”¯æŒçš„Goç‰ˆæœ¬ä¸­å¯ç”¨ï¼ˆç›®å‰æ˜¯Go1.11å’ŒGo1.12ï¼‰ã€‚\nè¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä½¿ç”¨Go modulesçš„ä¸€äº›å·¥ä½œæµï¼š\n go mod initåˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å—ï¼Œåˆå§‹åŒ–go.modæ–‡ä»¶ã€‚ go buildå’Œgo testå‘½ä»¤å’Œå…¶ä»–ä¸€äº›åŒ…æ„å»ºå‘½ä»¤æ·»åŠ å¿…è¦æ–°ä¾èµ–åˆ°go.modæ–‡ä»¶ã€‚ go list -m allæ‰“å°å½“å‰æ¨¡å—ä¾èµ–ã€‚ go getå‘½ä»¤ä¿®æ”¹ä¾èµ–çš„ç‰ˆæœ¬ï¼ˆæˆ–è€…æ–°å¢ä¾èµ–ï¼‰ã€‚ go mod tidyç§»é™¤æ— ç”¨ä¾èµ–ã€‚  æˆ‘ä»¬é¼“åŠ±ä½ ä»ç°åœ¨å¼€å§‹åœ¨ä½ çš„æœ¬åœ°å¼€å‘ä¸­å¯ç”¨modulesåŠŸèƒ½ï¼Œå¹¶ä¸”æ·»åŠ go.mod å’Œ go.sumæ–‡ä»¶åˆ°é¡¹ç›®ä¸­ã€‚ä½ å¯ä»¥ç»™æˆ‘ä»¬å‘é€BUGåé¦ˆæˆ–è€…æ˜¯ä½“éªŒæŠ¥å‘Šï¼Œåé¦ˆå’Œå¸®åŠ©Goä¾èµ–ç®¡ç†çš„æœªæ¥æ¼”è¿›ã€‚\næ„Ÿè°¢ä½ ä»¬çš„åé¦ˆå¸®åŠ©æå‡modulesåŠŸèƒ½ã€‚\n","date":"2019-03-20T14:22:00Z","permalink":"https://www.4async.com/2019/03/2019-03-20-using-go-modules/","title":"ä½¿ç”¨Go Modules"},{"content":"åœ¨å‡çº§åˆ°Python 3.5+ç‰ˆæœ¬ä¹‹åï¼Œæœ€å¤§çš„é¡¹ç›®ç®¡ç†ä¼˜åŒ–æ¥è‡ªäºPEP-484 Type Hintçš„å¼•å…¥ã€‚å€ŸåŠ©Type Hintï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥æå‡Pythonä»£ç çš„ç±»å‹æ ‡æ³¨ï¼Œä¿éšœåœ¨é‡æ„è¿‡ç¨‹ä¸­é¿å…å‡ºç°ä¸€äº›ä½çº§å¤±è¯¯ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡é«˜ç‰ˆæœ¬Pythonæ–°åŠ çš„æ–°è¯­æ³•å¯ç”¨è¿™é¡¹ç‰¹æ€§ï¼Œç„¶åé€šè¿‡mypyç­‰å·¥å…·æ£€æŸ¥ï¼š\ndef greeting(name: str) -\u0026gt; str: return \u0026#39;Hello \u0026#39; + name ç„¶è€Œï¼Œåœ¨å®é™…å®è·µè¿‡ç¨‹ä¸­ï¼Œä¹Ÿå¾€å¾€å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œè¿™äº›é—®é¢˜æ¥è‡ªäºå¾ˆå¤šæ–¹é¢ï¼š\n ä½ éš¾å…æœ‰ä¸€äº›å†å²æ€§ä»£ç ï¼Œè¿™äº›ä»£ç éœ€è¦åŒæ—¶æ”¯æŒPython2å’ŒPython3ã€‚ ä½ ä½¿ç”¨çš„Python 3 Onlyçš„ç¬¬ä¸‰æ–¹åº“æ²¡æœ‰Type Hintå®šä¹‰ï¼Œä½œè€…çœ‹èµ·æ¥å¹¶ä¸æ‰“ç®—è¿‘æœŸæ”¯æŒæˆ–è€…æŸäº›åŸå› ï¼ˆæ¯”å¦‚ä½ æ­£åœ¨ç”¨çš„æŸä¸ªè€ç‰ˆæœ¬ä¸ç»´æŠ¤äº†ï¼‰å¯¼è‡´ä½ ä¸èƒ½è´¡çŒ®ä»£ç ã€‚  è¿™äº›æ—¶å€™ä½ å¾€å¾€æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨Type Hintå¸¦æ¥çš„ä¾¿åˆ©çš„ï¼Œä¸è¿‡PEP-484ä¸­ä¹Ÿè€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µï¼ŒåŒ…å«äº†ä¸€ç§stub fileçš„å®šä¹‰å½¢å¼ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹æ–‡ä»¶.pyiæ–‡ä»¶ï¼Œå®šä¹‰å‡½æ•°å‚æ•°ç±»å‹ä¸è¿”å›å€¼ç±»å‹ã€‚\næ¯”å¦‚å®˜æ–¹æ–‡æ¡£ä¸­å°±å®šä¹‰äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„stubä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬å¯¹ä¸€ä¸ªåå«HttpRequest çš„ç±»è¿›è¡Œç±»å‹æ ‡è®°ï¼š\n# request.py class HttpRequest: \u0026#34;\u0026#34;\u0026#34;A basic HTTP request.\u0026#34;\u0026#34;\u0026#34; def __init__(self): self.META = {\u0026#34;SERVER_NAME\u0026#34;: \u0026#34;hello.com\u0026#34;} def get_raw_host(self): \u0026#34;\u0026#34;\u0026#34; Return the HTTP host using the environment or request headers. Skip allowed hosts protection, so may return an insecure host. \u0026#34;\u0026#34;\u0026#34; # Reconstruct the host using the algorithm from PEP 333. host = self.META[\u0026#34;SERVER_NAME\u0026#34;] return host æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å½“å‰æ–‡ä»¶çš„æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªåå«bytes.pyiçš„æ–‡ä»¶ï¼Œå¡«å†™å¦‚ä¸‹å†…å®¹ï¼š\n# request.py class HttpRequest: def get_raw_host(self) -\u0026gt; str: ... è®©æˆ‘ä»¬å…ˆæ„å»ºä¸€ä¸ªå­˜åœ¨ç±»å‹æ··æ·†çš„ä¾‹å­ï¼Œå¦‚æœä½ ä½¿ç”¨äº†mypyä¹‹ç±»çš„å·¥å…·è¿›è¡Œæ£€æŸ¥ï¼Œåˆ™å¯ä»¥å¿«é€Ÿå‘ç°ä¸‹é¢ä¾‹å­ä¸­æœ¬æ¥ä¸ºintå‹çš„iè¢«é‡æ–°èµ‹å€¼äº†strç±»å‹ã€‚\né€šè¿‡è¿™æ ·çš„æ–¹æ³•ï¼Œå¯ä»¥å¿«é€Ÿå°†å·²æœ‰çš„ä»£ç åº“å¿«é€Ÿæ·»åŠ ç±»å‹ã€‚ä¸è¿‡å®é™…ä¸­å¹¶ä¸æ˜¯è¿™ä¹ˆç®€å•ã€‚æˆ‘ä»¬ä¹‹å‰ä¹Ÿè¯´è¿‡ï¼Œå¾ˆå¤šé¡¹ç›®å¹¶ä¸æ˜¯ç”±æˆ‘ä»¬è‡ªè¡Œç»´æŠ¤çš„ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¾ˆéš¾å»ä¿®æ”¹ä¸Šæ¸¸ä»“åº“æ—¶ï¼Œåº”è¯¥å¦‚ä½•åšå‘¢ï¼Ÿ\nè¿™é‡Œï¼Œæˆ‘ä»¬ä»¥mypyå·¥å…·å’ŒDjangoè¿™ä¸ªPythonå¸¸ç”¨ä¸ºä¾‹å»æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•é…ç½®Djangoé¡¹ç›®çš„ç±»å‹æ£€æŸ¥ã€‚\nè¿™é‡Œæœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹æä¾›çš„Djangoç±»å‹æ ‡æ³¨åº“django-stubsï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡pipå‘½ä»¤è¿›è¡Œå®‰è£…ï¼š\npip install django-stubs åœ¨å®‰è£…å®Œæˆä¹‹åï¼Œå› ä¸ºè¿™ä¸ªæ ‡æ³¨æ–‡ä»¶æ—¶å•ç‹¬å‘å¸ƒçš„åŒ…ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¿®æ”¹mypyçš„æŒ‡å‘ï¼Œè®©mypyä½¿ç”¨è¿™ä¸ªåŒ…çš„æ ‡æ³¨ã€‚éœ€è¦ä¿®æ”¹mypy.iniæ–‡ä»¶ç”¨äºå®šä¹‰ã€‚å…³äºè¿™ä¸ªæ–‡ä»¶çš„å…·ä½“é…ç½®ï¼Œåˆ™å¯ä»¥å‚è€ƒmypyå·¥å…·çš„å®˜æ–¹æ–‡æ¡£ã€‚\n[mypy] plugins =mypy_django_plugin.main æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨mypyé’ˆå¯¹Djangoéƒ¨åˆ†è¿›è¡Œæ£€æŸ¥äº†ã€‚\n","date":"2019-01-29T14:30:00Z","permalink":"https://www.4async.com/2019/01/2019-01-28-python-typing-with-stub-files/","title":"åˆ©ç”¨Stub Fileæ ‡æ³¨Pythonæ–‡ä»¶"},{"content":"ä»Šå¤©æ—©äº›æ—¶å€™ï¼Œgolang/x/expä¸­é»˜é»˜çš„æ›´æ–°äº†ä¸€ä¸ªåæ›°xerrorsçš„åŒ…ï¼Œè¿™ä¸ªåŒ…å’ŒåŒæ ·å¤„äºgolang/x/expä¸‹çš„å¦ä¸€ä¸ªåå«errorsçš„åŒ…åå­—ååˆ†ç›¸ä¼¼ï¼Œå°±è¿ä»‹ç»ä¹Ÿéƒ½ä¸€è‡´ï¼š\n Package errors implements functions to manipulate errors. This package implements the Go 2 draft designs for error inspection and printing ä»ç›®å‰çš„æƒ…å†µæ¥çœ‹ï¼ŒåŸºæœ¬ä¸Šé”™è¯¯çš„å¤„ç†å½¢å¼åŸºæœ¬å·²ç»å®šå‹ï¼Œå¤„ç†æ–¹å¼åˆ™æ˜¯ç±»ä¼¼äºä¹‹å‰çš„å¦ä¸€ä¸ªgithub.com/pkg/errorsåŒ…ï¼Œä½†æ˜¯å…·ä½“ç»†èŠ‚ä¸å°½ç›¸åŒã€‚\nå¦‚ä½•å¤„ç†errorï¼Ÿ åœ¨ä¹‹å‰ä»‹ç»æ–‡ç« ä¸­æåˆ°è¿‡github.com/pkg/errorsåŒ…çš„è®¾è®¡æ€è·¯ï¼Œé‚£ä¹ˆåœ¨Goå›¢é˜Ÿçš„å®ç°ä¸­ï¼Œè¿™ç§æ€è·¯ä¹Ÿå¾—åˆ°äº†ç»§æ‰¿ã€‚å…ˆä»ä¸€ä¸ªå°ä¾‹å­å¼€å§‹ï¼š\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;golang.org/x/exp/xerrors\u0026#34; ) func raiseError() error { return xerrors.New(\u0026#34;a new error\u0026#34;) } func main() { err := xerrors.Errorf(\u0026#34;raiseError: %w\u0026#34;, raiseError()) fmt.Println(err) } è¾“å‡ºç»“æœï¼š\nraiseError: a new error çœ‹èµ·æ¥éå¸¸ç±»ä¼¼äºä¹‹å‰github.com/pkg/errorsçš„æ˜¾ç¤ºå†…å®¹ã€‚è€Œå…¶ä¸­xerrors.Errorfåˆ™å……å½“äº†ä¹‹å‰errors.Wrapçš„åŠŸèƒ½ã€‚ å…¶ä¸­å€¼å¾—ä¸€æçš„æ˜¯%wï¼Œè¿™ä¸ªç”¨äºåŒ…è£…é”™è¯¯ï¼Œåç»­éªŒè¯é”™è¯¯ä¸­ä¹Ÿä¼šç”¨åˆ°å…¶ä¸­çš„å€¼ã€‚\nåŒæ—¶ï¼Œè¿™ä¸ªåŒ…ä¸­ä¹ŸåŒ…å«äº†å‡ ä¸ªéå¸¸æœ‰ç”¨çš„è¾…åŠ©å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šéªŒè¯é”™è¯¯ç±»å‹æ–¹æ³•Isã€é”™è¯¯ç±»å‹è½¬æ¢æ–¹æ³•Asã€é”™è¯¯å…³ç³»é“¾è§£é™¤æ–¹æ³•Opaqueå’Œæå–å†…å±‚é”™è¯¯æ–¹æ³•Unwrapã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„æ¼”ç¤ºæ¥è¯´æ˜è¿™ç§å…³ç³»ï¼š\nvar ( ErrBase = xerrors.New(\u0026#34;a new error\u0026#34;) ) func main() { err := xerrors.Errorf(\u0026#34;raiseError: %w\u0026#34;, ErrBase) fmt.Println(ErrBase == ErrBase) // åœ°å€ç›¸åŒ \tfmt.Println(err == ErrBase) // åŸºäºErrBaseåŒ…è£…ä¹‹åä¸åŒ \tfmt.Println(xerrors.Is(err, ErrBase)) // éªŒè¯æ˜¯å¦ä¸ºåŸºäºErrBase \tfmt.Println(xerrors.Opaque(err) == err) // è§£é™¤å…³ç³»é“¾ä¹‹åä¸ä¸ºç›¸åŒåœ°å€ \tfmt.Println(xerrors.Is(xerrors.Opaque(err), ErrBase)) // è§£é™¤å…³ç³»é“¾ä¹‹åæ— æ³•ç¡®å®šå…³ç³» \tfmt.Println(xerrors.Unwrap(err) == ErrBase) // è·å–å†…å±‚é”™è¯¯ä¸ºåŸé”™è¯¯ï¼Œåœ°å€ç›¸åŒ } è¾“å‡ºç»“æœä¸ºï¼š\ntrue false true false false true å³ä¾¿æ˜¯åœ¨åŒ…è£¹å¤šå±‚ä¹‹åï¼Œé”™è¯¯ç±»å‹ä¹Ÿèƒ½é€šè¿‡Isæ–¹æ³•æ­£ç¡®è¯†åˆ«ï¼š\nfunc main() { err := xerrors.Errorf(\u0026#34;raiseError: %w\u0026#34;, ErrBase) err2 := xerrors.Errorf(\u0026#34;wrap#01: %w\u0026#34;, err) err3 := xerrors.Errorf(\u0026#34;wrap#02: %w\u0026#34;, err2) fmt.Println(xerrors.Is(err, ErrBase)) fmt.Println(xerrors.Is(err3, ErrBase)) // èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«å…³ç³»ï¼Œæ‰“å°ä¸ºtrue } å¦‚æœéœ€è¦æ‰“å°è¯¦ç»†çš„è°ƒç”¨é“¾è·¯ï¼Œåˆ™å¯ä»¥é€šè¿‡æ ‡å‡†åº“fmtç›¸å…³åŠŸèƒ½è¿›è¡Œè¾“å‡ºï¼Œæ¯”å¦‚Printfæˆ–è€…Sprintfç­‰ã€‚\nfunc main() { err := xerrors.Errorf(\u0026#34;raiseError: %w\u0026#34;, ErrBase) err2 := xerrors.Errorf(\u0026#34;wrap#01: %w\u0026#34;, err) err3 := xerrors.Errorf(\u0026#34;wrap#02: %w\u0026#34;, err2) fmt.Printf(\u0026#34;%+v\\n\u0026#34;, err3) } è¾“å‡ºé“¾è·¯å¦‚ä¸‹ï¼š\nwrap#02: main.main /.../error.go:16 - wrap#01: main.main /.../error.go:15 - raiseError: main.main /.../error.go:14 - a new error: main.init /.../error.go:10 ä½†æ˜¯æ³¨æ„ï¼Œä½¿ç”¨%wè¿›è¡ŒåŒ…è£…æ—¶ï¼Œä»…èƒ½å•æ¬¡åŒ…è£…å•ä¸ªé”™è¯¯ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§ä¸¤ä¸ªé”™è¯¯åŒæ—¶åŒ…è£…æ—¶ï¼Œæ˜¯ä¼šæ— æ³•è¯†åˆ«çš„ï¼š\nvar ( ErrBase = xerrors.New(\u0026#34;a new error\u0026#34;) ErrBase2 = xerrors.New(\u0026#34;another new error\u0026#34;) ) func main() { err := xerrors.Errorf(\u0026#34;raiseError: %w, %w\u0026#34;, ErrBase2, ErrBase2) fmt.Println(xerrors.Is(err, ErrBase)) fmt.Println(xerrors.Is(err, ErrBase2)) } è½åœ°ä½¿ç”¨ åœ¨å…·ä½“é¡¹ç›®å®ç°ä¸­ï¼Œå¦‚å¯¹å¤–æä¾›çš„åº“æ–‡ä»¶ä¸­ï¼Œæˆ‘å»ºè®®å¯ä»¥å‚è€ƒå…¶ä»–è¯­è¨€çš„å®ç°æ–¹å¼ï¼Œå®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„åŸºç¡€é”™è¯¯ç±»å‹ErrBaseï¼Œæ‰€æœ‰å…¶ä»–é”™è¯¯ç±»å‹å‡ç”±æ­¤ç±»å‹æ´¾ç”Ÿï¼Œåˆ™åç»­å¤–éƒ¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œåªéœ€é€šè¿‡xerros.Isåˆ¤å®šé”™è¯¯ç±»å‹ï¼Œåˆ™å¯ä»¥å¿«é€Ÿåˆ¤å®šé”™è¯¯æ˜¯å¦æ¥è‡ªäºæœ¬åŒ…ï¼Œå¹¶ä¸”å¯ä»¥å€ŸåŠ©æ­¤åŠŸèƒ½ç»Ÿä¸€å•ç‹¬å¤„ç†æ¥è‡ªäºæ­¤ç¬¬ä¸‰æ–¹åŒ…çš„å¼‚å¸¸ã€‚\nå¦‚æœä½ æœ‰å…¶ä»–çš„å»ºè®®å’Œç–‘é—®ï¼Œä¹Ÿæ¬¢è¿åœ¨ç•™è¨€åŒºä¸­ç•™è¨€è®¨è®ºã€‚å¦å¤–ï¼Œæ ¹æ®å®é™…å®ç°ä»£ç æ¥çœ‹ï¼Œå…¶ä¸­è¿˜æœ‰ä¸€äº›è¾¹ç¼˜æƒ…å†µæœªè€ƒè™‘æˆ–è€…æœªåšå¤„ç†ï¼Œç”±äºæ˜¯è¯•éªŒæ€§åº“ï¼Œæœ¬åº“åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­éœ€è‡ªè¡Œæ‰¿æ‹…æ‰€å¸¦æ¥çš„é£é™©ã€‚\n","date":"2019-01-25T23:20:00Z","permalink":"https://www.4async.com/2019/01/2019-01-25-go-new-xerrors/","title":"èŠèŠæ–°çš„Goè¯­è¨€é”™è¯¯å¤„ç†æ–¹æ¡ˆ"},{"content":"Ginæ¡†æ¶æ˜¯ä¸€ä¸ªGoè¯­è¨€æ¡†æ¶ä¸­éå¸¸å—æ¬¢è¿çš„ä¸€æ¬¾ã€‚ä»Šå¤©æˆ‘ä»¬å¼€æ”¾äº†ä¸€ä¸ªginiåº“ï¼Œç»“åˆäº†æˆ‘ä»¬å®é™…å¼€å‘ä¸­çš„ä½¿ç”¨ï¼Œæè¿°ä¸€ä¸‹æˆ‘ä»¬ä¸ºä»€ä¹ˆå¼€å‘è¿™ä¸ªåº“ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­çš„æƒè¡¡ã€‚\nginiç®€ä»‹ giniåº“ç›®å‰å‘å¸ƒäº†v0.1.0ç‰ˆæœ¬ï¼Œæ”¯æŒå‡ ä¸ªå¸¸è§çš„åŠŸèƒ½ï¼š\n æä¾›è¯·æ±‚æ•°æ®å’Œè¿”å›æ•°æ®æ‰“å°è®°å½•ä¸­é—´ä»¶ æä¾›å¯MockåŒ–Bindæ–¹å¼ æä¾›ç»Ÿä¸€è¾“å‡ºæ ¼å¼ç®¡ç†  ç›®å‰giniåº“åŠŸèƒ½å·²ç»å®é™…è½åœ°åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåœ¨é‡‡ç”¨ginæ¡†æ¶å¼€å‘çš„ç¨‹åºä¸­è·å¾—äº†åº”ç”¨ã€‚\nè®¾è®¡æ€è·¯ åœ¨å¼€å‘è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¯¹äºå‰åç«¯åˆ†ç¦»æ¨¡å¼å¼€å‘è¿‡ç¨‹ä¸­éƒ¨åˆ†åˆçº§å¼€å‘è€…æ— æ³•è¿›è¡Œæ–¹ä¾¿çš„è°ƒè¯•ï¼Œå°¤å…¶æ˜¯åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ï¼ˆå¦‚ï¼šè“ç‰™é€šè®¯åœºæ™¯ï¼‰ä¸‹ã€‚å€ŸåŠ©gini.DumpReqAndRespå¯ä»¥éå¸¸æ–¹ä¾¿çš„æ‰“å°å„ç§ä¿¡æ¯ã€‚ä¸è¿‡éå¸¸å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ“ä½œå­˜åœ¨ä¸¥é‡çš„æ•°æ®æ³„æ¼é£é™©ï¼Œæ˜¯ä¸¥ç¦å‘å¸ƒè‡³çº¿ä¸Šç‰ˆæœ¬ä¸­è¿è¡Œçš„ã€‚\nr := gin.New() r.Use(gini.DumpReqAndResp()) åœ¨å®é™…å¼€å‘æµ‹è¯•ä¸­ï¼Œé€šå¸¸æˆ‘ä»¬è¿›è¡ŒHTTPè¯·æ±‚æµ‹è¯•ä¸€èˆ¬ä¼šé‡‡ç”¨å¦‚ä¸‹çš„å½¢å¼ç¼–å†™ä»£ç ï¼š\nr := gin.New() ... w := httptest.NewRecorder() req, _ := http.NewRequest(\u0026#34;GET\u0026#34;, \u0026#34;xxx\u0026#34;, nil) r.ServeHTTP(w, req) assert.Equal(t, 200, w.Code) ... ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è§‰å¾—åœ¨å®é™…è¿‡ç¨‹ä¸­ï¼Œginç”±äºè®¾è®¡åŸå› ï¼Œæ— æ³•è¿›è¡Œæ›´å¥½çš„è¿›è¡ŒHandlerFuncåˆ†ç¦»å¤„ç†ã€‚æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨gini.Bindå’Œgini. JSONRenderWrapåˆ†ç¦»è¯·æ±‚å¤„ç†æµç¨‹ä¸è¿”å›æ•°æ®æµç¨‹ã€‚è®©ä¸šåŠ¡ä»£ç æ— éœ€å…³å¿ƒæ ¸å¿ƒæ•°æ®ï¼Œå°†HTTPè¯·æ±‚è½¬åŒ–ä¸ºç±»ä¼¼å‡½æ•°å¼çš„æµ‹è¯•æ–¹å¼ã€‚ä»¥ä¸€ä¸ªç®€å•çš„å†…å®¹ä¸ºä¾‹\npackage main import ( \u0026#34;errors\u0026#34; \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;github.com/ipfans/gini\u0026#34; ) var ( ErrNotValid = errors.New(\u0026#34;è¯·æ±‚æ•°æ®ä¸æ­£ç¡®\u0026#34;) ) // Echo data. func Echo(c *gin.Context) error { var data map[string]string err := gini.Bind(c, \u0026amp;data) if err != nil { return ErrNotValid } c.Set(\u0026#34;data\u0026#34;, data) return nil } func main() { gin.SetMode(gin.ReleaseMode) gini.RegisterError(ErrNotValid, 400, ErrNotValid.Error()) r := gin.Default() r.Use(gini.DumpReqAndResp()) r.GET(\u0026#34;/echo\u0026#34;, gini.JSONRenderWrap(Echo)) r.Run() } æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå€ŸåŠ©gini.Bindå¯ä»¥æ›¿æ¢çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿›è¡Œæ•°æ®çš„å®šä¹‰ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç¼–å†™æµ‹è¯•ä»£ç ï¼š\nfunc TestEcho(t *testing.T) { type args struct { reqBody string } tests := []struct { name string args args want interface{} wantErr bool }{ { \u0026#34;Normal\u0026#34;, args{ \u0026#34;{\\\u0026#34;name\\\u0026#34;:\\\u0026#34;kevin\\\u0026#34;}\u0026#34;, }, map[string]string{\u0026#34;name\u0026#34;: \u0026#34;kevin\u0026#34;}, false, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { c := \u0026amp;gin.Context{} b := \u0026amp;gini.MockJSONBinder{} b.Body(tt.args.reqBody) gini.SetBinder(b) if err := Echo(c); (err != nil) != tt.wantErr { t.Errorf(\u0026#34;Echo() error = %v, wantErr %v\u0026#34;, err, tt.wantErr) } if data, _ := c.Get(\u0026#34;data\u0026#34;); !assert.Equal(t, tt.want, data) { t.Errorf(\u0026#34;Echo() want = %v, got %v\u0026#34;, tt.want, data) } }) } } è¿™ä¸ªä¼¼ä¹çœ‹èµ·æ¥æ˜¯æ¯”HTTPè¯·æ±‚æ–¹å¼å¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªå¤šåŒºåˆ«ï¼Œä½†æ˜¯å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å„ç§è®¤è¯ç­‰ç­‰å‰ææ¡ä»¶å¼éªŒè¯ï¼Œè¿™åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¸¸å¸¸éœ€è¦åšé¢å¤–çš„fixtureså¸®åŠ©ï¼Œä½†æ˜¯å€ŸåŠ©è¿™ç§æ–¹å¼ï¼Œåˆ™å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„è§‚å¯Ÿä¹¦è¾“å…¥è¾“å‡ºï¼ŒåŒæ—¶åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œç»•è¿‡å¯èƒ½ä¼šå‡ºç°çš„é¢å¤–çš„æ•°æ®å†…å®¹ã€‚\nåŒæ—¶ä½ æˆ·æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨ä½¿ç”¨jsonæ ¼å¼ä½œä¸ºè¿”å›æ•°æ®ï¼Œå¹¶ä¸”åŒ…å«å›ºå®šçš„è¿”å›æ•°æ®æ ¼å¼ï¼Œè¿™ä¹Ÿæ›´æ–¹ä¾¿çš„è¿›è¡Œç»Ÿä¸€æ•°æ®ç®¡ç†ï¼Œæ–¹ä¾¿ä¿®æ­£æ•°æ®è¾“å‡ºæ ¼å¼ï¼ˆå¦‚ï¼šå¯ä»¥åˆ‡æ¢æˆyamlè¾“å‡ºï¼Ÿåˆ‡æ¢å­—æ®µå†…å®¹å’Œå®šä¹‰ï¼‰ã€‚ä¸ºäº†æ–¹ä¾¿æ›´å¥½çš„å…¼å®¹æ•°æ®å¤„ç†ï¼Œæä¾›äº†gini.RegisterErroræ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆ™æ›´å¥½çš„æä¾›è¿”å›çŠ¶æ€å€¼ä¸æç¤ºä¿¡æ¯çš„å®šä¹‰ã€‚å¦‚æœæœªè¿›è¡Œå®šä¹‰ï¼Œåˆ™é»˜è®¤statusä¸º500ï¼Œmsgé»˜è®¤ä¸ºerror.Error()ã€‚\ngini.RegisterError(ErrNotValid, 400, ErrNotValid.Error()) ç»“å°¾ giniåº“æ˜¯æˆ‘ä»¬åœ¨å®è·µä¸­æ€»ç»“å‡ºæ¥çš„ä¸€å¥—åˆä½œè§„çº¦ï¼Œéš¾å…å­˜åœ¨å„ç§ç”±äºæ€è·¯ä¸æŠ€æœ¯å­˜åœ¨çš„çŸ­æ¿ï¼Œå¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®ä¸æ€è·¯ï¼Œéå¸¸æ¬¢è¿åˆ°issuesä¸­ä¸æˆ‘ä»¬ä¸€èµ·è®¨è®ºã€‚\n","date":"2019-01-18T23:20:00Z","permalink":"https://www.4async.com/2019/01/2019-01-18-gin-toolkit-gini/","title":"giniï¼šä¸€ä¸ªè®©ä½ æ›´æ–¹ä¾¿ä½¿ç”¨Ginæ¡†æ¶çš„åº“"},{"content":"æ²¡æƒ³åˆ°ä»Šå¹´çªç„¶æœ‰åŠ¨åŠ›è¿˜èƒ½å†™ä¸€ç¯‡ã€‚å¯èƒ½æ¥è‡ªäºä¸¤ä¸ªæ–¹é¢ï¼Œæœ‰äº›ä¸œè¥¿éœ€è¦æ•´ç†ï¼Œå¦å¤–æœ‰ä¸€ä¸ªäº‹æƒ…æˆ‘æ˜¯æ„Ÿè§‰åˆ°å¾ˆè¯§å¼‚çš„ã€‚ä»Šå¤©æŠ€æœ¯åœˆæœ€ç«çš„äº‹æƒ…å½“å±AntDesignå½©è›‹äº‹ä»¶äº†ï¼ˆä»¥ä¸‹ç®€ç§°AntDï¼‰ï¼Œå¾ˆä¸å¹¸çš„æ˜¯ï¼Œæœ¬å¸ä¹Ÿæ˜¯æœ¬æ¬¡å—å®³è€…ä¹‹ä¸€ã€‚\nè€ƒè™‘åˆ°AntDæ˜¯ä¸€ä¸ªä½¿ç”¨ååˆ†å¹¿æ³›å¹¶ä¸”å…³æ³¨åº¦éå¸¸é«˜çš„å›½å†…é¡¹ç›®ï¼Œå¹¶ä¸”æœ‰é˜¿é‡Œæ”¯ä»˜å®çš„èƒŒä¹¦æ•ˆåº”ï¼Œè¿™ä¸€æ¬¡æˆ‘æƒ³å½±å“çš„ä¼šåœ¨ä¸¤ä¸ªæ–¹é¢ï¼šä¸€ä¸ªæ˜¯é˜¿é‡Œå¼€æºæœ¬èº«çš„ä¿¡ç”¨ï¼Œä¸€ä¸ªæ˜¯å¼€æºé¡¹ç›®åœ¨å›½å†…çš„æ¨å¹¿ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ç¡®å®åœ¨å¼•å…¥AntDæ–¹é¢ç¡®å®å¤ªè¿‡è‰ç‡ï¼šæˆ‘å…¶å®å…³æ³¨AntDäº†å¤§æ¦‚ä¸€å¹´æ—¶é—´ï¼Œè€ƒè™‘åˆ°issueæƒ…å†µå’Œé¡¹ç›®å¼€å‘æ´»è·ƒåº¦æƒ…å†µï¼Œè¦æ±‚å›¢é˜Ÿå¼•å…¥æ­¤æ¡†æ¶å¸Œæœ›å¯ä»¥æå‡å¼€å‘æ•ˆç‡ï¼Œæ²¡æƒ³åˆ°ç›¸å…³çš„é¡¹ç›®1-2ä¸ªæœˆå°±å‡ºç°äº†è¿™ç§äº‹æƒ…ï¼ŒçœŸæ˜¯ä»¤äººå®åœ¨ç—›å¿ƒã€‚\nè¿™ä»¶äº‹æƒ…ä¹Ÿæš´éœ²å‡ºæ¥ï¼Œæˆ‘ä»¬ä»¥å‰åœ¨ä½¿ç”¨å¼€æºé¡¹ç›®æ—¶ï¼Œå¤ªè¿‡ä¿¡ä»»\nå¦å¤–ï¼Œä½œä¸ºæœ€åçš„ä¸€ä¸ªå»ºè®®ï¼Œæˆ‘ä»¬å¸Œæœ›å¦‚æœå¤§å®¶ä»¥åå¼€æºé¡¹ç›®ï¼Œå¦‚æœåšä¸åˆ°ï¼Œè¯·ä¸è¦è¯´è‡ªå·±æ˜¯__ä¼ä¸šçº§é¡¹ç›®__ï¼Œå› ä¸ºä¸€èˆ¬ä¹Ÿå°±æ˜¯æ”¾åœ¨è‡ªå·±ä¼ä¸šé‡Œé¢ç”¨ï¼Œè¿™è·Ÿä¼ä¸šçº§é¡¹ç›®æ˜¯ä¸¤ä¸ªæ¦‚å¿µã€‚è‡³å°‘æˆ‘ä»¬å…·ä½“åˆ°AntDè¿™ä¸ªé¡¹ç›®ä¸Šï¼Œè¿™ä¸ªé¡¹ç›®æ— è®ºä»£ç å¼€å‘å’Œç®¡æ§ä¸Šï¼Œéƒ½æ˜¯ç®—ä¸ä¸Šçš„ã€‚\n","date":"2018-12-25T23:20:00Z","permalink":"https://www.4async.com/2018/12/2018-12-25-scm-security/","title":"æ¼«è°ˆä»£ç å®‰å…¨ï¼šä¹Ÿæ¥èŠä¸€èŠAntDè¿™æ¡£å­äº‹"},{"content":"æœ€è¿‘æˆ‘ä»¬åœ¨æŠŠçº¿ä¸Šç³»ç»Ÿå‡çº§è‡³Go 1.10ç‰ˆæœ¬æ—¶å‘ç°ï¼Œåœ¨æˆ‘ä»¬å®ç°çš„æŸäº›æ¥å£ä¸­ï¼Œå‡ºç°äº†å®¢æˆ·åé¦ˆè°ƒç”¨å¤±è´¥æç¤ºå‚æ•°ç¼ºå¤±çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­æœªèƒ½å¤çº¿ï¼Œåæ¥ç»è¿‡äº†è§£ï¼Œå‘ç°äº†æ•…éšœåŸå› ä¸ºGo 1.10ç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­æ›´æ”¹äº†éƒ¨åˆ†ç¨‹åºä»£ç ä¸éªŒè¯é€»è¾‘å¯¼è‡´çš„ã€‚\næ•…éšœè¯´æ˜ ä¸ºäº†æ–¹é¢è¯´æ˜ï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬å­˜åœ¨ä¸€ä¸ªè¦æ±‚ä»¥application/x-www-urlencoded-formçš„Content-Typeæäº¤çš„è¡¨å•ï¼Œåœ¨å…·ä½“çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨æ ‡å‡†åº“net/httpä¸­çš„ParseFormæ–¹æ³•å¤„ç†è¡¨å•ï¼Œæœ€åè·å–ç»“æœã€‚\nä½†æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼ŒæŸäº›å¼€å‘äººå‘˜ç´ è´¨ä¸è¶³ï¼Œä»ç½‘ä¸Šæ£€ç´¢éƒ¨åˆ†ä»£ç å¤åˆ¶ç²˜è´´ï¼ˆå¦‚éƒ¨åˆ†Javaå¼€å‘ï¼‰ï¼Œå¯¼è‡´æäº¤multipart/formdataæ•°æ®åˆ°æœåŠ¡å™¨è¿›è¡Œè¯·æ±‚ã€‚è¿™ä¸ªè¯·æ±‚æ–¹å¼åœ¨ParseFormå¤„ç†ä¸­æ˜¯å¯ä»¥è¢«æ¥å—çš„ï¼Œä»£ç ä¼šæ ¹æ®Content-Typeè¿›è¡Œå¤„ç†ï¼šå¦‚æœæ˜¯æä¾›äº†multipartçš„æ•°æ®ï¼ŒGoå†…éƒ¨ä¹Ÿä¼šæ­£å¸¸å¤„ç†ã€‚\nåœ¨Go1.10åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåœ¨CL70931ä¸­è¿›è¡Œäº†ä¿®æ”¹ï¼Œä¸ºäº†å…¼å®¹RFC2388ä¸­æ–‡ä»¶åç§°å¯é€‰çš„é—®é¢˜ã€‚åœ¨ä¿®æ”¹ä¹‹åï¼Œåœ¨ä½¿ç”¨multipart/formdataæ–¹å¼æäº¤çš„è¡¨å•ä¼šè¢«ç»Ÿä¸€è¯†åˆ«æˆæ–‡ä»¶ï¼Œåªèƒ½é€šè¿‡http.Request.FormFileæ–¹å¼è¯»å–ã€‚è¿™æ ·å°±å¯¼è‡´æˆ‘ä»¬ä½¿ç”¨FormValueè¯»å–è¡¨å•æ•°æ®åè¯»å–ç»“æœä¸ºç©ºã€‚\næ•…éšœå¤„ç† å¤„ç†æ–¹å¼ä¸ç¢ä¹ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ¨åŠ¨ç”¨æˆ·ä¿®æ”¹è‡ªå·±çš„ä»£ç ï¼Œè¿™ç§ä¸éœ€è¦é¢å¤–ä¿®æ”¹ã€‚\nå¦å¤–ä¸€ç§ä¸»è¦æ˜¯å·±æ–¹åŠ¨ä½œï¼Œå…¼å®¹Go1.10+ç‰ˆæœ¬å¸¦æ¥çš„é—®é¢˜ï¼ˆæˆ–è€…é™çº§1.9ç‰ˆæœ¬ï¼‰ã€‚è¿™é‡Œä¸»è¦ä»‹ç»ä¸€ä¸‹ç¬¬äºŒç§æ–¹æ³•çš„å¤„ç†ã€‚\nåœ¨ç¬¬äºŒç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†ä½¿ç”¨FormValueè¯»å–çš„æ•°æ®æ›´æ¢ä¸ºFormFileè·å–æ–‡ä»¶å½¢å¼è¿›è¡Œè·å–ã€‚è¿™ä¸ªå¯ä»¥å‚è€ƒå¦‚ä¸‹ä¼ªä»£ç è¿›è¡Œä¿®æ”¹ï¼ˆæœªå¤„ç†å¼‚å¸¸æƒ…å†µï¼Œè¯·è‡ªè¡Œä¿®æ”¹ï¼‰ï¼š\nf, _, err := req.FormFile(key) if err == nil { b, _ := ioutil.ReadAll(f) value = string(b) } æˆªæ­¢ç›®å‰ä¸ºæ­¢ï¼ˆGo1.10.3ï¼‰ï¼Œè¯¥å…¼å®¹æ€§é—®é¢˜ä¸€ç›´å°šæœªå¤„ç†ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ…å†µè‡ªè¡Œåˆ¤æ–­è§£å†³æ–¹æ¡ˆã€‚\n2018å¹´11æœˆæ›´æ–° æ­¤é—®é¢˜åœ¨Go 1.11.1ç‰ˆæœ¬ä¸­å›æ»šï¼Œå¯é€‰æ‹©Go 1.11.1ä»¥åç‰ˆæœ¬ç¼–è¯‘åŸç¨‹åºå³å¯ã€‚\n","date":"2018-06-08T12:20:00Z","permalink":"https://www.4async.com/2018/06/2018-06-08-compatibility-in-golang-1-10/","title":"Go 1.10ä¸­çš„ä¸€å¤„ä¸å…¼å®¹é—®é¢˜"},{"content":"ä»Šå¤©æ­£å¥½çœ‹åˆ°ä¸€ç¯‡å…³äºæ•æ„Ÿä¿¡æ¯è¿‡æ»¤çš„æ–‡ç« ï¼Œè¿™ç®—åšä¸€ä¸ªinterfaceå®é™…åº”ç”¨çš„ä¸€äº›ä¸¾ä¾‹å’Œåº”ç”¨ã€‚\nä¾‹å­ä¸­ä»‹ç»äº†ä¸€ç§æ¯”è¾ƒå¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼šä½¿ç”¨JSONä¿å­˜æ•°æ®æ—¶çš„å¯¹è¯¸å¦‚ç”¨æˆ·å¯†ç ç­‰ä¿¡æ¯è¿›è¡Œä¿æŠ¤æ—¶å€™åº”è¯¥åšçš„äº‹æƒ…ã€‚ä½œè€…ä»¥ä½¿ç”¨JSONæ ¼å¼ä¿å­˜ç”¨æˆ·è´¦æˆ·å’Œå¯†ç ä¸ºä¾‹ï¼Œè®²è§£äº†ä½¿ç”¨json.Unmarshaleræ¥å£ç±»å‹è¿‡æ»¤æ•æ„Ÿä¿¡æ¯ã€‚\næ¯”å¦‚ï¼Œå¯¹äºä¿å­˜æ•æ„Ÿæ•°æ®çš„ç»“æ„ä½“ï¼š\ntype Credentials struct { Email string `json:â€emailâ€` Password string `json:â€passwordâ€` } func (co Credentials) MarshalJSON() ([]byte, error) { type credentials Credentials cn := credentials(co) cn.Password = \u0026#34;[REDACTED]\u0026#34; return json.Marshal((*credentials)(\u0026amp;cn)) } é€šè¿‡å®šä¹‰MarshalJSONæ–¹æ³•æ»¡è¶³json.Unmarshaleræ¥å£ç±»å‹çš„è¦æ±‚ï¼Œè¿™æ ·ï¼Œå½“ä½¿ç”¨json.Unmarshalç­‰æ–¹æ³•æ—¶ï¼Œå°±å¯ä»¥è§„é¿æ‰åœ¨æ—¥å¿—æˆ–è€…JSONæ¥å£ä¹‹ç±»çš„æ–¹æ³•ä¸­è¾“å‡ºæ•æ„Ÿä¿¡æ¯Passwordã€‚\næ–‡ä¸­æåŠäº†json.Unmarshaleræ¥å£ä¸€ä¸ªæ–¹æ³•ï¼Œä½†è¿™ç§æ–¹æ³•å¹¶ä¸æ˜¯å®Œå…¨èƒ½å¤Ÿè§£å†³æ‰€æœ‰çš„ç±»å‹çš„æ•æ„Ÿä¿¡æ¯è¿‡æ»¤é—®é¢˜ã€‚æ¯”å¦‚åœ¨ä½¿ç”¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¼€å‘äººå‘˜å¸¸å¸¸ä½¿ç”¨çš„fmt/logåŒ…ï¼Œåˆ™ä¸èƒ½ç”¨è¿™ç§æ–¹æ³•è§£å†³ã€‚\nè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåˆ™éœ€è¦ä½¿ç”¨å¦å¤–ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ¥å£ç±»å‹ï¼Œé‚£ä¹ˆå°±æ˜¯fmt.Stringeræ¥å£ç±»å‹ã€‚è¯¥æ¥å£ç±»å‹é€šå¸¸ç”¨äºå¦‚log/fmtä¹‹ç±»çš„åŒ…çš„è¾“å‡ºä¸­ã€‚\nå®é™…ä¸Šï¼Œæˆ‘ä¸ªäººè®¤ä¸ºéå¸¸åˆé€‚çš„æ–¹æ³•æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ç‰¹å®šæŸä¸ªç‰¹æ®Šç±»å‹Sensitivityï¼Œå¯¹äºæ•æ„Ÿä¿¡æ¯ç»Ÿä¸€é‡‡ç”¨è¿™ä¸ªç±»å‹äºˆä»¥ä¿æŠ¤ã€‚è¿™æ ·ä¹Ÿæ–¹ä¾¿æˆ‘ä»¬åç»­æ·»åŠ æ–°çš„ä¿æŠ¤æ–¹å¼ã€‚\nçœ‹ä¸€ä¸‹è¿™ä¸ªæ•æ„Ÿä¿¡æ¯å¦‚ä½•è¿‡æ»¤ï¼š\ntype Sensitivity string func (s Sensitivity) String() string { return \u0026#34;[SENSITIVE DATA]\u0026#34; } ... request := CreateUserRequest{ Credentials: Credentials{ Email: \u0026#34;bilbro@theshire.net\u0026#34;, Password: \u0026#34;theonering\u0026#34;, }, } fmt.Println(\u0026#34;request:\u0026#34;, request) è¾“å‡ºç»“æœä¸ºï¼š\nrequest: {{bilbro@theshire.net [SENSITIVE DATA]}} åŒæ ·çš„ï¼Œæˆ‘ä»¬ç»“åˆç¬¬ä¸€ä¸ªæ–¹æ³•ä¸­çš„json.Unmarshalerä¸€èµ·ä½¿ç”¨æ—¶ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„æ•æ„Ÿä¿¡æ¯è¿‡æ»¤æ–¹æ¡ˆäº†ã€‚\ntype Sensitivity string func (s Sensitivity) String() string { return \u0026#34;[SENSITIVE DATA]\u0026#34; } func (s Sensitivity) MarshalJSON() ([]byte, error) { return []byte(`\u0026#34;[SENSITIVE DATA]\u0026#34;`), nil } è¿™ç§æ–¹å¼ä¹Ÿèƒ½å¾ˆå¥½çš„å…¼å®¹å„ç§æ•°æ®åº“ORMåº“ï¼Œä¿è¯æˆ‘ä»¬çš„åŠŸèƒ½å¯ä»¥æ­£å¸¸åº”ç”¨åœ¨æ•°æ®æ¨¡å‹ç­‰åœºæ™¯ä¸Šï¼š\nsess, _ := mgo.Dial(\u0026#34;\u0026#34;) sess.DB(\u0026#34;test\u0026#34;).C(\u0026#34;data\u0026#34;).Insert(\u0026amp;request.Credentials) var c Credentials sess.DB(\u0026#34;test\u0026#34;).C(\u0026#34;data\u0026#34;).Find(bson.M{}).One(\u0026amp;c) fmt.Println(c.Password == \u0026#34;theonering\u0026#34;) ... db, _ := gorm.Open(\u0026#34;mysql\u0026#34;, \u0026#34;root:pwd@/ytest?charset=utf8\u0026amp;parseTime=True\u0026amp;loc=Local\u0026#34;) ... db.Create(\u0026amp;request.Credentials) var c Credentials db.First(\u0026amp;c) fmt.Println(c.Password == \u0026#34;theonering\u0026#34;) ç±»ä¼¼çš„è¿˜æœ‰ä¸€ä¸ªæ¶‰åŠç¼–ç æ–¹æ³•encoding.TextMarshalerï¼ŒåŸºæœ¬ä¸fmt.Stringerç±»ä¼¼ï¼Œå› æ­¤ä¹Ÿä¸éœ€è¦é¢å¤–çš„èµ˜è¿°äº†ã€‚\næ³¨æ„ï¼šå¦‚æœä½ ä½¿ç”¨äº†å¦‚fmt.Sprintfä¹‹ç±»çš„æ ¼å¼åŒ–è¯·æ±‚ï¼Œä¹Ÿä¼šå—åˆ°fmt.Stringeræ¥å£ç±»å‹çš„å½±å“ï¼Œè¯·æ ¹æ®ä½¿ç”¨æƒ…å†µé…Œæƒ…ä½¿ç”¨ã€‚\n","date":"2018-06-06T16:07:00Z","permalink":"https://www.4async.com/2018/06/2018-06-06-sensitive-info-filter-in-golang/","title":"å…³äºGolangè¿‡æ»¤æ•æ„Ÿä¿¡æ¯çš„æ­£ç¡®å§¿åŠ¿"},{"content":"æˆ‘ä»¬ä» Consul 0.6.x ç‰ˆæœ¬å¼€å§‹ä½¿ç”¨ï¼Œä¸­é—´ä¹Ÿé‡åˆ°çš„ä¸€äº›å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ¯”è¾ƒå¸¸è§çš„æ“ä½œé—®é¢˜å°±æ˜¯ consul çš„å‡çº§é—®é¢˜ï¼ˆæ¯”å¦‚è§£å†³ BUGï¼Œæ—©æœŸ Consul çš„ BUG ä¹Ÿé‡åˆ°äº†å¥½å‡ ä¸ªï¼‰ã€‚\nå¹³æ»‘å‡çº§æ—¶ï¼Œæˆ‘ä»¬å¸¸è§çš„æ–¹å¼ä¸€èˆ¬ä¸ºæ›¿æ¢ consul å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œ Graceful é‡å¯\nå¸¸è§ Consul çš„ Graceful leave çš„æ–¹æ³•æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š\n å‘é€ SIGINT ä¿¡å·è‡³ Consulï¼› è¿æ¥è¦å‡çº§çš„ consulï¼Œä½¿ç”¨å‘½ä»¤ consul leave å‘é€ç¦»å¼€å‘½ä»¤ï¼›  è¿™ä¸¤ç§æ–¹å¼éƒ½ä¼šè®©è¯¥èŠ‚ç‚¹ä¸»åŠ¨é€€å‡ºé›†ç¾¤å¹¶ç»“æŸè¿›ç¨‹ï¼Œå¦‚ä¸‹ï¼š\n[INFO] agent: Caught signal: terminated [INFO] agent: Graceful shutdown disabled. Exiting [INFO] agent: Requesting shutdown [INFO] consul: shutting down server [WARN] serf: Shutdown without a Leave [ERR] agent: Coordinate update error: No cluster leader [ERR] agent: failed to sync remote state: No cluster leader [WARN] serf: Shutdown without a Leave [INFO] manager: shutting down [INFO] agent: consul server down [INFO] agent: shutdown complete [INFO] agent: Stopping DNS server 10.135.218.10:53 (tcp) [INFO] agent: Stopping DNS server 10.135.218.10:53 (udp) [INFO] agent: Stopping HTTP server 10.135.218.10:8500 (tcp) [INFO] agent: Waiting for endpoints to shut down [INFO] agent: Endpoints down [INFO] agent: Exit code: 1 ä¹‹åé‡æ–°å¯åŠ¨ consul è¿›ç¨‹å³å¯ã€‚\n","date":"2018-05-10T15:20:00Z","permalink":"https://www.4async.com/2018/05/2018-05-10-consul-graceful-stop/","title":"Consulå¹³æ»‘å‡çº§çš„ä¸€ç‚¹å»ºè®®"},{"content":"æ„Ÿè°¢Github Pageç»ˆäºæ”¯æŒäº†Let\u0026rsquo;s Encryptçš„HTTPSï¼Œå¾ˆä¹…ä¹‹å‰è´­ä¹°çš„åŸŸåç»ˆäºå¯ä»¥å†æ¬¡å‘å…‰å‘çƒ­äº†ã€‚\næ–°çš„åŸŸåï¼š https://www.4async.com\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ–°çš„åŸŸåç”Ÿæ•ˆä¹‹åï¼ŒHTTPSéœ€è¦ç­‰å¾…1-2ä¸ªå°æ—¶æ‰èƒ½å¯ç”¨ã€‚\n","date":"2018-05-03T11:20:00Z","permalink":"https://www.4async.com/2018/05/2018-05-03-new-domain/","title":"é…ç½®æ–°åŸŸå"},{"content":"æ ‘è“æ´¾æ”¯æŒå‘½ä»¤è¡Œä¸‹é…ç½®WiFiè¿æ¥ï¼Œå¯ä»¥é€šè¿‡ç¼–è¾‘ /etc/wpa_supplicant/wpa_supplicant.conf æ–‡ä»¶é…ç½®å¯¹åº”çš„WiFié…ç½®ã€‚å…·ä½“çš„å†…å®¹å¯ä»¥ä½¿ç”¨ wpa_passphrase å·¥å…·ç”Ÿæˆå¯¹åº”çš„é…ç½®ä¿¡æ¯ï¼Œé™„åŠ åˆ°è¯¥æ–‡ä»¶ç»“å°¾å³å¯ã€‚\nå‡è®¾æˆ‘å­˜åœ¨ SSID ä¸º testing å¯†ç ä¸º testingPassword çš„WiFiç½‘ç»œï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ wpa_passphrase  ç”Ÿæˆå¯¹åº”çš„é…ç½®å­—ç¬¦ä¸²ï¼š\n$ wpa_passphrase \u0026quot;testing\u0026quot; \u0026quot;testingPassword\u0026quot; network={ ssid=\u0026quot;testing\u0026quot; #psk=\u0026quot;testingPassword\u0026quot; psk=131e1e221f6e06e3911a2d11ff2fac9182665c004de85300f9cac208a6a80531 }  å½“ç„¶ä½ å¯ä»¥åœ¨ `psk` å¡«å†™åŸå§‹çš„å¯†ç ã€‚ ä¸è¿‡åœ¨æŸäº›æé™ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬æœ‰å¯èƒ½ä¾¿è£…å‡ºé—¨ï¼Œæœªé…ç½®ç½‘çº¿ç­‰å·¥å…·ï¼Œè¿™ä¸ªæ—¶å€™åªæœ‰æœªåŠ å…¥è¿‡çš„WiFiç½‘ç»œï¼Œè¿™æ ·å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ è¿™ç§æ–¹å¼ä¸å¼€å¯SSHæ–¹å¼ç±»ä¼¼ï¼Œåœ¨åˆ¶ä½œçš„SDå¡æ ¹ç›®å½•ä¸‹ï¼Œæ–°å¢/ä¿®æ”¹å¯¹åº”çš„ `wpa_supplicant.conf` æ–‡ä»¶ï¼Œæ·»åŠ å¯¹åº”çš„ä¿¡æ¯å³å¯ã€‚ *æ³¨æ„ï¼Œè¯¥æ–‡ä»¶åŒ…å«é»˜è®¤å¤´éƒ¨ä¿¡æ¯ä¸èƒ½ç¼ºå°‘ã€‚å¦‚Raspbian 20180418ç‰ˆæœ¬å®Œæ•´é…ç½®ä¸ºï¼š* ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev update_config=1\nnetwork={ ssid=\u0026ldquo;testing\u0026rdquo; #psk=\u0026ldquo;testingPassword\u0026rdquo; psk=131e1e221f6e06e3911a2d11ff2fac9182665c004de85300f9cac208a6a80531 }\n","date":"2018-04-20T17:30:00Z","permalink":"https://www.4async.com/2018/04/2018-04-20-setup-wifi-raspberrypi-headless/","title":"æ ‘è“æ´¾æ— ç•Œé¢é…ç½®WiFi"},{"content":"èƒŒæ™¯ä»‹ç» æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­é€æ¸åˆ‡æ¢ä½¿ç”¨äº†gRPCä½œä¸ºæœåŠ¡é—´è°ƒç”¨çš„ä¸»è¦æ‰‹æ®µï¼Œé€æ­¥æ›¿æ¢RESTful APIåœ¨ç›®å‰æˆ‘ä»¬é¡¹ç›®ä¸­çš„ä½¿ç”¨ã€‚åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼ŒgRPCçš„æ•ˆç‡æ˜¯æˆ‘ä»¬æƒ³å¯¹æ¯”è¾ƒå…³å¿ƒå¹¶ä¸”ä»ç›®å‰æ¥çœ‹ç›¸å¯¹éš¾ä»¥ä¼˜åŒ–çš„ç»„ä»¶ï¼Œæ‰€ä»¥æœ¬æ–‡å°±æ˜¯æ¢è®¨å¦‚ä½•èƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹gRPCæºç çš„å‰æä¸‹å°½é‡æå‡gRPCçš„æ€§èƒ½ã€‚\ngrpcå®˜æ–¹æä¾›äº†æ€§èƒ½benchmarkå¯ä»¥ä¾›å¤§å®¶æŸ¥çœ‹ï¼Œå…·ä½“çš„é“¾æ¥å¯ä»¥åœ¨ gRPC Performance Dashboard ä¸­æŸ¥çœ‹ã€‚\næ€§èƒ½æµ‹è¯• æ€§èƒ½æµ‹è¯•é‡‡ç”¨æˆ‘ä»¬çš„çº¿ä¸Šæ ‡é…ï¼Œç›®å‰ç”±äºä¸šåŠ¡é‡åŸå› ï¼Œå…¶å®æ€§èƒ½å¹¶ä¸é«˜ï¼Œè¿™é‡Œåªæ˜¯å¯¹æ¯”å‚è€ƒï¼Œå»ºè®®ä½ åœ¨åç»­å¤„ç†è¿‡ç¨‹ä¸­è‡ªè¡Œæµ‹è¯•ã€‚å…¶å®æœ€ç®€å•çš„å¤„ç†æ–¹å¼å°±æ˜¯åˆ›å»ºå¤šä¸ªgRPC clientã€‚\nå•Clientå¤„ç†ï¼š\nâœ client ./client -n 100000 -c 1 2017/08/04 16:49:39 concurrency: 1 requests per client: 100000 2017/08/04 15:59:39 message size: 581 bytes 2017/08/04 16:00:04 took 24467 ms for 100000 requests 2017/08/04 16:00:04 sent requests : 100000 2017/08/04 16:00:04 received requests : 100000 2017/08/04 16:00:04 received requests_OK : 100000 2017/08/04 16:00:04 throughput (TPS) : 4087 2017/08/04 16:00:04 mean: 244283 ns, median: 241106 ns, max: 6107692 ns, min: 138633 ns, p99: 678374 ns 2017/08/04 16:00:04 mean: 0 ms, median: 0 ms, max: 6 ms, min: 0 ms, p99: 0 ms ä¿®æ”¹Clientæ•°ç›®ä¸º10ï¼š\nâœ client ./client -n 100000 -c 10 2017/08/04 16:02:55 concurrency: 10 requests per client: 10000 2017/08/04 16:02:55 message size: 581 bytes 2017/08/04 16:03:01 took 6264 ms for 100000 requests 2017/08/04 16:03:01 sent requests : 100000 2017/08/04 16:03:01 received requests : 100000 2017/08/04 16:03:01 received requests_OK : 100000 2017/08/04 16:03:01 throughput (TPS) : 15964 2017/08/04 16:03:01 mean: 623814 ns, median: 550812 ns, max: 15572759 ns, min: 98979 ns, p99: 5868493 ns 2017/08/04 16:03:01 mean: 0 ms, median: 0 ms, max: 15 ms, min: 0 ms, p99: 5 ms ä¿®æ”¹Clientæ•°ç›®ä¸º20ï¼š\nâœ client ./client -n 100000 -c 20 2017/08/04 16:03:48 concurrency: 20 requests per client: 5000 2017/08/04 16:03:48 message size: 581 bytes 2017/08/04 16:03:54 took 6438 ms for 100000 requests 2017/08/04 16:03:54 sent requests : 100000 2017/08/04 16:03:54 received requests : 100000 2017/08/04 16:03:54 received requests_OK : 100000 2017/08/04 16:03:54 throughput (TPS) : 15532 2017/08/04 16:03:54 mean: 1277405 ns, median: 1132744 ns, max: 16286260 ns, min: 99258 ns, p99: 8126886 ns 2017/08/04 16:03:54 mean: 1 ms, median: 1 ms, max: 16 ms, min: 0 ms, p99: 8 ms ä¿®æ”¹Clientæ•°ç›®ä¸º15ï¼š\nâœ client ./client -n 100000 -c 15 2017/08/04 16:06:57 concurrency: 15 requests per client: 6666 2017/08/04 16:06:57 message size: 581 bytes 2017/08/04 16:07:02 took 5528 ms for 99990 requests 2017/08/04 16:07:02 sent requests : 99990 2017/08/04 16:07:02 received requests : 99990 2017/08/04 16:07:02 received requests_OK : 99990 2017/08/04 16:07:02 throughput (TPS) : 18087 2017/08/04 16:07:02 mean: 823191 ns, median: 741738 ns, max: 17466607 ns, min: 93208 ns, p99: 5787005 ns 2017/08/04 16:07:02 mean: 0 ms, median: 0 ms, max: 17 ms, min: 0 ms, p99: 5 ms ","date":"2018-04-20T12:00:00Z","permalink":"https://www.4async.com/2018/04/2018-04-20-grpc-performance-optimizing/","title":"gRPCæ€§èƒ½ä¼˜åŒ–"},{"content":"face_recognition æ˜¯ä¸€ä¸ªçƒ­é—¨çš„äººè„¸è¯†åˆ«åº“ï¼Œå¸¸å¹´å æ® Github Trending Python å­ç±»çš„ Top10ã€‚\nåœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œä»‹ç»å®‰è£… face_recognition æ­¥éª¤éå¸¸ç®€å•ï¼Œåªéœ€è¦æ‰§è¡Œ pip install face_recognition å°±å¯ä»¥äº†ï¼Œå®é™…åœ¨å®‰è£…è¿‡ç¨‹ä¸­ face_recognition æœ‰ä¸€äº›é Python ä¾èµ–ï¼Œéœ€è¦å•ç‹¬å®‰è£…ï¼Œæœ¬æ–‡å°±å¯¹å†…å®¹è¿›è¡Œä¸€ä¸ªç®€å•ä»‹ç»ï¼Œæƒä½œè®°å½•ï¼Œæ–¹ä¾¿å¤§å®¶æ‰‹åŠ¨å®‰è£…æ—¶æå‰è§„é¿ã€‚æ–‡ç« åŸºäº OSX 10.12.6+pyenv+python3.6.2 ä»‹ç»ã€‚\né—®é¢˜åœ¨å“ªé‡Œï¼Ÿ face_recognition çš„ä¾èµ–å¤§éƒ¨åˆ†éƒ½æ¯”è¾ƒå¥½å®‰è£…ï¼Œåªæœ‰ä¸€ä¸ªåº“ä¾‹å¤–ï¼Œé‚£å°±æ˜¯ dlib è¿™ä¸ªä¾èµ–ã€‚è¿™ä¸ªä¾èµ–éœ€è¦å®‰è£… boost å’Œ boost-python ä¸¤ä¸ªé Python ä¾èµ–ã€‚\nå®‰è£… Boost å’Œ boost-python è¿™ä¸¤ä¸ªåº“å¯ä»¥é€šè¿‡ Homebrew å¿«é€Ÿå®‰è£…ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š\nbrew install boost brew install boost-python --with-python3 éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ˜¯ Python3 ä½¿ç”¨ï¼Œéœ€è¦é¢å¤–å‚æ•°ï¼Œä½¿ç”¨æºç ç¼–è¯‘å®‰è£…ã€‚å¦‚æœä½¿ç”¨ Python2 å¯ä»¥ä½¿ç”¨ Homebrew çš„é¢„ç¼–è¯‘åŒ…ã€‚\nç¡®è®¤ Python dlib è¦æ±‚ Python ç¼–è¯‘æ—¶ä½¿ç”¨ --enable-shared å‚æ•°ç¼–è¯‘ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œpyenv æœªå¯ç”¨è¯¥å‚æ•°ï¼Œå› æ­¤ç¼–è¯‘éœ€è¦ä½¿ç”¨ä¸‹é¢å‚æ•°è¿›è¡Œ Python é‡æ–°ç¼–è¯‘\nPYTHON_CONFIGURE_OPTS=\u0026quot;--with-dtrace --enable-shared\u0026quot; pyenv install 3.6.2 å‰é¢ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä¸€ç›´ç¼–è¯‘ Python 3.6 ä½¿ç”¨çš„å‚æ•°ï¼Œæ–¹ä¾¿ä½¿ç”¨ DTrace ç›‘æ§ Python çš„æ‰§è¡Œã€‚å…·ä½“çš„ä½œç”¨å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« ã€‚\nè¿™æ ·è¿˜æ²¡æœ‰å®Œï¼Œå› ä¸º dlib çš„ä»£ç é—®é¢˜ï¼Œå¯¹é»˜è®¤ Python3.6 çš„ library è¯†åˆ«æœ‰é—®é¢˜ï¼Œå› æ­¤éœ€è¦å°† Python å®‰è£…ç›®å½•ä¸‹çš„ lib/libpython3.6m.dylib å¤åˆ¶ä¸º lib/libpython3.6.dylibã€‚ä¸€èˆ¬ pyenv ç›®å½•ä¸º ~/.pyenv/versions/3.6.2/lib/\nå®‰è£… face_recognition æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ pip æ­£å¸¸å®‰è£… face_recognition äº†ï¼Œå…¶ä¸­ dlib ç¼–è¯‘è¿˜æ˜¯éœ€è¦æ¶ˆè€—ä¸€äº›æ—¶é—´çš„ï¼Œéœ€è¦è€å¿ƒç­‰å¾…ã€‚\n","date":"2017-08-02T18:30:00Z","permalink":"https://www.4async.com/2017/08/2017-08-02-install-face-recognition-on-osx/","title":"OSX ä¸‹å®‰è£… face_recognition"},{"content":"ç”±äºè¿‡å»çš„å†å²åŸå› ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„é»˜è®¤ DB æ˜¯ MongoDB æ•°æ®åº“ã€‚MongoDB æ•°æ®åº“æœ¬èº«åœ¨æ”¯æŒéæ ¼å¼åŒ–çš„æ•°æ®å­˜å‚¨æ–¹é¢æœ‰æ¯”è¾ƒå¤§çš„ä¼˜åŠ¿ï¼Œä¹Ÿä¸éœ€è¦é¢å¤–åšå¾ˆå¤šçš„ Schema Migrationï¼Œåœ¨æˆ‘ä»¬é¡¹ç›®åˆæœŸï¼Œæ•°æ®å­˜å‚¨ç»“æ„å˜åŠ¨é¢‘ç¹æ—¶å¸®åŠ©éå¸¸å¤§ã€‚\nä½†æ˜¯ï¼Œéšç€æˆ‘ä»¬çš„ä¸šåŠ¡ä¸æ–­å¢é•¿ï¼Œæˆ‘ä»¬ä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè¿™ç¯‡æ–‡ç« æ€»ç»“äº†ä¸€äº›æˆ‘ä»¬åœ¨è¿‡å»çš„è¿‡ç¨‹ä¸­å‡ºç°çš„ä¸€äº›é—®é¢˜æˆ–è€…å¤±è¯¯ï¼Œå¸®åŠ©å¤§å®¶åœ¨å®è·µè¿‡ç¨‹ä¸­è¿›è¡Œè§„é¿ã€‚\né›†åˆä½¿ç”¨ä¸å½“é—®é¢˜ åœ¨ä½¿ç”¨ MongoDB è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å¤§é‡çš„é›†åˆã€‚è¿™ç§æƒ…å†µåœ¨ WiredTriger å¼•æ“ä¸‹åˆ›å»ºå¤§é‡é›¶æ•£æ–‡ä»¶ã€‚è¿™ä¸ªåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æš‚æ—¶æœªå¯¹æˆ‘ä»¬é€ æˆå®é™…çš„ä¸šåŠ¡è¾ƒå¤§å½±å“ï¼Œä½†æ˜¯ä»å®é™…ä½¿ç”¨è€Œè¨€ï¼Œå¯¹æ•´ä½“æ•°æ®åº“æ€§èƒ½ã€åç»­ä¸»ä»å¤åˆ¶é›†ç¾¤åŒæ­¥ï¼Œéƒ½æ˜¯æœ‰ä¸€å®šå½±å“çš„ã€‚åœ¨å®é™…åº”ç”¨è¿‡ç¨‹ä¸­åº”è¯¥é¿å…ï¼šæ‹¥æœ‰è¿‡å¤š DBã€ä¸€ä¸ª DB ä¸‹æœ‰è¿‡å¤š Collectionï¼Œè¿™æ ·éƒ½ä¼šå¯¼è‡´éƒ¨åˆ†æŒ‡ä»¤çš„æ€§èƒ½å¤§å¹…åº¦ä¸‹æ»‘ã€‚åŒæ—¶ï¼Œè¿‡å¤šçš„ DB ä¹Ÿä¼šå¯¼è‡´ä¸»ä»åŒæ­¥å¤±è´¥ (listDatabse è¶…æ—¶å¯¼è‡´å¤±è´¥ï¼Œä»åº“é€€å‡º)ã€‚\næ•°æ®åº“ç´¢å¼•å»ºç«‹ MongoDB Collection ç´¢å¼•å»ºç«‹åŠŸèƒ½æ”¯æŒå‰å°åˆ›å»ºæ¨¡å¼ä¸åå°åˆ›å»ºæ¨¡å¼ä¸¤ç§ã€‚é»˜è®¤æ¨¡å¼ä¸ºå‰å°åˆ›å»ºæ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹ä¼šå‘ç”Ÿï¼šDB è¢«é”ï¼Œä¸»åº“æ‰€æœ‰è¯»å†™è¢«ç¦æ­¢ã€ä»åº“æ— æ³•è®¿é—®ã€‚ä»å¦ä¸€æ–¹é¢æ¥è¯´ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿçš„æ•°æ®åº“è®¿é—®å—åˆ°å½±å“ã€‚è™½ç„¶å‰å°åˆ›å»ºæ¨¡å¼æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯çº¿ä¸Šæ“ä½œï¼Œå¹¶ä¸”æœ‰ä¸€å®šæ•°é‡çº§ï¼Œåˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ·»åŠ  {background:true} è®©åˆ›å»ºç´¢å¼•æ“ä½œè½¬æ¢ä¸ºåå°æ“ä½œï¼Œå°½ç®¡æ—¶é—´è¾ƒé•¿ï¼Œä½†æ˜¯å¯¹ä¸šåŠ¡å½±å“è¾ƒå°ã€‚åŒæ—¶ï¼Œè¯¥æ“ä½œä¹Ÿåº”è¯¥åœ¨ä¸šåŠ¡é‡å°æ—¶è¿›è¡Œã€‚\næ•°æ®åº“ä¸»ä»åˆ‡æ¢ è™½ç„¶ MongoDB çš„ Replica Set åŠŸèƒ½å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œè‡ªåŠ¨ä¸»ä»åˆ‡æ¢ã€‚ä½†æ˜¯å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¼šé‡åˆ°ä¸€äº›éœ€è¦æ‰‹å·¥è¿›è¡Œä¸»ä»åº“åˆ‡æ¢çš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œè¿›è¡Œè¿›è¡Œç‰ˆæœ¬å‡çº§ä¿®å¤ BUG æˆ–è€…å®‰å…¨æ¼æ´ã€‚ä½†æ˜¯å¦‚æœè¿™ä¸ªæ—¶å€™å¼ºè¡Œè¿›è¡Œ Primary çš„é‡å¯ï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°æœªåŒæ­¥è‡³ Secondary çš„æ•°æ®ä¸¢å¤±çš„æƒ…å†µï¼ˆè¡€æ³ªæ•™è®­ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œé‡å¯é›†ç¾¤çš„æ–¹å¼æ˜¯ï¼Œä¼˜å…ˆè¿›è¡Œ Secondary çš„æ›´æ–°æ“ä½œï¼Œåœ¨ Secondary æ›´æ–°å®Œæˆåï¼Œå¯¹ Primary è¿›è¡Œ stepDown æ“ä½œï¼Œç­‰å¾…ä¸»èŠ‚ç‚¹é™çº§æˆä¸º Secondary èŠ‚ç‚¹ï¼Œä¹‹åè¿›è¡Œæ“ä½œã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚ä½†æ˜¯å¦‚æœä¸»ä»æ•°æ®å·®å¼‚è¾ƒå¤§æ—¶ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆé™çº§å¤±è´¥ï¼Œæ­¤æ—¶å¯ä»¥é‡å¤æ‰§è¡Œ stepDown ç›´è‡³æˆåŠŸã€‚è¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå³ä¾¿ Secondary å¯ä»¥åœæœºç»´æŠ¤ï¼Œä½†æ˜¯ä»æ—§æœ‰å¯èƒ½ä¸¢æ•°æ®ï¼Œè¿™ä¸ªä¸ oplog å¤§å°æœ‰å…³ï¼Œæˆ‘ä»¬æ”¾åœ¨åé¢è¯´ã€‚\næ…¢æŸ¥è¯¢é—®é¢˜ æ…¢æŸ¥è¯¢çš„è®°å½•å¯ä»¥é€šè¿‡ Profiling è¿›è¡Œè®°å½•ï¼Œè¿™éƒ¨åˆ†èµ„æ–™æ¯”è¾ƒå¤šï¼Œå¯ä»¥é€šè¿‡ db.setProfilingLevel() è¿›è¡Œç®¡ç†ã€‚åŒæ—¶ï¼Œä¸»åŠ¨åˆ†æä¹Ÿå¯ä»¥é€šè¿‡ explain è¿›è¡Œé¢„åˆ†æã€‚è¿™ä¸€éƒ¨åˆ†èµ„æ–™æ¯”è¾ƒå¤šï¼Œæˆ‘è¿™é‡Œå°±ä¸å†å•°å—¦äº†ã€‚ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œéƒ¨åˆ†æ…¢æŸ¥è¯¢æ“ä½œä¸ä¼šéšç€å®¢æˆ·ç«¯æ–­å¼€ä¸­æ–­æ‰§è¡Œï¼Œéœ€è¦é€šè¿‡ db.currentOp() å’Œ db.killOp() åŠŸèƒ½å¹²æ‰é•¿æ—¶é—´æ‰§è¡Œã€æµªè´¹èµ„æºçš„æ“ä½œã€‚\nä¸»ä»åŒæ­¥å»¶è¿Ÿé—®é¢˜ ä¸»ä»åŒæ­¥é—®é¢˜æ˜¯æ¯”è¾ƒå¸¸è§çš„å»¶è¿Ÿé—®é¢˜äº†ï¼Œä¸»è¦é—®é¢˜éƒ½æ˜¯å‡ºåœ¨ oplog ä¸Šã€‚æ¯•ç«Ÿä¸»ä»åŒæ­¥æœºåˆ¶éƒ½æ˜¯é€šè¿‡æ­¤å®ç°çš„ã€‚oplog æ˜¯å›ºå®šå¤§å°çš„é›†åˆï¼Œå¦‚æœæ»¡äº†ï¼Œå°±ä¼šè‡ªåŠ¨åˆ é™¤è€çš„æ•°æ®ã€‚\nè¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæ­¤å¤„æŸ¥è¯¢ oplog æ“ä½œè®°å½•åˆ°ä»åº“åŒæ­¥ï¼Œå·²ç»æ‰§è¡Œäº† 194 æ¯«ç§’ã€‚\nä¸Šé¢æˆ‘ä»¬æåˆ°ï¼Œå½“ Secondary åœæœºç»´æŠ¤æ—¶ä¹Ÿå¯èƒ½å‡ºç°é—®é¢˜ï¼Œå°±æ˜¯å› ä¸ºï¼Œå½“ oplog ä¸è¶³æ—¶ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½ä¼šå¯¼è‡´æ•°æ®åŒæ­¥å¤±è´¥ã€‚å› æ­¤ä¸€èˆ¬æ•°æ®åº“åœæœºç»´æŠ¤æ“ä½œï¼Œä¹Ÿåº”è¯¥æ”¾åœ¨ä¸šåŠ¡é‡å°çš„æ—¶å€™è¿›è¡Œã€‚ä¸è¿‡ oplog æ˜¯å¯ä»¥è°ƒæ•´çš„ï¼Œå¯ä»¥å‚è€ƒ å®˜æ–¹æ–‡æ¡£ è¿›è¡Œè°ƒæ•´ã€‚æ³¨æ„ï¼Œè¿™éœ€è¦é‡å¯æ•°æ®åº“æ¥æ‰§è¡Œã€‚\nä¸»ä»åŒæ­¥å»¶è¿Ÿä¸€èˆ¬å‡ºç°çš„æƒ…å†µéƒ½æ˜¯æ•°æ®å‡ºç°å¤§é‡æ’å…¥å’Œä¿®æ”¹çš„æƒ…å†µã€‚åœ¨ Secondary è¿›è¡Œ oplog é‡æ”¾æ—¶ï¼Œå¼€é”€ä¼šå¤§äº Primary è¿›è¡Œæ“ä½œçš„å¼€é”€ã€‚è¿™ç§æƒ…å†µä¼šäº§ç”Ÿå¤§é‡çš„ oplogï¼ˆæ¯æ¡ä¿®æ”¹è®°å½•ä¸€æ¡ï¼Œéæ“ä½œï¼‰ï¼Œè®°å½•è¶Šå¤šï¼ŒåŒæ­¥é€Ÿåº¦è¶Šæ…¢ã€‚åŒæ—¶ï¼ŒæŸäº›æ“ä½œä¹Ÿä¼šå¤§å¹…åº¦æé«˜å•æ¡è®°å½•çš„åŒæ­¥æˆæœ¬ï¼Œæ¯”å¦‚ $incã€$push ç­‰ç­‰ä¼šè®©åŒæ­¥æ›´æ…¢ã€‚å¦‚æœä½ å¯¹æ•°æ®åº“ä¸­è¾ƒå¤§é‡æ•°æ®è¿›è¡Œ $set æ“ä½œï¼ŒåŒæ ·ä¹Ÿä¼šé€ æˆæ•°æ®å»¶è¿Ÿã€‚æˆ‘ä»¬çš„ä¸€ä½å·¥ç¨‹å¸ˆå°±å› ä¸ºè¿™æ ·æ›¾ç»é€ æˆäº†åˆ†é’Ÿçº§åˆ«çš„å»¶è¿Ÿï¼Œæ•™è®­ä¹Ÿæ˜¯éå¸¸æƒ¨ç—›çš„ã€‚è¿™ç§æ“ä½œæ¯”è¾ƒé¢‘ç¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´ replWriterThreadCount å‚æ•°è¿›è¡Œ Secondary é‡æ”¾çº¿ç¨‹æ•°é‡è°ƒæ•´ã€‚åœ¨ MongoDB ä¸­é»˜è®¤ä¸º 16ï¼Œè¿™ä¸ªå¯ä»¥æ ¹æ®æƒ…å†µè¿›è¡Œå…·ä½“è°ƒæ•´ã€‚ä¸è¿‡è¯¥å‚æ•°ä¸º MongoDB å¯åŠ¨å‚æ•°ï¼Œè°ƒæ•´è¯¥å‚æ•°ä¼šè¦æ±‚é‡å¯ MongoDBã€‚å¦å¤–ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ˜¯è¿™ç§æ“ä½œä¼šåŠ å¤§å†…å­˜å¼€é”€ï¼Œå¦‚æœå†…å­˜ç´§å¼ æ—¶ä¹Ÿéœ€è¦æ³¨æ„ã€‚\n","date":"2017-07-31T18:45:00Z","permalink":"https://www.4async.com/2017/07/2017-07-31-mongodb-optimizing/","title":"ä¸€äº› MongoDB çš„å‘"},{"content":"æˆ‘ä»¬åœ¨è¿›è¡ŒæœåŠ¡é—´è°ƒç”¨æ—¶å¹¿æ³›é‡‡ç”¨ gRPC ä½œä¸ºä¸»è¦çš„è°ƒç”¨åè®®ï¼Œå€ŸåŠ© gRPC çš„æ¨¡å—åŒ–ä¸è¯­è¨€æ— å…³çš„ç‰¹æ€§ï¼Œå¯ä»¥åœ¨æˆ‘ä»¬æ‹“å±•å¤šè¯­è¨€æ¨¡å—ä¹‹é—´æä¾›æ›´å¥½çš„æ”¯æŒã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨ gRPC ä¹‹ä¸­ä¹Ÿå‡ºç°äº†ä¸€äº›é—®é¢˜ï¼Œè¿™äº›é—®é¢˜ä¼šåšä¸€äº›è®°å½•ï¼Œå¸Œæœ›å¯ä»¥ä¸å¤§å®¶ä¸€èµ·æ²Ÿé€šä¸äº¤æµã€‚\næŸæ—¥ï¼Œæˆ‘ä»¬çš„å®¢æœåé¦ˆï¼Œæˆ‘ä»¬çš„åŸºç¡€è®¾æ–½æ“ä½œå·¥å…·å‡ºç°äº†é•¿æ—¶é—´æ— å“åº”çš„é—®é¢˜ã€‚è¯¥é—®é¢˜å‡ºç°åœ¨æˆ‘ä»¬å¯¹æŸäº›è®¾å¤‡è¿›è¡Œ OTA å‡çº§æ—¶ï¼Œæ“ä½œé•¿æ—¶é—´æ— è¿”å›ï¼Œä¸ä¹‹å‰é¢„æœŸçš„ 10 ç§’å†…è¿”å›å­˜åœ¨è¾ƒå¤§å‡ºå…¥ã€‚ç»è¿‡æˆ‘ä»¬çš„å·¥ç¨‹å¸ˆåˆ†æï¼Œæˆ‘ä»¬å‘ç°åœ¨ gRPC å¤„ç†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„æ“ä½œå·¥å…·é€šè¿‡ gRPC è°ƒç”¨è¿œç¨‹æœåŠ¡ç«¯æ¥å£æ—¶ï¼Œæ¥å£é•¿æ—¶é—´æ²¡æœ‰è¿”å›ç»“æœã€‚\næˆ‘ä»¬é¦–å…ˆæ€€ç–‘æ˜¯ gRPC è°ƒç”¨è¿‡ç¨‹ä¸­å‡ºç°äº†è¿æ¥é—®é¢˜ã€‚gRPC è¿‡ç¨‹ä¸­å¯èƒ½ç”±äºå¤šç§åŸå› å¯¼è‡´è¿æ¥æ–­å¼€æˆ–è€…æœåŠ¡å™¨æ— æ³•è¿æ¥ã€‚åœ¨è°ƒç”¨ gRPC æ–¹æ³•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ FailFast(true) æ–¹å¼è¿›è¡Œå¿«é€Ÿå¤±è´¥ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªå€¼é»˜è®¤æƒ…å†µä¸‹ä¸º trueã€‚\né‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦ä»è°ƒç”¨ä»ä½¿ç”¨è§’åº¦ä¸Šå¯»æ‰¾é—®é¢˜ã€‚æˆ‘ä»¬ä½¿ç”¨è¿‡ç¨‹ä¸­é»˜è®¸æœåŠ¡ç«¯åœ¨å¤„ç†æŸäº›æ“ä½œæ—¶è¿›è¡Œè¾ƒé•¿æ—¶é—´æ“ä½œï¼ˆå¦‚é•¿æ—¶é—´æ“ä½œï¼‰ï¼Œä½†æ˜¯ä»å®¢æˆ·ç«¯è§’åº¦è€Œè¨€ï¼Œéƒ¨åˆ†æ“ä½œæ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯å¸Œæœ›å¯ä»¥åœ¨æœ‰é¢„å®šç‰¹å®šç¯å¢ƒä¸‹è¾¾åˆ°æŸäº›æ—¶é—´ä»æ—§æœªè¿”å›ç»“æœå¯ä»¥æ ‡è®°ä¸ºç»“æœå¤±è´¥ã€‚è¿™æ ·å°±éœ€è¦é€šè¿‡ gRPC çš„æœºåˆ¶è¿›è¡Œè°ƒæ§ã€‚ç”±äºç›®å‰æˆ‘ä»¬çš„æ¥å£å¾ˆå¤šæƒ…å†µä¸‹è°ƒç”¨æ¥å£å®é™…ä¸ºç¡¬ä»¶æ¥å£ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬é‡‡ç”¨é€šè¿‡æ§åˆ¶ gRPC å®¢æˆ·ç«¯æ¥å£è¶…æ—¶çš„æ–¹æ³•æ§åˆ¶ã€‚\nåœ¨ gRPC ä¸­ï¼Œæä¾›äº† MethodConfig ç”¨äºæ§åˆ¶æ¯ä¸ªæ–¹æ³•çš„è¶…æ—¶æ—¶é—´ï¼Œè¿™æ ·å¯ä»¥å¯¹ä¸åŒçš„ RPC æ–¹æ³•è®¾ç½®è¶…æ—¶ã€‚\nä¸‹é¢ï¼Œæˆ‘ä»¬ç”¨ å®˜æ–¹çš„ gRPC ç¤ºä¾‹ æ¼”ç¤ºå¦‚ä½•è¿›è¡Œè°ƒç”¨è¶…æ—¶æ§åˆ¶ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ examples/helloworld/greeter_server/main.go ä¸­çš„ SayHello ä¸­æ·»åŠ ä¸€ä¸ªé•¿æ—¶é—´æ“ä½œæ¨¡æ‹Ÿï¼štime.Sleep(10*time.Second)ã€‚\nè¿™æ—¶ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å®¢æˆ·ç«¯åœ¨ 5 ç§’ä»¥å†…è¿”å›ç»“æœï¼Œåº”è¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿ\né‚£ä¹ˆæˆ‘ä»¬ä¿®æ”¹ examples/helloworld/greeter_client/main.go ä¸­çš„ mainï¼Œæ·»åŠ è¶…æ—¶å¤„ç†å†…å®¹ï¼š\nfunc main() { // Set up method timeout configure. \tvar wg sync.WaitGroup wg.Add(1) ch := make(chan grpc.ServiceConfig) go func() {defer wg.Done() mc := grpc.MethodConfig{ WaitForReady: true, Timeout: 5 * time.Second, } m := make(map[string]grpc.MethodConfig) // æ ¼å¼ï¼š/PackageName/ServiceName/MethodName \tm[\u0026#34;/helloworld.Greeter/SayHello\u0026#34;] = mc sc := grpc.ServiceConfig{Methods: m,} ch \u0026lt;- sc}() // Set up a connection to the server. \tconn, err := grpc.Dial(address, grpc.WithInsecure()) if err != nil {log.Fatalf(\u0026#34;did not connect: %v\u0026#34;, err) } defer conn.Close() c := pb.NewGreeterClient(conn) // Contact the server and print out its response. \tname := defaultName if len(os.Args) \u0026gt; 1 {name = os.Args[1] } log.Printf(\u0026#34;Starting...\\n\u0026#34;) // æ˜ç¡®æ‰§è¡Œæ—¶é—´ \tr, err := c.SayHello(context.Background(), \u0026amp;pb.HelloRequest{Name: name}) if err != nil {log.Fatalf(\u0026#34;could not greet: %v\u0026#34;, err) } log.Printf(\u0026#34;Greeting: %s\u0026#34;, r.Message) } å…¶ä¸­æ ¹æ® MethodConfig å¯¹åº” map ç»“æ„ï¼Œå¯ä»¥æ‰¾åˆ°å¯¹åº”æ–¹æ³•ï¼Œå¯¹æŒ‡å®šæ–¹æ³•è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚æœ€åï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š\n2017/05/19 15:59:11 Starting call... 2017/05/19 15:59:17 could not greet: rpc error: code = DeadlineExceeded desc = context deadline exceeded ","date":"2017-04-06T18:00:00Z","permalink":"https://www.4async.com/2017/04/2017-05-19-grpc-call-timeout/","title":"gRPC è°ƒç”¨è¶…æ—¶æ§åˆ¶"},{"content":"è¿™æ˜¯ä¸€ç¯‡éå¸¸ä¸é”™çš„ pandas åˆ†æå…¥é—¨æ–‡ç« ï¼Œåœ¨æ­¤ç®€å•ç¿»è¯‘æ‘˜å½•å¦‚ä¸‹ã€‚\n æœ¬å‘¨ï¼Œè¥¿é›…å›¾çš„è‡ªè¡Œè½¦å…±äº«ç³»ç»Ÿ Pronto CycleShare ä¸€å‘¨å²äº†ã€‚ ä¸ºäº†åº†ç¥è¿™ä¸€ç‚¹ï¼ŒPronto æä¾›äº†ä»ç¬¬ä¸€å¹´çš„æ•°æ®ç¼“å­˜ï¼Œå¹¶å®£å¸ƒäº† Pronto Cycle Share çš„æ•°æ®åˆ†ææŒ‘æˆ˜ã€‚\nä½ å¯ä»¥ç”¨å¾ˆå¤šå·¥å…·åˆ†æè¿™äº›æ•°æ®ï¼Œä½†æˆ‘çš„é€‰æ‹©å·¥å…·æ˜¯ Pythonã€‚ åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³å±•ç¤ºå¦‚ä½•å¼€å§‹åˆ†æè¿™äº›æ•°æ®ï¼Œå¹¶ä½¿ç”¨ PyData æŠ€æœ¯æ ˆï¼Œå³ NumPyï¼ŒPandasï¼ŒMatplotlib å’Œ Seaborn ä¸å…¶ä»–å¯ç”¨çš„æ•°æ®æºã€‚\nè¿™ç¯‡æ–‡ç« ä»¥ Jupyter Notebook å½¢å¼ç»„ç»‡ï¼Œå®ƒæ˜¯ä¸€ç§å¼€æ”¾çš„æ–‡æ¡£æ ¼å¼ã€‚ç»“åˆäº†æ–‡æœ¬ã€ä»£ç ã€æ•°æ®å’Œå›¾å½¢ï¼Œå¹¶ä¸”é€šè¿‡ Web æµè§ˆå™¨æŸ¥çœ‹ã€‚æœ¬æ–‡ä¸­çš„å†…å®¹å¯ä»¥ä¸‹è½½ å¯¹åº”çš„ Notebook æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ Jupyter æ‰“å¼€ã€‚\nä¸‹è½½ Pronto çš„æ•°æ® æˆ‘ä»¬å¯ä»¥ä» Pronto å®˜ç½‘ ä¸‹è½½å¯¹åº”çš„ æ•°æ®æ–‡ä»¶ã€‚æ€»ä¸‹è½½å¤§çº¦ 70MBï¼Œè§£å‹ç¼©çš„æ–‡ä»¶å¤§çº¦ 900MBã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å¯¼å…¥ä¸€äº› Python åŒ…ï¼š\nIn [2]:\n%matplotlib inline import matplotlib.pyplot as plt import pandas as pd import numpy as np import seaborn as sns; sns.set() ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ Pandas åŠ è½½æ‰€æœ‰çš„è¡Œç¨‹è®°å½•ï¼š\nIn [3]:\ntrips = pd.read_csv(\u0026#39;2015_trip_data.csv\u0026#39;, parse_dates=[\u0026#39;starttime\u0026#39;, \u0026#39;stoptime\u0026#39;], infer_datetime_format=True) trips.head() Out[3]:\nè¿™ä¸ªè¡Œç¨‹æ•°æ®é›†çš„æ¯ä¸€è¡Œæ˜¯ç”±ä¸€ä¸ªäººå•ç‹¬éª‘è¡Œï¼Œå…±åŒ…å«è¶…è¿‡ 140,000 æ¡æ•°æ®ã€‚\næ¢ç´¢æ—¶é—´ä¸è¡Œç¨‹çš„å…³ç³» è®©æˆ‘ä»¬å…ˆçœ‹çœ‹ä¸€å¹´ä¸­æ¯æ—¥è¡Œç¨‹æ¬¡æ•°çš„è¶‹åŠ¿ã€‚\nIn [4]:\n# Find the start date ind = pd.DatetimeIndex(trips.starttime) trips[\u0026#39;date\u0026#39;] = ind.date.astype(\u0026#39;datetime64\u0026#39;) trips[\u0026#39;hour\u0026#39;] = ind.hour In [5]:\n# Count trips by date by_date = trips.pivot_table(\u0026#39;trip_id\u0026#39;, aggfunc=\u0026#39;count\u0026#39;, index=\u0026#39;date\u0026#39;, columns=\u0026#39;usertype\u0026#39;, ) In [6]:\nfig, ax = plt.subplots(2, figsize=(16, 8)) fig.subplots_adjust(hspace=0.4) by_date.iloc[:, 0].plot(ax=ax[0], title=\u0026#39;Annual Members\u0026#39;); by_date.iloc[:, 1].plot(ax=ax[1], title=\u0026#39;Day-Pass Users\u0026#39;); æ­¤å›¾æ˜¾ç¤ºæ¯æ—¥è¶‹åŠ¿ï¼Œä»¥å¹´è´¹ç”¨æˆ·ï¼ˆä¸Šå›¾ï¼‰å’Œä¸´æ—¶ç”¨æˆ·ï¼ˆä¸‹å›¾ï¼‰åˆ†éš”ã€‚ æ ¹æ®å›¾æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å‡ ä¸ªç»“è®ºï¼š\n 4 æœˆä»½çŸ­æœŸä½¿ç”¨çš„ä¸´æ—¶ç”¨æˆ·å¤§å¹…å¢åŠ å¯èƒ½æ˜¯ç”±äº ç¾å›½è§„åˆ’åä¼šå…¨å›½ä¼šè®® åœ¨è¥¿é›…å›¾å¸‚ä¸­å¿ƒä¸¾è¡Œã€‚ å…¶ä»–ä¸€ä¸ªæ¯”è¾ƒæ¥è¿‘çš„æ—¶é—´æ˜¯ 7 æœˆ 4 æ—¥å‘¨æœ«ã€‚ ä¸´æ—¶ç”¨æˆ·å‘ˆç°äº†ä¸€ä¸ªä¸å­£èŠ‚ç›¸å…³è”çš„ç¨³å®šçš„è¡°é€€è¶‹åŠ¿; å¹´è´¹ç”¨æˆ·çš„ä½¿ç”¨æ²¡æœ‰éšç€ç§‹å¤©çš„æ¥ä¸´è€Œæ˜¾ç€å‡å°‘ã€‚ å¹´è´¹ç”¨æˆ·å’Œä¸´æ—¶ç”¨æˆ·ä¼¼ä¹éƒ½æ˜¾ç¤ºå‡ºæ˜æ˜¾çš„æ¯å‘¨è¶‹åŠ¿ã€‚  ç°åœ¨æ”¾å¤§æ¯å‘¨è¶‹åŠ¿ï¼Œçœ‹ä¸€ä¸‹æ‰€æœ‰çš„éª‘ä¹˜éƒ½æ˜¯æŒ‰ç…§æ˜ŸæœŸå‡ åˆ†éƒ¨çš„ã€‚ç”±äº 2015 å¹´ 1 æœˆä»½å·¦å³æ¨¡å¼çš„å˜åŒ–ï¼Œæˆ‘ä»¬æŒ‰ç…§å¹´ä»½å’Œæ˜ŸæœŸå‡ è¿›è¡Œæ‹†åˆ†ï¼š\nIn [7]:\nby_weekday = by_date.groupby([by_date.index.year, by_date.index.dayofweek]).mean() by_weekday.columns.name = None # remove label for plot fig, ax = plt.subplots(1, 2, figsize=(16, 6), sharey=True) by_weekday.loc[2014].plot(title=\u0026#39;Average Use by Day of Week (2014)\u0026#39;, ax=ax[0]); by_weekday.loc[2015].plot(title=\u0026#39;Average Use by Day of Week (2015)\u0026#39;, ax=ax[1]); for axi in ax: axi.set_xticklabels([\u0026#39;Mon\u0026#39;, \u0026#39;Tues\u0026#39;, \u0026#39;Wed\u0026#39;, \u0026#39;Thurs\u0026#39;, \u0026#39;Fri\u0026#39;, \u0026#39;Sat\u0026#39;, \u0026#39;Sun\u0026#39;]) æˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªäº’è¡¥çš„æ¨¡å¼ï¼šå¹´è´¹ç”¨æˆ·å€¾å‘äºå·¥ä½œæ—¥ä½¿ç”¨ä»–ä»¬çš„è‡ªè¡Œè½¦ï¼ˆå³ä½œä¸ºé€šå‹¤çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œè€Œä¸´æ—¶ç”¨æˆ·å€¾å‘äºåœ¨å‘¨æœ«ä½¿ç”¨ä»–ä»¬çš„è‡ªè¡Œè½¦ã€‚è¿™ç§æ¨¡å¼ç”šè‡³åœ¨ 2015 å¹´å¹´åˆéƒ½æ²¡æœ‰ç‰¹åˆ«çš„ä½“ç°å‡ºæ¥ï¼Œå°¤å…¶æ˜¯å¹´è´¹ç”¨æˆ·ï¼šä¼¼ä¹åœ¨å¤´å‡ ä¸ªæœˆï¼Œç”¨æˆ·è¿˜æ²¡æœ‰ä½¿ç”¨ Pronto çš„é€šå‹¤ä¹ æƒ¯ã€‚\næŸ¥çœ‹å¹³æ—¥å’Œå‘¨æœ«çš„å¹³å‡æ¯å°æ—¶éª‘è¡Œä¹Ÿå¾ˆæœ‰è¶£ã€‚è¿™éœ€è¦ä¸€äº›æ“ä½œï¼š\nIn [8]:\n# count trips by date and by hour by_hour = trips.pivot_table(\u0026#39;trip_id\u0026#39;, aggfunc=\u0026#39;count\u0026#39;, index=[\u0026#39;date\u0026#39;, \u0026#39;hour\u0026#39;], columns=\u0026#39;usertype\u0026#39;).fillna(0).reset_index(\u0026#39;hour\u0026#39;) # average these counts by weekend by_hour[\u0026#39;weekend\u0026#39;] = (by_hour.index.dayofweek\u0026gt;= 5) by_hour = by_hour.groupby([\u0026#39;weekend\u0026#39;, \u0026#39;hour\u0026#39;]).mean() by_hour.index.set_levels([[\u0026#39;weekday\u0026#39;, \u0026#39;weekend\u0026#39;], [\u0026#34;{0}:00\u0026#34;.format(i) for i in range(24)]], inplace=True); by_hour.columns.name = None ç°åœ¨æˆ‘ä»¬å¯ä»¥ç»˜åˆ¶ç»“æœæ¥æŸ¥çœ‹æ¯å°æ—¶çš„è¶‹åŠ¿ï¼š\nIn [9]:\nfig, ax = plt.subplots(1, 2, figsize=(16, 6), sharey=True) by_hour.loc[\u0026#39;weekday\u0026#39;].plot(title=\u0026#39;Average Hourly Use (Mon-Fri)\u0026#39;, ax=ax[0]) by_hour.loc[\u0026#39;weekend\u0026#39;].plot(title=\u0026#39;Average Hourly Use (Sat-Sun)\u0026#39;, ax=ax[1]) ax[0].set_ylabel(\u0026#39;Average Trips per Hour\u0026#39;); æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ª â€œé€šå‹¤â€ æ¨¡å¼å’Œä¸€ä¸ª â€œå¨±ä¹â€ æ¨¡å¼ä¹‹é—´çš„æ˜æ˜¾åŒºåˆ«:â€œé€šå‹¤â€ æ¨¡å¼åœ¨æ—©ä¸Šå’Œæ™šä¸Šæ€¥å‰§ä¸Šå‡ï¼Œè€Œ â€œå¨±ä¹â€ æ¨¡å¼åœ¨ä¸‹åˆçš„æ—¶å€™æœ‰ä¸€ä¸ªå®½å³°ã€‚ æœ‰è¶£çš„æ˜¯ï¼Œå¹´è´¹ä¼šå‘˜åœ¨å‘¨æœ«çš„è¡Œä¸ºä¼¼ä¹ä¸ä¸´æ—¶ç”¨æˆ·åœ¨å‘¨æœ«çš„è¡Œä¸ºå‡ ä¹ç›¸åŒã€‚\næ—…è¡Œæ—¶é—´ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ—…è¡Œçš„æŒç»­æ—¶é—´ã€‚ Pronto å…è´¹éª‘è¡Œæœ€é•¿å¯è¾¾ 30 åˆ†é’Ÿ; ä»»ä½•é•¿äºæ­¤çš„å•æ¬¡ä½¿ç”¨ï¼Œåœ¨å‰åŠä¸ªå°æ—¶éƒ½ä¼šäº§ç”Ÿå‡ ç¾å…ƒçš„ä½¿ç”¨è´¹ï¼Œæ­¤åæ¯å°æ—¶å¤§çº¦éœ€è¦åç¾å…ƒã€‚\nè®©æˆ‘ä»¬çœ‹çœ‹å¹´è´¹ä¼šå‘˜å’Œä¸´æ—¶ä½¿ç”¨è€…çš„æ—…è¡ŒæŒç»­æ—¶é—´çš„åˆ†å¸ƒï¼š\nIn [10]:\ntrips[\u0026#39;minutes\u0026#39;] = trips.tripduration / 60 trips.groupby(\u0026#39;usertype\u0026#39;)[\u0026#39;minutes\u0026#39;].hist(bins=np.arange(61), alpha=0.5, normed=True); plt.xlabel(\u0026#39;Duration (minutes)\u0026#39;) plt.ylabel(\u0026#39;relative frequency\u0026#39;) plt.title(\u0026#39;Trip Durations\u0026#39;) plt.text(34, 0.09,\u0026#34;Free Trips\\n\\nAdditional Fee\u0026#34;, ha=\u0026#39;right\u0026#39;, size=18, rotation=90, alpha=0.5, color=\u0026#39;red\u0026#39;) plt.legend([\u0026#39;Annual Members\u0026#39;, \u0026#39;Short-term Pass\u0026#39;]) plt.axvline(30, linestyle=\u0026#39;--\u0026#39;, color=\u0026#39;red\u0026#39;, alpha=0.3); åœ¨è¿™é‡Œï¼Œæˆ‘æ·»åŠ äº†ä¸€ä¸ªçº¢è‰²çš„è™šçº¿ï¼Œåˆ†å¼€å…è´¹éª‘ä¹˜ï¼ˆå·¦ï¼‰å’Œä»˜è´¹éª‘ä¹˜ï¼ˆå³ï¼‰ã€‚çœ‹æ¥ï¼Œå¹´è´¹ç”¨æˆ·å¯¹ç³»ç»Ÿè§„åˆ™æ›´åŠ äº†è§£ï¼šåªæœ‰è¡Œç¨‹åˆ†å¸ƒçš„ä¸€å°éƒ¨åˆ†è¶…è¿‡ 30 åˆ†é’Ÿã€‚å¦ä¸€æ–¹é¢ï¼Œå¤§çº¦å››åˆ†ä¹‹ä¸€çš„ä¸´æ—¶ç”¨æˆ·æ—¶é—´è¶…è¿‡åŠå°æ—¶é™åˆ¶ï¼Œå¹¶æ”¶å–é¢å¤–è´¹ç”¨ã€‚ æˆ‘çš„é¢„æœŸæ˜¯ï¼Œè¿™äº›ä¸´æ—¶ç”¨æˆ·ä¸èƒ½å¾ˆå¥½ç†è§£è¿™ç§å®šä»·ç»“æ„ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå› ä¸ºä¸å¼€å¿ƒçš„ä½“éªŒä¸å†ä½¿ç”¨ã€‚\nä¼°è®¡è¡Œç¨‹è·ç¦» çœ‹çœ‹æ—…è¡Œçš„è·ç¦»ä¹Ÿååˆ†æœ‰è¶£ã€‚Pronto å‘å¸ƒçš„æ•°æ®ä¸­ä¸åŒ…æ‹¬è¡Œè½¦çš„è·ç¦»ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡å…¶ä»–æ¥æºæ¥ç¡®å®šã€‚è®©æˆ‘ä»¬ä»åŠ è½½è¡Œè½¦æ•°æ®å¼€å§‹ - å› ä¸ºä¸€äº›è¡Œç¨‹åœ¨ Pronto çš„æœåŠ¡ç‚¹ä¹‹é—´å¼€å§‹å’Œç»“æŸï¼Œæˆ‘ä»¬å°†å…¶æ·»åŠ ä¸ºä¸€ä¸ª â€œè½¦ç«™â€ï¼š\nIn [11]:\nstations = pd.read_csv(\u0026#39;2015_station_data.csv\u0026#39;) pronto_shop = dict(id=54, name=\u0026#34;Pronto shop\u0026#34;, terminal=\u0026#34;Pronto shop\u0026#34;, lat=47.6173156, long=-122.3414776, dockcount=100, online=\u0026#39;10/13/2014\u0026#39;) stations = stations.append(pronto_shop, ignore_index=True) ç°åœ¨æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸¤å¯¹çº¬åº¦ / ç»åº¦åæ ‡ä¹‹é—´çš„éª‘è½¦è·ç¦»ã€‚å¹¸è¿çš„æ˜¯ï¼ŒGoogle åœ°å›¾æœ‰ä¸€ä¸ªè·ç¦» APIï¼Œæˆ‘ä»¬å¯ä»¥å…è´¹ä½¿ç”¨ã€‚\nä»æ–‡æ¡£ä¸­çŸ¥é“ï¼Œæˆ‘ä»¬æ¯å¤©å…è´¹ä½¿ç”¨çš„é™åˆ¶ä¸ºæ¯å¤©æœ€å¤š 2500 ä¸ªè·ç¦»ï¼Œæ¯ 10 ç§’æœ€å¤š 100 ä¸ªè·ç¦»ã€‚ç°åœ¨æœ‰ 55 ä¸ªç«™ï¼Œæˆ‘ä»¬æœ‰ï¼ˆ55 * 54/2ï¼‰ = 1485 ä¸ªéé›¶è·ç¦»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å‡ å¤©å†…å…è´¹æŸ¥è¯¢æ‰€æœ‰è½¦ç«™ä¹‹é—´çš„è·ç¦»ã€‚\nä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¸€æ¬¡æŸ¥è¯¢ä¸€è¡Œï¼Œåœ¨æŸ¥è¯¢ä¹‹é—´ç­‰å¾… 10 + ç§’ï¼ˆæ³¨æ„ï¼šæˆ‘ä»¬å¯èƒ½è¿˜ä¼šä½¿ç”¨ googlemaps Python åŒ… ï¼Œä½†ä½¿ç”¨å®ƒéœ€è¦è·å– API å¯†é’¥ï¼‰ã€‚\nIn [12]:\nfrom time import sleep def query_distances(stations=stations): \u0026#34;\u0026#34;\u0026#34;Query the Google API for bicycling distances\u0026#34;\u0026#34;\u0026#34; latlon_list = [\u0026#39;{0},{1}\u0026#39;.format(lat, long) for (lat, long) in zip(stations.lat, stations.long)] def create_url(i): URL = (\u0026#39;https://maps.googleapis.com/maps/api/distancematrix/json?\u0026#39; \u0026#39;origins={origins}\u0026amp;destinations={destinations}\u0026amp;mode=bicycling\u0026#39;) return URL.format(origins=latlon_list[i], destinations=\u0026#39;|\u0026#39;.join(latlon_list[i + 1:])) for i in range(len(latlon_list) - 1): url = create_url(i) filename = \u0026#34;distances_{0}.json\u0026#34;.format(stations.terminal.iloc[i]) print(i, filename) !curl \u0026#34;{url}\u0026#34; -o {filename} sleep(11) # only one query per 10 seconds! def build_distance_matrix(stations=stations): \u0026#34;\u0026#34;\u0026#34;Build a matrix from the Google API results\u0026#34;\u0026#34;\u0026#34; dist = np.zeros((len(stations), len(stations)), dtype=float) for i, term in enumerate(stations.terminal[:-1]): filename = \u0026#39;queried_distances/distances_{0}.json\u0026#39;.format(term) row = json.load(open(filename)) dist[i, i + 1:] = [el[\u0026#39;distance\u0026#39;][\u0026#39;value\u0026#39;] for el in row[\u0026#39;rows\u0026#39;][0][\u0026#39;elements\u0026#39;]] dist += dist.T distances = pd.DataFrame(dist, index=stations.terminal, columns=stations.terminal) distances.to_csv(\u0026#39;station_distances.csv\u0026#39;) return distances # only call this the first time import os if not os.path.exists(\u0026#39;station_distances.csv\u0026#39;): # Note: you can call this function at most ~twice per day! query_distances() # Move all the queried files into a directory # so we don\u0026#39;t accidentally overwrite them if not os.path.exists(\u0026#39;queried_distances\u0026#39;): os.makedirs(\u0026#39;queried_distances\u0026#39;) !mv distances_*.json queried_distances # Build distance matrix and save to CSV distances = build_distance_matrix() è¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ª 5x5 è·ç¦»çŸ©é˜µï¼š\nIn [13]:\ndistances = pd.read_csv(\u0026#39;station_distances.csv\u0026#39;, index_col=\u0026#39;terminal\u0026#39;) distances.iloc[:5, :5] Out[13]:\nè®©æˆ‘ä»¬å°†è¿™äº›è·ç¦»è½¬æ¢ä¸ºè‹±é‡Œï¼Œå¹¶å°†å®ƒä»¬åŠ å…¥æˆ‘ä»¬çš„è¡Œç¨‹æ•°æ®ï¼š\nIn [14]:\nstacked = distances.stack() / 1609.34 # convert meters to miles stacked.name = \u0026#39;distance\u0026#39; trips = trips.join(stacked, on=[\u0026#39;from_station_id\u0026#39;,\u0026#39;to_station_id\u0026#39;]) ç°åœ¨æˆ‘ä»¬å¯ä»¥ç»˜åˆ¶è¡Œç¨‹è·ç¦»çš„åˆ†å¸ƒï¼š\nIn [15]:\nfig, ax = plt.subplots(figsize=(12, 4)) trips.groupby(\u0026#39;usertype\u0026#39;)[\u0026#39;distance\u0026#39;].hist(bins=np.linspace(0, 6.99, 50), alpha=0.5, ax=ax); plt.xlabel(\u0026#39;Distance between start \u0026amp; end (miles)\u0026#39;) plt.ylabel(\u0026#39;relative frequency\u0026#39;) plt.title(\u0026#39;Minimum Distance of Trip\u0026#39;) plt.legend([\u0026#39;Annual Members\u0026#39;, \u0026#39;Short-term Pass\u0026#39;]); è¯·è®°ä½ï¼Œè¿™æ˜¾ç¤ºç«™ç‚¹ä¹‹é—´çš„æœ€çŸ­å¯èƒ½è·ç¦»ï¼Œæ˜¯æ¯æ¬¡è¡Œç¨‹ä¸Šå®é™…è·ç¦»çš„ä¸‹é™ã€‚è®¸å¤šæ—…è¡Œï¼ˆç‰¹åˆ«æ˜¯ä¸´æ—¶ç”¨æˆ·ï¼‰åœ¨å‡ ä¸ªè¡—åŒºå†…å¼€å§‹å’Œç»“æŸã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ—…è¡Œé«˜å³°ä¸€èˆ¬åœ¨å¤§çº¦ 1 è‹±é‡Œå·¦å³ï¼Œä¹Ÿæœ‰ä¸€äº›ç”¨æˆ·å°†ä»–ä»¬çš„æ—…è¡Œè·ç¦»æ‰©å±•åˆ°å››è‹±é‡Œæˆ–æ›´é•¿çš„è·ç¦»ã€‚\néª‘æ‰‹é€Ÿåº¦ ç»™å®šè¿™äº›è·ç¦»ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¡ç®—ä¼°è®¡éª‘è¡Œé€Ÿåº¦çš„ä¸‹é™ã€‚ è®©æˆ‘ä»¬è¿™æ ·åšï¼Œç„¶åçœ‹çœ‹å¹´è´¹ç”¨æˆ·å’Œä¸´æ—¶ç”¨æˆ·çš„é€Ÿåº¦åˆ†å¸ƒï¼š\nIn [16]:\ntrips[\u0026#39;speed\u0026#39;] = trips.distance * 60 / trips.minutes trips.groupby(\u0026#39;usertype\u0026#39;)[\u0026#39;speed\u0026#39;].hist(bins=np.linspace(0, 15, 50), alpha=0.5, normed=True); plt.xlabel(\u0026#39;lower bound riding speed (MPH)\u0026#39;) plt.ylabel(\u0026#39;relative frequency\u0026#39;) plt.title(\u0026#39;Rider Speed Lower Bound (MPH)\u0026#39;) plt.legend([\u0026#39;Annual Members\u0026#39;, \u0026#39;Short-term Pass\u0026#39;]); æœ‰è¶£çš„æ˜¯ï¼Œåˆ†å¸ƒæ˜¯å®Œå…¨ä¸åŒçš„ï¼Œå¹´è´¹ç”¨æˆ·çš„é€Ÿåº¦å¹³å‡å€¼æ›´é«˜ä¸€äº›ã€‚ä½ å¯èƒ½ä¼šæƒ³åˆ°è¿™é‡Œçš„ç»“è®ºï¼Œå¹´è´¹ç”¨æˆ·çš„é€Ÿåº¦æ¯”ä¸´æ—¶ç”¨æˆ·æ›´é«˜ï¼Œä½†æ•°æ®æœ¬èº«ä¸è¶³ä»¥æ”¯æŒè¿™ä¸€ç»“è®ºã€‚å¦‚æœå¹´è´¹ç”¨æˆ·å€¾å‘äºé€šè¿‡æœ€ç›´æ¥çš„è·¯çº¿ä»ç‚¹ A å»å¾€ç‚¹ Bï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®ä¹Ÿå¯ä»¥è¢«è§£é‡Šï¼Œè€Œä¸´æ—¶ç”¨æˆ·å€¾å‘äºç»•è¡Œå¹¶é—´æ¥åˆ°è¾¾ä»–ä»¬çš„ç›®çš„åœ°ã€‚æˆ‘æ€€ç–‘ç°å®æ˜¯è¿™ä¸¤ç§æ•ˆåº”çš„æ··åˆã€‚\nè¿˜è¦çœ‹çœ‹è·ç¦»å’Œé€Ÿåº¦ä¹‹é—´çš„å…³ç³»ï¼š\nIn [17]:\ng = sns.FacetGrid(trips, col=\u0026#34;usertype\u0026#34;, hue=\u0026#39;usertype\u0026#39;, size=6) g.map(plt.scatter,\u0026#34;distance\u0026#34;,\u0026#34;speed\u0026#34;, s=4, alpha=0.2) # Add lines and labels x = np.linspace(0, 10) g.axes[0, 0].set_ylabel(\u0026#39;Lower Bound Speed\u0026#39;) for ax in g.axes.flat: ax.set_xlabel(\u0026#39;Lower Bound Distance\u0026#39;) ax.plot(x, 2 * x,\u0026#39;--r\u0026#39;, alpha=0.3) ax.text(9.8, 16.5,\u0026#34;Free Trips\\n\\nAdditional Fee\u0026#34;, ha=\u0026#39;right\u0026#39;, size=18, rotation=39, alpha=0.5, color=\u0026#39;red\u0026#39;) ax.axis([0, 10, 0, 25]) æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬çœ‹åˆ°è¾ƒé•¿çš„è·¯é€”é€Ÿåº¦æ›´å¿« - è™½ç„¶è¿™å—åˆ°ä¸ä¸Šè¿°ç›¸åŒçš„ä¸‹é™å½±å“ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œä½œä¸ºå‚è€ƒï¼Œæˆ‘ç»˜åˆ¶äº†éœ€è¦çš„çº¢çº¿ç”¨äºåŒºåˆ†é¢å¤–è´¹ç”¨ï¼ˆä½äºçº¢çº¿ï¼‰å’Œå…è´¹è´¹ç”¨ï¼ˆçº¢çº¿ä»¥ä¸Šï¼‰ã€‚æˆ‘ä»¬å†æ¬¡çœ‹åˆ°ï¼Œå¹´åº¦ä¼šå‘˜å¯¹äºä¸è¶…è¿‡åŠå°æ—¶çš„é™åˆ¶æ¯”æ¯å¤©é€šè¿‡ç”¨æˆ·æ›´åŠ ç²¾æ˜ - ç‚¹çš„åˆ†å¸ƒçš„æŒ‡å‘äº†ç”¨æˆ·æ³¨æ„äº†ä»–ä»¬ä½¿ç”¨çš„æ—¶é—´ï¼Œä»¥é¿å…é¢å¤–çš„è´¹ç”¨ã€‚\næµ·æ‹”é«˜åº¦ åœ¨è¥¿é›…å›¾è‡ªè¡Œè½¦åˆ†äº«æœåŠ¡çš„å¯è¡Œæ€§çš„ä¸€ä¸ªç„¦ç‚¹æ˜¯ï¼Œè¥¿é›…å›¾æ˜¯ä¸€ä¸ªä¸˜é™µåŸå¸‚ã€‚åœ¨æœåŠ¡å‘å¸ƒä¹‹å‰ï¼Œä¸€äº›åˆ†æå¸ˆé¢„æµ‹ï¼Œè¥¿é›…å›¾ä¼šæœ‰æºæºä¸æ–­çš„è‡ªè¡Œè½¦ä¸Šå¡ä¸‹å¡ï¼Œæ‰€ä»¥å¹¶ä¸é€‚åˆåˆ†äº«å•è½¦ç³»ç»Ÿçš„è½åœ°ã€‚\næ•°æ®ç‰ˆæœ¬ä¸­ä¸åŒ…å«æµ·æ‹”é«˜åº¦æ•°æ®ï¼Œä½†æˆ‘ä»¬å¯ä»¥è½¬åˆ° Google Maps API è·å–æˆ‘ä»¬éœ€è¦çš„æ•°æ®; è¯·å‚é˜… æ­¤ç½‘ç«™ äº†è§£æµ·æ‹” API çš„æè¿°ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‡ªç”±ä½¿ç”¨é™åˆ¶ä¸ºæ¯å¤© 2500 ä¸ªè¯·æ±‚ï¼Œæ¯æ¬¡è¯·æ±‚æœ€å¤šåŒ…å« 512 ä¸ªæµ·æ‹”é«˜åº¦ã€‚ ç”±äºæˆ‘ä»¬åªéœ€è¦ 55 ä¸ªæµ·æ‹”é«˜åº¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å•ä¸ªæŸ¥è¯¢ä¸­æ‰§è¡Œï¼š\nIn [18]:\ndef get_station_elevations(stations): \u0026#34;\u0026#34;\u0026#34;Get station elevations via Google Maps API\u0026#34;\u0026#34;\u0026#34; URL = \u0026#34;https://maps.googleapis.com/maps/api/elevation/json?locations=\u0026#34; locs = \u0026#39;|\u0026#39;.join([\u0026#39;{0},{1}\u0026#39;.format(lat, long) for (lat, long) in zip(stations.lat, stations.long)]) URL += locs !curl \u0026#34;{URL}\u0026#34; -o elevations.json def process_station_elevations():\u0026#34;\u0026#34;\u0026#34;Convert Elevations JSON output to CSV\u0026#34;\u0026#34;\u0026#34; import json D = json.load(open(\u0026#39;elevations.json\u0026#39;)) def unnest(D): loc = D.pop(\u0026#39;location\u0026#39;) loc.update(D) return loc elevs = pd.DataFrame([unnest(item) for item in D[\u0026#39;results\u0026#39;]]) elevs.to_csv(\u0026#39;station_elevations.csv\u0026#39;) return elevs # only run this the first time: import os if not os.path.exists(\u0026#39;station_elevations.csv\u0026#39;): get_station_elevations(stations) process_station_elevations() ç°åœ¨è®©æˆ‘ä»¬è¯»å…¥æµ·æ‹”é«˜åº¦æ•°æ®ï¼š\nIn [19]:\nelevs = pd.read_csv(\u0026#39;station_elevations.csv\u0026#39;, index_col=0) elevs.head() Out[19]:\nä¸ºäº†éªŒè¯ç»“æœï¼Œæˆ‘ä»¬éœ€è¦ä»”ç»†æ£€æŸ¥çº¬åº¦å’Œç»åº¦æ˜¯å¦åŒ¹é…ï¼š\nIn [20]:\n# double check that locations match print(np.allclose(stations.long, elevs.lng)) print(np.allclose(stations.lat, elevs.lat)) True True ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†æµ·æ‹”æ•°æ®ä¸è¡Œç¨‹æ•°æ®æ•´åˆï¼š\nIn [21]:\nstations[\u0026#39;elevation\u0026#39;] = elevs[\u0026#39;elevation\u0026#39;] elevs.index = stations[\u0026#39;terminal\u0026#39;] trips[\u0026#39;elevation_start\u0026#39;] = trips.join(elevs, on=\u0026#39;from_station_id\u0026#39;)[\u0026#39;elevation\u0026#39;] trips[\u0026#39;elevation_end\u0026#39;] = trips.join(elevs, on=\u0026#39;to_station_id\u0026#39;)[\u0026#39;elevation\u0026#39;] trips[\u0026#39;elevation_gain\u0026#39;] = trips[\u0026#39;elevation_end\u0026#39;] - trips[\u0026#39;elevation_start\u0026#39;] è®©æˆ‘ä»¬æ¥çœ‹çœ‹æµ·æ‹”æ•°æ®å’Œä¼šå‘˜ç±»å‹çš„åˆ†å¸ƒå…³ç³»ï¼š\nIn [22]:\ng = sns.FacetGrid(trips, col=\u0026#34;usertype\u0026#34;, hue=\u0026#39;usertype\u0026#39;) g.map(plt.hist,\u0026#34;elevation_gain\u0026#34;, bins=np.arange(-145, 150, 10)) g.fig.set_figheight(6) g.fig.set_figwidth(16); # plot some lines to guide the eye for lim in range(60, 150, 20): x = np.linspace(-lim, lim, 3) for ax in g.axes.flat: ax.fill(x, 100 * (lim - abs(x)), color=\u0026#39;gray\u0026#39;, alpha=0.1, zorder=0) æˆ‘ä»¬åœ¨èƒŒæ™¯ä¸­ç»˜åˆ¶äº†ä¸€äº›é˜´å½±ä»¥å¸®åŠ©å¼•å¯¼åˆ†æã€‚ å¹´åº¦ä¼šå‘˜å’Œä¸´æ—¶ç”¨æˆ·ä¹‹é—´æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼šå¹´è´¹ç”¨æˆ·éå¸¸æ˜æ˜¾çš„è¡¨ç¤ºå‡ºåå¥½ä¸‹å¡è¡Œç¨‹ï¼ˆå·¦ä¾§çš„åˆ†å¸ƒï¼‰ï¼Œè€Œä¸´æ—¶ç”¨æˆ·è¡¨ç°å¹¶ä¸æ˜æ˜¾ï¼Œè€Œæ˜¯è¡¨ç¤ºå–œæ¬¢éª‘ä¹˜å¼€å§‹å¹¶åœ¨ç›¸åŒé«˜åº¦ç»“æŸã€‚\nä¸ºäº†ä½¿æµ·æ‹”æ•°æ®å˜åŒ–çš„å½±å“æ›´åŠ æ˜æ˜¾ï¼Œæˆ‘ä»¬åšä¸€äº›è®¡ç®—ï¼š\nIn [23]:\nprint(\u0026#34;total downhill trips:\u0026#34;, (trips.elevation_gain \u0026lt; 0).sum()) print(\u0026#34;total uphill trips:\u0026#34;, (trips.elevation_gain\u0026gt; 0).sum()) total downhill trips: 80532 total uphill trips: 50493 æˆ‘ä»¬çœ‹åˆ°ï¼Œç¬¬ä¸€å¹´ä¸‹å¡æ¯”ä¸Šå¡å¤šå‡ºäº† 3 ä¸‡æ¬¡ - è¿™æ˜¯å¤§çº¦ 60ï¼… ä»¥ä¸Šã€‚ æ ¹æ®ç›®å‰çš„ä½¿ç”¨æ°´å¹³ï¼Œè¿™æ„å‘³ç€ Pronto å·¥ä½œäººå‘˜å¿…é¡»æ¯å¤©ä»æµ·æ‹”è¾ƒä½çš„æœåŠ¡ç‚¹è¿é€å¤§çº¦ 100 è¾†è‡ªè¡Œè½¦åˆ°é«˜æµ·æ‹”æœåŠ¡ç‚¹ã€‚\nå¤©æ°” å¦ä¸€ä¸ªå¸¸è§çš„åå¯¹å¾ªç¯å…±äº«çš„å¯è¡Œæ€§çš„è®ºç‚¹æ˜¯å¤©æ°”ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å‡ºè¡Œæ•°é‡éšç€æ¸©åº¦å’Œé™æ°´é‡çš„å˜åŒ–ã€‚\nå¹¸è¿çš„æ˜¯ï¼Œæ•°æ®åŒ…æ‹¬äº†å¤§èŒƒå›´çš„å¤©æ°”æ•°æ®ï¼š\nIn [24]:\nweather = pd.read_csv(\u0026#39;2015_weather_data.csv\u0026#39;, index_col=\u0026#39;Date\u0026#39;, parse_dates=True) weather.columns Out[24]:\nIndex([\u0026#39;Max_Temperature_F\u0026#39;, \u0026#39;Mean_Temperature_F\u0026#39;, \u0026#39;Min_TemperatureF\u0026#39;, \u0026#39;Max_Dew_Point_F\u0026#39;, \u0026#39;MeanDew_Point_F\u0026#39;, \u0026#39;Min_Dewpoint_F\u0026#39;, \u0026#39;Max_Humidity\u0026#39;, \u0026#39;Mean_Humidity\u0026#39;, \u0026#39;Min_Humidity\u0026#39;, \u0026#39;Max_Sea_Level_Pressure_In\u0026#39;, \u0026#39;Mean_Sea_Level_Pressure_In\u0026#39;, \u0026#39;Min_Sea_Level_Pressure_In\u0026#39;, \u0026#39;Max_Visibility_Miles\u0026#39;, \u0026#39;Mean_Visibility_Miles\u0026#39;, \u0026#39;Min_Visibility_Miles\u0026#39;, \u0026#39;Max_Wind_Speed_MPH\u0026#39;, \u0026#39;Mean_Wind_Speed_MPH\u0026#39;, \u0026#39;Max_Gust_Speed_MPH\u0026#39;, \u0026#39;Precipitation_In\u0026#39;, \u0026#39;Events\u0026#39;], dtype=\u0026#39;object\u0026#39;) dtype =\u0026#39;object\u0026#39;ï¼‰ è®©æˆ‘ä»¬å°†å¤©æ°”æ•°æ®ä¸è¡Œç¨‹æ•°æ®ç»“åˆèµ·æ¥ï¼š\nIn [25]:\nby_date = trips.groupby([\u0026#39;date\u0026#39;, \u0026#39;usertype\u0026#39;])[\u0026#39;trip_id\u0026#39;].count() by_date.name = \u0026#39;count\u0026#39; by_date = by_date.reset_index(\u0026#39;usertype\u0026#39;).join(weather) ç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹çœ‹æŒ‰å·¥ä½œæ—¥å’Œå‘¨æœ«ä¸ºçº¬åº¦ï¼ŒæŸ¥çœ‹å‡ºè¡Œæ•°é‡éšæ¸©åº¦å’Œé™æ°´é‡çš„å˜åŒ–ï¼š\nIn [26]:\n# add a flag indicating weekend by_date[\u0026#39;weekend\u0026#39;] = (by_date.index.dayofweek\u0026gt;= 5) #---------------------------------------------------------------- # Plot Temperature Trend g = sns.FacetGrid(by_date, col=\u0026#34;weekend\u0026#34;, hue=\u0026#39;usertype\u0026#39;, size=6) g.map(sns.regplot,\u0026#34;Mean_Temperature_F\u0026#34;,\u0026#34;count\u0026#34;) g.add_legend(); # do some formatting g.axes[0, 0].set_title(\u0026#39;\u0026#39;) g.axes[0, 1].set_title(\u0026#39;\u0026#39;) g.axes[0, 0].text(0.05, 0.95,\u0026#39;Monday - Friday\u0026#39;, va=\u0026#39;top\u0026#39;, size=14, transform=g.axes[0, 0].transAxes) g.axes[0, 1].text(0.05, 0.95,\u0026#39;Saturday - Sunday\u0026#39;, va=\u0026#39;top\u0026#39;, size=14, transform=g.axes[0, 1].transAxes) g.fig.text(0.45, 1,\u0026#34;Trend With Temperature\u0026#34;, ha=\u0026#39;center\u0026#39;, va=\u0026#39;top\u0026#39;, size=16); #---------------------------------------------------------------- # Plot Precipitation g = sns.FacetGrid(by_date, col=\u0026#34;weekend\u0026#34;, hue=\u0026#39;usertype\u0026#39;, size=6) g.map(sns.regplot,\u0026#34;Precipitation_In \u0026#34;,\u0026#34;count\u0026#34;) g.add_legend(); # do some formatting g.axes[0, 0].set_ylim(-50, 600); g.axes[0, 0].set_title(\u0026#39;\u0026#39;) g.axes[0, 1].set_title(\u0026#39;\u0026#39;) g.axes[0, 0].text(0.95, 0.95,\u0026#39;Monday - Friday\u0026#39;, ha=\u0026#39;right\u0026#39;, va=\u0026#39;top\u0026#39;, size=14, transform=g.axes[0, 0].transAxes) g.axes[0, 1].text(0.95, 0.95,\u0026#39;Saturday - Sunday\u0026#39;, ha=\u0026#39;right\u0026#39;, va=\u0026#39;top\u0026#39;, size=14, transform=g.axes[0, 1].transAxes) g.fig.text(0.45, 1,\u0026#34;Trend With Precipitation\u0026#34;, ha=\u0026#39;center\u0026#39;, va=\u0026#39;top\u0026#39;, size=16); å¯¹äºå¤©æ°”çš„å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ˜æ˜¾çš„è¶‹åŠ¿ï¼šäººä»¬æ›´å–œæ¬¢æ¸©æš–ã€é˜³å…‰æ˜åªšçš„å¤©æ°”ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›æœ‰è¶£çš„ç»†èŠ‚ï¼šå·¥ä½œæ—¥æœŸé—´ï¼Œæ‰€æœ‰çš„ç”¨æˆ·éƒ½å—åˆ°å¤©æ°”çš„å½±å“ã€‚ç„¶è€Œå‘¨æœ«å¹´è´¹ç”¨æˆ·å—å½±å“æ›´å°‘ã€‚æˆ‘æ²¡æœ‰ä»€ä¹ˆå¥½çš„ç†è®ºè¯´æ˜ä¸ºä»€ä¹ˆæœ‰è¿™ç§è¶‹åŠ¿ï¼Œå¦‚æœä½ æœ‰å¥½çš„æƒ³æ³•ï¼Œæ¬¢è¿æä¾›ã€‚\næ€»ç»“ æ ¹æ®ä¸Šé¢çš„ä¸€äº›ç³»åˆ—åˆ†æï¼Œä½†æ˜¯æˆ‘æƒ³æˆ‘ä»¬å¯ä»¥ä»è¿™äº›æ•°æ®ä¸­è·å¾—ä¸€äº›ç»“è®ºï¼š\n å¹´è´¹ç”¨æˆ·ä¸ä¸´æ—¶ç”¨æˆ·æ•´ä½“ä¸Šä¼šæœ‰ä¸åŒçš„è¡Œä¸ºï¼šå¹´è´¹ç”¨æˆ·é€šå¸¸æ˜¯åˆ©ç”¨ Pronto è¿›è¡Œå·¥ä½œæ—¥çš„é€šå‹¤ã€‚ä¸´æ—¶ç”¨æˆ·åˆ™æ˜¯å‘¨æœ«ä½¿ç”¨ Pronto æ¢ç´¢åŸå¸‚çš„ç‰¹å®šåŒºåŸŸã€‚ å°½ç®¡å¹´è´¹ç”¨æˆ·å¯¹å®šä»·ç­–ç•¥æœ‰æ‰€äº†è§£ï¼Œä½†æ˜¯å››åˆ†ä¹‹ä¸€çš„è¡Œç¨‹è¿˜æ˜¯è¶…è¿‡äº†åŠå°æ—¶çš„é™åˆ¶ï¼Œå¹¶äº§ç”Ÿäº†é¢å¤–çš„è´¹ç”¨ã€‚ä¸ºäº†å®¢æˆ·çš„æƒç›Šï¼ŒPronto åº”è¯¥æ›´å¥½å‘ŠçŸ¥ç”¨æˆ·è¿™ç§å®šä»·ç­–ç•¥ã€‚ æµ·æ‹”å’Œå¤©æ°”ä¼šå½±å“ä½¿ç”¨ï¼Œæ­£å¦‚ä½ é¢„è®¡çš„ä¸€æ ·ï¼šä¸‹å¡æ¯”ä¸Šå¡å¤š 60%ï¼Œå¯’å†·å’Œä¸‹é›¨ä¹Ÿä¼šæ˜æ˜¾å‡å°‘å½“å¤©çš„éª‘è¡Œæ•°é‡ã€‚  ","date":"2017-02-19T18:00:00Z","permalink":"https://www.4async.com/2017/02/2017-02-19-analyzing-pronto-cycleshare-data-with-python-and-pandas/","title":"ä½¿ç”¨ Python å’Œ Pandas åˆ†æ Pronto CycleShare æ•°æ®"},{"content":"Golang ä¸­çš„é”™è¯¯å¤„ç†æ˜¯ä¸€ä¸ªè¢«å¤§å®¶ç»å¸¸æ‹¿å‡ºæ¥è®¨è®ºçš„ è¯é¢˜(å¦å¤–ä¸€ä¸ªæ˜¯ æ³›å‹)ã€‚å…¶ä¸­æ³›å‹è¿™ä¸ªé—®é¢˜ï¼Œrsc åœ¨æœ€è¿‘çš„è®¡åˆ’ä¸­ä¹Ÿæå‡º äº†çº³å…¥ä»–ä»Šå¹´çš„è€ƒè™‘è®¡åˆ’ä¸­ï¼ŒåŒæ—¶ï¼Œæ³›å‹çš„ææ¡ˆ åœ¨ 2016 å¹´ä¹Ÿè¿›è¡Œäº†ä¸€äº›æ›´æ–°ï¼Œç›¸ä¿¡æœªæ¥ä¼šæœ‰ä¸€äº›æ›´å¥½çš„æ–¹æ¡ˆæå‡ºã€‚è¿™ä¸ªæ–‡ç« æˆ‘ä»¬è®¨è®ºä¸€ä¸‹å¦‚ä½•åœ¨ç°è¡Œçš„ Golang æ¡†æ¶ä¸‹æä¾›æ›´å‹å¥½å’Œä¼˜é›…çš„é”™è¯¯å¤„ç†ã€‚\nä»ç°çŠ¶è°ˆèµ· Golang ä¸­çš„é”™è¯¯å¤„ç†åŸåˆ™ï¼Œå¼€å‘è€…æ›¾ç»ä¹‹å‰ä¸“é—¨å‘å¸ƒäº†å‡ ç¯‡æ–‡ç«  (Error handling and Go å’Œ Defer, Panic, and Recoverã€Errors are values ) ä»‹ç»ã€‚åˆ†åˆ«ä»‹ç»äº† Golang ä¸­å¤„ç†ä¸€èˆ¬é¢„çŸ¥åˆ°çš„é”™è¯¯ä¸é‡åˆ°å´©æºƒæ—¶çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»¥å®˜æ–¹åšå®¢ä¸­çš„é”™è¯¯å¤„ç†ä¾‹å­ä¸ºä¾‹ï¼š\nfunc main() {f, err := os.Open(\u0026#34;filename.ext\u0026#34;) if err != nil {log.Fatal(err) // æˆ–è€…æ›´ç®€å•çš„ï¼š  // return err  } ... } å½“ç„¶å¯¹äºç®€åŒ–ä»£ç è¡Œæ•°ï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§å†™æ³•ï¼š\nfunc main() { ... if f, err = os.Open(\u0026#34;filename.ext\u0026#34;); err != nil{log.Fatal(err) } ... } æ­£å¸¸æƒ…å†µä¸‹ï¼ŒGolang ç°æœ‰çš„å“²å­¦ä¸­ï¼Œè¦æ±‚ä½ å°½é‡æ‰‹å·¥å¤„ç†æ‰€æœ‰çš„é”™è¯¯è¿”å›ï¼Œè¿™ç¨å¾®å¢åŠ äº†å¼€å‘äººå‘˜çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚å…³äºè¿™éƒ¨åˆ†è®¾è®¡çš„è®¨è®ºï¼Œè¯·å‚è€ƒæœ¬æ–‡æœ€å¼€å§‹æä¾›çš„å‚è€ƒé“¾æ¥ï¼Œæ­¤å¤„ä¸åšå¤ªå¤šæ¢è®¨ã€‚\næœ¬è´¨ä¸Šï¼ŒGolang ä¸­çš„é”™è¯¯ç±»å‹ error æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼š\ntype error interface {Error() string } åªè¦æ»¡è¶³è¿™ä¸€æ¥å£å®šä¹‰çš„æ‰€æœ‰æ•°å€¼éƒ½å¯ä»¥ä¼ å…¥ error ç±»å‹çš„ä½ç½®ã€‚åœ¨ Go Proverbs ä¸­ä¹Ÿæåˆ°äº†å…³äºé”™è¯¯çš„æè¿°ï¼š Errors are valuesã€‚è¿™ä¸€å¥å¦‚ä½•ç†è§£å‘¢ï¼Ÿ\nErrors are values äº‹å®ä¸Šï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¹Ÿå‘ç°äº†å¯¹ Golang è€Œè¨€ï¼Œæ‰€æœ‰çš„ä¿¡æ¯æ˜¯éå¸¸ä¸è¶³çš„ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š\nbuf := make([]byte, 100) n, err := r.Read(buf) buf = buf[:n] if err == io.EOF {log.Fatal(\u0026#34;read failed:\u0026#34;, err) } äº‹å®ä¸Šè¿™åªä¼šæ‰“å°ä¿¡æ¯ 2017/02/08 13:53:54 read failed:EOFï¼Œè¿™å¯¹æˆ‘ä»¬çœŸå®ç¯å¢ƒä¸‹çš„é”™è¯¯è°ƒè¯•ä¸åˆ†æå…¶å®æ˜¯å¹¶æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ï¼Œæˆ‘ä»¬åœ¨æŸ¥çœ‹æ—¥å¿—è·å–é”™è¯¯ä¿¡æ¯çš„æ—¶å€™èƒ½å¤Ÿè·å–åˆ°çš„ä¿¡æ¯ååˆ†æœ‰é™ã€‚\näºæ˜¯ä¹ï¼Œä¸€äº›æä¾›äº†ä¸Šä¸‹æ–‡æ–¹å¼çš„ä¸€äº›é”™è¯¯å¤„ç†å½¢å¼ä¾¿åœ¨å¾ˆå¤šç±»åº“ä¸­éå¸¸å¸¸è§ï¼š\nerr := os.Remove(\u0026#34;/tmp/nonexist\u0026#34;) log.Println(err) è¾“å‡ºäº†ï¼š\n2017/02/08 14:09:22 remove /tmp/nonexist: no such file or directory è¿™ç§æ–¹å¼æä¾›äº†ä¸€ç§æ›´åŠ ç›´è§‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¯”å¦‚å…·ä½“å‡ºé”™çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡ºç°é”™è¯¯çš„æ–‡ä»¶ç­‰ç­‰ã€‚é€šè¿‡æŸ¥çœ‹ Remove çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š\n// PathError records an error and the operation and file path that caused it. type PathError struct { Op string Path string Err error } func (e *PathError) Error() string { return e.Op +\u0026#34; \u0026#34;+ e.Path +\u0026#34;: \u0026#34;+ e.Err.Error() } // file_unix.go é’ˆå¯¹ *nix ç³»ç»Ÿçš„å®ç° // Remove removes the named file or directory. // If there is an error, it will be of type *PathError. func Remove(name string) error { // System call interface forces us to know \t// whether name is a file or directory. \t// Try both: it is cheaper on average than \t// doing a Stat plus the right one. \te := syscall.Unlink(name) if e == nil {return nil} e1 := syscall.Rmdir(name) if e1 == nil {return nil} // Both failed: figure out which error to return. \t// OS X and Linux differ on whether unlink(dir) \t// returns EISDIR, so can\u0026#39;t use that. However, \t// both agree that rmdir(file) returns ENOTDIR, \t// so we can use that to decide which error is real. \t// Rmdir might also return ENOTDIR if given a bad \t// file path, like /etc/passwd/foo, but in that case, \t// both errors will be ENOTDIR, so it\u0026#39;s okay to \t// use the error from unlink. \tif e1 != syscall.ENOTDIR {e = e1} return \u0026amp;PathError{\u0026#34;remove\u0026#34;, name, e} } å®é™…ä¸Šè¿™é‡Œ Golang æ ‡å‡†åº“ä¸­è¿”å›äº†ä¸€ä¸ªåä¸º PathError çš„ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“å®šä¹‰äº†æ“ä½œç±»å‹ã€è·¯å¾„å’ŒåŸå§‹çš„é”™è¯¯ä¿¡æ¯ï¼Œç„¶åé€šè¿‡ Error æ–¹æ³•å¯¹æ‰€æœ‰ä¿¡æ¯è¿›è¡Œäº†æ•´åˆã€‚\nä½†æ˜¯è¿™æ ·ä¹Ÿä¼šå­˜åœ¨é—®é¢˜ï¼Œæ¯”å¦‚éœ€è¦è¿›è¡Œå•ç‹¬ç±»å‹å¤æ‚çš„åˆ†ç±»å¤„ç†ï¼Œæ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­ï¼Œéœ€è¦å•ç‹¬å¤„ç† PathError è¿™ç§é—®é¢˜ï¼Œä½ å¯èƒ½éœ€è¦ä¸€ä¸ªå•ç‹¬çš„ç±»å‹æ¨å¯¼ï¼š\nerr := xxxx() if err != nil {swtich err := err.(type) { case *os.PathError: ... default: ... } } è¿™æ ·åå€’ä¼šå¢åŠ é”™è¯¯å¤„ç†çš„å¤æ‚åº¦ã€‚åŒæ—¶ï¼Œè¿™äº›é”™è¯¯å¿…é¡»å˜ä¸ºå¯¼å‡ºç±»å‹ï¼Œä¹Ÿä¼šå¢åŠ æ•´ä¸ªç³»ç»Ÿçš„å¤æ‚åº¦ã€‚\nå¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬åœ¨å‡ºç°é”™è¯¯æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¹Ÿå¸Œæœ›è·å–æ›´å¤šçš„å †æ ˆä¿¡æ¯ï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œåç»­çš„æ•…éšœè¿½è¸ªã€‚åœ¨ç°æœ‰çš„é”™è¯¯ä½“ç³»ä¸­ï¼Œè¿™ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼šä½ å¾ˆéš¾é€šè¿‡ä¸€ä¸ªæ¥å£ç±»å‹è·å–å®Œæ•´çš„è°ƒç”¨å †æ ˆã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½å°±éœ€è¦ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“åŒºå»è§£å†³é‡åˆ°çš„è¿™äº›é”™è¯¯å¤„ç†é—®é¢˜ã€‚\nè¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨é”™è¯¯å¤„ç†è¿‡ç¨‹ä¸­åŒæ ·å¯ä»¥é™„åŠ ä¸€äº›ä¿¡æ¯ï¼Œè¿™äº›ä¹Ÿä¼šç›¸å¯¹æ¯”è¾ƒéº»çƒ¦ã€‚\næ›´ä¼˜é›…çš„é”™è¯¯å¤„ç† ä¹‹å‰æåˆ°äº†å¤šç§å®é™…åº”ç”¨åœºæ™¯ä¸­å‡ºç°çš„é”™è¯¯å¤„ç†æ–¹æ³•å’Œé‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å»è§£å†³éƒ¨åˆ†é—®é¢˜ï¼šgithub.com/pkg/errorsã€‚\næ¯”å¦‚å½“æˆ‘ä»¬å‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„ä½¿ç”¨ errors.New æˆ–è€… errors.Errorf ç”Ÿæˆä¸€ä¸ªé”™è¯¯å˜é‡ï¼š\nerr := errors.New(\u0026#34;whoops\u0026#34;) // or err := errors.Errorf(\u0026#34;whoops: %s\u0026#34;, \u0026#34;foo\u0026#34;) å½“æˆ‘ä»¬éœ€è¦é™„åŠ ä¿¡æ¯æ—¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ï¼š\ncause := errors.New(\u0026#34;whoops\u0026#34;) err := errors.Wrap(cause,\u0026#34;oh noes\u0026#34;) å½“éœ€è¦è·å– @ç”¨å †æ ˆæ—¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ï¼š\nerr := errors.New(\u0026#34;whoops\u0026#34;) fmt.Printf(\u0026#34;%+v\u0026#34;, err) å…¶ä»–å»ºè®® åœ¨ä¸Šé¢åšç±»å‹æ¨å¯¼æ—¶ï¼Œæˆ‘ä»¬å‘ç°åœ¨å¤„ç†ä¸€ç±»é”™è¯¯æ—¶å¯èƒ½éœ€è¦å¤šä¸ªé”™è¯¯ç±»å‹ï¼Œè¿™å¯èƒ½åœ¨æŸäº›æƒ…å†µä¸‹ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤æ‚ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¥å£å½¢å¼å»æ–¹ä¾¿å¤„ç†ï¼š\ntype temporary interface {Temporary() bool } // IsTemporary returns true if err is temporary. func IsTemporary(err error) bool {te, ok := errors.Cause(err).(temporary) return ok \u0026amp;\u0026amp; te.Temporary()} è¿™æ ·å°±å¯ä»¥æä¾›æ›´åŠ æ–¹ä¾¿çš„é”™è¯¯è§£æå’Œå¤„ç†ã€‚\nå¹¿å‘Šæ—¶é—´ æˆ‘ä»¬æ­£åœ¨æ‹›æ”¶æ–°äºº Gopherï¼Œåº”å±Šæ¯•ä¸šç”Ÿ or å®ä¹ ç”Ÿæ¬¢è¿æŠ•é€’ç®€å†ã€‚æˆ‘ä»¬æ­£åœ¨åŠªåŠ›å®ç°å¼€å‘æµç¨‹æ ‡å‡†åŒ–ï¼Œå¦‚æœä½ æƒ³è·å¾—æé«˜ï¼Œç›¸ä¿¡ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„æœºä¼šã€‚ç®€å†æŠ•é€’ kevin [at] yeeuu [dot] comã€‚\n","date":"2017-02-08T18:00:00Z","permalink":"https://www.4async.com/2017/02/2017-02-08-more-effective-golang-error/","title":"æ›´ä¼˜é›…çš„ Golang é”™è¯¯å¤„ç†"},{"content":"ä»Šå¹´åœ¨ Pycon China ä¸Šï¼Œæ¥è‡ªé¥¿äº†ä¹ˆçš„éƒ­æµ©å·åˆ†äº«äº† åˆ©ç”¨ systemtap è¿›è¡Œ Python æ‰§è¡Œæƒ…å†µåˆ†æ çš„å†…å®¹ã€‚åˆ†äº«åˆ©ç”¨ systemtap åœ¨çº¿ä¸Šç¯å¢ƒä¸­å®æ—¶ç›‘æ§ gevent patch çš„ green thread ç¨‹åºçš„æ‰§è¡ŒçŠ¶å†µã€‚\ndtrace å’Œ systemtap å‡æ”¯æŒåœ¨ Linux ä¸Šè¿›è¡Œåˆ†æï¼Œåœ¨ macOS ç³»ç»Ÿä¸Šåˆ™åªæœ‰ dtrace ä½¿ç”¨ã€‚åœ¨ Python3.5 å’Œä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œéœ€è¦ä½¿ç”¨æ‰‹å·¥ Patch çš„æ–¹å¼è¿›è¡ŒåŸ‹ç‚¹ç›‘æ§ã€‚åœ¨ Python 3.6 ä»¥ä¸Šä¸­ dtrace å’Œ systemtap åŸ‹ç‚¹æ”¯æŒåŠŸèƒ½å¯ä»¥é€šè¿‡ç¼–è¯‘å‚æ•° \u0026ndash;with-dtrace å¼€å¯ã€‚\nä» dtrace å¼€å§‹ dtrace æ˜¯ä¸€ä¸ªä½å¼€é”€çš„æˆæœ¬åŠ¨æ€è·Ÿè¸ªå·¥å…·ï¼Œå¯ä»¥é€šè¿‡åŸ‹ç‚¹ probs æ–¹å¼ç›‘æ§å„é¡¹ç¨‹åºè¿è¡ŒçŠ¶æ€ã€‚dtrace æœ€åˆå†…ç½®åœ¨ Solaris ç³»ç»Ÿä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å€ŸåŠ© Solaris ç³»ç»Ÿçš„ç›¸å…³æ–‡æ¡£äº†è§£ dtrace çš„åŸºæœ¬æ“ä½œã€‚DTrace ç”¨æˆ·æŒ‡å— æ˜¯ Oracle æä¾›çš„åŸºäº Solaris ç³»ç»Ÿçš„ dtrace æ“ä½œæ‰‹å†Œï¼Œæ“ä½œåŸºæœ¬ä¸å…¶å®ƒç³»ç»Ÿç›¸åŒï¼Œæ¨èåœ¨æœ€åˆå¼€å§‹é˜¶æ®µé˜…è¯»è¯¥ä½¿ç”¨æ‰‹å†Œã€‚\nåœ¨ macOS ä¸Šï¼Œå·²ç»å¾ˆå¤šç³»ç»Ÿåº•å±‚åŠŸèƒ½å’Œ framework ä¸­å·²ç»é›†æˆäº† dtrace çš„åŠŸèƒ½ã€‚\næ¯”å¦‚è¯´æˆ‘ä»¬éœ€è¦ç›‘æ§ read è¿™ä¸ª syscall çš„å…¥å£ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸ªå‘½ä»¤å®ç°ï¼š\nâœ ~ sudo dtrace -n syscall::read:entry dtrace: description 'syscall::read:entry' matched 1 probe CPU ID FUNCTION:NAME 0 156 read:entry 0 156 read:entry 0 156 read:entry ... å…¶ä¸­ -n å‚æ•°è¡¨ç¤ºæ‰“å°ç‰¹å®šçš„ probs å†…å®¹çš„è°ƒç”¨ã€‚ç°åœ¨è¿™æ ·ä»…ä»…æ˜¾ç¤ºäº†è°ƒç”¨ï¼Œä½†æ˜¯è°ƒç”¨çš„ä¿¡æ¯è¿˜æ˜¯ä¸è¯¦ç»†çš„ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨ dtrace çš„è„šæœ¬è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚\ndtrace çš„è„šæœ¬ dtrace çš„åå­—æš—ç¤ºäº†è‡ªå·±çš„è„šæœ¬ï¼Œdtrace ä½¿ç”¨äº† D è¯­è¨€ä½œä¸ºè„šæœ¬è¯­è¨€ï¼ˆWTFï¼‰ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦å­¦ä¹ ä¸€ä¸‹åŸºç¡€çš„ D è¯­è¨€å†…å®¹ã€‚dtrace ä¸­ D è¯­è¨€çš„ä½¿ç”¨ï¼Œå¯ä»¥åœ¨ä¸Šé¢æåˆ°çš„ dtrace ç”¨æˆ·æŒ‡å—ä¸­çš„å¯¹åº”ç« èŠ‚ã€‚\næˆ‘ä»¬ç»§ç»­ä¸Šä¸€èŠ‚ä¸­çš„ä¾‹å­ï¼Œæ£€æµ‹è°ƒç”¨ read syscall çš„å‚æ•°å†…å®¹ã€‚åœ¨è¿›è¡Œæ“ä½œä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ read çš„å‚æ•°ï¼š\nsize_t read(int fildes, void *buf, size_t nbyte); æˆ‘ä»¬æƒ³çŸ¥é“è°ƒç”¨æ¥è‡ªäºå“ªäº›è¿›ç¨‹ï¼Œè¯»å–äº†å¤šå°‘å­—èŠ‚ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå« syscall.d æ–‡ä»¶ã€‚\nsyscall::read:entry {printf (\u0026#34;%s called read, asking for %d bytes\\n\u0026#34;, execname, arg2); } ç„¶åé€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œï¼š\nâœ ~ sudo dtrace -s syscall.d dtrace: script 'syscall.d' matched 1 probe CPU ID FUNCTION:NAME 0 156 read:entry steam_osx called read, asking for 128 bytes 0 156 read:entry steam_osx called read, asking for 128 bytes 0 156 read:entry steam_osx called read, asking for 128 bytes 0 156 read:entry steam_osx called read, asking for 128 bytes 0 156 read:entry iTerm2 called read, asking for 32 bytes 0 156 read:entry iTerm2 called read, asking for 1024 bytes ... ä» dtrace åˆ° Python è·Ÿè¸ª åœ¨ Pycon ä¸Šçš„åˆ†äº«ä¸Šï¼Œæä¾›äº†ä¸€ç§ CPython è™šæ‹Ÿæœºä»£ç  Patch æ–¹å¼è¿›è¡Œè·Ÿè¸ªçš„æ–¹æ¡ˆï¼Œè¿™ç§æ–¹æ¡ˆéœ€è¦ç³»ç»Ÿæ”¯æŒï¼Œæ¯”å¦‚ REHL ç³»åˆ—ç³»ç»Ÿé»˜è®¤æ”¯æŒï¼Œå‡å¦‚ä½ æ˜¯ç”¨äº† Ubuntu ç³»ç»Ÿï¼Œé™¤äº†é‡æ–°ç¼–è¯‘ CPython ä»¥å¤–æ²¡æœ‰å…¶ä»–åŠæ³•ã€‚ä¸è¿‡é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ Python USDTã€‚ä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯ Python USDT æ˜¯ä¸€ç§ç”¨æˆ·æ€ä¿®é¥°å™¨ç›‘æ§æ–¹æ³•ï¼Œè¿™ç§æ–¹å¼ä¸ patch CPython çš„æ–¹å¼ç›¸æ¯”å·®è·è¾ƒå¤§ï¼Œæ¯•ç«Ÿ USDT æ— æ³•ç›‘æ§ä¸€äº›ç³»ç»Ÿåº•å±‚çš„å°¤å…¶æ˜¯æ¶‰åŠåˆ°æ¯”å¦‚ gevent å¯¼è‡´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶çš„æ··ä¹±ã€‚åŒæ ·çš„ï¼Œsystemtap ä¹Ÿæœ‰ä¸€ä¸ªä¸“é—¨çš„åº“ï¼špython-systemtapã€‚\nä¸è¿‡è¿˜æ˜¯ä» USDT å¼€å§‹ã€‚USDT å¯ä»¥é€šè¿‡ pip ç›´æ¥å®‰è£…ï¼š\npip install usdt æ¥ä¸‹æ¥ç”¨ ipython æ¼”ç¤ºä¸€ä¸‹ usdt çš„åŸºç¡€ä½¿ç”¨ï¼š\nâœ ~ ipython Python 2.7.12 (default, Jul 4 2016, 11:33:35) Type \u0026quot;copyright\u0026quot;, \u0026quot;credits\u0026quot; or \u0026quot;license\u0026quot; for more information. IPython 5.0.0 -- An enhanced Interactive Python. ? -\u0026gt; Introduction and overview of IPython's features. %quickref -\u0026gt; Quick reference. help -\u0026gt; Python's own help system. object? -\u0026gt; Details about 'object', use 'object??' for extra details. In [1]: import os In [2]: os.getpid() Out[2]: 7777 In [3]: from usdt.tracer import fbt In [4]: @fbt ...: def example(v): ...: pass ...: In [5]: example(\u0026quot;hello\u0026quot;) æˆ‘ä»¬ä½¿ç”¨ç›‘å¬è¿›ç¨‹çš„æ–¹å¼ç›‘æ§æ¥è‡ªäº usdt çš„æ¢é’ˆï¼š\nâœ ~ sudo dtrace -l -p 7777 -m fbt ID PROVIDER MODULE FUNCTION NAME 1206 python-fbt7777 fbt example entry 1207 python-fbt7777 fbt example return å…¶ä¸­ -p ç”¨äºæŒ‡å®šè¿›ç¨‹ï¼Œ-m æŒ‡å®šå¯¹åº”çš„æ¨¡å—ã€‚å¦‚æœä¸è¿›è¡Œæ¨¡å—è¿‡æ»¤çš„è¯ï¼Œä½ å¾ˆæœ‰å¯èƒ½è¢«å¾ˆå¤šç›¸å…³çš„è°ƒè¯•ä¿¡æ¯æ·¹æ²¡ã€‚\nåœ¨æ–°ç‰ˆçš„ Python 3.6 ä»¥ä¸Šç‰ˆæœ¬ä¸­é€šè¿‡å¼€å¯ --with-dtrace å¼€å…³çš„æ–¹å¼å¯ä»¥è·å–è¯¦ç»†çš„ Python è¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š\n å‡½æ•°è°ƒç”¨ä¸è¿”å› GC å¼€å§‹ä¸ç»“æŸ æ‰§è¡Œä»£ç è¡Œæ•°  é¦–å…ˆè¿è¡Œä¸€ä¸ª Python 3.6\nâœ ~ ipython Python 3.6.0b1 (default, Sep 15 2016, 10:16:39) Type \u0026quot;copyright\u0026quot;, \u0026quot;credits\u0026quot; or \u0026quot;license\u0026quot; for more information. IPython 5.1.0 -- An enhanced Interactive Python. ? -\u0026gt; Introduction and overview of IPython's features. %quickref -\u0026gt; Quick reference. help -\u0026gt; Python's own help system. object? -\u0026gt; Details about 'object', use 'object??' for extra details. In [1]: import os In [2]: os.getpid() Out[2]: 33164 In [3]: æ¥ä¸‹æ¥é€šè¿‡ dtrace æ¥è·å–æ‰€æœ‰çš„ Python æ¢é’ˆè¾“å‡ºï¼š\nâœ ~ sudo dtrace -l -m python3.6 ID PROVIDER MODULE FUNCTION NAME 35775 python33164 python3.6 _PyEval_EvalFrameDefault function-entry 35776 python33164 python3.6 _PyEval_EvalFrameDefault function-return 35777 python33164 python3.6 collect gc-done 35778 python33164 python3.6 collect gc-start 35779 python33164 python3.6 _PyEval_EvalFrameDefault line å¦‚æœæƒ³è¦å®ç°ä¸€ä¸ªç±»ä¼¼ pycon ä¸­ç›‘æ§ç¨‹åºæ‰§è¡Œå…·ä½“å†…å®¹çš„ dtrace è„šæœ¬ï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ Instrumenting CPython with DTrace and SystemTap ä¸­çš„ç°æˆè„šæœ¬å³å¯ã€‚\næ€»ç»“ dtrace æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„ã€ä½å¹²æ‰°çš„ Python å†…éƒ¨æ‰§è¡Œæ¢æŸ¥æ–¹å¼ã€‚é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥æ–¹ä¾¿çš„äº†è§£ç›®å‰ Python çš„å…·ä½“æ‰§è¡ŒçŠ¶å†µã€‚åŒæ—¶ï¼Œé€šè¿‡è„šæœ¬ï¼Œå¯ä»¥å¿«é€Ÿè·å–å’Œå®šä½ç›¸å…³æƒ³è¦äº†è§£çš„å…·ä½“å†…å®¹ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åƒéƒ­æµ©å·åˆ†äº«çš„é‚£æ ·ï¼Œåšä¸€ä¸ªæ¯”è¾ƒç‚«é…·çš„çƒˆç„°å›¾ã€‚XD\n","date":"2016-09-15T18:00:00Z","permalink":"https://www.4async.com/2016/09/2016-09-15-tracing-python-program-with-dtrace/","title":"ä½¿ç”¨ dtrace è·Ÿè¸ª Python åº”ç”¨"},{"content":"traefik(https://traefik.io/) æ˜¯ä¸€æ¬¾å¼€æºçš„åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡å·¥å…·ã€‚å®ƒæœ€å¤§çš„ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿä¸å¸¸è§çš„å¾®æœåŠ¡ç³»ç»Ÿç›´æ¥æ•´åˆï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒ–åŠ¨æ€é…ç½®ã€‚ç›®å‰æ”¯æŒ Docker, Swarm, Mesos/Marathon, Mesos, Kubernetes, Consul, Etcd, Zookeeper, BoltDB, Rest API ç­‰ç­‰åç«¯æ¨¡å‹ã€‚\ntraefik çš„å…·ä½“æ¨¡å‹å¦‚ä¸‹ï¼š ä¸ºä»€ä¹ˆé€‰æ‹© traefikï¼Ÿ äº‹å®ä¸Šåœ¨ä¹‹å‰æˆ‘å¯¹ LB çš„é€‰æ‹©ä¸€ç›´æ›´å€¾å‘äºä½¿ç”¨ HAProxyã€‚ä½†æ˜¯é€‰æ‹© traefik ä¸»è¦æ˜¯æœ‰ä»¥ä¸‹ç‰¹ç‚¹è®©æˆ‘ä»¬å†³å®šä½¿ç”¨ï¼š\n Golang ç¼–å†™ï¼Œå•æ–‡ä»¶éƒ¨ç½²ï¼Œä¸ç³»ç»Ÿæ— å…³ï¼ŒåŒæ—¶ä¹Ÿæä¾›å°å°ºå¯¸ Docker é•œåƒã€‚ æ”¯æŒ Docker/Etcd åç«¯ï¼Œå¤©ç„¶è¿æ¥æˆ‘ä»¬çš„å¾®æœåŠ¡é›†ç¾¤ã€‚ å†…ç½® Web UIï¼Œç®¡ç†ç›¸å¯¹æ–¹ä¾¿ã€‚ è‡ªåŠ¨é…ç½® ACME(Let\u0026rsquo;s Encrypt) è¯ä¹¦åŠŸèƒ½ã€‚ æ€§èƒ½å°šå¯ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰åˆ°å‹æ¦¨ LB æ€§èƒ½çš„é˜¶æ®µï¼Œæ˜“ç”¨æ€§æ›´é‡è¦ã€‚  é™¤äº†è¿™äº›ä»¥å¤–ï¼Œtraefik è¿˜æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n Restful API æ”¯æŒã€‚ æ”¯æŒåç«¯å¥åº·çŠ¶æ€æ£€æŸ¥ï¼Œæ ¹æ®çŠ¶æ€è‡ªåŠ¨é…ç½®ã€‚ æ”¯æŒåŠ¨æ€åŠ è½½é…ç½®æ–‡ä»¶å’Œ graceful é‡å¯ã€‚ æ”¯æŒ WebSocket å’Œ HTTP/2ã€‚  é™¤äº†ä¸Šé¢æåˆ°çš„å¾®æœåŠ¡åŒ–é›†ç¾¤æ”¯æŒï¼Œä¸€äº› AB æµ‹è¯•é˜¶æ®µä¹Ÿå¯ä»¥é€šè¿‡ frontend çš„è·¯ç”±ç‰¹æ€§è¿›è¡ŒåŠ¨æ€åˆ†é…ï¼Œå½“ç„¶è¿™äº›å¯¹ HAProxy ç­‰è½¯ä»¶éƒ½æ˜¯æ ‡å‡†æ”¯æŒçš„ã€‚\ntraefik çš„é…ç½® traefik æ”¯æŒçš„é…ç½®æ–¹å¼æ”¯æŒæ–‡ä»¶æ–¹å¼è¿›è¡Œé…ç½®ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„é…ç½®æ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ã€‚\ntraefik æ”¯æŒçš„ toml æ–¹å¼è¿›è¡Œé…ç½®ï¼Œå®˜æ–¹æä¾›äº†ä¸€ä¸ª ç¤ºä¾‹çš„ traefik.toml æ–‡ä»¶ ç”¨äºæ¼”ç¤ºé…ç½®ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåç«¯æœåŠ¡ä¸€èˆ¬æ˜¯é‡‡ç”¨å•ç‹¬æ–‡ä»¶è¿›è¡Œå­˜å‚¨ï¼Œæ¯”å¦‚æ¼”ç¤ºé…ç½®ä¸­æŒ‡å®šçš„ rules.tomlã€‚\nå…·ä½“ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªåç«¯ï¼Œ127.0.0.1:7727ï¼Œ127.0.0.1:7728ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰€æœ‰çš„ Chrome ç”¨æˆ·éƒ½å¯ä»¥è®¿é—® 127.0.0.1:7727ï¼Œå…¶å®ƒäººéƒ½è®¿é—® 127.0.0.1:7728ï¼Œè¿™æ ·è¿™ä¸ª rules.toml åº”è¯¥å¦‚ä½•é…ç½®å‘¢ï¼Ÿ\n# rules.toml [backends] [backends.backend1] [backends.backend1.servers.server1] url = \u0026#34;http://127.0.0.1:7727\u0026#34; [backends.backend2] [backends.backend2.servers.server1] url = \u0026#34;http://127.0.0.1:7728\u0026#34; [frontends] [frontends.frontend1] entrypoints = [\u0026#34;http\u0026#34;] backend = \u0026#34;backend1\u0026#34; [frontends.frontend1.routes.test_1] rule = \u0026#34;HeadersRegexp: User-Agent, Chrome\u0026#34; [frontends.frontend2] entrypoints = [\u0026#34;http\u0026#34;] backend = \u0026#34;backend2\u0026#34; é¦–å…ˆå®šä¹‰ä¸¤ä¸ªåç«¯æœåŠ¡ï¼Œæ¯ä¸ªåç«¯æœåŠ¡å¯ä»¥æ”¯æŒå¤šä¸ªæœåŠ¡å•å…ƒï¼Œè¿™é‡Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªã€‚å‰ç«¯ frontends ç”¨äºåŒ¹é…è¯·æ±‚è½åˆ°å“ªä¸ªåç«¯æœåŠ¡ä¸­ã€‚æˆ‘ä»¬è¿™é‡Œå®šä¹‰ä¸€ä¸ªè§„åˆ™ test_1ï¼Œè®¾ç½®è§„åˆ™ä¸ºæ ¹æ® HTTP è¯·æ±‚å¤´éƒ¨æ­£åˆ™è¿›è¡Œåˆ†é…ï¼šå¦‚æœ UserAgent ä¸­åŒ…å« Chrome å­—æ ·ï¼Œåˆ™è®¿é—®åˆ° 127.0.0.1:7727ã€‚åŒ¹é…çš„è§„åˆ™æ–¹å¼åŒ…å«äº†ä»¥ä¸‹å‡ ç§æ–¹å¼:\n Headers/HeaderRegexp: å¤´éƒ¨åŒ¹é…æ–¹å¼ï¼Œåˆ†åˆ«å¯¹åº”æŒ‰å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼ä¸¤ç§æ–¹å¼ã€‚ Host/HostRegexp: æŒ‰ç…§è¯·æ±‚ä¸»æœºåè¿›è¡ŒåŒ¹é…ï¼Œä¸å¤´éƒ¨ä¿¡æ¯ç›¸ä¼¼ã€‚ Method: æŒ‰ç…§è¯·æ±‚æ–¹å¼åŒºåˆ†ã€‚ Path/PathStrip/PathPrefix/PathPrefixStrip: æŒ‰ç…§è·¯å¾„åŒºåˆ†åç«¯ã€‚  traefik ä¸å¾®æœåŠ¡é›†ç¾¤ è¿™ä¸ªæœ‰äººå·²ç»å†™è¿‡ç›¸å…³çš„æ–‡ç« äº†ï¼Œæˆ‘åœ¨è¿™é‡Œç®€å•æ¨èä¸€ä¸‹ï¼š Microservices Bliss with Docker and Traefikï¼ˆä¸­æ–‡è¯‘æ–‡ï¼‰ã€‚æˆ‘å°±ä¸åšé¢å¤–çš„æè¿°äº†ã€‚\n","date":"2016-08-01T11:00:00Z","permalink":"https://www.4async.com/2016/08/2016-08-01-introduce-traefik-load-balance/","title":"traefik ç®€ä»‹"},{"content":"Type Hintï¼ˆæˆ–è€…å«åš PEP-484ï¼‰æä¾›äº†ä¸€ç§é’ˆå¯¹ Python ç¨‹åºçš„ç±»å‹æ ‡æ³¨æ ‡å‡†ã€‚\nä¸ºä»€ä¹ˆä½¿ç”¨ Type Hintï¼Ÿå¯¹äºåŠ¨æ€è¯­è¨€è€Œè¨€ï¼Œå¸¸å¸¸å‡ºç°çš„æƒ…å†µæ˜¯å½“ä½ å†™äº†ä¸€æ®µä»£ç åï¼Œéš”æ®µæ—¶é—´ä½ å¯èƒ½å¿˜è®°è¿™ä¸ªæ–¹æ³•çš„åŸå‹æ˜¯ä»€ä¹ˆæ ·å­çš„äº†ï¼Œä½ ä¹Ÿä¸æ¸…æ¥šå…·ä½“åº”è¯¥ä¼ å…¥ä»€ä¹ˆç±»å‹çš„å‚æ•°ï¼Œè¿™æ ·å¾€å¾€éœ€è¦ä½ å»é˜…è¯»ä»£ç æ‰èƒ½å®šä¹‰æ¯ä¸ªç±»å‹å…·ä½“æ˜¯ä»€ä¹ˆã€‚æˆ–è€…å½“ä½ ä½¿ç”¨ä¸€ä¸ªæ–‡æ¡£å¹¶ä¸æ˜¯ç‰¹åˆ«å®Œå…¨çš„ç¬¬ä¸‰æ–¹åº“ï¼Œä½ ä¸çŸ¥é“è¿™ä¸ªåº“åº”è¯¥å¦‚ä½•ä½¿ç”¨ï¼Œè¿™éƒ½ä¼šå¾ˆç—›è‹¦ã€‚\nç°åœ¨ï¼Œå€ŸåŠ© Type Hintï¼Œä½ å¯ä»¥å®ç°ï¼š\n å®ç°ç±»å‹æ£€æŸ¥ï¼Œé˜²æ­¢è¿è¡Œæ—¶å‡ºç°çš„ç±»å‹ä¸ç¬¦åˆæƒ…å†µã€‚ ä½œä¸ºæ–‡æ¡£é™„åŠ å±æ€§ï¼Œæ–¹ä¾¿å¼€å‘è€…è°ƒç”¨æ—¶ä¼ å…¥ä¼ å‡ºçš„å‚æ•°ç±»å‹ã€‚ æå‡ IDE çš„æ£€æŸ¥æœºåˆ¶ï¼Œåœ¨æ™ºèƒ½æç¤ºæ—¶æ›´å¿«ç»™å‡ºæç¤ºå’Œç±»å‹æ£€æŸ¥ç»“æœã€‚  å®ç°è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ éœ€è¦ä½¿ç”¨ Python 3.5+ ä¸­æä¾›çš„æ–°æ¨¡å— typingã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ”¹åŠ¨å¹¶ä¸ä¼šå½±å“ç¨‹åºè¿è¡Œï¼Œä»…ä»…æ˜¯ä¸ºäº†æ–¹ä¾¿ç±»å‹æ£€æŸ¥å™¨å®ç°çš„ã€‚\nType Hint ç±»å‹æ£€æŸ¥å™¨ ç›®å‰ï¼Œæ¯”å¦‚ JetBrains å®¶çš„ PyCharm å·²ç»æ”¯æŒ Type Hint è¯­æ³•æ£€æŸ¥åŠŸèƒ½ï¼Œå¦‚æœä½ ä½¿ç”¨äº†è¿™ä¸ª IDEï¼Œå¯ä»¥é€šè¿‡ IDE åŠŸèƒ½è¿›è¡Œå®ç°ã€‚å¦‚æœä½ åƒæˆ‘ä¸€æ ·ï¼Œä½¿ç”¨äº† SublimeText ç¼–è¾‘å™¨ï¼Œé‚£ä¹ˆç¬¬ä¸‰æ–¹å·¥å…· mypy å¯ä»¥å¸®åŠ©åˆ°ä½ ã€‚AnacondaST3 æœ€è¿‘è¦å‘å¸ƒçš„ 2.0 ç‰ˆæœ¬ä¹Ÿå†…ç½®äº† mypy åŠŸèƒ½çš„æ”¯æŒï¼Œå…·ä½“çš„è¿›åº¦å¯ä»¥çœ‹ä¸€ä¸‹ è¿™ä¸ª issueã€‚ä¸€äº›å…¶å®ƒçš„ Python å·¥å…· (æ¯”å¦‚ ä»£ç æç¤ºå·¥å…· jedi 0.10+) ä¹Ÿæ”¯æŒäº† Type Hint åŠŸèƒ½ã€‚\nä»ç®€å•çš„ä¾‹å­å¼€å§‹ ä»ç®€å•çš„ä¾‹å­å¼€å§‹ï¼Œæˆ‘ä»¬å…ˆä»ä¸€ä¸ªç®€å•çš„ç¨‹åºå¼€å§‹ï¼Œè¿è¡Œç¯å¢ƒä¸º Python 3.5.2ï¼Œä½¿ç”¨ mypy å·¥å…·è¿›è¡Œæ£€æŸ¥ã€‚\né¦–å…ˆé€šè¿‡ pip install mypy-lang å‘½ä»¤å®‰è£… mypy å·¥å…·ã€‚æ³¨æ„æ˜¯ mypy-langï¼Œä¹‹æ‰€ä»¥æ˜¯è¿™æ ·ï¼Œæ˜¯å› ä¸ºåœ¨ pypi é‡Œ mypy è¿™ä¸ªåå­—å·²ç»è¢«å ç”¨æ‰äº†ã€‚\næ¥ä¸‹æ¥ï¼Œé€šè¿‡ mypy æ£€æŸ¥ä¸‹é¢è¿™ä¸ªæ–‡ä»¶\n# fib.py from typing import Iterator def fib(n: int) -\u0026gt; Iterator[int]: a, b = 0, 1 while a \u0026lt; n: yield a a, b = b, a + b i = fib(3.2) print(next(i)) print(next(i)) åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œå‘½ä»¤ mypy fib.pyï¼Œè·å–è¿”å›ç»“æœï¼š\nâœ mypy fib.py fib.py:11: error: Argument 1 to \u0026quot;fib\u0026quot; has incompatible type \u0026quot;float\u0026quot;; expected \u0026quot;int\u0026quot; ä½†æ˜¯åœ¨å®é™…çš„åº”ç”¨è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªåŠŸèƒ½åœ¨ Python é‡Œæ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œçš„ï¼š\nâœ mypy python fib.py 0 1 å¯ä»¥çœ‹åˆ°ï¼Œmypy å·¥å…·æç¤ºäº†æˆ‘ä»¬çš„ä»£ç ä¸­å­˜åœ¨ä¸€å¤„ç±»å‹ä¸åŒ¹é…çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä¸è¿›è¡Œæ£€æŸ¥ï¼Œä»£ç æœ‰å¯èƒ½æ‰§è¡Œå‡ºä¸å¯é¢„çŸ¥çš„ç»“æœã€‚\nåœ¨è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯ Python åŸºç¡€æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ strã€int ç­‰ç­‰ï¼Œè¿™äº›ç±»å‹æ•°æ®æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ï¼›å¦å¤–ä¸€ç§æ˜¯æ¥è‡ªäº typing ä¸­å¼•å…¥çš„ Iteratorï¼Œç”¨æ¥è¡¨ç¤ºè¿­ä»£å™¨ç±»å‹ã€‚å¦å¤–ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œtyping ä¸­éƒ¨åˆ†ç±»å‹ä¹Ÿä¼šéšæ—¶æ·»åŠ ï¼Œä¸€èˆ¬æˆ‘ä»¬ä»¥æ¼”ç¤ºç‰ˆæœ¬ä¸ºå‡†ã€‚\nä»ç®€å•åˆ°å¤æ‚ï¼Œç±»å‹ç»„åˆæ€ä¹ˆåŠï¼Ÿ å®é™…ä¸Šï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨è¿‡ç¨‹ä¸­è¿˜æœ‰å¯èƒ½ä¼ é€’ä¸€äº›æ›´åŠ å¤æ‚çš„å‚æ•°ç±»å‹ï¼Œæ¯”å¦‚ list ç±»å‹ï¼Œtuple ç±»å‹ç­‰ç­‰ï¼Œè¿™ç±»å‹çš„æ•°æ®å¦‚ä½•å£°æ˜å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼š\ndef foo(strings, string_list, count, total): è¿™ä¸ªå‡½æ•°çš„å‚æ•°æˆ‘ä»¬ä»å­—é¢å¯ä»¥çœ‹å‡ºæ¥åˆ†åˆ«æ˜¯ strï¼Œå…ƒç´ ä¸º str çš„ list ç±»å‹å’Œä¸¤ä¸ªæ•´æ•°å‚æ•°ã€‚æˆ‘ä»¬å‡å®šä¸€ä¸ªè¿”å›å€¼ä¸º ((int, int), str)ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å‹æ£€æŸ¥å¯ä»¥è¿™æ ·å®šä¹‰ï¼š\nfrom typing import List, Tuple Result = Tuple[Tuple[int, int], str] def foo(strings: str, lines: List[str], line_number: int, total_lines: int) -\u0026gt; Result: å…¶å®ƒçš„ä¸€äº›ç±»å‹æç¤ºã€åç¨‹ç­‰ç­‰çš„æ”¯æŒéƒ½å¯ä»¥åœ¨å®˜æ–¹çš„ typing æ¨¡å—æ–‡æ¡£ ä¸­è¿›è¡ŒæŸ¥çœ‹ã€‚\nå…³äºç”Ÿäº§çš„ä¸€äº›é—²æ‰¯ æˆ‘ä»¬ç°åœ¨ä¹Ÿåœ¨è¿›è¡Œä¸€äº› mypy å·¥å…·åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„å…·ä½“ä½¿ç”¨æµ‹è¯•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå‘ç°äº†ä¸€äº›å­˜åœ¨çš„é—®é¢˜ï¼Œæ¯”å¦‚ Python æœ¬èº«çš„åŠ¨æ€è¯­è¨€ç‰¹æ€§ç»™ç±»å‹æ ‡æ³¨å°±å¸¦æ¥äº†ä¸€äº›éº»çƒ¦ã€‚å¦å¤–ï¼Œå˜é‡å¤ç”¨å¯¼è‡´çš„ç±»å‹å˜æ¢æœ‰å¯èƒ½ä¼šæç¤ºé‡‡ç”¨æ–°çš„å˜é‡å®ç°ã€‚è¿™å¯¹äºä¸€ä¸ªå·²ç»å­˜åœ¨çš„çº¿ä¸Šé¡¹ç›®æ¥è¯´ç›¸å¯¹æˆæœ¬è¾ƒé«˜ï¼Œæˆ‘ä»¬åç»­ä¹Ÿä¼šåœ¨ä¸€äº›æ–°é¡¹ç›®ä¸­é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚å¦å¤– mypy è¿˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„é¡¹ç›®ï¼Œæœ¬èº«æ˜¯æ‹¥æœ‰ä¸€äº› bugã€‚å¦å¤–ä¸€ä¸ªæ˜¯åœ¨æŸäº› mypy çš„éç±»å‹é”™è¯¯æç¤ºå…¶å®éå¸¸çš„æ¨¡ç³Šï¼Œå¯¼è‡´å¾ˆå¤šé”™è¯¯æœ‰æ—¶éœ€è¦è¿›è¡Œäººå·¥æ’æŸ¥ã€‚\nä¸ç®¡æ€æ ·ï¼Œå³ä¾¿åœ¨ mypy å­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œä½†æ˜¯ä»æ—§æ˜¯æœªæ¥éå¸¸æœ‰æ½œåŠ›çš„å·¥å…·ï¼Œæå‰äº†è§£å’Œåº”ç”¨ä¹Ÿèƒ½æœ‰æ•ˆçš„æå‡ç¨‹åºçš„å¼ºå£®æ€§ã€‚\n","date":"2016-07-13T20:00:00Z","permalink":"https://www.4async.com/2016/07/2016-07-13-type-hint-improve-python-programming/","title":"åˆ©ç”¨ Type Hint æå‡ Python ç¨‹åºå¼€å‘æ•ˆç‡"},{"content":"æœåŠ¡å‘ç°æ˜¯å¾®æœåŠ¡åŒ–æ¶æ„ä¸­é‡è¦çš„ä¸€ç¯ï¼ŒæœåŠ¡çš„é…ç½®ä¿¡æ¯éœ€è¦æœ‰ä¸€ç§å¯é é«˜æ•ˆçš„å‘ç°æœºåˆ¶ï¼Œä¿è¯æœåŠ¡ä¸Šçº¿æ—¶å¯ä»¥åŠæ—¶è¢«ä½¿ç”¨ï¼ŒæœåŠ¡å¤±æ•ˆä¸­æ–­æ—¶å¯ä»¥åŠæ—¶åˆ‡èµ°ã€‚æœåŠ¡å‘ç°å·¥å…· Etcd å°±æ˜¯ä¸ºäº†è¿™ç§éœ€æ±‚å¼€å‘çš„ã€‚\nä»€ä¹ˆæ˜¯ Etcdï¼Ÿ Etcd æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ KV æ•°æ®åº“ï¼Œé€šè¿‡å°†æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å¤šå°ç‹¬ç«‹çš„è®¾å¤‡ä¸Šï¼Œä»è€Œæé«˜æ•°æ®çš„å¯é æ€§æˆ–è¯»å†™æ€§èƒ½ã€‚Etcd æ˜¯å‡ ä¸ªæ¯”è¾ƒå¸¸è§çš„æœåŠ¡å‘ç°åº”ç”¨ä¹‹ä¸€ï¼Œå®ƒæ”¯æŒ TTL çš„æ”¯æŒå’Œ HTTP Restful APIï¼ŒåŒæ—¶é€šè¿‡ Raft ä¸€è‡´æ€§ç®—æ³•å¤„ç†æ—¥å¿—å¤åˆ¶ä»¥ä¿è¯å¼ºä¸€è‡´æ€§ã€‚å…³äº Raft ç®—æ³•ï¼Œè¯·å‚è€ƒ è¿™ç¯‡æ–‡ç« ï¼Œè¿™é‡Œä¸å¤šä»‹ç»ã€‚Etcd æœ¬æ¥å°±æ˜¯ CoreOS å›¢é˜Ÿå¼€å‘æ”¯æŒçš„ï¼Œå› æ­¤ä¹Ÿæ˜¯åŸç”Ÿå­˜åœ¨åœ¨ CoreOS ç³»ç»Ÿä¸­ã€‚\nEtcd ä¸­æä¾›äº†è®¢é˜…é€šçŸ¥æœºåˆ¶ï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ªçº¿ä¸ŠæœåŠ¡ https://discovery.etcd.io/ï¼Œè¿™ä¸ªæœåŠ¡å¯ä»¥ç”¨äºå‘ç°é›†ç¾¤ä¸­çš„æœºå™¨ã€‚æ¯”å¦‚ Fleet ç­‰ç­‰å·¥å…·ä¹Ÿæ˜¯åŸºäº Etcd å»å‘ç°ç½‘ç»œä¸­çš„èŠ‚ç‚¹æœåŠ¡å™¨ã€‚åœ¨ CoreOS æœºå™¨éƒ¨ç½²ä¹‹åï¼Œç³»ç»Ÿä¸­ä¸€ä¸ªå«åš cloud-init çš„æœåŠ¡ä¼šæ ¹æ®ä¹‹å‰çš„ user-data æ–‡ä»¶å»å¯åŠ¨ Etcdã€‚Etcd ä¼šæ›´æ–°å¯¹åº”çš„è‡ªå·±çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¹¶ä¸”è·å–å…¶å®ƒçš„èŠ‚ç‚¹ä¿¡æ¯ã€‚\nå¦å¤–æ¯”è¾ƒå¸¸è§çš„æœåŠ¡å‘ç°è¿˜æœ‰ ZooKeeperï¼ˆåº”ç”¨æœ€å¹¿æ³›ï¼‰ã€Consul ç­‰ç­‰ï¼Œå¦‚æœæœ‰å…´è¶£ï¼Œå¯ä»¥è‡ªå·±åœ¨è¿›è¡Œç ”ç©¶ã€‚\nEtcdctl ä½¿ç”¨ å·¥å…· etcdctl æ˜¯ etcd çš„æ§åˆ¶ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹æ‰€æœ‰é”®å€¼ï¼š\ncore@core-01 ~ $ etcdctl ls / --recursive /coreos.com /coreos.com/network /coreos.com/network/config /coreos.com/network/subnets /coreos.com/network/subnets/10.1.64.0-24 /coreos.com/network/subnets/10.1.48.0-24 /coreos.com/network/subnets/10.1.10.0-24 /coreos.com/updateengine /coreos.com/updateengine/rebootlock /coreos.com/updateengine/rebootlock/semaphore è¿˜å¯ä»¥é€šè¿‡ç±»ä¼¼ Redis çš„ get ç­‰å‘½ä»¤è·å–å…·ä½“å­˜å‚¨å†…å®¹ï¼š\ncore@core-01 ~ $ etcdctl get /coreos.com/network/subnets/10.1.64.0-24 {\u0026quot;PublicIP\u0026quot;:\u0026quot;172.17.8.101\u0026quot;} åŒºåˆ«æ˜¯ Etcd æ˜¯æ”¯æŒç›®å½•çš„ï¼š\ncore@core-01 ~ $ etcdctl mkdir hello core@core-01 ~ $ etcdctl get hello /hello: is a directory core@core-01 ~ $ etcdctl rmdir hello åˆšåˆšæˆ‘ä»¬ä»‹ç»æ—¶ä¹Ÿæåˆ°ï¼ŒEtcd æ”¯æŒ HTTP æ–¹å¼è°ƒç”¨ï¼Œæ¯”å¦‚ï¼š\ncore@core-01 ~ $ curl -L -X PUT http://127.0.0.1:2379/v2/keys/message -d value=\u0026quot;Hello\u0026quot; {\u0026quot;action\u0026quot;:\u0026quot;set\u0026quot;,\u0026quot;node\u0026quot;:{\u0026quot;key\u0026quot;:\u0026quot;/message\u0026quot;,\u0026quot;value\u0026quot;:\u0026quot;Hello\u0026quot;,\u0026quot;modifiedIndex\u0026quot;:10318,\u0026quot;createdIndex\u0026quot;:10318},\u0026quot;prevNode\u0026quot;:{\u0026quot;key\u0026quot;:\u0026quot;/message\u0026quot;,\u0026quot;value\u0026quot;:\u0026quot;Hello\u0026quot;,\u0026quot;modifiedIndex\u0026quot;:10300,\u0026quot;createdIndex\u0026quot;:10300}} core@core-01 ~ $ etcdctl get /message Hello core@core-01 ~ $ curl -L -X DELETE http://127.0.0.1:2379/v2/keys/message {\u0026quot;action\u0026quot;:\u0026quot;delete\u0026quot;,\u0026quot;node\u0026quot;:{\u0026quot;key\u0026quot;:\u0026quot;/message\u0026quot;,\u0026quot;modifiedIndex\u0026quot;:10462,\u0026quot;createdIndex\u0026quot;:10318},\u0026quot;prevNode\u0026quot;:{\u0026quot;key\u0026quot;:\u0026quot;/message\u0026quot;,\u0026quot;value\u0026quot;:\u0026quot;Hello\u0026quot;,\u0026quot;modifiedIndex\u0026quot;:10318,\u0026quot;createdIndex\u0026quot;:10318}} core@core-01 ~ $ etcdctl get /message Error: 100: Key not found (/message) [10467] TTL çš„ç‰¹æ€§å¯ä»¥åœ¨è®¾ç½®çŠ¶æ€æ—¶è¿›è¡Œè®¾å®šï¼š\netcdctl set /foo \u0026quot;Expiring Soon\u0026quot; --ttl 20 è¿™ä¸ª KV å¯¹å°±ä¼šåœ¨ 20 ç§’å†…æ—¶æ•ˆã€‚\nEtcd é›†ç¾¤ç®¡ç† é™¤äº†æœ¬èº«çš„ KV æ•°æ®åº“ç‰¹æ€§å¤–ï¼Œä½œä¸ºé›†ç¾¤æœåŠ¡å‘ç°å·¥å…·æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ restful api æ–¹å¼å‘ç°å½“å‰é›†ç¾¤ä¿¡æ¯ï¼š\ncore@core-01 ~ $ curl -L http://127.0.0.1:4001/v2/stats/leader {\u0026quot;leader\u0026quot;:\u0026quot;efb737dfdc9ee528\u0026quot;,\u0026quot;followers\u0026quot;:{\u0026quot;6219cfe16536320\u0026quot;:{\u0026quot;latency\u0026quot;:{\u0026quot;current\u0026quot;:0.003561,\u0026quot;average\u0026quot;:0.0031178274017212987,\u0026quot;standardDeviation\u0026quot;:0.018016615756979302,\u0026quot;minimum\u0026quot;:9e-06,\u0026quot;maximum\u0026quot;:1.338917},\u0026quot;counts\u0026quot;:{\u0026quot;fail\u0026quot;:0,\u0026quot;success\u0026quot;:51588}},\u0026quot;a8cc28a8e121c40d\u0026quot;:{\u0026quot;latency\u0026quot;:{\u0026quot;current\u0026quot;:0.002212,\u0026quot;average\u0026quot;:0.002837358092138387,\u0026quot;standardDeviation\u0026quot;:0.015615452604769925,\u0026quot;minimum\u0026quot;:1.7e-05,\u0026quot;maximum\u0026quot;:1.48721},\u0026quot;counts\u0026quot;:{\u0026quot;fail\u0026quot;:0,\u0026quot;success\u0026quot;:51618}},\u0026quot;e44ee28dd4e590ac\u0026quot;:{\u0026quot;latency\u0026quot;:{\u0026quot;current\u0026quot;:0.001838,\u0026quot;average\u0026quot;:0.006247004906804689,\u0026quot;standardDeviation\u0026quot;:0.4458222893241591,\u0026quot;minimum\u0026quot;:9e-06,\u0026quot;maximum\u0026quot;:105.637627},\u0026quot;counts\u0026quot;:{\u0026quot;fail\u0026quot;:32,\u0026quot;success\u0026quot;:58694}}}} core@core-01 ~ $ curl -L http://127.0.0.1:4001/v2/stats/self {\u0026quot;name\u0026quot;:\u0026quot;c99fef8aac9b4a3e9d3a44f58b0739a6\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;efb737dfdc9ee528\u0026quot;,\u0026quot;state\u0026quot;:\u0026quot;StateLeader\u0026quot;,\u0026quot;startTime\u0026quot;:\u0026quot;2016-05-28T09:44:01.416629553Z\u0026quot;,\u0026quot;leaderInfo\u0026quot;:{\u0026quot;leader\u0026quot;:\u0026quot;efb737dfdc9ee528\u0026quot;,\u0026quot;uptime\u0026quot;:\u0026quot;1h59m14.023315023s\u0026quot;,\u0026quot;startTime\u0026quot;:\u0026quot;2016-05-28T09:44:44.495996231Z\u0026quot;},\u0026quot;recvAppendRequestCnt\u0026quot;:0,\u0026quot;sendAppendRequestCnt\u0026quot;:162816,\u0026quot;sendPkgRate\u0026quot;:20.004570208101516,\u0026quot;sendBandwidthRate\u0026quot;:1953.7463493742348} å…¶å®ƒçš„ç³»åˆ—é›†ç¾¤æ¥å£ï¼Œä¹Ÿå¯ä»¥åœ¨ å®˜æ–¹æ–‡æ¡£ ä¸­æŸ¥çœ‹ã€‚\nEtcd é…ç½® å¦‚æœä½ æœ‰å°è±¡åœ¨ç¬¬ä¸€ç¯‡ä¸­ï¼Œå¦‚æœä½ æ‰“å¼€ user-data æ–‡ä»¶ï¼Œä½ å°±ä¼šå‘ç° Etcd çš„è¸ªå½±ï¼š\nâœ coreos-vagrant git:(master) cat user-data #cloud-config --- coreos: etcd2: advertise-client-urls: http://$public_ipv4:2379 initial-advertise-peer-urls: http://$private_ipv4:2380 listen-client-urls: http://0.0.0.0:2379,http://0.0.0.0:4001 listen-peer-urls: http://$private_ipv4:2380,http://$private_ipv4:7001 discovery: https://discovery.etcd.io/xxxxxxxxxxxx fleet: public-ip: \u0026#34;$public_ipv4\u0026#34; flannel: interface: \u0026#34;$public_ipv4\u0026#34; .... æˆ‘ä»¬è¿™é‡Œä½¿ç”¨äº†çº¿ä¸ŠæœåŠ¡ https://discovery.etcd.io/ å‘ç°é›†ç¾¤ä¸­çš„æœºå™¨ï¼Œè¿™ä¸ªæœåŠ¡åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬åœ°å†…ç³»ç»Ÿã€‚\nåˆ©ç”¨ Etcd åˆ¶ä½œæœåŠ¡å‘ç° ä¹‹å‰æåˆ°ï¼ŒEtcd çš„ç‰¹æ€§éå¸¸æ–¹ä¾¿ç”¨åšæœåŠ¡å‘ç°ï¼Œå…·ä½“å¦‚ä½•æ“ä½œå‘¢ï¼Ÿåœ¨è°ˆå…·ä½“å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹ä¸¤ç§æœåŠ¡æ³¨å†Œæ–¹æ³•ï¼šä¸€ç§å«åš è‡ªæ³¨å†Œæ–¹æ³•ï¼›å¦å¤–ä¸€ç§å« ç¬¬ä¸‰æ–¹æ³¨å†Œæ–¹æ³•ã€‚åŒºåˆ«æ˜¯æ˜¯å¦ç”±è‡ªèº«æ¥è¿›è¡Œå¥åº·æ£€æŸ¥å’Œæé†’ã€‚å¦å¤–ï¼ŒæœåŠ¡å‘ç°é‡è¦çš„æ˜¯ï¼Œåœ¨æœåŠ¡å¤±æ•ˆæ—¶å¯ä»¥åŠæ—¶å»é™¤æ— æ•ˆæœåŠ¡ï¼Œè¿™ä¸ªåœ¨ Etcd çš„ TTL åŠŸèƒ½ä¸Šå°±ä¼šæ˜¾å¾—æ¯”è¾ƒé‡è¦ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªé”®å€¼çš„æœ‰æ•ˆæœŸä¸º 3 ç§’ï¼Œå¹¶ä¸”æ¯ç§’é’Ÿéƒ½æ¥åˆ·æ–°æˆæƒï¼Œå¦‚æœç¨‹åºå¼‚å¸¸é€€å‡ºæˆ–è€…åˆ·æ–°ä¸åŠæ—¶ï¼Œé‚£ä¹ˆè¿™ä¸ªæœåŠ¡ç®€ç›´å°±ä¼šå¤±æ•ˆã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±å¯ä»¥æœ‰æ•ˆéªŒè¯æœåŠ¡æ˜¯å¦æœ‰æ•ˆã€‚\nå…·ä½“çš„ä»£ç å°±ä¸å†é¢å¤–ç»™å‡ºäº†ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±åŠ¨æ‰‹å®ç°ä¸€ä¸‹ã€‚å¦å¤–ï¼Œå…¶å®æœåŠ¡å‘ç°è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æ˜¯æä¾›è‡ªèº«å·¥ä½œçš„åœ°å€ç«¯å£ä¿¡æ¯ï¼Œè¿™äº›å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’åˆ°å®¹å™¨çš„æ³¨å†Œè¿‡ç¨‹ä¸­å»ï¼Œè¿™ä¸ªä¹Ÿæ˜¯èƒ½å¤Ÿè®©è´Ÿè½½å‡è¡¡æˆ–è€… WebService æœåŠ¡å™¨å¯ä»¥è¯†åˆ«æœåŠ¡çš„é‡è¦æ‰‹æ®µã€‚æ¯”å¦‚ Nginx å¯ä»¥åœ¨æ ¹æ®æœåŠ¡æ³¨å†Œä¿¡æ¯å®šæœŸæ›´æ–°è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼Œåˆ©ç”¨é‡è½½ä¿è¯ä¸é—´æ–­çš„æœåŠ¡è¿è¡Œã€‚\n","date":"2016-05-31T09:13:00Z","permalink":"https://www.4async.com/2016/05/2016-05-31-learning-coreos-part3/","title":"CoreOS æŠ˜è…¾ç¬”è®°ï¼ˆä¸‰ï¼‰äº†è§£ Etcd"},{"content":"å¦‚æœè¦è¯´ä»€ä¹ˆæ ·å­çš„åˆ†å¸ƒå¼é›†ç¾¤å¯¹ç”¨æˆ·æ˜¯æœ€å‹å¥½çš„ï¼Œé‚£æ— ç–‘æ˜¯å¯¹å®¢æˆ·æ¥è¯´ï¼Œåƒæœ¬åœ°æ‰§è¡Œå‘½ä»¤ä¸€æ ·æ–¹ä¾¿çš„æ‰§è¡Œé›†ç¾¤å‘½ä»¤è‚¯å®šæ˜¯æœ€èˆ’æœçš„äº†ã€‚è¿™ä¸ªæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ é›†ç¾¤éƒ¨ç½² é‡Œé¢å°±æåˆ°äº†ä¸€ä¸ªå«åš \u0026ldquo;fleetctl\u0026rdquo; çš„å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤æ˜¯åšä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿ\nfleet æ˜¯ä»€ä¹ˆ å·¥å…· fleet æ˜¯ä¸€ä¸ªåœ¨é›†ç¾¤å±‚é¢ä¸Šçš„ systemd ç®¡ç†å·¥å…·ã€‚å®ƒçš„é…ç½®æ–‡ä»¶è¯­æ³•åŸºäº systemd çš„è¯­æ³•ï¼Œå¦å¤–æ·»åŠ äº†ä¸€äº›è‡ªæœ‰çš„å±æ€§ã€‚å¦‚æœä½ å¸Œæœ›åœ¨é›†ç¾¤ä¸­è¿è¡Œä½ çš„æœåŠ¡ï¼Œé‚£ä¹ˆä½¿ç”¨ fleet ç®¡ç† systemd å•å…ƒæ˜¯å†æœ‰å¿…è¦ä¸è¿‡çš„äº†ã€‚\nåœ¨æ¯”è¾ƒæ–°çš„ç³»ç»Ÿ (CentOS 7+ã€Ubuntu 16+ã€Debian 8+) ä¸­å‡é‡‡ç”¨äº† systemd ä½œä¸ºå¯åŠ¨é¡¹ç®¡ç†å·¥å…·ã€‚å¦‚æœä½ å¯¹ systemd æœ‰ç–‘é—®çš„è¯ï¼Œè¯·åˆ°å…¶ å®˜æ–¹ç½‘ç«™ æŸ¥çœ‹å…·ä½“çš„ä»‹ç»ï¼Œè¿™é‡Œä¸åšèµ˜è¿°ã€‚\nä¹‹å‰ä½¿ç”¨çš„ fleetctl å°±æ˜¯ fleet çš„ç®¡ç†å·¥å…·ï¼Œé»˜è®¤æ˜¯åœ¨é›†ç¾¤ä¸­çš„æŸå°æœºå™¨ä¸Šè¿›è¡Œç®¡ç†ã€‚å½“ç„¶ï¼Œfleetctl åŒæ ·ä¹Ÿå¯ä»¥é€šè¿‡è¿œç¨‹è¿›è¡Œç®¡ç†ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿æ¥è¿œç¨‹é›†ç¾¤ã€‚\nFLEETCTL_ENDPOINT=http://\u0026lt;IP:[PORT]\u0026gt; fleetctl list-units fleetctl å¸¸è§å‘½ä»¤ æ¯”è¾ƒå¸¸è§çš„ fleetctl å‘½ä»¤æœ‰ï¼š\ncore@core-01 ~ $ fleetctl -h ... COMMANDS: cat\tæŸ¥çœ‹å·²ç»æäº¤çš„å•å…ƒæ–‡ä»¶å†…å®¹ destroy\té”€æ¯é›†ç¾¤ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒ fd-forward\tå°†æ ‡å‡†è¾“å…¥è¾“å‡ºè½¬å‘åˆ°ä¸€ä¸ª unix socket ä¸­ journal\tå°†é›†ç¾¤ä¸­çš„æŸä¸ª unit çš„æ—¥å¿—è¾“å‡ºåˆ°å½“å‰ list-machines\tæŸ¥çœ‹é›†ç¾¤ä¸­çš„å·²çŸ¥æœºå™¨ list-unit-files\tæŸ¥çœ‹é›†ç¾¤ä¸­å­˜åœ¨çš„å•å…ƒ list-units\tæŸ¥çœ‹é›†ç¾¤ä¸­çš„å•å…ƒçŠ¶æ€ load\tå°†ä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒåŠ è½½åˆ°é›†ç¾¤ä¸­ï¼Œå¿…è¦æ—¶ä¼šå…ˆæ‰§è¡Œ submit åŠŸèƒ½ ssh\tè¿æ¥åˆ°é›†ç¾¤ä¸­çš„æŸå°æœºå™¨ start\tå¯åŠ¨é›†ç¾¤ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒï¼Œå¿…è¦æ—¶ä¼šå…ˆæ‰§è¡Œ submit å’Œ load åŠŸèƒ½ status\tè¾“å‡ºé›†ç¾¤ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒçš„çŠ¶æ€ stop\tåœæ­¢é›†ç¾¤ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒ submit\tä¸Šä¼ ä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒåˆ°é›†ç¾¤ä¸­ï¼Œå¹¶ä¸ä¼šåŠ è½½æ‰§è¡Œ unload\tå¸è½½é›†ç¾¤ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒ fleet å•å…ƒæ–‡ä»¶ ä»¥ä¸€ä¸ª Hello World ç¨‹åºä½œä¸ºæ¼”ç¤ºæ¥è®²è§£ï¼š\n[Unit] Description=Echo Hello World After=docker.service Requires=docker.service [Service] TimeoutStartSec=0 ExecStartPre=-/usr/bin/docker kill busybox ExecStartPre=-/usr/bin/docker rm busybox ExecStartPre=/usr/bin/docker pull busybox ExecStart=/usr/bin/docker run --name busybox busybox /bin/sh -c \u0026#34;trap\u0026#39;exit 0\u0026#39;INT TERM; while true; do echo Hello World; sleep 1; done\u0026#34; ExecStop=/usr/bin/docker stop busybox çœ‹èµ·æ¥åŸºæœ¬ä¸ systemd è¯­æ³•ä¸€è‡´ã€‚ä¿å­˜æˆ helloworld.serviceï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ï¼š\ncore@core-01 ~ $ fleetctl start helloworld.service Unit helloworld.service inactive Unit helloworld.service launched on 6e1b9fae.../172.17.8.104 å¯ä»¥é€šè¿‡ fleetctl æŸ¥çœ‹çŠ¶æ€ï¼š\ncore@core-01 ~ $ fleetctl list-units UNIT\tMACHINE\tACTIVE\tSUB helloworld.service\t6e1b9fae.../172.17.8.104\tactive\trunning core@core-01 ~ $ fleetctl list-unit-files UNIT\tHASH\tDSTATE\tSTATE\tTARGET helloworld.service\tce68bd4\tlaunched\tlaunched\t6e1b9fae.../172.17.8.104 åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡ fleetctl journal æŸ¥çœ‹ç¨‹åºæ˜¯å¦æ­£å¸¸è¿è¡Œäº†ã€‚\ncore@core-01 ~ $ fleetctl journal helloworld The authenticity of host '172.17.8.104' can't be established. ECDSA key fingerprint is 11:63:ee:93:e4:b9:5e:06:e9:c6:cd:63:e2:df:ef:9e. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added '172.17.8.104' (ECDSA) to the list of known hosts. -- Logs begin at Sat 2016-05-28 08:45:39 UTC, end at Sat 2016-05-28 10:09:13 UTC. -- May 28 10:09:04 core-04 docker[1163]: Hello World May 28 10:09:05 core-04 docker[1163]: Hello World May 28 10:09:06 core-04 docker[1163]: Hello World May 28 10:09:07 core-04 docker[1163]: Hello World May 28 10:09:08 core-04 docker[1163]: Hello World May 28 10:09:09 core-04 docker[1163]: Hello World May 28 10:09:10 core-04 docker[1163]: Hello World May 28 10:09:11 core-04 docker[1163]: Hello World May 28 10:09:12 core-04 docker[1163]: Hello World May 28 10:09:13 core-04 docker[1163]: Hello World é€šè¿‡ fleet å•å…ƒæ–‡ä»¶å®ç°é«˜å¯ç”¨æœåŠ¡ å®ç°é«˜å¯ç”¨æœåŠ¡éœ€è¦å¤šä¸ªæœåŠ¡å®ä¾‹ï¼šå½“å…¶ä¸­ä¸€ä¸ªæœåŠ¡å®ä¾‹å‡ºç°é—®é¢˜æ—¶ï¼Œä¸ä¼šå¹²æ‰°å…¶å®ƒæœåŠ¡å®ä¾‹çš„è¿è¡Œã€‚è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„å•å…ƒæ–‡ä»¶ï¼Œä½†æ˜¯éœ€è¦åšé¢å¤–çš„ä¿®æ”¹è®©å…¶æ”¯æŒå¤šå®ä¾‹è¿è¡Œï¼š\n[Unit] Description=Echo Hello World After=docker.service Requires=docker.service [Service] TimeoutStartSec=0 ExecStartPre=-/usr/bin/docker kill busybox ExecStartPre=-/usr/bin/docker rm busybox ExecStartPre=/usr/bin/docker pull busybox ExecStart=/usr/bin/docker run --name busybox busybox /bin/sh -c \u0026#34;trap\u0026#39;exit 0\u0026#39;INT TERM; while true; do echo Hello World; sleep 1; done\u0026#34; ExecStop=/usr/bin/docker stop busybox [X-Fleet] Conflicts=helloworld@*.service æœ€åæ–°å¢çš„å†…å®¹æ˜¯ fleet çš„ä¸“å±è¯­æ³•ï¼Œä½¿ç”¨ Conflicts å¯ä»¥é™å®šæ¯å°æœºå™¨ä¸Šä»…å…è®¸ä¸€ä¸ª helloworld æœåŠ¡è¿è¡Œã€‚\ncore@core-01 ~ $ fleetctl stop helloworld Unit helloworld.service loaded on 6e1b9fae.../172.17.8.104 core@core-01 ~ $ fleetctl unload helloworld Unit helloworld.service inactive core@core-01 ~ $ mv helloworld.service helloworld@.service core@core-01 ~ $ fleetctl start helloworld@1 Unit helloworld@1.service inactive Unit helloworld@1.service launched on 6e1b9fae.../172.17.8.104 core@core-01 ~ $ fleetctl start helloworld@2 Unit helloworld@2.service inactive Unit helloworld@2.service launched on 91060182.../172.17.8.103 core@core-01 ~ $ fleetctl start helloworld@3 Unit helloworld@3.service inactive Unit helloworld@3.service launched on af1494a6.../172.17.8.102 core@core-01 ~ $ fleetctl start helloworld@4 Unit helloworld@4.service inactive Unit helloworld@4.service launched on c99fef8a.../172.17.8.101 core@core-01 ~ $ fleetctl list-unit-files UNIT\tHASH\tDSTATE\tSTATE\tTARGET helloworld.service\tce68bd4\tinactive\tinactive\t- helloworld@1.service\tce68bd4\tlaunched\tlaunched\t6e1b9fae.../172.17.8.104 helloworld@2.service\tce68bd4\tlaunched\tlaunched\t91060182.../172.17.8.103 helloworld@3.service\tce68bd4\tlaunched\tlaunched\taf1494a6.../172.17.8.102 helloworld@4.service\tce68bd4\tlaunched\tlaunched\tc99fef8a.../172.17.8.101 å¸è½½ä¹‹å‰çš„ helloworldï¼Œæ‰§è¡Œäº†æ–°çš„ 4 ä¸ªå®ä¾‹ï¼Œé€šè¿‡è§‚å¯Ÿå¯ä»¥çœ‹åˆ°ç›®å‰å®ä¾‹éƒ½æ˜¯è¿è¡Œåœ¨äº† 4 å°ä¸åŒæœºå™¨ä¸Šã€‚\nfleet çš„ä¸€äº›ç–‘é—® äº‹å®ä¸Šï¼Œé€šè¿‡ fleetï¼Œå¯ä»¥å°†æœåŠ¡è¿›è¡Œå¤šå‰¯æœ¬éƒ¨ç½²ï¼ŒåŒæ—¶é€šè¿‡ fleet å®ˆæŠ¤ç¨‹åºçš„æ­£å¸¸è¿è¡Œã€‚ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨ä¸­ä½ ä¼šå‘ç°æœ‰ä¸€ä¸ªå®é™…é—®é¢˜ï¼Œåœ¨å¾®æœåŠ¡åŒ–åœºæ™¯ä¸­ï¼Œæ¯ä¸ªæœåŠ¡éƒ¨ç½²çš„æœºå™¨æ˜¯æ— æ³•æ§åˆ¶çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆçŸ¥é“æœåŠ¡ç©¶ç«Ÿåœ¨å“ªå‘¢ï¼Ÿ\nå¦‚ä½•æ§åˆ¶æµé‡æµå‘ï¼Œæˆ–è€…è¯´æœåŠ¡å‘ç°é—®é¢˜ï¼Œè¿™ä¸ªæˆ‘ä¼šåœ¨ä¸‹ä¸€ä¸ª Etcd çš„ä»‹ç»ä¸­è¯´ä¸€ä¸‹ï¼Œæ•¬è¯·æœŸå¾…ã€‚\n","date":"2016-05-28T18:00:00Z","permalink":"https://www.4async.com/2016/05/2016-05-28-learning-coreos-part2/","title":"CoreOS æŠ˜è…¾ç¬”è®°ï¼ˆäºŒï¼‰Fleet è¿›é˜¶"},{"content":"æœ€è¿‘åœ¨æŠ€æ”¹å®Œæˆä¹‹åæ‰“ç®—è¿›è¡Œå¤§é‡çš„å¾®æœåŠ¡åŒ–æ”¹é€ ï¼Œè€Œæ–¹ä¾¿è¿›è¡Œå¾®æœåŠ¡åŒ–çš„æ­¥éª¤ä¹‹ä¸€ï¼Œå°±æ˜¯å°†ç°æœ‰çš„ç³»ç»Ÿç§»æ¤è¿›å…¥ Docker ç¯å¢ƒä¹‹ä¸­ã€‚åœ¨æ ‡å‡†å®¹å™¨ç³»ç»Ÿçš„é€‰æ‹©ä¸Šï¼Œæˆ‘æŠŠç›®å…‰æ”¾åœ¨äº† CoreOS ä¸Šã€‚å®é™…ä¸Šï¼Œæˆ‘åœ¨ CoreOS ç‰ˆæœ¬è¿˜æ˜¯ 2 å¼€å¤´çš„æ—¶å€™å°±æœ‰ç®€å•ç ”ç©¶è¿‡ï¼Œä½†æ˜¯å½“æ—¶ä¸»è¦ä½œä¸ºç ”ç©¶ Docker çš„é€”å¾„ï¼Œç°åœ¨åˆ™æ˜¯ä½œä¸ºé›†ç¾¤åŒ–éƒ¨ç½²çš„åŸºå‡†ç³»ç»Ÿã€‚ä»æœ¬æ–‡å¼€å§‹çš„ä¸€ç³»åˆ—æŠ˜è…¾åˆ™æ˜¯æˆ‘åœ¨ç ”ç©¶ CoreOS é›†ç¾¤åŒ–ä½¿ç”¨çš„ä¸€äº›çºªå½•ï¼Œè€Œæœ¬æ–‡å°±æ˜¯ä»‹ç»ä¸€ä¸ªæœ¬åœ°å®ç°å®¹å™¨åŒ–æœºç¾¤çš„æ­¥éª¤ã€‚\nå®‰è£… Vagrant ç•¥ï¼Œå› ä¸ºå¤ªç®€å•äº†ã€‚å¦å¤–è¿˜éœ€è¦ VirtualBoxï¼Œä¸è¦å¿˜è®°è£…ã€‚\né…ç½® CoreOS-vagrant æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ngit clone https://github.com/coreos/coreos-vagrant.git cd coreos-vagrant ä¸‹è½½ CoreOS çš„ vagrant é…ç½®ã€‚å€¼å¾—åœ¨è¿›å…¥æ­£å¼é…ç½®ä¹‹å‰ä¸€æçš„æ˜¯ï¼ŒCoreOS æœ¬èº«æ˜¯æ²¡æœ‰é»˜è®¤å¯†ç æˆ–è€…å®‰è£…å¯†ç æœºåˆ¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç°æœ‰çš„æ‰€æœ‰è®¤è¯ç™»å½•éœ€è¦é€šè¿‡ SSH è¿›è¡Œã€‚å¦‚æœæ˜¯é€šè¿‡ vagrant å®‰è£…ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆç™»å½•éœ€è¦çš„ SSH å¯†é’¥ï¼Œè¿™ä¸ªæ˜¯éœ€è¦é¢å¤–æ³¨æ„çš„å†…å®¹ã€‚\né¦–å…ˆï¼Œå°†ä»“åº“ä¸­æä¾›çš„ä¸¤ä¸ªæ¨¡ç‰ˆé…ç½®æ–‡ä»¶å¤åˆ¶æˆæ­£å¼ï¼Œæ¥ä¸‹æ¥éœ€è¦ä¿®æ”¹å¯¹åº”çš„æ–‡ä»¶ï¼š\ncp config.rb.sample config.rb cp user-data.sample user-data é¦–å…ˆä¿®æ”¹ config.rb æ–‡ä»¶ã€‚è¿™é‡Œé‡ç‚¹æ˜¯ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å¯åŠ¨çš„å®ä¾‹æ•°é‡ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å‡çº§çš„ç‰ˆæœ¬ï¼Œæˆ‘ä¿®æ”¹æˆäº†\n$num_instances=4 $update_channel=\u0026#39;stable\u0026#39; å¯åŠ¨ 4 ä¸ªå®ä¾‹ï¼Œå‡çº§é€‰æ‹©çš„ç‰ˆæœ¬åˆ™æ˜¯æœˆåº¦å‡çº§ç‰ˆã€‚å¦å¤–ä¸€ä¸ª user-data æš‚æ—¶ä¸ä½œä¿®æ”¹ã€‚\næ¥ä¸‹æ¥æ‰§è¡Œï¼š\nvagrant up åœ¨ä¸€å †è¾“å‡ºä¹‹åï¼Œç”Ÿæˆçš„ 4 ä¸ªå®ä¾‹å°±å·²ç»åœ¨è¿è¡Œäº†ã€‚ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤ vagrant status æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ã€‚\nâœ coreos-vagrant git:(master) vagrant status Current machine states: core-01 running (virtualbox) core-02 running (virtualbox) core-03 running (virtualbox) core-04 running (virtualbox) This environment represents multiple VMs. The VMs are all listed above with their current state. For more information about a specific VM, run `vagrant status NAME`. æ¥ä¸‹æ¥éœ€è¦æŠŠ SSH å¯†é’¥æ·»åŠ åˆ° SSH å¯ä»¥è¯†åˆ«çš„è·¯å¾„ä¸­ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ ssh -i æ¯æ¬¡æŒ‡å®š keyã€‚\nâœ coreos-vagrant git:(master) ssh-add ~/.vagrant.d/insecure_private_key Identity added: /Users/user/.vagrant.d/insecure_private_key (/Users/user/.vagrant.d/insecure_private_key) âœ coreos-vagrant git:(master) vagrant ssh core-01 -- -A CoreOS stable (1010.5.0) core@core-01 ~ $ è¿™é‡Œçš„ -- -A å‰ä¸¤çš„ä¸ªæ¨ªæ†è¡¨ç¤º ssh å‚æ•°çš„èµ·å§‹ã€‚ä¹‹åçš„ -A æ˜¯æ ‡å‡†çš„ SSH å‘½ä»¤å‚æ•°ï¼Œè¡¨ç¤ºå°†ä¸»æœºçš„ SSH ç§˜é’¥ä¼ é€’åˆ°è™šæ‹Ÿæœºé‡Œé¢ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†ä¹‹åçš„æ¶‰åŠ SSH æ“ä½œæ›´åŠ æ–¹ä¾¿ï¼Œå¦åˆ™ä¼šåœ¨æŸäº›å‘½ä»¤æ—¶æŠ¥é”™ã€‚\nè¿›å…¥ CoreOS ä¹‹åï¼Œå°±å¯ä»¥æŸ¥çœ‹ç°åœ¨é›†ç¾¤ä¸­çš„æœºå™¨ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼š\ncore@core-01 ~ $ fleetctl list-machines MACHINE\tIP\tMETADATA 6e1b9fae...\t172.17.8.104\t- 91060182...\t172.17.8.103\t- af1494a6...\t172.17.8.102\t- c99fef8a...\t172.17.8.101\t- æŸ¥çœ‹è®¾å¤‡æ˜¯å¦æ­£å¸¸åŠ å…¥ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿çš„ç™»å½•å…¶å®ƒç³»ç»Ÿï¼š\ncore@core-01 ~ $ fleetctl ssh -machine af1494a6 The authenticity of host '172.17.8.102' can't be established. ECDSA key fingerprint is 24:34:be:4e:b7:43:be:94:34:33:b2:81:e0:0c:08:9d. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added '172.17.8.102' (ECDSA) to the list of known hosts. CoreOS stable (1010.5.0) core@core-02 ~ $ exit logout è¿™æ ·æˆ‘ä»¬çš„ç¬¬ä¸€æ­¥ï¼Œä½¿ç”¨ CoreOS éƒ¨ç½²æœ¬åœ°é›†ç¾¤å°±å·²ç»å®ç°äº†ã€‚\næœ€åï¼Œå¦‚æœéœ€è¦å…³é—­è¿™äº› CoreOS å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡ vagrant halt åœæ­¢æ‰€æœ‰ï¼Œä¸‹æ¬¡å¯ä»¥é€šè¿‡ vagrant up å°±å¯ä»¥é‡æ–°å¯åŠ¨äº†ã€‚\n","date":"2016-05-28T17:00:00Z","permalink":"https://www.4async.com/2016/05/2016-05-28-learning-coreos-part1/","title":"CoreOS æŠ˜è…¾ç¬”è®°ï¼ˆä¸€ï¼‰é›†ç¾¤éƒ¨ç½²"},{"content":"ä¹‹å‰ä½œä¸º Docker beta çš„ç¬¬ä¸€æ‰¹ç”¨æˆ·è·å¾—äº† beta çš„æˆæƒï¼Œä½†æ˜¯å› ä¸ºé‚®ä»¶è¿›äº†åƒåœ¾é‚®ä»¶ï¼Œæ‰€ä»¥ä¸€ç›´æ²¡æœ‰å‘ç°ã€‚ä»Šå¤©ç»™ Docker å‘é‚®ä»¶ç”³è¯· beta æµ‹è¯•æ‰çŸ¥é“å·²ç»é€šè¿‡äº†ï¼Œèµ¶ç´§å°é²œèµ·æ¥ã€‚å¦‚æœä½ æ²¡æœ‰æƒé™ï¼Œå¯ä»¥å°è¯•åˆ° Docker Beta ç”³è¯·æµ‹è¯•èµ„æ ¼ã€‚\næµ‹è¯•ç‰ˆæœ¬å¯èƒ½å­˜åœ¨é£é™©ï¼Œè¯·è‡ªè¡Œåˆ¤æ–­ã€‚\nå®‰è£…ä¹‹å‰ Docker for Mac éœ€è¦ä¸€äº›å‰ç½®è¦æ±‚ï¼Œå®˜æ–¹æ–‡æ¡£æä¾›çš„æ•°æ®å¦‚ä¸‹ï¼š\n 2010 å¹´ä¹‹åçš„ Intel Mac æœºå‹ï¼Œæ”¯æŒ MMU(Memory Management Unit) è™šæ‹ŸåŒ–ã€EPT(Extended Page Table) ç­‰ç‰¹æ€§ OSX 10.10.3 ä»¥ä¸Šç³»ç»Ÿ è‡³å°‘ 4GB å†…å­˜ VirtualBox 4.x ä¸ Docker for Mac å†²çªï¼Œå› æ­¤å¦‚æœä½ å®‰è£…è¿™ä¸ªç³»åˆ—çš„ Virtualbox éœ€è¦å¸è½½ã€‚  å¦‚æœä¹‹å‰è£…è¿‡ Docker Toolbox çš„è¯ï¼Œéœ€è¦ä¸€äº›é¢å¤–çš„æ“ä½œå»ä¸ Docker Toolbox å…¼å®¹ã€‚ï¼ˆæˆ‘é€‰æ‹©äº†ç›´æ¥å¸è½½ç°æœ‰çš„ Docker Toolboxã€‚XD ï¼‰\nå®‰è£… Docker for Mac Docker for Mac æ˜¯ä¸€ä¸ª 98.3M(Mac æ˜¾ç¤ºä¸º 103.1MB) çš„ DMG æ–‡ä»¶ï¼Œä¸‹è½½ä¸‹æ¥ä¹‹ååŒå‡»æ–‡ä»¶ï¼Œå°†é²¸é±¼æ‹–æ‹½åˆ° Applications æ–‡ä»¶å¤¹ä¸­å³å¯ã€‚\nç¬¬ä¸€æ¬¡æ‰“å¼€ Docker for Mac éœ€è¦æä¾›é‚€è¯·ç ï¼ŒåŒæ—¶éœ€è¦ç‰¹æ®Šæƒé™å†™å…¥ Docker bin æ–‡ä»¶ã€‚\nDocker for Mac åŒ…å«äº† Docker å¼•æ“ï¼ŒDocker å‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼ŒDocker Compose å’Œ Docker Machineã€‚ä¹‹ååŒå‡»åº”ç”¨ç¨‹åºä¸­çš„ Docker å°±å¯ä»¥å¯ç”¨å¼•æ“ï¼Œè¿™æ—¶ï¼Œå³ä¸Šè§’ä¼šæœ‰ä¸€ä¸ªé²¸é±¼çš„æ ‡å¿—ã€‚\nç‚¹å‡»æ ‡è®°å¯ä»¥è·å¾—èœå•ï¼Œè¿›è¡Œè®¾ç½®ï¼ŒæŸ¥çœ‹æ—¥å¿—ç­‰ç­‰ä¿¡æ¯ã€‚\nç‚¹å‡»æ£€æŸ¥æ›´æ–°å¯ä»¥éªŒè¯å½“å‰æ˜¯å¦ä¸ºæœ€æ–°ç‰ˆæœ¬çš„ Docker for Macã€‚\nDocker for mac å°é²œ å…ˆçœ‹ä¸€ä¸‹ Docker çš„è®¾ç½®ï¼Œå¯ä»¥è®¾ç½®ä½¿ç”¨çš„å†…å­˜å¯ç”¨æ–¹å¼ï¼Œæ˜¯å¦å¯ç”¨ VPN å…¼å®¹æ¨¡å¼ (ç°åœ¨æˆ‘çœ‹è®ºå›æœ‰äººæåˆ°ä¼šä¸å…¼å®¹ Cisco AnyConnect)ï¼Œç¦ç”¨ VM çš„æ—¶å…‰æœºå¤‡ä»½åŠŸèƒ½ã€‚å¦å¤–å¯ä»¥åœ¨è¿™é‡Œæä¾›äº†ç›´æ¥å¸è½½æŒ‰é’®ï¼Œä¸æƒ³ç”¨çš„æ—¶å€™ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚\né™„å¸¦çš„è½¯ä»¶ç‰ˆæœ¬ä¹Ÿæ˜¯æ–°çš„ Docker è½¯ä»¶ï¼š\nâœ ~ docker -v Docker version 1.11.0, build 4dc5990 âœ ~ docker-compose --version docker-compose version 1.7.0, build 0d7bf73 âœ ~ docker-machine --version docker-machine version 0.7.0, build a650a40 è·‘ä¸€ä¸ª Ubuntu æµ‹è¯•ä¸€ä¸‹ï¼š\nâœ ~ docker run -i -t --name ubuntu ubuntu:16.04 /bin/bash root@d5ceb77516bf:/# uname -a Linux d5ceb77516bf 4.4.6 #1 SMP Mon Apr 18 19:18:15 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux root@d5ceb77516bf:/# æˆ‘å‘ç°ä¸€ç›´ä¸æ€ä¹ˆä¼šå†™ç»“å°¾ï¼ç»“è®ºï¼Œé‚£ä¹ˆæœ€åæ‰¯ä¸ªè›‹ï¼šæˆ‘ä»¬åœ¨è¿›è¡Œ Docker åœ¨ CI/CDã€çº¿ä¸Šç¯å¢ƒä¸­çš„åº”ç”¨æ‘¸ç´¢ï¼Œå¦‚æœä½ æœ‰å…´è¶£äº¤æµï¼Œæ¬¢è¿è”ç³» kevin \u0026lt;at\u0026gt; yeeuu \u0026lt;dot\u0026gt; comã€‚\n","date":"2016-04-26T18:00:00Z","permalink":"https://www.4async.com/2016/04/2016-04-26-docker-for-mac-beta/","title":"Docker for Mac å°é²œ"},{"content":"ç›®å‰æˆ‘ä»¬æœ‰å¤§é‡çš„åº”ç”¨é‡‡ç”¨äº† Golang ç¨‹åºè¿›è¡Œæ„å»ºï¼Œä½†æ˜¯åœ¨æ‰§è¡Œç ”å‘æµç¨‹é‡Œæˆ‘ä»¬ä¼šå‘ç°ä¸€äº›æ¥è‡ªäºé™æ€ç¼–è¯‘ç¨‹åºçš„ä¸ä¾¿ï¼šç›¸å¯¹äºæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„ Python è¯­è¨€ç¨‹åºè€Œè¨€ï¼Œæˆ‘ä»¬æ— æ³•åœ¨ç¨‹åºåŠŸèƒ½çš„å•å…ƒæµ‹è¯•é‡Œå¤§é‡çš„ä½¿ç”¨ Mock æ–¹å¼æ¥è¿›è¡Œé«˜æ•ˆæµ‹è¯•ã€‚\nè€Œè¿™äº›ä¸œè¥¿å¾€å¾€å¯ä»¥åœ¨å¼€å‘äººå‘˜ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹æ—¶æœ‰æ•ˆçš„èŠ‚çœæ—¶é—´å’Œä¸€äº›é¢å¤–çš„ç¯å¢ƒå‡†å¤‡æˆæœ¬ã€‚å› æ­¤ï¼Œè¿™ä¹Ÿç»™æˆ‘ä»¬çš„ç¨‹åºçš„å•å…ƒè¦†ç›–ç‡å¸¦æ¥äº†å¾ˆå¤šéº»çƒ¦çš„åœ°æ–¹ï¼šä¸€äº›ä¾èµ–äºé¢å¤–éªŒè¯å’Œè¡¨ç°çš„æƒ…å†µæˆ–è€…å°å‡ ç‡å‡ºç°çš„æƒ…å†µéœ€è¦å¤æ‚çš„æ¨¡æ‹Ÿæ­¥éª¤ï¼Œå¯¹å¼€å‘è¿›åº¦å’Œæ•ˆç‡å¸¦æ¥äº†ä¸€äº›é¢å¤–çš„å½±å“ã€‚å¦‚ä½•ç¼–å†™ä¸€ä¸ªæµ‹è¯•å‹å¥½çš„ Golang ç¨‹åºæˆä¸ºä¸€ä¸ªæ— æ³•ç»•å¼€çš„é—®é¢˜ã€‚\nä»åŠ¨æ€è¯­è¨€åˆ°é™æ€è¯­è¨€ åŠ¨æ€è¯­è¨€æœ‰è‰¯å¥½çš„è¿è¡Œæ—¶ä¿®æ”¹å±æ€§ï¼Œåœ¨è¿è¡Œæ—¶çš„åŠ¨æ€ä¿®æ”¹å‡½æ•°ï¼Œå¯ä»¥è¿›è¡Œæœ‰æ•ˆçš„ Mockã€‚æ¯”å¦‚åœ¨ Pythonï¼ˆä»¥ 3 ä¸ºä¾‹ï¼Œå†…ç½®äº† unittest.mock æ ‡å‡†åº“ï¼‰ç¨‹åºä¸­:\nwith patch.object(ProductionClass,\u0026#39;method\u0026#39;, return_value=None) as mock_method: thing = ProductionClass() thing.method(1, 2, 3) è‡ªç„¶è€Œç„¶çš„ï¼Œæˆ‘ä»¬æƒ³åˆ°äº†è¿™æ ·çš„ç”¨æ³•ï¼š\nvar imp = func() bool {return true} func TestFunc(t *testing.T) {defer func(org func() bool) {imp = org}(imp) img = func() bool {return false} // testing or something else... } è¿™æ ·å®ç° Mock æ˜¯å®Œå…¨å¯ä»¥çš„ï¼Œä½†æ˜¯å®é™…ä¸Šä¼šå¸¦æ¥ä¸€äº›é¢å¤–çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´åœ¨ MVC æ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬æ­£å¸¸é‡‡ç”¨çš„æ–¹å¼ä¸€èˆ¬æ˜¯è¿™æ ·çš„ï¼š\nimport (\u0026#34;models\u0026#34; ... ) func A(ctx Context) error { ... data := models.Data() ... } è¿™ç§æ–¹å¼åˆ™æ˜¯æ— æ³•åœ¨è¿è¡Œä¸­è¿›è¡ŒåŠ¨æ€ Mock çš„ï¼Œé™¤éå°†å…¶è½¬æ¢ä¸ºå‚æ•°æ–¹å¼è¿›è¡Œè°ƒç”¨ã€‚\nfunc TestFunc(t *testing.T) {Convey(\u0026#34;test\u0026#34;, t, func() {defer func(org func() string) {models.Data = org // Error: cannot assign to models.Data}(models.Data)  models.Data = func() string {return\u0026#34;mocked!\u0026#34;} .... }) } è½¬æˆ\n// var data = models.Data // in A: data := data()  func TestFunc(t *testing.T) {Convey(\u0026#34;test\u0026#34;, t, func() {defer func(org func() string) {data = org}(data) data = func() string {return\u0026#34;mocked!\u0026#34;}}) } è¿™æ ·å†™æ³•ç•¥å¾®ä¼šå¤šå¤„å¤§é‡çš„ä¸´æ—¶å‡½æ•°æŒ‡é’ˆå˜é‡ï¼Œå¦‚æœæ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼åˆ™éœ€è¦é¢å¤–çš„å˜é‡å€¼çš„å¯¹åº”å…³ç³»ï¼Œæµ‹è¯•å®Œæˆåå˜é‡å€¼éœ€è¦æ¢å¤æˆåŸæœ‰æŒ‡é’ˆï¼ˆå¦‚æœéœ€è¦æµ‹è¯•æ­£å¸¸åŠŸèƒ½ï¼‰ã€‚\nä»å˜é‡åˆ°æ¥å£ é™¤äº†ä¸Šé¢ä»‹ç»çš„æ–¹æ³•ä»¥å¤–ï¼Œæ˜¯ä¸æ˜¯è¿˜æœ‰çœ‹èµ·æ¥ç¨å¾®ä¼˜é›…ä¸€ç‚¹çš„æµ‹è¯•æ–¹æ³•å‘¢ï¼Ÿæˆ‘ä»¬å°è¯•å°†ä¸Šé¢çš„å‡½æ•°å½¢å¼æ¢æˆä¸‹é¢çš„æ¥å£å½¢å¼ï¼Œå°† interface å¯¹åº”çš„å˜é‡ä½œä¸ºå…¨å±€å˜é‡ã€‚\n// main.go var fetcher DataFetcherInterface type DataFetcherInterface interface {Data() string } type DataFetcher struct { } func (d DataFetcher) Data() string {return\u0026#34;hello world!\u0026#34;} func Func(w http.ResponseWriter, r *http.Request) {fmt.Fprintf(w,\u0026#34;%s\u0026#34;, fetcher.Data()) } func main() {fetcher = DataFetcher{} http.HandleFunc(\u0026#34;/\u0026#34;, Func) http.ListenAndServe(\u0026#34;127.0.0.1:12821\u0026#34;, nil) } è¿™æ ·çš„è¯æˆ‘ä»¬å°±å¯ä»¥åœ¨æµ‹è¯•æ–‡ä»¶é‡Œé¢å®šä¹‰ä¸€ä¸ª FakeDataFetcherï¼Œå®ç°ç›¸å…³çš„åŠŸèƒ½ï¼š\n// main_test.go type FakeDataFetcher struct { } func (f FakeDataFetcher) Data() string {return\u0026#34;mocked!\u0026#34;} func TestFunc(t *testing.T) {Convey(\u0026#34;test\u0026#34;, t, func() {defer func(org DataFetcherInterface) {fetcher = org}(fetcher) fetcher = FakeDataFetcher{} req, _ := http.NewRequest(\u0026#34;GET\u0026#34;, \u0026#34;http://example.com/\u0026#34;, nil) w := httptest.NewRecorder() Func(w, req) So(w.Body.String(), ShouldEqual, \u0026#34;mocked!\u0026#34;) }) } è¿™æ ·å¯ä»¥å‡å°‘å˜é‡çš„ç”Ÿæˆä¸ªæ•°ï¼ŒåŒæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ FakeDataFetcher{} ä¼ å…¥ä¸åŒçš„å‚æ•°ï¼Œå®ç°ä¸åŒçš„ Faker æµ‹è¯•ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™ä¸ª interface æ–¹æ³•ä¸­éœ€è¦ç‰¹åˆ«æ³¨æ„å˜é‡å…±äº«çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚\nä¾èµ–æ³¨å…¥ ä¸Šé¢ä¸¤ç§æ–¹æ³•ä¼¼ä¹æ€è·¯ç±»ä¼¼ï¼Œé™¤äº†è¿™äº›æ–¹æ¡ˆä¹‹å¤–ï¼Œè¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„æ–¹æ¡ˆå‘¢ï¼Ÿæœ€åä»‹ç»ä¸€ä¸‹ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥ä¸ä¸Šé¢æåˆ°çš„æ¥å£æ–¹å¼æ­é…ä½¿ç”¨ã€‚è¿™ç§æ–¹å¼å®ç°èµ·æ¥æ¯”è¾ƒç®€å•æ–¹ä¾¿ï¼Œä¹Ÿéå¸¸é€‚åˆåˆ©ç”¨åœ¨ä¸€äº›é¢å‘è¿‡ç¨‹åœºæ™¯ä¸­ã€‚\n// main.go type EchoInterface interface {Echo() string } type Echoer struct { } func (e Echoer) Echo() string {return\u0026#34;hello world!\u0026#34;} func Echo(e EchoInterface) string {return e.Echo() } func main() {provider := Echoer{} fmt.Println(Echo(provider)) } æµ‹è¯•æ–‡ä»¶:\n// main_test.go type FakeEchoer struct { } func (f FakeEchoer) Echo() string {return\u0026#34;mocked!\u0026#34;} func TestFunc(t *testing.T) {Convey(\u0026#34;test\u0026#34;, t, func() {provider := FakeEchoer{} So(Echo(provider), ShouldEqual, \u0026#34;mocked!\u0026#34;) }) } æ€»ç»“ ä¸Šé¢çš„å‡ ç§æµ‹è¯•æ–¹æ³•åŸºæœ¬ä¸Šæ˜¯é€šè¿‡å›ºå®šçš„åŸå‹å°†ä»£ç è½¬ä¸ºæµ‹è¯•å‹å¥½çš„ Golang ä»£ç ã€‚è¿™æ ·å¯ä»¥é€šè¿‡ Mockï¼Œå‡å°‘æ¥è‡ªäºå…¶ä»–æ•°æ®å’Œå‰ç½®æ¡ä»¶çš„å½±å“ï¼Œå°½å¯èƒ½çš„é™ä½ä»£ç å¼€å‘çš„é™„åŠ æˆæœ¬ã€‚\n","date":"2016-04-18T18:40:00Z","permalink":"https://www.4async.com/2016/04/2016-04-18-writing-testable-golang-code/","title":"ç¼–å†™æµ‹è¯•å‹å¥½çš„ Golang ä»£ç "},{"content":"ä» asyncio ç®€å•å®ç°çœ‹å¼‚æ­¥æ˜¯å¦‚ä½•å·¥ä½œçš„\nby ipfans\næ³¨ï¼šè¯·ä½¿ç”¨ Python 3.5+ ç‰ˆæœ¬è¿è¡Œä»¥ä¸‹ä»£ç ã€‚\nå…ˆä»ä¾‹å­çœ‹èµ· é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ª socket é€šè®¯çš„ä¾‹å­ï¼Œè¿™ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥åœ¨å®˜æ–¹ socket æ¨¡å—çš„æ–‡æ¡£ä¸­æ‰¾åˆ°éƒ¨åˆ†åŸå‹ä»£ç ï¼š\n# echo.py from socket import * # æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å¥½çš„å†™æ³• def echo_server(address): sock = socket(AF_INET, SOCK_STREAM) sock.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1) sock.bind(address) sock.listen(5) while True: client, addr = sock.accept() print(\u0026#34;connect from\u0026#34;, addr) echo_handler(client) def echo_handler(client): while True: data = client.recv(10000) if not data: break client.send(str.encode(\u0026#34;Got: \u0026#34;) + data) print(\u0026#34;connection closed.\u0026#34;) if __name__ == \u0026#39;__main__\u0026#39;: echo_server((\u0026#39;\u0026#39;, 25000)) ä½†æ˜¯åŒæ­¥æ¨¡å¼ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“è¿›è¡Œé€šè®¯æ˜¯é˜»å¡çš„ï¼Œå½“ä¸€ä¸ªè¿æ¥å ç”¨æ—¶å°±ä¼šé˜»ç¢å…¶ä»–è¿æ¥çš„ç»§ç»­ï¼Œè¿™ä¸ªæ—¶å€™åº”è¯¥æ€ä¹ˆæ›´å¿«çš„è¿è¡Œå‘¢ï¼Ÿ\nå›é¡¾å†å² åœ¨ asyncio å‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½æ˜¯æ€ä¹ˆæé«˜æ•ˆç‡çš„å‘¢ï¼Ÿé¦–å…ˆæƒ³åˆ°çš„æ–¹æ³•å°±æ˜¯å¤šçº¿ç¨‹å¤„ç†ï¼š\n# echo_thread.py from socket import * import _thread def echo_server(address): sock = socket(AF_INET, SOCK_STREAM) sock.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1) sock.bind(address) sock.listen(5) while True: client, addr = sock.accept() print(\u0026#34;connect from\u0026#34;, addr) _thread.start_new_thread(echo_handler, (client,)) def echo_handler(client): while True: data = client.recv(10000) if not data: break client.send(str.encode(\u0026#34;Got: \u0026#34;) + data) print(\u0026#34;connection closed.\u0026#34;) if __name__ == \u0026#39;__main__\u0026#39;: echo_server((\u0026#39;\u0026#39;, 25000)) å½“ç„¶äº†ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å¤šçº¿ç¨‹ä¹‹ä¸‹æ€»æ˜¯ä¼šæœ‰ä¸€äº›é—®é¢˜çš„ã€‚é‚£ä¹ˆè¿˜æœ‰æ›´å¥½çš„æ–¹æ¡ˆå—ï¼Ÿå¦‚æœä½ äº†è§£è¿‡C10k é—®é¢˜ï¼Œä½ ä¸€å®šå¬è¿‡ epoll```ã€```kqueue ä¹‹ç±»çš„å¤§åã€‚é‚£ä¹ˆï¼Œèƒ½åœ¨ Python ä¸­ä½¿ç”¨è¿™äº›åŠŸèƒ½å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚é‚£å°±æ˜¯selectã€‚\n# echo_select.py from socket import * import select def echo_server(address): sock = socket(AF_INET, SOCK_STREAM) sock.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1) sock.bind(address) sock.listen(5) input = [sock,] while True: r, _, _ = select.select(input, [], []) for s in r: if s == sock: client, addr = sock.accept() print(\u0026#34;connect from\u0026#34;, addr) echo_handler(client) def echo_handler(client): while True: data = client.recv(10000) if not data: break client.send(str.encode(\u0026#34;Got: \u0026#34;) + data) print(\u0026#34;connection closed.\u0026#34;) if __name__ == \u0026#39;__main__\u0026#39;: echo_server((\u0026#39;\u0026#39;, 25000)) ç›¸æ¯” _thread æ¥è¯´ï¼Œselect æ›´åŠ åº•å±‚ï¼Œæä¾›äº†æœ€åŸºç¡€çš„ç­‰å¾… IO å®ŒæˆåŠŸèƒ½ã€‚ä½†æ˜¯ç¼ºç‚¹æ˜¯è¿™ä¸ªåŠŸèƒ½å¤ªå•ä¸€äº†ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåé¢è¯­è¨€æä¾›äº† asyncio```ã€‚æœ€æ—©åº”è¯¥æ˜¯ python-devä¸­ [æå‡ºäº†](https://mail.python.org/pipermail/python-ideas/2012-May/015223.html) è¦åœ¨æ ‡å‡†åº“ä¸­æ·»åŠ åŸºäºselectçš„å¼‚æ­¥ IO åŠŸèƒ½ã€‚ä¹‹å Python åœ¨ 3.4 ç‰ˆæœ¬ä¹‹ä¸­å°±åŠ å…¥äº† [```selectors](https://docs.python.org/3.5/library/selectors.html) ä¸ asyncio åº“ç”¨äºå¼‚æ­¥ IOã€‚\nå…¶ä»–çš„æ–¹æ³•è¿˜æœ‰ geventã€Twistedã€Tornado ç­‰ç­‰çš„æ–¹æ¡ˆï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚(åœ¨ 3.4 çš„æ—¶å€™æˆ‘ä¸€ç›´è§‰å¾— yield form å¤ªä¸‘é™‹äº†ï¼Œç›¸å¯¹æˆ‘å®æ„¿ç»§ç»­ç”¨ Tornado çš„ yield æ–¹å¼ã€‚å½“ç„¶è¿™ä¸ªæ›´åŠ ä¸»è§‚çš„åŸå› å§ï¼Œä¸è¿‡ç°åœ¨ async/await æ–¹å¼æ˜æ˜¾è®©æˆ‘åˆè®©æˆ‘çˆ±ä¸Šäº†ã€‚ï¼‰\nä»åŒæ­¥åˆ° asyncio é‚£ä¹ˆå¦‚ä½•åœ¨ asyncio æ¡†æ¶ä¸‹å¦‚ä½•å®ç°å¼‚æ­¥ socket é€šè®¯çš„ä¾‹å­å‘¢ï¼Ÿäº‹å®ä¸Šå®˜æ–¹æ–‡æ¡£ä¸­æä¾›äº†ä¸¤ä¸ªæ¯”è¾ƒé«˜å±‚å°è£…è¿‡çš„ asyncio åº“ä¾‹å­ TCP echo server protocol å’ŒTCP echo server using streamsã€‚è¿™ä¸¤ä¸ªä¾‹å­é‡‡ç”¨çš„æ˜¯ asyncio çš„ socket é€šè®¯é«˜çº§åˆ«å°è£…ï¼Œä¼¼ä¹ä¸æˆ‘ä»¬åŒæ­¥ä»£ç ç›¸å·®æœ‰ç‚¹è¿œã€‚è¿™é‡Œæˆ‘ä»¬å®é™…ä¾‹å­ä¸­ä½¿ç”¨äº†æ›´åŠ åº•å±‚çš„Low-level socket operationsã€‚è¿™ä¸ªæ›´æ¥è¿‘äºæˆ‘ä»¬åœ¨åŒæ­¥çŠ¶æ€ä¸‹ä½¿ç”¨ socket çš„ä»£ç ã€‚\n# aecho.py from socket import * import asyncio loop = asyncio.get_event_loop() async def echo_server(address): sock = socket(AF_INET, SOCK_STREAM) sock.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1) sock.bind(address) sock.listen(5) sock.setblocking(False) # è®¾ç½®éé˜»å¡ while True: client, addr = await loop.sock_accept(sock) print(\u0026#34;connect from\u0026#34;, addr) loop.create_task(echo_handler(client)) async def echo_handler(client): with client: while True: data = await loop.sock_recv(client, 10000) if not data: break await loop.sock_sendall(client, str.encode(\u0026#34;Got: \u0026#34;) + data) print(\u0026#34;connection closed\u0026#34;) loop.create_task(echo_server((\u0026#39;\u0026#39;, 25000))) loop.run_forever() å…¶ä¸­é‡åˆ°çš„ create_task ä¼šç›¸å¯¹åŒæ­¥çŠ¶æ€ä¸‹æ— æ³•å¯¹åº”ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºå®‰æ’ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œï¼Œå°†ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•å°è£…ä¸º future å¯¹è±¡ã€‚å…¶ä»–çš„ Event Loop ä¸­çš„åŠŸèƒ½åŸºæœ¬ä¸ä¼ ç»Ÿçš„ç¨‹åºç›¸åŒã€‚\nä» asyncio åˆ°è‡ªå·±çš„å®ç° é‚£ä¹ˆåœ¨ asyncio.event_loop ä¸­åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å°è¯•ç”¨è‡ªå·±çš„ç¨‹åºå®ç°ä¸€ä¸‹ã€‚\nå¦‚æœä½ é˜…è¯»è¿‡PEP-0492ï¼Œä½ å°±çŸ¥é“ï¼Œå®é™…ä¸Š Python çš„åç¨‹æ˜¯é€šè¿‡ç”Ÿæˆå™¨å®ç°çš„ã€‚\n# async_yield.py from types import coroutine @coroutine def read_wait(sock): yield \u0026#34;read_wait\u0026#34;, sock # ä¸ºä»€ä¹ˆæœ‰ä¸ª read_waitï¼Ÿç­‰ä¸‹ä»‹ç» ä¸‹é¢æ¥æ¨¡æ‹Ÿå®é™…è°ƒç”¨ï¼š\npython -i async_yield.py \u0026gt;\u0026gt;\u0026gt; f = read_wait(\u0026#34;somesocket\u0026#34;) \u0026gt;\u0026gt;\u0026gt; f \u0026lt;generator object read_wait at 0x10200d5c8\u0026gt; \u0026gt;\u0026gt;\u0026gt; f.send(None) (\u0026#39;read_wait\u0026#39;, \u0026#39;somesocket\u0026#39;) \u0026gt;\u0026gt;\u0026gt; f.send(None) Traceback (most recent call last): File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; StopIteration å¦‚æœä¸äº†è§£ send() ä¸ StopIteration ä½œç”¨çš„è¯ï¼Œè¯·å‚è€ƒ PEP-0492 ä¸­ç›¸å…³çš„æè¿°ã€‚\næ¥ä¸‹æ¥ç»§ç»­å®Œå–„ write æ–¹æ³•ï¼Œå¹¶ä¸”å®ç°æˆ‘ä»¬è‡ªå·±çš„ Loopã€‚\n# async_yield.py from types import coroutine from collections import deque from selectors import DefaultSelector, EVENT_READ, EVENT_WRITE @coroutine def read_wait(sock): yield \u0026#34;read_wait\u0026#34;, sock @coroutine def write_wait(sock): yield \u0026#34;write_wait\u0026#34;, sock class Loop(object): def __init__(self): self.ready = deque() self.selector = DefaultSelector() async def sock_recv(self, sock, maxbytes): await read_wait(sock) return sock.recv(maxbytes) async def sock_accept(self, sock): await read_wait(sock) return sock.accept() async def sock_sendall(self, sock, data): while data: await write_wait(sock) n = sock.send(data) data = data[n:] def create_task(self, coro): self.ready.append(coro) def run_forever(self): while True: while not self.ready: events = self.selector.select() for key, _ in events: self.ready.append(key.data) self.selector.unregister(key.fileobj) while self.ready: self.current_task = self.ready.popleft() try: op, *args = self.current_task.send(None) getattr(self, op)(*args) except StopIteration: pass def read_wait(self, sock): self.selector.register(sock, EVENT_READ, self.current_task) def write_wait(self, sock): self.selector.register(sock, EVENT_WRITE, self.current_task) å¯¹äºä¹‹å‰ä¸€èŠ‚ä¸­çš„ aecho.py æ–‡ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸€ä¸‹å¯¼å…¥æ¨¡å—ä¸ loop çš„è·å–æ–¹æ³•å³å¯ï¼š\n# pecho.py from socket import * import async_yield loop = async_yield.Loop() async def echo_server(address): sock = socket(AF_INET, SOCK_STREAM) sock.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1) sock.bind(address) sock.listen(5) sock.setblocking(False) # è®¾ç½®éé˜»å¡æ¨¡å¼ while True: client, addr = await loop.sock_accept(sock) print(\u0026#34;connect from\u0026#34;, addr) loop.create_task(echo_handler(client)) async def echo_handler(client): with client: while True: data = await loop.sock_recv(client, 10000) if not data: break await loop.sock_sendall(client, str.encode(\u0026#34;Got: \u0026#34;) + data) print(\u0026#34;connection closed\u0026#34;) loop.create_task(echo_server((\u0026#39;\u0026#39;, 25000))) loop.run_forever() async_yield å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªåç¨‹å‡½æ•° read_wait å’Œ write_waitï¼Œåˆ†åˆ«ç”¨äºç›¸åº”å¤„ç†è¯»å–æ“ä½œä¸å†™å…¥æ“ä½œã€‚å…¶ä¸­è¿”å›äº†ä¸€ä¸ª tuple ç±»å‹æ•°æ®ï¼Œç”¨äºåœ¨ op, *args = self.current_task.send(None) ä¸­å¡«å……æ–¹æ³•åå’Œå‚æ•°ï¼Œä¹‹ååœ¨ getattr(self, op)(*args) ä¸­è¿›è¡Œåˆ†åˆ«è°ƒç”¨ã€‚\nä¸‹é¢ Loop ç±»å®ç°äº†åœ¨ pecho ä¸­ç”¨åˆ°çš„æ‰€æœ‰å¼‚æ­¥å‡½æ•°ã€‚åˆå§‹åŒ–æ—¶çš„ self.ready ç”¨äºå­˜å‚¨åç¨‹çš„è°ƒç”¨åºåˆ—ã€‚è¯¥åºåˆ—é€šè¿‡ create_task æ·»åŠ åç¨‹åˆ°é˜Ÿåˆ—ä¸­ã€‚\nåœ¨ run_forever ä¸­ï¼Œå¦‚æœç›®å‰é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™é€šè¿‡ self.selector.select() æå–ä¸€ä¸ªäº‹ä»¶æ”¾å…¥é˜Ÿåˆ—å¤„ç†ï¼Œè‹¥é˜Ÿåˆ—å­˜åœ¨é€šè¿‡ self.current_task.send(None) é€šçŸ¥äº‹ä»¶å‘é€ï¼Œä»è€Œè°ƒç”¨å¯¹åº”çš„äº‹ä»¶åŠŸèƒ½ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ op, *args = self.current_task.send(None) åæ·»åŠ  print(op) è·å–å®æ—¶çš„è°ƒç”¨æƒ…å†µã€‚\nç»“è¯­ äº‹å®ä¸Šè¿™ç¯‡æ–‡ç« çš„æ€è·¯æ˜¯åŸºäº @dabeaz åœ¨ Python Brasil ä¸Šçš„ keynote æ•´ç†è€Œæ¥ã€‚dabeaz è¿˜æœ‰å¦å¤–ä¸€ä¸ªéå¸¸ä¸é”™çš„åŸºäº select çš„å¼‚æ­¥åº“ï¼Œåå­—å«åšcurioï¼Œæ˜¯ä¸€ä¸ªäº†è§£å®ç°å¼‚æ­¥åº“çš„å¾ˆå¥½æ•™ç¨‹ã€‚\næœ€åè®²ä¸ªæ®µå­ï¼Œä¹‹å‰æœ‰äººå¼€ç©ç¬‘ï¼ŒèŸ’çˆ¹å¼€å‘ä¸€ä¸ªåŠŸèƒ½ï¼Œä¹‹åå¤§å®¶éƒ½ä¸ä¼šæ­£ç¡®ä½¿ç”¨ï¼Œç›´åˆ° dabeaz ç«™å‡ºæ¥å‘Šè¯‰å¤§å®¶å¦‚ä½•æ­£ç¡®ä½¿ç”¨æ–°åŠŸèƒ½ã€‚åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™è™½ç„¶å¾ˆæƒ³æ‰¾å‡ºæ¥å‡ºå¤„ï¼Œä½†æ˜¯ä¼¼ä¹æ‰¾ä¸åˆ°äº†\u0026hellip;\n","date":"2016-02-03T15:40:00Z","permalink":"https://www.4async.com/2016/02/2016-02-03-simple-implement-asyncio-to-understand-how-async-works/","title":"ä» asyncio ç®€å•å®ç°çœ‹å¼‚æ­¥æ˜¯å¦‚ä½•å·¥ä½œçš„"},{"content":"åœ¨åˆ›ä¸šå…¬å¸åˆåˆ›ä¼Šå§‹ï¼Œå¦‚ä½•é€‰æ‹©åˆé€‚çš„è¯­è¨€å†³å®šäº†äº§å“åç»­çš„æŠ€æœ¯æ ˆå’Œå¦‚ä½•è¿›è¡Œåˆç†çš„ä¸šåŠ¡æ”¯æ’‘æ–¹å‘ã€‚å¦‚æœä½ åœ¨è¯»è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæ›´å€¾å‘äºé€‰æ‹© Java/C#/PHP å¸¸è§è¯­è¨€æŠ€æœ¯æ ˆï¼Œæˆ‘è§‰å¾—å¯¹äºä½ è€Œè¨€ï¼Œè¿™ç¯‡æ–‡ç« å¸®åŠ©ä¸å¤§ã€‚å› ä¸ºå¯¹ä½ è€Œè¨€ï¼Œè¿™äº›æŠ€æœ¯æ ˆæ„å‘³ç€æ›´åŠ æ–¹ä¾¿æ‹›äººï¼Œæ›´æ–¹ä¾¿çš„æ•…éšœå¤„ç†èµ„æ–™ç­‰ç­‰ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªåˆåˆ›å…¬å¸æƒ³è¦é€‰æ‹©åˆç†çš„å°ä¼—è¯­è¨€æŠ€æœ¯æ ˆï¼Œæˆ‘æƒ³è¿™ç¯‡æ–‡ç« å¯¹ä½ ä¹Ÿè®¸æœ‰ä¸€äº›å¸®åŠ©ã€‚\nåœ¨æ–‡ç« å¼€å§‹ä¹‹å‰ï¼Œæˆ‘è§‰å¾—æœ‰å¿…è¦æè¿°ä¸€ä¸‹æ‰€è°“çš„å°ä¼—è¯­è¨€ï¼Œè¿™é‡Œæˆ‘åœ¨æœ€åˆè¿›è¡ŒæŠ€æœ¯é€‰å‹æ—¶ï¼Œè€ƒå¯Ÿäº†åŒ…æ‹¬ï¼š\n Python: ä½ å¯èƒ½åœ¨æ¥è§¦çˆ¬è™«ã€å¤§æ•°æ®åˆ†æç­‰ç­‰æ–¹é¢å¬è¿‡ Python çš„å¤§åï¼Œå¤§å®¶éƒ½çŸ¥é“ Pythonista éƒ½ä¹ æƒ¯è¯´çš„ä¸€å¥è¯å°±æ˜¯ï¼šäººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨ Pythonã€‚ Ruby: ä½ å¦‚æœåšè¿‡ Web æ¡†æ¶ï¼Œä½ é‡åˆ°æœ€å¤šçš„æ˜¯å¾ˆå¤šäººéƒ½ä¼šæåˆ° RoR æ¡†æ¶ã€‚ç”¨è¿‡ä¹‹ååªæœ‰ä¸€ä¸ªæƒŠå¹äº†ã€‚ JavaScriptï¼ˆNodejsï¼‰: æœ‰æ²¡æœ‰å¬è¿‡ JavaScript å…¨æ ˆå·¥ç¨‹å¸ˆï¼Ÿæœ‰æ²¡æœ‰å¬è¿‡ JavaScript å…¨æ ˆå·¥ç¨‹å¸ˆï¼Ÿæœ‰æ²¡æœ‰å¬è¿‡ JavaScript å…¨æ ˆå·¥ç¨‹å¸ˆï¼Ÿ Golang: ç®€å•ç²—æš´çš„è¯­è¨€ï¼Œä¹Ÿè®¸ä½ è§è¿‡å¾ˆå¤šäººè·Ÿä½ å¹å˜˜ï¼ŒGolang æ˜¯ä¸‹ä¸€ä»£çš„äº‘è®¡ç®—å¼€å‘è¯­è¨€ã€‚  å…¶ä»–è¯­è¨€å¤ªè¿‡äºå°ä¼—ï¼Œè€ƒè™‘è¯­è¨€çš„åº”ç”¨å¾ˆå¤šéœ€è¦å¾—åˆ°æ›´å¤šçš„ç¤¾åŒºæ”¯æŒï¼Œç›®å‰ä¸åœ¨è€ƒè™‘çš„èŒƒç•´å†…ã€‚\nå°ä¼—è¯­è¨€çš„åŠ£åŠ¿ æ­£æ‰€è°“çŸ¥å·±çŸ¥å½¼ç™¾æˆ˜ä¸æ®†ï¼Œåœ¨äº†è§£ä¸€ä¸ªæŠ€æœ¯é€‰å‹ä¹‹å‰ï¼Œæœ€å¥½æ˜¯ç ”ç©¶è¿™äº›è¯­è¨€çš„ç¼ºç‚¹ã€‚å› ä¸ºä½ æœ€åæ„Ÿè§‰è¿™ä¸ªæŠ€æœ¯é€‰å‹ä¸é€‚åˆä½ çš„æ—¶å€™ï¼Œæ ¹æœ¬çš„åŸå› æ˜¯è¿™äº›åŠ£åŠ¿å½±å“äº†ä½ ã€‚\nåœ¨ä¸Šé¢æåˆ°çš„å‡ ä¸ªè¯­è¨€ä¸­ï¼ŒPythonã€Rubyã€JavaScript æ˜¯å±äºåŠ¨æ€è¯­è¨€ã€‚å…³äºåŠ¨æ€è¯­è¨€çš„äº‰è®®æœ€å¤§çš„åœ°æ–¹æ˜¯ï¼šåŠ¨æ€è¯­è¨€åˆ°åº•æ˜¯å¦åˆé€‚è¿›è¡Œå¤§å‹é¡¹ç›®ã€‚äº‹å®ä¸Šï¼Œåœ¨æŸäº›é˜¶æ®µï¼Œå¤šäººåˆä½œï¼Œå¹¶ä¸”å¤§å®¶æ°´å¹³è¯­è¨€ä¸åŒæ—¶ï¼Œè¿™ä¸ªæ—¶å€™é€šå¸¸ä¼šæœ‰è¿™æ ·çš„é—®é¢˜ï¼šå›¢é˜Ÿéœ€è¦èŠ±æ›´å¤šçš„æ—¶é—´åœ¨ç¡®ä¿åŠ¨æ€è¯­è¨€çš„å‡†ç¡®æ€§ä¸Šã€‚å¯¹äºä¸€ä¸ªé¡¹ç›®æœ‰é«˜å¯ç”¨ã€ä½é”™è¯¯ç‡çš„è¦æ±‚æ—¶ï¼Œç”±äºè¯­è¨€çš„åŠ¨æ€ç‰¹æ€§ï¼Œå°±éœ€è¦å¯¹ç¨‹åºå¼€å‘æ—¶çš„å•å…ƒæµ‹è¯•å’ŒåæœŸé›†æˆæµ‹è¯•çš„è¦æ±‚æ›´é«˜ã€‚å› ä¸ºå˜é‡åœ¨è¿è¡Œæ—¶æ‰ä¼šèµ‹äºˆç±»å‹å«ä¹‰ï¼Œæ‰€ä»¥å¾ˆéš¾åœ¨é™æ€æ£€æµ‹è¿‡ç¨‹ä¸­å‘ç°è¶³å¤Ÿå¤šçš„é—®é¢˜ã€‚è¿™æ ·å¯¹æµ‹è¯•äººå‘˜çš„å‹åŠ›ä¹Ÿä¼šæ›´å¤§ï¼Œå½“ä½ æ²¡æœ‰åˆé€‚çš„æµ‹è¯•äººå‘˜æ—¶ï¼Œè¿™ä¸ªæ—¶å€™é€šå¸¸ä¼šå˜æˆï¼Œä½ åªè¦†ç›–æµ‹è¯•äº†ç†æƒ³æƒ…å†µä¸‹çš„æˆåŠŸå¤±è´¥æƒ…å†µï¼Œè€Œå¯¹ç‰¹åˆ«å¼‚å¸¸æƒ…å†µç¼ºå°‘è¯„ä¼°ã€‚\nPythonã€Ruby è¯­æ³•å¯¹ç¨‹åºå‘˜è€Œè¨€æœ€å¤§çš„æˆæœ¬åœ¨äºéœ€è¦é‡æ–°å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€ã€‚è¿™ä¸ªå­¦ä¹ æˆæœ¬ã€æ—¶é—´æˆæœ¬é€šå¸¸å¯¹åˆåˆ›å…¬å¸è€Œè¨€é€šå¸¸æ˜¯æ”¯ä»˜ä¸èµ·çš„ï¼Œå“ªæ€•åƒè¿™äº›æ¯”è¾ƒå®¹æ˜“å­¦ä¹ çš„åŠ¨æ€è¯­è¨€è€Œè¨€ã€‚å¦å¤–ä¸€ä¸ªå€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ— è®ºæ˜¯ Python è¿˜æ˜¯ Rubyï¼Œä»é•¿è¿œçœ‹ï¼Œå¦‚æœä½ åç»­æœ‰è¾ƒå¤§çš„ç”¨æˆ·å¢é•¿åˆéœ€è¦ä¿è¯ç”¨æˆ·ä½“éªŒæ—¶ï¼ŒPythonã€Ruby çš„æ‰§è¡Œæ•ˆç‡å’Œååé‡ä¼šæœ‰è¾ƒå¤§çš„å½±å“ã€‚\nPython å’Œç¨‹åºå‘˜å…¥é—¨çš„è¯­è¨€å·®è·è¾ƒå¤§ï¼šç”¨ 4 ä¸ªç©ºæ ¼è¡¨è¿°ç¨‹åºç¼©è¿›ã€‚è¿™æ„å‘³ç€ï¼Œç¨‹åºå‘˜ç›´æ¥ä»ç½‘ä¸Šå¯»æ‰¾è§£å†³æ–¹æ¡ˆï¼ˆæ‹·è´ä»£ç ï¼‰æ—¶æˆæœ¬æ›´é«˜ï¼Œå› ä¸ºå¾ˆæœ‰å¯èƒ½ä»–éœ€è¦æ‰‹å·¥è¿›è¡Œä»£ç æ ¼å¼åŒ–ï¼Œè¿™æ ·æœ‰å¯èƒ½é€ æˆç¨‹åºé€»è¾‘çš„æ”¹å˜ã€‚å¦å¤–ä¸€ä¸ªä¸å¾—ä¸æçš„æ˜¯ä¸€äº› Python åº“çœ‹ä¼¼å¥½ç”¨ï¼Œå®é™…ä¸Šæˆ–å¤šæˆ–å°‘æœ‰æœ‰ä¸€äº›å‘ï¼Œè¿™å¯¹æ–°æ‰‹è€Œè¨€ï¼Œå¾€å¾€æ˜¯è‡´å‘½çš„ã€‚å¯¹åº”çš„ï¼ŒRuby è¯­è¨€æœ¬èº«æ—¶ä¸å­˜åœ¨è¿™äº›é—®é¢˜çš„ã€‚ç„¶è€Œ Ruby ä½œä¸ºå¼€å‘ä¸»è¯­è¨€æ—¶æœ€å¤§çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœé€‰æ‹© RoR æ¡†æ¶ä½œä¸ºåˆå§‹çš„ Web æ¡†æ¶æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªç†Ÿæ‚‰ RoR æ¡†æ¶çš„äººï¼Œé‚£ä¹ˆå­¦ä¹ ä¿®æ”¹ RoR æ¡†æ¶çš„æˆæœ¬æ˜¯ç‰¹åˆ«é«˜çš„ï¼šå¯¹äºä¸€ä¸ªé€šç”¨å‹æ¡†æ¶è€Œè¨€ï¼Œä½ å¯èƒ½éœ€è¦æ›´å¤šçš„ç‰¹æ®Šåœºæ™¯å®šåˆ¶ï¼Œè¿™å¯èƒ½éœ€è¦åšå¤§é‡çš„çŒ´å­è¡¥ä¸ï¼Œå¦‚æœä¸å¯¹æ¡†æ¶æœ‰ä¸€ä¸ªæ¸…æ™°äº†è§£æ—¶ï¼Œè¿™æ ·çš„æˆæœ¬ä¼šæ›´é«˜ã€‚\nJavaScriptï¼ˆåé¢ç»Ÿä¸€ç”¨ Nodejs ä»£ç§°ï¼‰åˆ™å€ŸåŠ© Nodejs å®ç°äº†é«˜æ€§èƒ½å’Œè¾ƒå¤§ååé‡ã€‚è€Œä¸”ä»è¯­è¨€å±‚é¢ä¸Šï¼ŒJavaScript å¯¹å¾ˆå¤šç¨‹åºå‘˜å¹¶ä¸é™Œç”Ÿã€‚ç„¶è€Œï¼Œåœ¨è¿‡å»çš„å¾ˆé•¿æ—¶é—´ï¼ŒçœŸæ­£ç†Ÿç»ƒæŒæ¡ JavaScript çš„éƒ½æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å°´å°¬çš„é—®é¢˜ã€‚å¯¹åç«¯å·¥ç¨‹å¸ˆè€Œè¨€ï¼ŒNodejs éœ€è¦ä¸å‰ç«¯ä¸åŒçš„æŠ€æœ¯æ ˆï¼Œè€Œä¸”å¤§æ¦‚æ²¡æœ‰å…¬å¸å¸Œæœ›ä¸€ä¸ªå®Œå…¨æ²¡æœ‰ä»»ä½•åç«¯ç»éªŒçš„å‰ç«¯å·¥ç¨‹å¸ˆå»æ¥æ‰‹åç«¯é¡¹ç›®çš„å¼€å‘çš„ã€‚Nodejs æ˜¯ä¸€ä¸ªå¹´è½»çš„è¯­è¨€ï¼Œå¹´è½»å¿…ç„¶ä¼šä¼´éšä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼Œåº“æ¯”è¾ƒå°‘ï¼ˆå½“ç„¶ç°åœ¨ä¹Ÿæ˜¯äº•å–·æœŸï¼‰ã€‚ä¸€äº›å¿…è¦çš„åº“éœ€è¦æ…¢æ…¢å¯»æ‰¾ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä¹Ÿä¸å¾—ä¸åæ§½ï¼Œå¯èƒ½æ˜¯å¼€å‘è€…æ°´å¹³é—®é¢˜ï¼Œå¯¼è‡´å¾ˆå¤š npm æä¾›çš„åŒ…ï¼Œå¾€å¾€æˆ–å¤šæˆ–å°‘å­˜åœ¨ä¸€äº›æ¯”è¾ƒæ¼äººçš„ BUGï¼Œè¿™äº› BUG å¯èƒ½ä¼šåœ¨ä½ å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ­£å¸¸è¿è¡Œä¸­å‡ºç°ï¼Œè€Œä½ å´ä¸å¾—ä¸å¹²æ‰å®ƒã€‚å¯¹äºè¿™ç§ BUGï¼Œå¾ˆå¤šæ—¶å€™æ›´å¿«çš„å¤„ç†æ–¹å¼æ˜¯ä½ è‡ªå·±åŠ¨æ‰‹è¿›è¡Œå¿«é€Ÿä¿®å¤ã€‚ç„¶è€Œå½“ä½ çš„ç¨‹åºå‘˜ä¸å…·å¤‡è¿™ç§èƒ½åŠ›çš„æ—¶å€™ï¼Œå°±éœ€è¦æä¸€ä¸ª issue åˆ°å¼€å‘è€…ï¼Œç”±å¼€å‘è€…è¿›è¡Œä¿®å¤ï¼Œå¹¶ä¸”éœ€è¦ç­‰å¾…ç‰ˆæœ¬æ›´æ–°åˆ° npm æºä¸­ã€‚å¾ˆå¤šæ—¶å€™è¿™ä¸ªè¿‡ç¨‹éƒ½æ˜¯æ¯”è¾ƒå°´å°¬çš„ï¼Œå°¤å…¶æ˜¯ä½ é€‰æ‹©äº†ä¸€ä¸ªå¼€å‘è€…å¹¶ä¸æ˜¯ç‰¹åˆ«æ´»è·ƒçš„åŒ…ã€‚\nGolang æ˜¯ä¸€ä¸ªç¼–è¯‘å‹è¯­è¨€ï¼Œè¯­æ³•ç®€å•ï¼Œä¼¼ä¹ä¸€åˆ‡çœ‹èµ·æ¥éƒ½æ˜¯é‚£ä¹ˆçš„ç¾å¥½ã€‚äº‹å®ä¸Š Golang æœ¬èº«è¿˜æ˜¯å¤„äºåœ¨ Google å¼€å‘ç»´æŠ¤çš„é˜¶æ®µï¼Œæœ¬è´¨ä¸Šè™½ç„¶è¯­è¨€å®Œå…¨å¼€æºäº†ï¼Œä½†æ˜¯å´ä¸æ˜¯ä¸€ä¸ªå®Œå…¨ç¤¾åŒºç»´æŠ¤çš„è¯­è¨€ã€‚æ¢å¥è¯è¯´ï¼ŒGoogle ä¼šå†³å®š Golang æœªæ¥çš„èµ°å‘ã€‚ä¸è¿‡å¥½åœ¨ç¬¬ä¸‰æ–¹åŒ…éƒ½æ˜¯ç”±ç¤¾åŒºæ¥é©±åŠ¨çš„ï¼Œè¿™æ ·è¿˜æ˜¯æä¾›äº†æ›´å¤šçš„å¯å®šåˆ¶æ€§ã€‚å¦å¤–ä¸€ä¸ªæ¯”è¾ƒçƒ¦æ¼çš„æ˜¯ Golang æœ¬èº«çš„åŒ…ç®¡ç†æœºåˆ¶ï¼Œäº‹å®ä¸Šï¼Œè¿™æ˜¯å®Œå…¨æ˜¯ä¸€ä¸ªä¼ªå‘½é¢˜ã€‚åˆ«å‘Šè¯‰æˆ‘ä½ è§‰å¾— go get å®Œå…¨è¶³å¤Ÿäº†ï¼Œé‚£åªæ˜¯å› ä¸ºä½ è¿˜æ²¡æœ‰é‡åˆ°ä¾èµ–å¯¼è‡´ break çš„é—®é¢˜è€Œå·²ï¼ˆGodep ä¹Ÿå¯ä»¥è§£å†³ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œç„¶è€Œç¬¬ä¸‰æ–¹åŒ… API çš„å˜æ›´ä½ æ˜¯æ²¡åŠæ³•æ§åˆ¶çš„ï¼‰ã€‚ä¸è¿‡ä»ç°åœ¨çœ‹èµ·ç  Google æ„è¯†åˆ°è‡ªå·±çš„é—®é¢˜ï¼Œä¹Ÿæ­£åœ¨åŠªåŠ›æ”¹å˜å§ã€‚Golang åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªå¹´è½»çš„è¯­è¨€ï¼Œåº“æ¯”è¾ƒå°‘çš„é—®é¢˜ä¹Ÿä¼šå‡ºç°ã€‚è™½ç„¶ä½ å¯ä»¥åˆ©ç”¨ cgo å»æ¡¥æ¥ä¸€äº›ç°æœ‰çš„ C/C++ åº“åˆ° Golang ç¨‹åºä¸­ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†çš„ä»£ç ç»´æŠ¤ï¼Œæ¶‰åŠåˆ° GC çš„ä¼˜åŒ–å¤„ç†ç­‰å„ä¸ªæ–¹é¢ï¼Œå¯¹å¼€å‘è€…çš„è¦æ±‚ä¸ä½ã€‚å¦å¤–ä¸€ä¸ªå¤§å®¶éƒ½ä¼šæŠ“ä½è®²çš„å°±æ˜¯ GC é—®é¢˜ï¼Œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ GC çš„å½±å“ä» 1.5 å¼€å§‹ä¸‹é™äº†å¾ˆå¤šï¼Œä½†æ˜¯ GC å¹¶ä¸åƒ Java ä¸€æ ·æ›´åŠ å¯æ§ï¼Œå¾ˆå¤šæ—¶å€™ GC è¿˜æ˜¯éœ€è¦è¿›è¡Œä»£ç å±‚é¢è¿›è¡Œæ§åˆ¶ã€‚\nä¸Šé¢æ‰€æœ‰çš„å°ä¼—è¯­è¨€è¿˜é¢ä¸´ä¸€ä¸ªå…±åŒçš„é—®é¢˜ï¼Œæ‹›äººã€‚æ²¡é”™ï¼Œæ‰¾åˆ°ä¸€ä¸ªé€‚åˆçš„å°ä¼—è¯­è¨€å·¥ç¨‹å¸ˆæ˜¯ä¸€ä¸ªç—›è‹¦çš„äº‹æƒ…ã€‚è™½ç„¶ä½ å¯ä»¥é€šè¿‡è¯­è¨€çš„é«˜å¼€å‘æ•ˆç‡å»èŠ‚çœäººåŠ›ï¼Œä½†æ˜¯å½“ä½ é¢ä¸´äººæ‰‹ç´§ç¼ºçš„å›°å¢ƒæ—¶ï¼Œå»æ‰¾ä¸€ä¸ªåˆé€‚çš„æ›¿è¡¥äººå°±å˜æˆäº†ä¸€ä»¶éå¸¸æ˜‚è´µçš„äº‹æƒ…ã€‚é€šå¸¸ä½ éœ€è¦ä»ç°æœ‰çš„äººå‘˜ä¸­åŸ¹å…»åˆ™æ›´åŠ é è°±ã€‚ï¼ˆåº†å¹¸çš„æ˜¯ï¼Œç»è¿‡åŸ¹å…»åï¼Œå“ªæ€•æˆ‘ä»¬çš„ç§»åŠ¨å¼€å‘å·¥ç¨‹å¸ˆä¹Ÿå¯ä»¥ hold ä½æˆ‘ä»¬ç°åœ¨çš„åç«¯éƒ¨åˆ†éœ€æ±‚ã€‚å½“ç„¶ï¼Œè¿™åªæ˜¯æ„Ÿå…´è¶£çš„å‰æä¸‹ã€‚ï¼‰\nå¦‚ä½•é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ ˆ è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„é—®é¢˜ã€‚é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ ˆï¼Œä½ éœ€è¦è¦†ç›–ä¸Šé¢æˆ‘æåˆ°çš„æ‰€æœ‰çš„åŠ£åŠ¿é—®é¢˜ã€‚æ¯”å¦‚è¯´ï¼Œä½ é€‰æ‹©äº† Nodejsï¼Œä½ å°±è¦è€ƒè™‘ï¼Œä½ å¯ä»¥ hold ä½æ‰€æœ‰çš„éš¾ç‚¹ï¼Œä½ å¯ä»¥ä¿®æ­£å¼€æºåŒ…çš„é—®é¢˜ï¼Œç”šè‡³ä½ å¯ä»¥è§£å†³ç°åœ¨æ²¡æœ‰åŒ…çš„éš¾é¢˜ï¼ŒOKï¼Œé‚£ä¹ˆä½ é€‰æ‹©è¿™ä¸ªè¯­è¨€æœ¬èº«æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ã€‚\nè€Œæˆ‘åœ¨ç»¼åˆè€ƒè™‘ä¹‹åï¼Œé€‰æ‹©çš„æŠ€æœ¯æ ˆæ¯”è¾ƒç®€å•ï¼šPython å’Œ Golangã€‚å…¶å®é€‰æ‹©çš„åŸå› å¾ˆç®€å•ï¼Œè¿™ä¸¤ç§è¯­è¨€æˆ‘æ›´ç†Ÿæ‚‰ã€‚æ²¡é”™ï¼Œè¿™ä¸ªæ˜¯ç¬¬ä¸€ä¸ªç†ç”±ã€‚ä¸ºä»€ä¹ˆä¼šæœ‰ 2 ä¸ªæŠ€æœ¯æ ˆï¼Œè¿™ä¸ªå…¶å®ä¸æˆ‘ä»¬ç°æœ‰çš„ä¸šåŠ¡çŠ¶æ€å’Œæœªæ¥å‘å±•çš„æ€è€ƒæœ‰å…³ï¼Œè¿™ä¸ªä¼šåœ¨åé¢è¿›è¡Œä¸€ä¸‹ä»‹ç»ã€‚åšè„¸çš®çš„è¯´ä¸€ä¸‹ï¼ŒPython å’Œ Golang è¯­è¨€ä¸­çš„ç»å¤§éƒ¨åˆ†é—®é¢˜ç›®å‰éƒ½å¯ä»¥è‡ªå·±è§£å†³ï¼Œè¿™ä¹Ÿæ˜¯å¦å¤–ä¸€ä¸ªç†ç”±ã€‚\næ¥ä¸‹æ¥ï¼Œäººå‘˜åŸ¹å…»æ–¹é¢ï¼Œä¸Šé¢æåˆ°çš„å°ä¼—è¯­è¨€å¤§å¤šåŸ¹è®­å®¹æ˜“ï¼Œä»¥ç°åœ¨äº§å“å‘å±•èŠ‚å¥å’Œäº§å“æ¼”è¿›é€Ÿåº¦ï¼Œæˆ‘ä»¬çš„äººå‘˜åŸ¹å…»æˆæœ¬ç›®å‰æ˜¯å¯ä»¥æ‰¿å—çš„ã€‚\nä½¿ç”¨ Python çš„åŸå› ï¼Œæ˜¯__å¼€å‘æ›´å¿«ï¼Œä»è€Œå¯ä»¥å¿«é€Ÿè¯•é”™__ã€‚åˆ©ç”¨ç°æœ‰çš„ Web æ¡†æ¶ï¼Œæ­é…åˆé€‚çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ 1-2 å‘¨å†…å®ç°ä¸€ä¸ªå®Œæ•´äº§å“çš„ä¸Šçº¿ï¼Œè¿›è¡Œå¿«é€Ÿè¯•é”™ã€‚æˆ‘ä»¬é’ˆå¯¹ Python åˆ¶è®¢äº†ä¸€ç³»åˆ—çš„æ ‡å‡†ï¼Œç”¨äºè§„èŒƒä»£ç çš„æ ¼å¼ï¼Œä¿è¯ä»£ç çš„å¼ºå£®åº¦ã€‚è¿™ä¸ªå¯ä»¥å‚è€ƒä¸‹æˆ‘ä¹‹å‰å…³äº ä»£ç é£æ ¼è¦æ±‚çš„æ–‡ç« ã€‚\nä½¿ç”¨ Golang çš„åŸå› ï¼Œåœ¨äºéœ€è¦åˆ¶ä½œå¤§å‹é•¿æœŸç¨³å®šè¿è¡Œé¡¹ç›®çš„è€ƒé‡ã€‚äº‹å®ä¸Šï¼Œæˆ‘åœ¨å‰é¢ä¹Ÿæåˆ°äº†ï¼Œåœ¨ç›®å‰çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒPython åœ¨å¤šäººåä½œè¿‡ç¨‹ä¸­ä¸ªäººç¼–ç é£æ ¼ã€å·¥ç¨‹æ€§ä¸Šè¦æ›´å¼±ã€é•¿æœŸè¿è¡Œæ— æ³•æ§åˆ¶çš„å†…å­˜æ³„æ¼ç­‰ç­‰é—®é¢˜ï¼Œå¦‚æœéœ€è¦é•¿æœŸç¨³å®šè¿è¡Œï¼Œæˆ‘æ›´å€¾å‘äºé€‰æ‹©å¯ä»¥è¿›è¡Œç¼–è¯‘çš„ç¼–è¯‘å‹è¯­è¨€ï¼Œé€šè¿‡é™æ€æ£€æŸ¥ï¼‹åŠ¨æ€æµ‹è¯•æ–¹å¼ï¼Œæ›´å¥½çš„ä¿è¯ç¨‹åºçš„å¼ºå£®å‹ã€‚\nç»“è¯­ ä¸Šé¢å•°é‡Œå…«å—¦è¯´äº†é‚£ä¹ˆå¤šï¼Œåªæ˜¯æƒ³å‘Šè¯«å¤§å®¶ï¼Œå¯¹å°ä¼—è¯­è¨€è€Œè¨€ï¼Œé€‰æ‹©çš„æœºä¼šæˆæœ¬æ˜¯ç‰¹åˆ«é«˜çš„ã€‚å¦‚æœä½ åªæ˜¯éªŒè¯è¯•é”™ï¼Œæˆ–è€…ä½ åªæ˜¯æƒ³å·ä¸€ç¬”é’±å°±è·‘ï¼Œå°ä¼—è¯­è¨€çš„é«˜å¼€å‘æ•ˆç‡æ˜¯ç»å¯¹å¯ä»¥æ»¡è¶³ä½ çš„ã€‚ä½†æ˜¯ä»ä¸€ä¸ªå¤§å‹å·¥ç¨‹çš„è§’åº¦ï¼Œä½ éœ€è¦é€šç›˜è€ƒè™‘å°ä¼—è¯­è¨€çš„åŠ£åŠ¿ï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„è¯­è¨€ä½œä¸ºä½ çš„æŠ€æœ¯æ ˆæ˜¯ååˆ†å¿…è¦çš„ã€‚\nå¦ï¼Œæ­å·äº‘æŸšç§‘æŠ€é•¿æœŸæ‹›è˜æœ‰æ½œåŠ›çš„ Python/Golang å¼€å‘è€…ï¼Œæœ‰å…´è¶£çš„è¯·å‘é€ç®€å†è‡³ kevin |at| yeeuu |dot| com\n","date":"2016-01-27T09:48:00Z","permalink":"https://www.4async.com/2016/01/2016-01-27-startup-architecture-language/","title":"èŠèŠåˆåˆ›å…¬å¸çš„åç«¯è¯­è¨€é€‰å‹ (å°ä¼—è¯­è¨€)"},{"content":"mgo åº“ æ˜¯ä¸€ä¸ªå¾ˆå¥½ç”¨çš„ MongoDB é©±åŠ¨ã€‚å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œä¸»åŠ›æ•°æ®åº“æ˜¯ MongoDBï¼Œå› æ­¤è¿™ä¸ªé©±åŠ¨å¯¹æˆ‘ä»¬æ¥è¯´ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚ä½†æ˜¯ï¼Œmgo åº“æœ‰äº›é—®é¢˜ç®—æ˜¯ä¸€äº›å‘ï¼Œè¿™é‡Œæˆ‘åšäº†ä¸€äº›ç®€å•çš„æ•´ç†ã€‚\nä¸€äº›å…³äº bson.ObjectId çš„é—®é¢˜ ObjectId ä¸ºç©ºçš„åˆ¤æ–­ å¦‚æœä½ çœ‹ bson.ObjectId å®šä¹‰çš„è¯ï¼Œå®ƒæ˜¯ä¸€ä¸ª string ç±»å‹çš„æ•°æ®ã€‚ä½†æ˜¯å¦‚æœä½ ç›´æ¥å®šä¹‰ä¸€ä¸ªç»“æ„ï¼Œå¹¶ä¸”ç”Ÿæˆå¯¹è±¡æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚\næˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼š\ntype Home struct {ID bson.ObjectId `bson:\u0026#34;_id,omitempty\u0026#34;` Name string `bson:\u0026#34;name\u0026#34;` } ç„¶åçœ‹çœ‹ä¸€ä¸ªç”Ÿæˆçš„å†…å®¹\nh := Home{Name:\u0026#34;123\u0026#34;} fmt.Println(h.ID) ç»“æœæ˜¯ ObjectIdHex(\u0026quot;\u0026quot;)ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ æ˜¯æƒ³åˆ¤æ–­ä¸€ä¸ªç»“æ„ä½“çš„ ObjectId æ˜¯å¦ä¸ºç©ºï¼Œä½¿ç”¨ h.ID ==\u0026quot;\u0026quot; æ˜¯ä¸€å®šä¼šç»“æœä¸º false çš„ã€‚å¦‚æœä½ æƒ³åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œæ­£ç¡®çš„æ–¹å¼åº”è¯¥ä¸ºï¼š\nh := Home{Name:\u0026#34;123\u0026#34;} fmt.Println(h.ID) fmt.Println(h.ID.Hex() == \u0026#34;\u0026#34;) æ­£ç¡®çš„ç”Ÿæˆ ObjectId é¦–å…ˆå€¼å¾—æ³¨æ„çš„æ˜¯ NewObjectIdWithTime(t time.Time) è¿™ä¸ªæ–¹æ³•ç”Ÿæˆçš„ ObjectId å¹¶ä¸æ˜¯å”¯ä¸€çš„ï¼Œç»“æœå¯èƒ½å¯¼è‡´çš„æ˜¯æ’å…¥å¤±è´¥ã€‚æœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯è®¾å®š ObjectId å¯¹è±¡æ”¯æŒ omitempty å±æ€§ï¼Œå°±åƒæˆ‘ä¸Šé¢ç”Ÿæˆçš„ç»“æ„ä½“ä¸€æ ·ï¼Œç”±æ•°æ®åº“ç»Ÿä¸€è°ƒé…ç”Ÿæˆ ObjectIdã€‚å¦‚æœçœŸçš„ç¡®å®éœ€è¦ï¼Œå¯ä»¥é€‰æ‹© NewObjctId()ã€‚\næ—¶é—´é—®é¢˜ ä¹‹å‰çœ‹åˆ°æœ‰äººé—®ï¼Œä¸ºä»€ä¹ˆä¿å­˜çš„æ—¶é—´è¿›å…¥åˆ°æ•°æ®åº“ä¸­æ…¢äº† 8 ä¸ªå°æ—¶å‘¢ï¼ŸåŸå› æ˜¯åœ¨ä¿å­˜è¿›å…¥ MongoDB æ—¶ï¼Œæ•°æ®æ˜¯æŒ‰ç…§ UTC æ—¶é—´ï¼ˆä¸æ‡‚ä»€ä¹ˆæ˜¯ UTCï¼Ÿçœ‹è¿™é‡Œï¼‰è¿›è¡Œçš„ä¿å­˜ï¼Œä½†æ˜¯å–å‡ºæ˜¯æŒ‰ç…§å½“å‰æ—¶åŒºæ¥å–å‡ºã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘çš„å®¢æˆ·å¦‚æœä¸éƒ½æ˜¯å›½äººï¼Œæˆ‘æ€ä¹ˆä¿å­˜æ—¶é—´å‘¢ï¼Ÿç›®å‰æˆ‘ä»¬é‡‡ç”¨äº†ä¸¤ç§æ–¹å¼æ¥ç¡®å®šæ•°æ®åº“çš„ä¿å­˜æ—¶é—´ã€‚ä¸€ç§æ˜¯ Unix æ—¶é—´æˆ³ ï¼Œè¿™ä¸ªæ˜¯ä¸å—åˆ°æ—¶åŒºçš„å½±å“çš„ï¼Œç”±å‰ç«¯æ ¼å¼åŒ–ä¸ºå¯¹åº”çš„æ—¶åŒºæ—¶é—´ï¼›å¦å¤–ä¸€ç§åˆ™æ˜¯éœ€è¦åœ¨é¢å¤–çš„å¯¹ä» MongoDB æ•°æ®åº“ä¸­å–å‡ºçš„æ•°æ®è¿›è¡Œé¢å¤–çš„æ—¶åŒºæ ¡å‡†ï¼Œç®€å•æ¥è¯´å¯ä»¥è¿™æ ·ï¼š\ntype Home struct {ID bson.ObjectId `bson:\u0026#34;_id,omitempty\u0026#34;` Name string `bson:\u0026#34;name\u0026#34;` InsertTime time.Time `bson:\u0026#34;insert_time\u0026#34;` } func main() {sess, _ := mgo.Dial(\u0026#34;127.0.0.1\u0026#34;) c := sess.DB(\u0026#34;test\u0026#34;).C(\u0026#34;home\u0026#34;) h := Home{Name:\u0026#34;123\u0026#34;, InsertTime: time.Now()} c.Upsert(bson.M{\u0026#34;name\u0026#34;:\u0026#34;123\u0026#34;}, h) c.Find(bson.M{\u0026#34;name\u0026#34;:\u0026#34;123\u0026#34;}).One(\u0026amp;h) fmt.Println(h.InsertTime.Format(\u0026#34;2006-01-02 15:04:05\u0026#34;)) tz, _ := time.LoadLocation(\u0026#34;America/New_York\u0026#34;) fmt.Println(h.InsertTime.In(tz).Format(\u0026#34;2006-01-02 15:04:05\u0026#34;)) } æ›´é«˜æ•ˆçš„ä½¿ç”¨ Session åœ¨ MongoDB ä¸­åˆç†ä½¿ç”¨ Session å¯ä»¥æ›´é«˜æ•ˆçš„æ“ä½œæ•°æ®åº“ï¼Œåšæ³•æ˜¯åœ¨ä¹‹å‰è¿›è¡Œä¸€æ¬¡ Copy æ“ä½œï¼š\nsessionCopy := mongoSession.Copy() defer sessionCopy.Close() collection := sessionCopy.DB(TestDatabase).C(\u0026#34;buoy_stations\u0026#34;) log.Printf(\u0026#34;RunQuery : %d : Executing\\n\u0026#34;, query) // Retrieve the list of stations. var buoyStations []BuoyStation err := collection.Find(nil).All(\u0026amp;buoyStations) if err != nil {log.Printf(\u0026#34;RunQuery : ERROR : %s\\n\u0026#34;, err) return } log.Printf(\u0026#34;RunQuery : %d : Count[%d]\\n\u0026#34;, query, len(buoyStations)) å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ MongoDB æœ¬èº«ï¼Œç›®å‰æˆ‘ä»¬å·²ç»æå‡åˆ°äº† MongoDB 3.0+ ç‰ˆæœ¬ï¼Œä¼˜åŠ¿æ˜¯ç›¸å¯¹ä¹‹å‰ç‰ˆæœ¬çš„ WiredTiger å¼•æ“æ¯”è¾ƒä»¤äººå°è±¡æ·±åˆ»ï¼ˆå¦‚æœæœ‰æ¡ä»¶å¯ä»¥é€‰æ‹©æœ€æ–°çš„ 3.2 ç‰ˆæœ¬ï¼‰ã€‚å¤§å®¶å¯¹ä¹‹å‰ MongoDB ä¸­ç´¢å¼•å»ºç«‹çš„ç—›è‹¦æœ‰å°è±¡ï¼Œè¿™ä¸ªç°è±¡åœ¨ WiredTiger å¼•æ“ä¸­ä¹Ÿæœ‰æ‰€æ”¹è¿›ã€‚æ›´å¤šçš„æ”¹è¿›å¯ä»¥åœ¨ WiredTiger çš„ å®˜ç½‘ å’Œ MongoDB çš„ æ€§èƒ½ç™½çš®ä¹¦ ä¸­äº†è§£æ›´å¤šã€‚æœ€åï¼Œå½“ç„¶ï¼Œæˆ‘ä»ç„¶ä¸å»ºè®®åœ¨éä¸¥é‡å¿…è¦æƒ…å†µä¸‹åˆ›å»ºå¤šä½™ç´¢å¼•ï¼Œè¿™å¯¹ MongoDB çš„æ€§èƒ½å’Œèµ„æºæ¶ˆè€—éƒ½æœ‰è¾ƒå¤§å½±å“ã€‚\n","date":"2016-01-26T21:30:00Z","permalink":"https://www.4async.com/2016/01/2016-01-26-something-about-mgo-driver/","title":"Mgo åº“çš„å¸¸è§å‘æ€»ç»“"},{"content":"æˆ‘ä»¬æ˜¯å¦‚ä½•è½å® Code Style Guide çš„ï¼ˆPython ç¯‡ï¼‰\næœ€è¿‘å¹´ç»ˆï¼Œæ€»æ˜¯æƒ³è°ˆè°ˆè¿‡å»ä¸€å¹´çš„æ„Ÿæ‚Ÿå’Œç§¯ç´¯ã€‚æ¥ä¸‹æ¥å¤§æ¦‚æœ‰å‡ ç¯‡å…³äºé¡¹ç›®ç®¡ç†ç­‰ç­‰ä¸€äº›å°æ–¹é¢çš„ä»‹ç»ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ä¸€ä¸‹æˆ‘ä»¬å¦‚ä½•å°† Python ç¼–ç è§„èŒƒçœŸæ­£è½å®åˆ°ç¨‹åºçš„å®é™…å¼€å‘è¿‡ç¨‹ä¸­çš„ã€‚\nç¼–ç è§„èŒƒé€‰æ‹© Python ä½œä¸ºçµæ´»çš„è„šæœ¬è¯­è¨€ï¼Œåœ¨æ ¼å¼æ–¹é¢å¹¶ä¸å­˜åœ¨å¤ªå¤šçš„é™åˆ¶ï¼ˆç›¸å¯¹ç¼–è¯‘è¯­è¨€ï¼‰ã€‚è¿™æ ·ä¼šå¯¼è‡´ä¸€ä¸ªæ¯”è¾ƒè›‹ç–¼çš„é—®é¢˜ï¼šåœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç”±äºä¸ªäººçš„ä¹ æƒ¯å’Œç¼–ç é£æ ¼ï¼Œå¯¼è‡´ç¨‹åºç¼ºå°‘ä¸€ä¸ªç»Ÿä¸€çš„æ ‡å‡†ï¼Œæ¯ä¸ªäººçš„ä»£ç è¡¨ç°å½¢å¼ä¹Ÿä¸åŒã€‚å› æ­¤ï¼Œåœ¨å®é™…é¡¹ç›®ç”±äºæ–°äººåŠ å…¥ã€è€äººé€€å‡ºè¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿæ¯”è¾ƒé«˜çš„æ¨¡å—ç»´æŠ¤æˆæœ¬ã€‚å› æ­¤ï¼Œåœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªç¼–ç æ ‡å‡†ä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„ã€‚\né¢å¯¹ç¼–ç é£æ ¼é€‰æ‹©ï¼Œæ¯”è¾ƒå¸¸è§çš„åŒ…æ‹¬ PEP-8 å’Œ Google Python Style Guideã€‚åœ¨æœ€åï¼Œæˆ‘é€‰æ‹©äº† PEP-8 ä½œä¸ºé¡¹ç›®ä¸­çš„å®é™…åº”ç”¨æ ‡å‡†ï¼Œè¦æ±‚ç¨‹åºéœ€è¦åœ¨æ»¡è¶³ç¼–ç è¦æ±‚è§„èŒƒçš„å‰æä¸‹è¿›è¡Œç¼–ç ã€‚\né™¤äº†å¯¹ä»£ç ç¼–ç æ›´ä¸ªçš„è¦æ±‚ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯¹ import ç­‰å…·ä½“çš„ç»†èŠ‚è¿›è¡Œäº†æ ‡å‡†åŒ–ã€‚\nå°½é‡è§„èŒƒæ³¨é‡Š åœ¨é™ä½æ¨¡å—ç»´æŠ¤æˆæœ¬è¿‡ç¨‹ä¸­ï¼Œå¦å¤–ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹å¼æ˜¯å°½é‡æä¾›è‰¯å¥½çš„ä»£ç æ³¨é‡Šã€‚å°½ç®¡è¿™ä¸ªç®—æ˜¯ä¸€ä¸ªå’Œè¯­è¨€æ— å…³çš„è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ï¼Œæˆ‘åªæ˜¯æƒ³åœ¨è¿™é‡Œæä¸€ä¸‹å¦å¤–ä¸€ä¸ª PEPï¼šPEP-0257ï¼Œè¿™é‡Œä»‹ç»äº†ä¸€ç§çº¦å®šçš„ docstring ç¼–å†™æ–¹æ³•ï¼Œå¯¹äºç¼–è¾‘å™¨è€Œè¨€ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶å¿«é€Ÿå®ç°æ³¨é‡Šã€‚\nä¸è¿‡æˆ‘è€ƒè™‘åˆ°å¯¹ä¸ªäººä¹ æƒ¯çš„å½±å“è¾ƒå¤§ï¼Œè¿™ä¸ª PEP å®é™…é¡¹ç›®å¼€å‘ä¸­å¹¶æœªä½œä¸ºå®é™…å¼€å‘è§„èŒƒï¼Œåªæ˜¯é¼“åŠ±å¤§å®¶åœ¨é¡¹ç›®ä¸­è¿›è¡Œæ‰§è¡Œã€‚\nä»è§„èŒƒåˆ°æ‰§è¡Œ ä»ä»£ç å¼€å‘æœ€åˆçš„è§„èŒƒçº¦å®šæ˜¯ä¸€å›äº‹ï¼Œå½“å›åˆ°å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¼€å‘è€…éš¾å…ä¼šå› ä¸ºä¸ªäººçš„ä¹ æƒ¯æˆ–è€…ç–å¿½ç­‰å„ç§åŸå› å¯¼è‡´ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ç¨‹åºç¼–ç é£æ ¼ä¸ç»Ÿä¸€é—®é¢˜ã€‚å› æ­¤åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åˆéœ€è¦é€šè¿‡å·¥å…·ä¿è¯ç¨‹åºåœ¨å®é™…è¿‡ç¨‹ä¸­èƒ½å¤Ÿå¸®åŠ©è§„èŒƒåŒ–æˆ–è€…æ£€æŸ¥æ ¼å¼é”™è¯¯ã€‚\nå€ŸåŠ©ç¤¾åŒºçš„åŠ›é‡ï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº†å·¥å…· flake8ã€yapf å’Œ isortã€‚å…¶ä¸­ï¼Œflake8 ç”¨äºæ£€æŸ¥æˆ‘ä»¬çš„ä»£ç æ˜¯å¦æ­£ç¡®çš„æ‰§è¡Œäº†æ ‡å‡†ï¼›yapf å·¥å…·ç”¨äºå¿«é€Ÿè¿›è¡Œ PEP-8 æ ‡å‡†åŒ–ï¼Œå‡å°‘äº†äººå·¥ä¿®æ”¹çš„æˆæœ¬ï¼›isort å·¥å…·åˆ™æ˜¯æ‰§è¡Œæˆ‘ä»¬ä¹‹å‰æåˆ°çš„ import æ ‡å‡†åŒ–å·¥ä½œã€‚\nyapf æ˜¯ Google å‘˜å·¥å¼€å‘çš„ä¸€ä¸ª Python æ ¼å¼åŒ–å·¥å…·ï¼Œå®ƒæ”¯æŒ PEP8 ä¸ Google ç¼–ç æ ‡å‡†ï¼Œä¸€äº›å…·ä½“çš„ä½¿ç”¨æ–¹å¼å¯ä»¥æŸ¥çœ‹é¡¹ç›®çš„ä¸»é¡µã€‚åœ¨å®é™…çš„é¡¹ç›®è½åœ°è¿‡ç¨‹ä¸­ï¼Œä½ åº”è¯¥ä¼šé‡åˆ°çš„ä¸€ä¸ªé—®é¢˜æ˜¯å…³äº flake8 ä¸ yapf æ ‡å‡†ä¸ä¸€è‡´å¯¼è‡´ä¸€ä¸ªé€šè¿‡å¦ä¸€ä¸ªæ— æ³•æ­£å¸¸é€šè¿‡çš„é—®é¢˜ã€‚è¿™ä¸€ä¸ªæ–¹é¢ï¼Œæˆ‘ä»¬é€‰æ‹©çš„æ–¹å¼æ˜¯ç»Ÿä¸€å¦¥åæˆ flake8 çš„æ ‡å‡†ã€‚å¯¹äº yapf ä¸æ”¯æŒçš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å»ºè®®æ´»ç”¨ # yapf: disable æ ‡è®°ã€‚\nè¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜æ˜¯å…³äºä¸€äº› flake8 æœ¬èº«çš„æ ‡å‡†ï¼ˆæˆ–è€…è¯´ PEPï¼8 æ ‡å‡†ï¼‰é—®é¢˜ï¼Œæ¯”å¦‚ flake8 å¸¸è§é—®é¢˜ï¼šE501 ç¨‹åºä»£ç é•¿åº¦è¶…è¿‡ 79 ä¸ªå­—ç¬¦é—®é¢˜ï¼Œæˆ‘ä»¬å®é™…ç¼–ç è¿‡ç¨‹ä¸­å¯¹è¿™ä¸€æ ‡å‡†åšäº†é€‚å½“å¦¥åï¼Œå…è®¸æœ€å¤§å•è¡Œå­—ç¬¦ä¸²é•¿åº¦ä¸º 200ã€‚ä½†æ˜¯æˆ‘ä»¬ä»ç„¶å»ºè®®ç¼©å°è‡³ 79 ä¸ªå­—ç¬¦å†…è¡¨ç¤ºå®Œã€‚\nä»æ‰§è¡Œåˆ°æ£€æŸ¥ åœ¨æœ€åä¸€å…³ï¼Œæ˜¯æˆ‘ä»¬çš„ä¸Šçº¿å‰æ£€æŸ¥ã€‚æˆ‘ä»¬è®¾ç½®äº†ä»£ç è´¨é‡æ£€æŸ¥å…³å¡å’Œç³»ç»Ÿé›†æˆæµ‹è¯•ã€‚\nåœ¨ä»£ç è´¨é‡æ£€æŸ¥è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå¯¹ç¨‹åºçš„å®é™…ä»£ç è´¨é‡è¿›è¡Œè¯„ä¼°ã€‚æˆ‘ä»¬å¯¹ä»£ç è´¨é‡è¿›è¡Œæ‰“åˆ†ï¼Œå¯¹äºåˆ†å€¼è¾ƒä½çš„ä»£ç ä¸å…è®¸æäº¤è¿›å…¥ master åˆ†æ”¯ã€‚ä»£ç è´¨é‡çš„æ£€æŸ¥ï¼Œæˆ‘ä»¬åŒæ ·çš„é‡‡ç”¨äº† flake8 å·¥å…·ä½œä¸ºç»Ÿä¸€æ ‡å‡†ã€‚æœ€åä¸ªäººçš„ä»£ç è´¨é‡ï¼Œé€šè¿‡ Webhook ä¹Ÿä¼šç›´æ¥åé¦ˆåœ¨å…·ä½“çš„é¡¹ç›®ç®¡ç†å·¥å…·ä¸­ã€‚\n","date":"2016-01-15T17:30:00Z","permalink":"https://www.4async.com/2016/01/2016-01-15-how-we-follow-python-style-guide/","title":"æˆ‘ä»¬æ˜¯å¦‚ä½•è½å® Code Style Guide çš„ï¼ˆPython ç¯‡ï¼‰"},{"content":"åœ¨ cargo.toml æ–‡ä»¶ä¸­æ·»åŠ \n[dependencies] hyper = \u0026#34;0.7.2\u0026#34; src ä¸­åˆ›å»º main.rs\nextern crate hyper; use std::io::Read; use hyper::Client; fn main() {println!(\u0026#34;welcome to rust http\u0026#34;); let client = Client::new(); let mut res = client.get(\u0026#34;https://httpbin.org/get\u0026#34;).send().unwrap(); assert_eq!(res.status, hyper::Ok); println!(\u0026#34;headers:\\n {}\u0026#34;, res.headers); let mut body = String::new(); res.read_to_string(\u0026amp;mut body).unwrap(); println!(\u0026#34;body:\\n {}\u0026#34;, body); res = client.post(\u0026#34;https://httpbin.org/post\u0026#34;).body(\u0026#34;{\\\u0026#34;a\\\u0026#34;:1}\u0026#34;).send().unwrap(); assert_eq!(res.status, hyper::Ok); println!(\u0026#34;headers:\\n {}\u0026#34;, res.headers); let mut body = String::new(); res.read_to_string(\u0026amp;mut body).unwrap(); println!(\u0026#34;body:\\n {}\u0026#34;, body); } æ‰§è¡Œ cargo build åæ‰§è¡Œ ./target/debug / é¡¹ç›®å  å³å¯çœ‹åˆ°æ•ˆæœã€‚\n","date":"2016-01-06T17:13:00Z","permalink":"https://www.4async.com/2016/01/2016-01-06-rust-http-client/","title":"ä¸€ä¸ª Rust HttpClient ä¾‹å­"},{"content":"æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­é™¤äº† å¤§é‡çš„ä½¿ç”¨ Python å¤–ï¼Œä¹Ÿå¤§é‡çš„ä½¿ç”¨äº† Golang æ„å»ºé«˜æ•ˆåŸºç¡€è¿è¡ŒæœåŠ¡ã€‚åœ¨ä½¿ç”¨ Golang è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç° Golang ç¨‹åºç¼ºå°‘ä¾èµ–åº“ç‰ˆæœ¬åŠŸèƒ½æ˜¯ä¸€ä¸ªéå¸¸ä»¤äººå¤´å¤§çš„é—®é¢˜ï¼šæŸäº›ä¾èµ–åœ¨æŸä¸ª commit ä¹‹åå‘ç”Ÿäº† API å˜æ›´ä¹‹åï¼Œå¦‚æœä¸ä¿®æ”¹ä»£ç å¾ˆéš¾å…¼å®¹ï¼Œç„¶è€Œå¼€å‘è€…ä¹‹é—´å¾ˆæœ‰å¯èƒ½å› ä¸ºå‚ä¸çš„æ—¶é—´ä¸åŒï¼Œå¯¼è‡´æ‰§è¡Œ go get å‘½ä»¤è·å–çš„ç‰ˆæœ¬ä¸åŒï¼Œè€Œå¯¼è‡´åœ¨ä¸åŒç”µè„‘ä¸Šå‡ºç°ç¼–è¯‘ä¸é€šè¿‡é—®é¢˜ã€‚åŒæ—¶ï¼Œåœ¨å¤šä¸ªç¨‹åºä¸­ï¼Œå¦‚æœä½¿ç”¨çš„ commit ç‰ˆæœ¬ä¸åŒï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºç¼–è¯‘è¿‡ç¨‹ä¸­å‡ºç°ä¸åŒçš„é—®é¢˜ã€‚\nåœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼Œä¸€ç§æ˜¯æ‹†è§£ go get å‘½ä»¤çš„æ‰§è¡Œï¼Œé¦–å…ˆåˆ›å»ºå¯¹åº”ä¾èµ–ç›®å½•ï¼Œåˆ©ç”¨ git å‘½ä»¤åˆ‡æ¢è‡³æŒ‡å®šçš„ commitï¼Œç„¶åæ‰§è¡Œ go install å‘½ä»¤ã€‚å¦å¤–ä¸€ç§æ¯”è¾ƒçœäº‹çš„æ–¹æ³•æ˜¯ä½¿ç”¨ godep å·¥å…·ï¼Œè¿™é‡Œå°±ä¸åšè¿‡å¤šä»‹ç»äº†ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæ–‡æ¡£æˆ–è€…æœç´¢ä¸­æ–‡æ•™ç¨‹ã€‚\nåœ¨ Golang1.5 ä¹‹åï¼ŒGo æä¾›äº† GO15VENDOREXPERIMENT ç¯å¢ƒå˜é‡ï¼Œç”¨äºå°† go build æ—¶çš„åº”ç”¨è·¯å¾„æœç´¢è°ƒæ•´æˆä¸º  å½“å‰é¡¹ç›®ç›®å½• / vendor ç›®å½•æ–¹å¼ã€‚é€šè¿‡è¿™ç§å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ç±»ä¼¼äº godep æ–¹å¼çš„é¡¹ç›®ä¾èµ–ç®¡ç†ã€‚ä¸è¿‡èµ·ç åœ¨ç¨‹åºç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå†ä¹Ÿæ— éœ€åœ¨å…¶ä»–ç«¯éƒ¨ç½²ä¸€ä¸ª godep å·¥å…·ã€‚\nåœ¨ä½¿ç”¨ä¹‹å‰ï¼Œéœ€è¦å®‰è£…ä¸€ä¸ªè¾…åŠ©å·¥å…·ï¼ˆå¦‚æœ Golang è‡ªæ”¹ä¸€ä¸ªå°±å¥½äº†ï¼‰ï¼šgo get -u -v github.com/kardianos/govendorã€‚\nä¸‹é¢ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚é¦–å…ˆæœ‰ä¸€ä¸ªåä¸º vendorproj çš„é¡¹ç›®ã€‚å‡å¦‚åªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼š\npackage main import (\u0026#34;github.com/yeeuu/echoic\u0026#34;) func main() {e := echoic.New() e.SetDebug(true) e.Run(\u0026#34;127.0.0.1:4321\u0026#34;) } æ‰§è¡Œä¸€ä¸‹å‘½ä»¤å°±å¯ä»¥ç”Ÿæˆ vendor æ–‡ä»¶å¤¹ï¼š\n$ govendor init $ ls main.go vendor $ cd vendor/ $ ls vendor.json è¿™ä¸ª vendor.json ä¼šç±»ä¼¼ godep å·¥å…·ä¸­çš„æè¿°æ–‡ä»¶ç‰ˆæœ¬çš„åŠŸèƒ½ã€‚æ¥ä¸‹æ¥ï¼Œéœ€è¦æ‰§è¡Œå‘½ä»¤å°†å½“å‰åº”ç”¨å¿…é¡»çš„æ–‡ä»¶åŒ…å«è¿›æ¥\n$ govendor add +external å¦‚æœéœ€è¦æ›´æ–°æˆ–ç§»é™¤ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹å·¥å…·çš„å…·ä½“æ–‡æ¡£ä½¿ç”¨ update æˆ–è€… remove å‘½ä»¤å³å¯ã€‚è¿™æ ·ä¼šåœ¨ vendor ç›®å½•ä¸‹å°†å¿…é¡»çš„ç¼–è¯‘æ–‡ä»¶ç§»å…¥è¿›æ¥ï¼ˆæ³¨æ„ï¼šæµ‹è¯•æ‰€éœ€ä¾èµ–å¹¶ä¸åŒ…å«ï¼Œä¾èµ–é¡¹ç›®çš„æµ‹è¯•æ–‡ä»¶ä¹Ÿä¸ä¼šåŒ…å«ï¼‰ã€‚\n$ ls github.com golang.org vendor.json $ cat vendor.json {\u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;,\u0026#34;ignore\u0026#34;:\u0026#34;test\u0026#34;,\u0026#34;package\u0026#34;: [{\u0026#34;path\u0026#34;:\u0026#34;github.com/yeeuu/echoic\u0026#34;,\u0026#34;revision\u0026#34;:\u0026#34;a7d6994f92e2dc60cff071ae38b204fbd4bd2a3f\u0026#34;,\u0026#34;revisionTime\u0026#34;:\u0026#34;2015-12-18T11:14:29+08:00\u0026#34;}, {\u0026#34;path\u0026#34;: \u0026#34;golang.org/x/net/context\u0026#34;, \u0026#34;revision\u0026#34;: \u0026#34;1d9fd3b8333e891c0e7353e1adcfe8a612573033\u0026#34;, \u0026#34;revisionTime\u0026#34;: \u0026#34;2015-11-13T15:40:13-08:00\u0026#34; } ] } $ cd github.com/yeeuu/echoic $ ls LICENSE context.go group.go router.go README.md echoic.go response.go é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ GO15VENDOREXPERIMENT=1 ä½¿ç”¨ vendor æ–‡ä»¶å¤¹æ„å»ºæ–‡ä»¶ã€‚å¯ä»¥é€‰æ‹© export GO15VENDOREXPERIMENT=1 æˆ–è€…å¹²è„† GO15VENDOREXPERIMENT=1 go build æ‰§è¡Œç¼–è¯‘ã€‚\né€šè¿‡è¿™ç§æ–¹å¼å°±å¯ä»¥ä¿è¯ç¨‹åºèƒ½å¤Ÿå®ç°ç±»ä¼¼ Python ä¸­ Virtualenv çš„æ¨¡å¼ï¼Œå®ç°ä¸åŒç¨‹åºä½¿ç”¨ä¸åŒç‰ˆæœ¬ä¾èµ–çš„ç›®çš„ã€‚\n","date":"2016-01-05T23:13:00Z","permalink":"https://www.4async.com/2016/01/2016-01-05-golang-vendor/","title":"ä½¿ç”¨ vendor ç®¡ç† Golang é¡¹ç›®ä¾èµ–"},{"content":"åœ¨æœåŠ¡å™¨ç«¯å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ¯”è¾ƒç—›è‹¦çš„æ˜¯åœ¨å¤šä¸ªäººå‘˜è¿›è¡Œå¼€å‘æ—¶ï¼Œå®¹æ˜“å› ä¸ºç¯å¢ƒä¸ç»Ÿä¸€ç­‰ç­‰çš„æƒ…å†µï¼Œå®¹æ˜“å‡ºç°ä¼ è¯´ä¸­çš„ â€œæˆ‘è¿™å„¿èƒ½è·‘ï¼Œæ¢ä¸ªç¯å¢ƒå°±å‡ºé—®é¢˜â€ çš„æƒ…å†µã€‚æˆ‘ä»¬åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­å¤§é‡çš„ä½¿ç”¨äº† Python è¯­è¨€æ„å»º Web ç±»å‹æœåŠ¡ã€‚Python å¯¹äºæŸäº›éœ€è¦ç¼–è¯‘çš„æ‰©å±•æ¨¡å—ï¼Œå¯èƒ½åœ¨ä¸åŒçš„åœºæ™¯ä¸‹å¸¦æ¥ä¸åŒçš„å½±å“ï¼ˆå¦‚ç¼–è¯‘ä¸è¿‡ç­‰ç­‰ã€äºŒè¿›åˆ¶ç‰ˆæœ¬ä¸åŒç­‰ç­‰é—®é¢˜ï¼‰ã€‚\nåœ¨å¤„ç†è¿™ç§å¤šäººåä½œçš„ç¯å¢ƒç»Ÿä¸€é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬é€‰æ‹© Vagrantï¼‹VirtualBoxï¼‹CentOS è™šæ‹Ÿç¯å¢ƒæ–¹æ¡ˆç»Ÿä¸€å¼€å‘ç¯å¢ƒï¼Œé¿å…å‡ºç°åˆ‡æ¢å¼€å‘è€…ï¼Œåˆ‡æ¢å¼€å‘ç¯å¢ƒå¸¦æ¥çš„ä¸ç»Ÿä¸€çš„éº»çƒ¦ã€‚\nåˆå§‹åŒ–é¡¹ç›® vagrant å¯ä»¥åœ¨ https://www.vagrantup.com/ ä¸‹è½½å®‰è£…ï¼Œå¯¹åº”çš„ç³»ç»Ÿé•œåƒå¯ä»¥åœ¨ http://www.vagrantbox.es/ æ‰¾åˆ°ä¸‹è½½å®‰è£…ã€‚æ ¹æ®å›½å†…å®é™…çš„ä¸‹è½½æƒ…å†µï¼Œæˆ‘ä»¬å»ºè®®å…ˆè¡Œä¸‹è½½é•œåƒæ–¹å¼åˆå§‹åŒ–é¡¹ç›®ã€‚åœ¨é€‰æ‹©é•œåƒæ—¶ï¼Œå»ºè®®é€‰æ‹©ä¸çº¿ä¸ŠæœåŠ¡å™¨ç‰ˆæœ¬ç›¸åŒçš„é•œåƒã€‚ä¸‹é¢æˆ‘ä»¬ä»…æ¼”ç¤ºæœ¬åœ°åŠ è½½é•œåƒæ–¹å¼ã€‚\nä¸‹è½½ vagrant å’Œé•œåƒåï¼Œå®‰è£… vagrant è½¯ä»¶ã€‚è¿™æ ·å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œç›¸å…³æŒ‡ä»¤ã€‚è¿˜æœ‰ï¼Œè®°å¾—å®‰è£… VirtualBoxã€‚\nvagrant box add centos /path/to/centos-6.6-x86_64.box æ¯”å¦‚æˆ‘ä»¬çº¿ä¸ŠæœåŠ¡å™¨ä½¿ç”¨äº† centos ç¯å¢ƒï¼Œæˆ‘ä»¬åœ¨å¼€å‘æ—¶ï¼Œä¹Ÿæ˜¯é€‰æ‹©ç›¸åŒç‰ˆæœ¬çš„ CentOS boxã€‚\næ¥ä¸‹æ¥è¿›å…¥å¯¹åº”çš„é¡¹ç›®ç›®å½•ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»º Vagrantfileï¼ˆcentos æ˜¯åˆšåˆšæ·»åŠ çš„ boxï¼‰ã€‚å½“ç„¶ï¼Œå¦‚æœé¡¹ç›®å·²ç»å­˜åœ¨ Vagrantfileï¼Œåˆ™å¯ä»¥è¿›è¡Œçœç•¥ã€‚\nvagrant init centos é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹ä¼šç”Ÿæˆ Vagrantfile æ–‡ä»¶ã€‚\nVagrantfile ç¼–è¾‘ Vagrant åœ¨æ‰§è¡Œç¯å¢ƒåˆå§‹åŒ–æ—¶ä¼šæ ¹æ® Vagrantfile æ–‡ä»¶çš„æè¿°è¿›è¡Œã€‚æ¯”è¾ƒå¸¸è§çš„ç¼–è¾‘å†…å®¹ä¸€èˆ¬åŒ…å«ä»¥ä¸‹å‡ ç§ã€‚\nå¦‚æœæƒ³è¦ä½¿ç”¨ IP è®¿é—®è¯¥è™šæ‹ŸæœåŠ¡å™¨ï¼Œå¯ä»¥é€šè¿‡åˆ é™¤ config.vm.network :private_network, ip: \u0026quot;192.168.33.10\u0026quot; å‰çš„ â€œ#â€ï¼Œå°†è¯¥è®¾ç½®ç”Ÿæ•ˆã€‚æ³¨æ„éœ€è¦ç¡®è®¤ ip ä¸è¦è¢«å ç”¨ã€‚\nå¦‚æœéœ€è¦åŒæ­¥æ–‡ä»¶å¤¹åˆ°è™šæ‹Ÿæœºä¸­ï¼ˆæ¯”å¦‚é¡¹ç›®æ–‡ä»¶å¤¹ï¼‰ï¼Œå¯ä»¥æ³¨é‡Šæ‰ config.vm.synced_folder \u0026quot;../data\u0026quot;, \u0026quot;/vagrant_data\u0026quot; å‰çš„ â€œ#â€ï¼Œå°†è®¾ç½®ç”Ÿæ•ˆã€‚è¯¥å‘½ä»¤å¯ä»¥åˆ‡æ¢æ›´å¤æ‚çš„è®¾ç½®ï¼šconfig.vm.synced_folder \u0026quot;./\u0026quot;, \u0026quot;/var/www\u0026quot;, create: true, group: \u0026quot;nginx\u0026quot;, owner: \u0026quot;nginx\u0026quot; å‘½ä»¤è¡¨ç¤ºå°†æœ¬åœ°çš„å½“å‰ç›®å½•æ˜ å°„åˆ° /var/www ç›®å½•ï¼Œè‹¥ä¸å­˜åœ¨æ—¶åˆ›å»ºï¼ŒåŒæ„ user å’Œ group è®¾ç½®ä¸º nginxã€‚\næœåŠ¡å™¨åˆå§‹åŒ– æœåŠ¡å™¨åˆå§‹åŒ–åŠŸèƒ½ä¹Ÿç®—æ˜¯åœ¨ Vagrantfile ç¼–è¾‘ä¹‹ä¸­çš„ï¼Œä¹‹æ‰€ä»¥å•ç‹¬ä»‹ç»ï¼Œæ˜¯å› ä¸ºæœåŠ¡å™¨çš„ç¯å¢ƒæ˜¯åˆå§‹åŒ–æ—¶ä¸€ä¸ªæ›´åŠ ç‹¬ç«‹çš„è¿‡ç¨‹ï¼Œåº”ç”¨ä¹Ÿæœ€å¤šã€‚åœ¨ vagrant ç¯å¢ƒåˆå§‹åŒ–æ—¶ï¼Œå¯ä»¥é€šè¿‡ Vagrantfile çš„ config.vm.provision \u0026quot;shell\u0026quot; åŠŸèƒ½ï¼Œåˆå§‹åŒ–æœåŠ¡å™¨é…ç½®å’Œä¸€äº›åŸºç¡€è¿è¡Œç¯å¢ƒã€‚æ¯”å¦‚è¯´æˆ‘ä»¬ç°åœ¨æ­£åœ¨ä½¿ç”¨çš„é…ç½®å¦‚ä¸‹ï¼ˆVagrantfile ä¸­å¯¹åº”å†…å®¹ï¼‰ï¼š\nconfig.vm.provision \u0026#34;shell\u0026#34;, inline: \u0026lt;\u0026lt;-SHELL  mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo sudo yum install -y zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel sudo yum install -y mysql-server mysql-client mysql-devel sudo yum install -y make gcc gcc-c++ cd /tmp wget https://www.python.org/ftp/python/2.7.11/Python-2.7.11.tgz tar zxvf Python-2.7.11.tgz cd /tmp/Python-2.7.11 ./configure --prefix=/usr/local --with-ensurepip=upgrade make sudo make install sudo /usr/local/bin/pip install virtualenv virtualenv /mnt/pyenv sudo /usr/local/bin/virtualenv /mnt/pyenv source /mnt/pyenv/bin/activate sudo /mnt/pyenv/bin/pip install -r /vagrant/requirements.txt SHELL è¯¥é¡¹é…ç½®ä½¿ç”¨äº†é˜¿é‡Œäº‘çš„ CentOS æºï¼Œç¼–è¯‘ Python 2.7.11 å¹¶ä¸”å®‰è£…åº”ç”¨å¿…é¡»çš„ä¸€äº›ä¾èµ–ã€‚é¡¹ç›®é»˜è®¤è·¯å¾„ä¼šå®‰è£…åœ¨ / vagrant / ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡å…¶ä»–å½¢å¼ï¼Œå®‰è£…è‡³ä¸çº¿ä¸Šç¯å¢ƒç›¸åŒçš„ä½ç½®ã€‚\nVagrant ä¹Ÿæ”¯æŒä½¿ç”¨ ansible-playbook å½¢å¼éƒ¨ç½²æœåŠ¡ï¼Œå¦‚æœä½ äº†è§£å…·ä½“çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å½¢å¼æŒ‡å®š playbookã€‚\nVagrant.configure(2) do |config| # # Run Ansible from the Vagrant Host # config.vm.provision \u0026#34;ansible\u0026#34; do |ansible| ansible.playbook = \u0026#34;playbook.yml\u0026#34; end end å½“ç„¶ï¼Œåˆ©ç”¨ Vagrant ä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿çš„å­¦ä¹ å’Œæµ‹è¯• ansible-playbookã€‚\nè¿è¡Œæµ‹è¯• åœ¨ç¼–è¾‘ Vagrantfile å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ vagrant up å‘½ä»¤ï¼Œå¯åŠ¨è™šæ‹Ÿç¯å¢ƒã€‚æ­¤æ—¶å¦‚æœè®¾ç½®äº†æœåŠ¡å™¨åˆå§‹åŒ–ï¼Œä¼šåœ¨æœ€å¼€å§‹è¿‡ç¨‹ä¸­æ‰§è¡Œå¤§é‡çš„åˆå§‹åŒ–æ“ä½œã€‚å¾…æ“ä½œå®Œæˆåï¼Œåˆ™å¯ä»¥éªŒè¯ã€‚\næ‰“åŒ…åˆ†å‘ åœ¨ç¼–è¾‘å®Œæˆåï¼Œåˆ™å¯ä»¥æ ¹æ®å½“å‰ç‰ˆæœ¬ç”Ÿæˆ Box æ–‡ä»¶ã€‚å¯¹å…¶ä»–å¼€å‘è€…è€Œè¨€ï¼Œå¯ä»¥é€šè¿‡ Box æ–‡ä»¶ç›´æ¥å¿«é€Ÿç”Ÿæˆå¼€å‘ç¯å¢ƒï¼Œä¹Ÿé¿å…äº†è¿˜éœ€è¦è¿›è¡ŒæœåŠ¡å™¨åˆå§‹åŒ–é˜¶æ®µã€‚\nvagrant package è¾“å‡ºä¼šæç¤ºä¿å­˜æ–‡ä»¶åœ°å€ï¼š\n==\u0026gt; default: Attempting graceful shutdown of VM... ==\u0026gt; default: Clearing any previously set forwarded ports... ==\u0026gt; default: Exporting VM... ==\u0026gt; default: Compressing package to: /path/to/package.box å¦‚æœè¿›è¡Œäº†åˆå§‹åŒ–ç¯å¢ƒçš„å˜æ›´ï¼Œæˆ‘ä»¬å»ºè®®åŒæ—¶æ›´æ–° Vagrantfile æ–‡ä»¶ï¼Œé€šè¿‡é‡æ–°æ‰“åŒ…çš„æ–¹å¼è¿›è¡ŒåŒæ­¥æ›´æ–°ã€‚\nVagrant å…¶ä»–å‘½ä»¤ åœ¨åˆšåˆšæåˆ°çš„å‡ ä¸ªå‘½ä»¤ä¸­ï¼Œvagrant up å¯ä»¥ç”¨äºå¼€å¯ç¯å¢ƒï¼Œå¯¹åº”çš„è¿˜æœ‰ä¸€äº›å…¶ä»–å‘½ä»¤ï¼š\nvagrant ssh\t// ssh vagrant halt\t// å…³æœº vagrant status\t// æŸ¥çœ‹çŠ¶æ€ vagrant destory\t// åˆ é™¤è™šæ‹Ÿæœºï¼Œå¦‚æœä½ éœ€è¦é‡æ–°å¼€å§‹ ... ","date":"2015-12-28T15:43:12Z","permalink":"https://www.4async.com/2015/12/2015-12-28-using-vagrant-development-env/","title":"ä½¿ç”¨ Vagrant ç»Ÿä¸€å¼€å‘ç¯å¢ƒå®è·µ"},{"content":"ä»Šå¤©åœ¨è®¨è®º Python çš„å¼‚æ­¥ç¼–ç¨‹çš„æ—¶å€™æåˆ°çš„é—®é¢˜ï¼šåˆ°åº•ä¸ºä»€ä¹ˆç°åœ¨ Python çš„å¼‚æ­¥æ•°æ®åº“é‚£ä¹ˆå°‘å‘¢ï¼Ÿåˆ°åº•é’ˆå¯¹ Python è€Œè¨€ï¼Œä»€ä¹ˆæ˜¯å½±å“ Python æ€§èƒ½æœ€å¤§çš„é—¨æ§›å‘¢ï¼Ÿ\nä¸ºäº†ææ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¯¹çº¿ä¸Šç¯å¢ƒåº”ç”¨ä½¿ç”¨äº†æ€§èƒ½æ¢é’ˆç³»ç»Ÿã€‚æ€§èƒ½å‡ºäººæ„æ–™ (CPython 2.7.10)ï¼š\nä¼¼ä¹çœŸå®æ¥è¯´ï¼ŒPython æœ¬èº«çš„æ€§èƒ½é—®é¢˜æ‰æ˜¯å½±å“ Python æ€§èƒ½çš„çœŸå‡¶ã€‚\nåœ¨æ­¤ä»¥å‰ï¼Œæˆ‘ä»¬è°ˆè¿™ä¸ªä¹‹å‰ï¼Œè¿˜æ˜¯å…ˆå¤ä¹ ä¸€ä¸‹ä»€ä¹ˆæ˜¯ GIL å§ã€‚æ— è®ºæ˜¯ CPython(æ™®é€šçš„ Python 2.7.x å’Œ Python 3.5.x) è¿˜æ˜¯ pypyï¼Œéƒ½æ˜¯æœ‰ä¸€ä¸ªåæ›°ã€Global Interpreter Lockã€çš„ä¸œè¥¿é™åˆ¶äº†å®ƒçš„æ€§èƒ½ï¼Œç”¨ä¸€å¼ å›¾å¯ä»¥ç”ŸåŠ¨çš„è¡¨ç°å¸¦ GIL çš„ Python åœ¨å¤šæ ¸ä¸‹çš„ CPU å‹åŠ›ï¼š\nGIL é™åˆ¶äº† Python çš„ bytecode åªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼Œä½¿ç”¨è¿™ç§ GIL é¿å…å¤šçº¿ç¨‹ç¼–ç¨‹æ—¶éšå«å¹¶å‘è®¿é—®å¯¹è±¡å¯èƒ½å¸¦æ¥çš„æ½œåœ¨é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿè®© Python åœ¨å¤šæ ¸ä¸‹æ€§èƒ½è¡¨ç°æ„Ÿäººã€‚è¿™ç§å®ç°æ–¹å¼ä¸€ç›´å¤‡å—è¯Ÿç—…ï¼Œè¿™ä¹Ÿå¯¼è‡´ Python åœ¨æŸäº›é«˜å¹¶å‘åœºæ™¯æ—¶ä¼šå‡ºç°è¾ƒä¸¥é‡çš„æ€§èƒ½ä¸‹æ»‘é—®é¢˜ã€‚\nåœ¨ Python æ€§èƒ½æå‡ä¸Šï¼Œæ¯”è¾ƒå¸¸è§çš„æ€§èƒ½æå‡çš„æ–¹å¼ï¼Œæ˜¯å°†å¤šçº¿ç¨‹è½¬åŒ–ä¸ºå¤šè¿›ç¨‹æ–¹å¼ï¼Œä»¥å……åˆ†åˆ©ç”¨ CPU å¤šæ ¸å¿ƒã€‚ä½†æ˜¯è¿™æ ·å¸¦æ¥ç›´æ¥çš„é—®é¢˜æ˜¯è¿›ç¨‹é—´é€šè®¯ä¼šä¸¥é‡å½±å“æ•´ä½“ç¨‹åºçš„ååé‡ã€‚ä¸€ä¸ªç®€å•çš„ CPU å¯†é›† Python socket çš„é€šè®¯ç¨‹åºï¼Œé Block çŠ¶æ€ä¸‹ï¼Œååé‡èƒ½æœ‰å¤§æ¦‚ 10 å€ä»¥ä¸Šçš„å·®è·ã€‚(å‚è€ƒ Python Concurrency From the Ground Up )\nä¸è¿‡ç›¸å¯¹æ¥è¯´ï¼Œè¿™æ ·è™½ç„¶å½±å“äº†æœ€å¤§ååé‡ï¼Œä½†æ˜¯åœ¨åˆ©ç”¨å¤šæ ¸æ•ˆç‡ä¸Šæå‡æ˜æ˜¾ï¼Œå³ä¾¿æ˜¯ CPU å¯†é›†çš„æƒ…å†µï¼Œä¹Ÿèƒ½ä¿è¯ç¨‹åºçš„æ•´ä½“ååé‡ä¸ä¼šå‡ºç°çº¿ç¨‹æ¨¡å¼çš„æˆç™¾ä¸Šåƒå€çš„æ€§èƒ½å·®è·ã€‚\né‚£ä¹ˆï¼Œè¿™äº›ä¸å¼‚æ­¥åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ\nå¯¹å¼‚æ­¥æƒ…å†µè€Œè¨€ï¼Œå¯¹ Python çš„ä»£ç æ‰§è¡Œå¹¶æ²¡æœ‰å½±å“ï¼Œæˆ‘ä»¬æ‰€æåˆ°çš„å¼‚æ­¥ï¼Œèƒ½å¤Ÿæå‡çš„æ€§èƒ½ï¼Œä¹Ÿä»…ä»…é™äºé’ˆå¯¹é’ˆå¯¹äºè¾ƒé•¿ IO ç­‰å¾…çš„é—®é¢˜ï¼Œæ¯”å¦‚å¸¸è§çš„å°±æ˜¯è¯·æ±‚è¿œç¨‹ API æ¥å£ (http query) ç­‰ç­‰æƒ…å†µã€‚å¯¹è¿™ç§æƒ…å†µè€Œè¨€ï¼Œå½“è¿›å…¥ Blocking çš„ socket ç­‰å¾…æ—¶é—´æ—¶ï¼Œå°† CPU æ—¶é—´é‡Šæ”¾ï¼Œç”¨äºå»åšæ›´æœ‰æ„ä¹‰çš„å…¶ä»–æ“ä½œæ˜¯å®Œå…¨åˆç†çš„ã€‚å¯¹äºæ•°æ®åº“æ“ä½œè€Œè¨€ï¼Œåˆ™ä¹Ÿéœ€è¦æ ¹æ®ä¸åŒçš„æƒ…å†µè¿›è¡Œå¯¹å¾…ã€‚æ¯”å¦‚è¿æ¥è¿œç¨‹ç½‘ç»œæ•°æ®åº“ï¼Œé‚£ä¹ˆä½¿ç”¨å¼‚æ­¥åˆ™æ ¹æ®å®é™…çš„æ€§èƒ½æ¶ˆè€—æ—¶é—´è€Œå®šï¼Œå¦‚æœæ˜¯æœ¬åœ°çš„æ•°æ®åº“ï¼Œé‚£ä¹ˆæˆ‘æƒ³å›åˆ°ç¬¬ä¸€å¼ å›¾ï¼Œç›¸ä¿¡æ ¹æœ¬æ— éœ€ä½¿ç”¨å¼‚æ­¥åº“å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nä»ä¸€ä¸ª CPU å¯†é›†çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½çœ‹å‡ºï¼Œå…¶å®ï¼Œä½¿ç”¨ JIT å¸¦æ¥çš„æ€§èƒ½æå‡æ¯”è¾ƒæ˜æ˜¾ã€‚ç„¶è€Œï¼Œå¯¹å¼‚æ­¥åº“çš„å¼‚æ­¥é˜Ÿåˆ—ä»æ˜¯æŒ‰é¡ºåºå•ä¸ªå¤„ç†çš„ï¼Œå½“é˜Ÿåˆ—è¾ƒé•¿æ—¶ï¼ŒåŒæ ·ä¼šå¸¦æ¥æ›´ä¸¥é‡çš„æ€§èƒ½æŸè€—ï¼šå› ä¸ºå¯¹é‚£äº›å¿«é€Ÿçš„ç½‘ç»œè¿æ¥è€Œè¨€ï¼ŒPython GIL åˆ™æ›´åŠ é™åˆ¶äº† Python çš„æ‰§è¡Œæ€§èƒ½ã€‚\n","date":"2015-11-11T18:18:18Z","permalink":"https://www.4async.com/2015/11/2015-11-11-async-python/","title":"Python å¼‚æ­¥ä¸æ€§èƒ½è¿·æ€"},{"content":"åŸæ–‡åœ°å€: PEP-0492\n   PEP 492     æ ‡é¢˜ åç¨‹ä¸ async/await è¯­æ³•   ä½œè€… Yury Selivanov \u0026lt;yury at magic.io\u0026gt;   ç¿»è¯‘ ipfans \u0026lt;ipfanscn at gmail.com\u0026gt;   çŠ¶æ€ æœ€ç»ˆç¨¿   Python ç‰ˆæœ¬ 3.5   ç¿»è¯‘æœ€åæ›´æ–° 2015-11-03    ç›®å½•\næ‘˜è¦ API è®¾è®¡å’Œå®ç°çš„å¤‡æ³¨ åŸºæœ¬åŸç†å’Œç›®æ ‡\nè¯­æ³•è§„èŒƒ\n æ–°åç¨‹å£°æ˜è¯­æ³• types.coroutine() Await è¡¨è¾¾å¼  æ–°çš„æ“ä½œç¬¦ä¼˜å…ˆçº§åˆ—è¡¨ await è¡¨è¾¾å¼ç¤ºä¾‹   å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†ä¸ async with  æ–°è¯­æ³• ä¾‹å­   å¼‚æ­¥è¿­ä»£å™¨ä¸ async for  æ–°è¯­æ³• ä¾‹å­ 1 ä¾‹å­ 2 ä¸ºä»€ä¹ˆä½¿ç”¨ StopAsyncIteration   åç¨‹å¯¹è±¡  ä¸ç”Ÿæˆå™¨çš„ä¸åŒä¹‹å¤„ åç¨‹å¯¹è±¡æ–¹æ³•   è°ƒè¯•ç‰¹æ€§ æ–°çš„æ ‡å‡†åº“å‡½æ•° æ–°çš„æŠ½è±¡åŸºç±»  ä¸“ç”¨æœ¯è¯­è¡¨\nå‡½æ•°ä¸æ–¹æ³•åˆ—è¡¨\nç§»æ¤è®¡åˆ’\n å‘åå…¼å®¹æ€§  asyncio asyncio ç§»æ¤ç­–ç•¥ CPython ä»£ç ä¸­çš„ async/await   è¯­æ³•æ›´æ–° å¤±æ•ˆè®¡åˆ’  è®¾è®¡æ€è·¯ (æš‚æ—¶ä¸è€ƒè™‘ç¿»è¯‘)\næ€§èƒ½\n æ€»ä½“å½±å“ ç¼–è¯‘å™¨ä¿®æ”¹ async/await  å®ç°å‚è€ƒ\n ä¸Šå±‚ä¿®æ”¹å’Œæ–°åè®®åˆ—è¡¨ å¯ä»¥å·¥ä½œçš„å®ä¾‹  å‚è€ƒ\nè‡´è°¢\nç‰ˆæƒä¿¡æ¯\næ‘˜è¦ ä¸æ–­å¢é•¿çš„ç½‘ç»œè¿é€šæ€§éœ€æ±‚å¸¦åŠ¨äº†å¯¹å“åº”æ€§ã€ä¼¸ç¼©æ€§ä»£ç çš„éœ€æ±‚ã€‚è¿™ä¸ª PEP çš„ç›®æ ‡åœ¨äºå›ç­”å¦‚ä½•æ›´ç®€å•çš„ã€Pythinic çš„å®ç°æ˜¾å¼çš„å¼‚æ­¥ / å¹¶å‘çš„ Python ä»£ç ã€‚\næˆ‘ä»¬æŠŠåç¨‹æ¦‚å¿µç‹¬ç«‹å‡ºæ¥ï¼Œå¹¶ä¸ºå…¶ä½¿ç”¨æ–°çš„è¯­æ³•ã€‚æœ€ç»ˆç›®æ ‡æ˜¯å»ºç«‹ä¸€ä¸ªé€šç”¨ã€æ˜“å­¦çš„ Python å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œå¹¶å°½é‡ä¸åŒæ­¥ç¼–ç¨‹çš„é£æ ¼ä¿æŒä¸€è‡´ã€‚\nè¿™ä¸ª PEP å‡è®¾å¼‚æ­¥ä»»åŠ¡è¢«ä¸€ä¸ªäº‹ä»¶å¾ªç¯å™¨ï¼ˆç±»ä¼¼äºæ ‡å‡†åº“é‡Œçš„ asyncio.events.AbstractEventLoopï¼‰ç®¡ç†å’Œè°ƒåº¦ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šä¾èµ–æŸä¸ªäº‹ä»¶å¾ªç¯å™¨çš„å…·ä½“å®ç°æ–¹æ³•ï¼Œä»æœ¬è´¨ä¸Šè¯´åªä¸æ­¤ç›¸å…³ï¼šä½¿ç”¨ yield ä½œä¸ºç»™è°ƒåº¦å™¨çš„ä¿¡å·ï¼Œè¡¨ç¤ºåç¨‹å°†ä¼šæŒ‚èµ·ç›´åˆ°ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶ï¼ˆå¦‚ IOï¼‰å®Œæˆã€‚\næˆ‘ä»¬ç›¸ä¿¡è¿™äº›æ”¹å˜å°†ä¼šä½¿ Python åœ¨è¿™ä¸ªå¼‚æ­¥ç¼–ç¨‹å¿«é€Ÿå¢é•¿çš„é¢†åŸŸèƒ½å¤Ÿä¿æŒä¸€å®šçš„ç«äº‰æ€§ï¼Œå°±åƒè®¸å¤šå…¶å®ƒç¼–ç¨‹è¯­è¨€å·²ç»ã€å°†è¦è¿›è¡Œçš„æ”¹å˜é‚£æ ·ã€‚\nAPI è®¾è®¡å’Œå®ç°çš„å¤‡æ³¨ æ ¹æ® Python 3.5 Beta æœŸé—´çš„åé¦ˆï¼Œæˆ‘ä»¬è¿›è¡Œäº†é‡æ–°è®¾è®¡ï¼šæ˜ç¡®çš„æŠŠåç¨‹ä»ç”Ÿæˆå™¨é‡Œç‹¬ç«‹å‡ºæ¥ \u0026mdash; åŸç”Ÿåç¨‹ç°åœ¨æ‹¥æœ‰äº†è‡ªå·±å®Œæ•´çš„ç‹¬ç«‹ç±»å‹ï¼Œè€Œä¸å†æ˜¯ä¸€ç§æ–°çš„ç”Ÿæˆå™¨ç±»å‹ã€‚\nè¿™ä¸ªæ”¹å˜ä¸»è¦æ˜¯ä¸ºäº†è§£å†³åœ¨ Tornado Web æœåŠ¡ä¸­é‡Œé›†æˆåç¨‹æ—¶å‡ºç°çš„ä¸€äº›é—®é¢˜ã€‚\nåŸºæœ¬åŸç†å’Œç›®æ ‡ ç°åœ¨ç‰ˆæœ¬çš„ Python æ”¯æŒä½¿ç”¨ç”Ÿæˆå™¨å®ç°åç¨‹åŠŸèƒ½ (PEP-342)ï¼Œåé¢é€šè¿‡ PEP-380 å¼•å…¥äº† yield from è¯­æ³•è¿›è¡Œäº†å¢å¼ºã€‚ä½†æ˜¯è¿™æ ·ä»æœ‰ä¸€äº›ç¼ºç‚¹ï¼š\n åç¨‹ä¸å¸¸è§„çš„ç”Ÿæˆå™¨åœ¨ç›¸åŒè¯­æ³•æ—¶ç”¨ä»¥æ··æ·†ï¼Œå°¤å…¶æ˜¯å¯¹å¿ƒå¼€å‘è€…è€Œè¨€ã€‚ ä¸€ä¸ªå‡½æ•°æ˜¯å¦æ˜¯åç¨‹éœ€è¦é€šè¿‡æ˜¯å¦ä¸»ä½“ä»£ç ä¸­ä½¿ç”¨äº† yield æˆ–è€… yield from è¯­å¥è¿›è¡Œæ£€æµ‹ï¼Œè¿™æ ·åœ¨é‡æ„ä»£ç ä¸­æ·»åŠ ã€å»é™¤è¿‡ç¨‹ä¸­å®¹æ˜“å‡ºç°ä¸æ˜æ˜¾çš„é”™è¯¯ å¼‚æ­¥è°ƒç”¨çš„æ”¯æŒè¢« yield æ”¯æŒçš„è¯­æ³•å…ˆå®šäº†ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•ä½¿ç”¨æ›´å¤šçš„è¯­æ³•ç‰¹æ€§ï¼Œæ¯”å¦‚ with å’Œ for è¯­å¥ã€‚  è¿™ä¸ªæè®®çš„ç›®çš„æ˜¯å°†åç¨‹ä½œä¸ºåŸç”Ÿ Python è¯­è¨€ç‰¹æ€§ï¼Œå¹¶ä¸”å°†ä»–ä»¬ä¸ç”Ÿæˆå™¨æ˜ç¡®çš„åŒºåˆ†å¼€ã€‚å®ƒé¿å…äº†ç”Ÿæˆå™¨ / åç¨‹ä¸­é—´çš„æ··æ·†è¯·å›°é«˜ï¼Œæ–¹ä¾¿ç¼–å†™å‡ºä¸ä¾èµ–äºç‰¹å®šåº“çš„åç¨‹ä»£ç ã€‚è¿™ä¸ªä¹Ÿæ–¹ä¾¿ linter å’Œ IDE èƒ½å¤Ÿå®ç°æ›´å¥½çš„è¿›è¡Œé™æ€ä»£ç åˆ†æå’Œé‡æ„ã€‚\nåŸç”Ÿåç¨‹å’Œç›¸å…³çš„æ–°è¯­æ³•ç‰¹æ€§ä½¿å¾—å¯ä»¥åœ¨å¼‚æ­¥æ¡†æ¶ä¸‹å¯ä»¥å®šä¹‰ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨å’Œè¿­ä»£åè®®ã€‚åœ¨è¿™ä¸ªæè®®åç»­ä¸­ï¼Œæ–°çš„ async with è¯­æ³•è®© Python ç¨‹åºåœ¨è¿›å…¥å’Œç¦»å¼€è¿è¡Œä¸Šä¸‹æ–‡æ—¶å®ç°å¼‚æ­¥è°ƒç”¨ï¼Œæ–°çš„ async for è¯­æ³•å¯ä»¥åœ¨è¿­ä»£å™¨ä¸­å®ç°å¼‚æ­¥è°ƒç”¨ã€‚\nè¯­æ³•è§„èŒƒ è¿™ä¸ªæè®®ä»‹ç»äº†æ–°çš„è¯­æ³•ç”¨äºå¢å¼º Python ä¸­çš„åç¨‹æ”¯æŒã€‚\nè¿™ä¸ªè¯­æ³•è§„èŒƒå‡è®¾ä½ å·²ç»äº†è§£ Python ç°æœ‰åç¨‹å®ç°æ–¹æ³• (PEP-342 å’Œ PEP-380)ã€‚è¿™æ¬¡è¯­æ³•æ”¹å˜çš„åŠ¨æœºæ¥è‡ªäº asyncio æ¡†æ¶ (PEP-3156) å’Œ Cofunctions æè®® (PEP-3152ï¼Œç°åœ¨æ­¤æè®®å·²è¢«åºŸå¼ƒ)ã€‚\nä»æœ¬æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ åŸç”Ÿåç¨‹ ä»£æŒ‡æ–°è¯­æ³•ç”Ÿå‘½çš„å‡½æ•°ï¼ŒåŸºäºç”Ÿæˆå™¨çš„åç¨‹ ç”¨äºè¡¨ç¤ºé‚£äº›åŸºäºç”Ÿæˆå™¨è¯­æ³•å®ç°çš„åç¨‹ã€‚åç¨‹ åˆ™è¡¨ç¤ºä¸¤ä¸ªåœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨çš„å†…å®¹ã€‚\næ–°åç¨‹å£°æ˜è¯­æ³• ä¸‹é¢çš„æ–°è¯­æ³•ç”¨äºå£°æ˜åŸç”Ÿåç¨‹ï¼š\nasync def read_data(db): pass åç¨‹çš„ä¸»è¦å±æ€§åŒ…æ‹¬ï¼š\n async def å‡½æ•°å§‹ç»ˆä¸ºåç¨‹ï¼Œå³ä½¿å®ƒä¸åŒ…å« await è¡¨è¾¾å¼ã€‚ å¦‚æœåœ¨ async å‡½æ•°ä¸­ä½¿ç”¨ yield æˆ–è€… yield from è¡¨è¾¾å¼ä¼šäº§ç”Ÿ SyntaxError é”™è¯¯ã€‚ åœ¨å†…éƒ¨ï¼Œå¼•å…¥äº†ä¸¤ä¸ªæ–°çš„ä»£ç å¯¹è±¡æ ‡è®°ï¼š  CO_COROUTINE ç”¨äºæ ‡è®°åŸç”Ÿåç¨‹ï¼ˆå’Œæ–°è¯­æ³•ä¸€èµ·å®šä¹‰ï¼‰ CO_ITERABLE_COROUTINE ç”¨äºæ ‡è®°åŸºäºç”Ÿæˆå™¨çš„åç¨‹ï¼Œå…¼å®¹åŸç”Ÿåç¨‹ã€‚(é€šè¿‡ types.coroutine() å‡½æ•°è®¾ç½®)   å¸¸è§„ç”Ÿæˆå™¨åœ¨è°ƒç”¨æ—¶ä¼šè¿”å›ä¸€ä¸ª genertor å¯¹è±¡ï¼ŒåŒç†ï¼Œåç¨‹åœ¨è°ƒç”¨æ—¶ä¼šè¿”å›ä¸€ä¸ª coroutine å¯¹è±¡ã€‚ åç¨‹ä¸å†æŠ›å‡º StopIteration å¼‚å¸¸ï¼Œè€Œæ˜¯æ›¿ä»£ä¸º RuntimeErrorã€‚å¸¸è§„ç”Ÿæˆå™¨å®ç°ç±»ä¼¼çš„è¡Œä¸ºéœ€è¦è¿›è¡Œå¼•å…¥  __future__(PEP-3156) å½“åç¨‹è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œä¸€ä¸ªä»æœªè¢« await çš„åç¨‹ä¼šæŠ›å‡º RuntimeWarning å¼‚å¸¸ã€‚(å‚è€ƒ è°ƒè¯•ç‰¹æ€§) æ›´å¤šå†…å®¹è¯·å‚è€ƒ åç¨‹å¯¹è±¡ ä¸€èŠ‚ã€‚  types.coroutine() åœ¨ types æ¨¡å—ä¸­æ–°æ·»åŠ äº†ä¸€ä¸ªå‡½æ•° coroutine(fn) ç”¨äº asyncio ä¸­åŸºäºç”Ÿæˆå™¨çš„åç¨‹ä¸æœ¬ PEP ä¸­å¼•å…¥çš„åŸç”Ÿæºåç¨‹äº’é€šã€‚\n@types.coroutine def process_data(db): data = yield from read_data(db) ... è¿™ä¸ªå‡½æ•°å°†ç”Ÿæˆå™¨å‡½æ•°å¯¹è±¡è®¾ç½® CO_ITERABLE_COROUTINE æ ‡è®°ï¼Œå°†è¿”å›å¯¹è±¡å˜ä¸º coroutine å¯¹è±¡ã€‚\nå¦‚æœ fn ä¸æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œé‚£ä¹ˆå®ƒä¼šå¯¹å…¶è¿›è¡Œå°è£…ã€‚å¦‚æœå®ƒè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œé‚£ä¹ˆå®ƒä¼šå°è£…ä¸€ä¸ª awaitable ä»£ç†å¯¹è±¡ (å‚è€ƒä¸‹é¢ awaitable å¯¹è±¡çš„å®šä¹‰)ã€‚\næ³¨æ„ï¼šCO_COROUTINE æ ‡è®°ä¸èƒ½é€šè¿‡ types.coroutine() è¿›è¡Œè®¾ç½®ï¼Œè¿™å°±å¯ä»¥å°†æ–°è¯­æ³•å®šä¹‰çš„åŸç”Ÿåç¨‹ä¸åŸºäºç”Ÿæˆå™¨çš„åç¨‹è¿›è¡ŒåŒºåˆ†ã€‚\ntypes æ¨¡å—æ·»åŠ äº†ä¸€ä¸ªæ–°å‡½æ•° coroutine(fn)ï¼Œä½¿ç”¨å®ƒï¼Œâ€œç”Ÿæˆå™¨å®ç°çš„åç¨‹â€ å’Œ â€œåŸç”Ÿåç¨‹â€ ä¹‹é—´å¯ä»¥è¿›è¡Œäº’æ“ä½œã€‚\nAwait è¡¨è¾¾å¼ ä¸‹é¢æ–°çš„ await è¡¨è¾¾å¼ç”¨äºè·å–åç¨‹æ‰§è¡Œç»“æœï¼š\nasync def read_data(db): data = await db.fetch(\u0026#39;SELECT ...\u0026#39;) ... await ä¸ yield from ç›¸ä¼¼ï¼ŒæŒ‚èµ· read_data åç¨‹çš„æ‰§è¡Œç›´åˆ° db.fetch è¿™ä¸ª awaitable å¯¹è±¡å®Œæˆå¹¶è¿”å›ç»“æœæ•°æ®ã€‚\nå®ƒå¤ç”¨äº† yield from çš„å®ç°ï¼Œå¹¶ä¸”æ·»åŠ äº†é¢å¤–çš„éªŒè¯å‚æ•°ã€‚await åªæ¥å—ä»¥ä¸‹ä¹‹ä¸€çš„ awaitable å¯¹è±¡ï¼š\n ä¸€ä¸ªåŸç”Ÿåç¨‹å‡½æ•°è¿”å›çš„åŸç”Ÿåç¨‹å¯¹è±¡ã€‚ ä¸€ä¸ªä½¿ç”¨ types.coroutine() ä¿®é¥°å™¨çš„å‡½æ•°è¿”å›çš„åŸºäºç”Ÿæˆå™¨çš„åç¨‹å¯¹è±¡ã€‚ ä¸€ä¸ªåŒ…å«è¿”å›è¿­ä»£å™¨çš„ __await__ æ–¹æ³•çš„å¯¹è±¡ã€‚\nä»»æ„ä¸€ä¸ª yield from é“¾éƒ½ä¼šä»¥ä¸€ä¸ª yield ç»“æŸï¼Œè¿™æ˜¯ Future å®ç°çš„åŸºæœ¬æœºåˆ¶ã€‚å› æ­¤ï¼Œåç¨‹åœ¨å†…éƒ¨ä¸­æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç”Ÿæˆå™¨ã€‚æ¯ä¸ª await æœ€ç»ˆä¼šè¢« await è°ƒç”¨é“¾æ¡ä¸Šçš„æŸä¸ª yield è¯­å¥æŒ‚èµ·ï¼ˆå‚è€ƒ PEP-3156 ä¸­çš„è¿›ä¸€æ­¥è§£é‡Šï¼‰ã€‚\nä¸ºäº†å¯ç”¨åç¨‹çš„è¿™ä¸€ç‰¹ç‚¹ï¼Œä¸€ä¸ªæ–°çš„é­”æœ¯æ–¹æ³• __await__ è¢«æ·»åŠ è¿›æ¥ã€‚åœ¨ asyncio ä¸­ï¼Œå¯¹äºå¯¹è±¡åœ¨ await è¯­å¥å¯ç”¨ Future å¯¹è±¡åªéœ€è¦æ·»åŠ  __await__ = __iter__ è¿™è¡Œåˆ° asyncio.Future ç±»ä¸­ã€‚\nåœ¨æœ¬ PEP ä¸­ï¼Œå¸¦æœ‰ __await__ æ–¹æ³•çš„å¯¹è±¡ä¹Ÿå«åš Future-like å¯¹è±¡ã€‚ åŒæ ·çš„ï¼Œè¯·æ³¨æ„åˆ° __aiter__ æ–¹æ³•ï¼ˆä¸‹é¢ä¼šå®šä¹‰ï¼‰ä¸èƒ½ç”¨äºè¿™ç§ç›®çš„ã€‚å®ƒæ˜¯ä¸åŒçš„åè®®ï¼Œæœ‰ç‚¹ç±»ä¼¼äºç”¨ __iter__ æ›¿ä»£æ™®é€šè°ƒç”¨æ–¹æ³•çš„ __call___ã€‚\nå¦‚æœ __await__ è¿”å›éè¿­ä»£å™¨ç±»å‹æ•°æ®ï¼Œä¼šäº§ç”Ÿä¸€ä¸ª TypeError. CPython C API ä¸­ä½¿ç”¨  tp_as_async.am_await å®šä¹‰çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆç±»ä¼¼ __await__ æ–¹æ³•ï¼‰ã€‚  æ–°çš„æ“ä½œç¬¦ä¼˜å…ˆçº§åˆ—è¡¨ å…³é”®è¯ await ä¸ yield å’Œ yield form æ“ä½œç¬¦çš„åŒºåˆ«æ˜¯ await è¡¨è¾¾å¼å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸éœ€è¦æ‹¬å·åŒ…è£¹ã€‚\nåŒæ ·çš„ï¼Œyield from å…è®¸å…è®¸ä»»æ„è¡¨è¾¾å¼åšå…¶å‚æ•°ï¼ŒåŒ…å«è¡¨è¾¾å¼å¦‚ yield a()+b()ï¼Œè¿™æ ·é€šå¸¸å¤„ç†ä½œä¸º yield from (a()+b())ï¼Œè¿™ä¸ªé€šå¸¸ä¼šé€ æˆ Bugã€‚é€šå¸¸æƒ…å†µä¸‹ä»»æ„ç®—æ•°æ“ä½œçš„ç»“æœéƒ½ä¸ä¼šæ˜¯ awaitable å¯¹è±¡ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°† await çš„ä¼˜å…ˆçº§è°ƒæ•´ä¸ºä½äº [], () å’Œ.ï¼Œä½†æ˜¯é«˜äº ** æ“ä½œç¬¦ã€‚\n   æ“ä½œç¬¦ æè¿°     yield x , yield from x Yield è¡¨è¾¾å¼   lambda Lambda è¡¨è¾¾å¼   if \u0026ndash; else æ¡ä»¶è¡¨è¾¾å¼   or å¸ƒå°”æˆ–   and å¸ƒå°”ä¸   not x å¸ƒå°”é   in , not in , is , is not , \u0026lt;, \u0026lt;= ,\u0026gt; , \u0026gt;= , != , == æ¯”è¾ƒï¼ŒåŒ…å«æˆå‘˜æµ‹è¯•å’Œç±»å‹æµ‹è¯•   | å­—èŠ‚æˆ–   ^ å­—èŠ‚å¼‚æˆ–   \u0026amp; å­—èŠ‚ä¸   \u0026laquo;,\u0026raquo; ç§»ä½   + , - åŠ å’Œå‡   * , @ , / , // , % ä¹˜ï¼ŒçŸ©é˜µä¹˜æ³•ï¼Œé™¤ï¼Œå–ä½™   +x , -x , ~x æ­£æ•°, å¤æ•°, å–å   ** å¹³æ–¹   await x Await è¡¨è¾¾å¼   x[index] , x[index:index] , x(arguments\u0026hellip;) , x.attribute å­é›†ï¼Œåˆ‡ç‰‡ï¼Œè°ƒç”¨ï¼Œå±æ€§   (expressions\u0026hellip;) , [expressions\u0026hellip;] , {key: value\u0026hellip;} , {expressions\u0026hellip;} ç±»å‹æ˜¾ç¤º    await è¡¨è¾¾å¼ç¤ºä¾‹ æœ‰æ•ˆçš„è¯­æ³•ä¾‹å­:\n   è¡¨è¾¾å¼ ä¼šè¢«å¤„ç†ä¸º     if await fut: pass if (await fut): pass   if await fut + 1: pass if (await fut) + 1: pass   pair = await fut, \u0026lsquo;spam\u0026rsquo; pair = (await fut), \u0026lsquo;spam\u0026rsquo;   with await fut, open(): pass with (await fut), open(): pass   await foo()[\u0026lsquo;spam\u0026rsquo;].baz()() await (foo()[\u0026lsquo;spam\u0026rsquo;].baz()() )   return await coro() return ( await coro() )   res = await coro() ** 2 res = (await coro()) ** 2   func(a1=await coro(), a2=0) func(a1=(await coro()), a2=0)   await foo() + await bar() (await foo()) + (await bar())   -await foo() -(await foo())    é”™è¯¯çš„è¯­æ³•ä¾‹å­:\n   è¡¨è¾¾å¼ åº”å†™ä½œ     await await coro() await (await coro())   await -coro() await (-coro())    å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†ä¸ async with ä¸€ä¸ªå¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ˜¯ç”¨äºåœ¨ enter å’Œ exit æ–¹æ³•ä¸­ç®¡ç†æš‚åœæ‰§è¡Œçš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚\nä¸ºæ­¤ï¼Œæˆ‘ä»¬è®¾ç½®äº†æ–°çš„å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚æ·»åŠ äº†ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼š __aenter__ å’Œ __aexit__ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½è¿”å› awaitable å¯¹è±¡ã€‚\nå¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¾‹å­å¦‚ä¸‹ï¼š\nclass AsyncContextManager: async def __aenter__(self): await log(\u0026#39;entering context\u0026#39;) async def __aexit__(self, exc_type, exc, tb): await log(\u0026#39;exiting context\u0026#39;) æ–°è¯­æ³• ä¸€ä¸ªæ–°çš„å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†è¯­æ³•è¢«æ¥å—ï¼š\nasync with EXPR as VAR: BLOCK è¯­ä¹‰ä¸Šç­‰åŒäºï¼š\nmgr = (EXPR) aexit = type(mgr).__aexit__ aenter = type(mgr).__aenter__(mgr) exc = True VAR = await aenter try: BLOCK except: if not await aexit(mgr, *sys.exc_info()): raise else: await aexit(mgr, None, None, None) å’Œæ™®é€šçš„ with è¯­å¥ä¸€æ ·ï¼Œå¯ä»¥åœ¨å•ä¸ª async with è¯­å¥é‡ŒæŒ‡å®šå¤šä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚\nåœ¨ä½¿ç”¨ async with æ—¶ï¼Œå¦‚æœä¸Šä¸‹æ–‡ç®¡ç†å™¨æ²¡æœ‰ __aenter__ å’Œ __aexit__ æ–¹æ³•ï¼Œåˆ™ä¼šå¼•å‘é”™è¯¯ã€‚åœ¨ async def å‡½æ•°ä¹‹å¤–ä½¿ç”¨ async with åˆ™ä¼šå¼•å‘ SyntaxError å¼‚å¸¸ã€‚\nä¾‹å­ é€šè¿‡å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ›´å®¹æ˜“å®ç°åç¨‹å¯¹æ•°æ®åº“äº‹åŠ¡çš„æ­£ç¡®ç®¡ç†ï¼š\nasync def commit(session, data): ... async with session.transaction(): ... await session.update(data) ... ä»£ç çœ‹èµ·æ¥ä¹Ÿæ›´åŠ ç®€å•ï¼š\nasync with lock: ... è€Œä¸æ˜¯\nwith (yield from lock): ... å¼‚æ­¥è¿­ä»£å™¨ä¸ async for ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨èƒ½å¤Ÿåœ¨å®ƒçš„è¿­ä»£å®ç°é‡Œè°ƒç”¨å¼‚æ­¥ä»£ç ï¼Œä¹Ÿå¯ä»¥åœ¨å®ƒçš„ __next__ æ–¹æ³•é‡Œè°ƒç”¨å¼‚æ­¥ä»£ç ã€‚ä¸ºäº†æ”¯æŒå¼‚æ­¥è¿­ä»£ï¼Œéœ€è¦ï¼š\n ä¸€ä¸ªå¯¹è±¡å¿…é¡»å®ç° __aiter__ æ–¹æ³•ï¼ˆæˆ–è€…ï¼Œä½¿ç”¨ CPython C API çš„ tp_as_async.am_aiter å®šä¹‰ï¼‰ï¼Œè¿”å›ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨å¯¹è±¡ä¸­çš„ ```awaitable```` ç»“æœã€‚ ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨å¿…é¡»å®ç° __anext__ æ–¹æ³•ï¼ˆæˆ–è€…ï¼Œä½¿ç”¨ CPython C API çš„ tp_as_async.am_anext å®šä¹‰ï¼‰è¿”å›ä¸€ä¸ª awaitableã€‚ åœæ­¢è¿­ä»£å™¨çš„ __anext__ å¿…é¡»æŠ›å‡ºä¸€ä¸ª StopAsyncIteration  å¼‚å¸¸ã€‚  ä¸€ä¸ªå¼‚æ­¥è¿­ä»£çš„ä¾‹å­ï¼š\nclass AsyncIterable: async def __aiter__(self): return self async def __anext__(self): data = await self.fetch_data() if data: return data else: raise StopAsyncIteration async def fetch_data(self): ... æ–°è¯­æ³• ä¸€ç§æ–°çš„å¼‚æ­¥è¿­ä»£æ–¹æ¡ˆè¢«é‡‡çº³ï¼š\nasync for TARGET in ITER: BLOCK else: BLOCK2 è¯­ä¹‰ä¸Šç­‰åŒäºï¼š\niter = (ITER) iter = await type(iter).__aiter__(iter) running = True while running: try: TARGET = await type(iter).__anext__(iter) except StopAsyncIteration: running = False else: BLOCK else: BLOCK2 å¦‚æœå¯¹ä¸€ä¸ªæ™®é€šçš„ä¸å«æœ‰ __aiter__ æ–¹æ³•çš„è¿­ä»£å™¨ä½¿ç”¨ async forï¼Œä¼šå¼•å‘ TypeError å¼‚å¸¸ã€‚å¦‚æœåœ¨ async def å‡½æ•°å¤–ä½¿ç”¨ async for ä¼šå·²å‘ SyntaxError å¼‚å¸¸ã€‚\nå’Œæ™®é€šçš„ for è¯­æ³•ä¸€æ ·ï¼Œasync for æœ‰å¯é€‰çš„ else åˆ†æ”¯ã€‚\nä¾‹å­ 1 é€šè¿‡å¼‚æ­¥è¿­ä»£å™¨ï¼Œå°±å¯ä»¥å®ç°é€šè¿‡è¿­ä»£å®ç°å¼‚æ­¥ç¼“å†²æ•°æ®ï¼š\nasync for data in cursor: ... å½“ cursor æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨æ—¶ï¼Œå°±å¯ä»¥åœ¨ N æ¬¡è¿­ä»£åä»æ•°æ®åº“ä¸­é¢„å– N è¡Œæ•°æ®ã€‚\nä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†æ–°çš„å¼‚æ­¥è¿­ä»£åè®®ï¼š\nclass Cursor: def __init__(self): self.buffer = collections.deque() async def _prefetch(self): ... async def __aiter__(self): return self async def __anext__(self): if not self.buffer: self.buffer = await self._prefetch() if not self.buffer: raise StopAsyncIteration return self.buffer.popleft() é‚£ä¹ˆè¿™ä¸ª Cursor ç±»å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼ä½¿ç”¨ï¼š\nasync for row in Cursor(): print(row) è¿™ä¸ªç­‰åŒäºä¸‹é¢çš„ä»£ç ï¼š\ni = await Cursor().__aiter__() while True: try: row = await i.__anext__() except StopAsyncIteration: break else: print(row) ä¾‹å­ 2 ä¸‹é¢çš„å·¥å…·ç±»ç”¨äºå°†æ™®é€šçš„è¿­ä»£è½¬æ¢ä¸ºå¼‚æ­¥ã€‚è¿™ä¸ªå¹¶æ²¡æœ‰ä»€ä¹ˆå®é™…çš„ä½œç”¨ï¼Œè¿™ä¸ªä»£ç åªæ˜¯ç”¨äºæ¼”ç¤ºæ™®é€šè¿­ä»£ä¸å¼‚æ­¥è¿­ä»£ä¹‹é—´çš„å…³ç³»ã€‚\nclass AsyncIteratorWrapper: def __init__(self, obj): self._it = iter(obj) async def __aiter__(self): return self async def __anext__(self): try: value = next(self._it) except StopIteration: raise StopAsyncIteration return value async for letter in AsyncIteratorWrapper(\u0026#34;abc\u0026#34;): print(letter) ä¸ºä»€ä¹ˆä½¿ç”¨ StopAsyncIteration åç¨‹åœ¨å†…éƒ¨å®ç°ä¸­ä¾æ—§æ˜¯ä¾èµ–äºè¿­ä»£å™¨çš„ã€‚å› æ­¤ï¼Œåœ¨ PEP-479 ç”Ÿæ•ˆä¹‹å‰ï¼Œä¸‹é¢ä¸¤è€…å¹¶æ²¡æœ‰åŒºåˆ«ï¼š\ndef g1(): yield from fut return \u0026#39;spam\u0026#39; and def g2(): yield from fut raise StopIteration(\u0026#39;spam\u0026#39;) ä½†æ˜¯åœ¨ PEP 479 æ¥å—å¹¶ä¸”é»˜è®¤å¯¹åç¨‹å¼€å¯æ—¶ï¼Œä¸‹é¢çš„ä¾‹å­ä¸­çš„ StopIteration ä¼šè¢«å°è£…æˆ RuntimeErrorã€‚\nasync def a1(): await fut raise StopIteration(\u0026#39;spam\u0026#39;) æ‰€ä»¥ï¼Œæƒ³é€šçŸ¥å¤–éƒ¨ä»£ç è¿­ä»£å·²ç»ç»“æŸï¼ŒæŠ›å‡ºä¸€ä¸ª StopIteration å¼‚å¸¸çš„æ˜¯ä¸è¡Œçš„ã€‚å› æ­¤ï¼Œä¸€ä¸ªæ–°çš„å†…ç½®å¼‚å¸¸ç±» StopAsyncIteration  è¢«å¼•å…¥è¿›æ¥äº†ã€‚\nå¦å¤–ï¼Œæ ¹æ® PEP 479ï¼Œæ‰€æœ‰åç¨‹ä¸­æŠ›å‡ºçš„ StopIteration å¼‚å¸¸éƒ½ä¼šè¢«å°è£…æˆ RuntimeErrorã€‚\nåç¨‹å¯¹è±¡ ä¸ç”Ÿæˆå™¨çš„ä¸åŒä¹‹å¤„ è¿™èŠ‚è¿›é€‚ç”¨äº CO_COROUTINE æ ‡è®°çš„åŸç”Ÿåç¨‹ï¼Œå³ï¼Œä½¿ç”¨ async def è¯­æ³•å®šä¹‰çš„å¯¹è±¡ã€‚\nç°æœ‰çš„ asyncio åº“ä¸­çš„ * åŸºäºç”Ÿæˆå™¨çš„åç¨‹ * çš„è¡Œä¸ºæœªåšå˜æ›´ã€‚\nä¸ºäº†å°†åç¨‹ä¸ç”Ÿæˆå™¨åŒºåˆ«å¼€æ¥ï¼Œå®šä¹‰äº†ä¸‹é¢çš„æ¦‚å¿µï¼š\n åŸç”Ÿåç¨‹å¯¹è±¡ä¸å®ç° __iter__ å’Œ __next__ æ–¹æ³•ã€‚å› æ­¤ï¼Œä»–ä»¬ä¸èƒ½å¤Ÿé€šè¿‡ iter()ï¼Œlist()ï¼Œtuple() å’Œå…¶ä»–ä¸€äº›å†…ç½®å‡½æ•°è¿›è¡Œè¿­ä»£ã€‚ä»–ä»¬ä¹Ÿä¸èƒ½ç”¨äº for...in å¾ªç¯ã€‚\nåœ¨åŸç”Ÿåç¨‹ä¸­å°è¯•ä½¿ç”¨ __iter__ æˆ–è€… __next ä¼šè§¦å‘ TypeError å¼‚å¸¸ã€‚ æœªè¢«è£…é¥°çš„ç”Ÿæˆå™¨ä¸èƒ½å¤Ÿ yield from ä¸€ä¸ªåŸç”Ÿåç¨‹ï¼šè¿™æ ·ä¼šå¼•å‘ TypeErrorã€‚ åŸºäºç”Ÿæˆå™¨çš„åç¨‹ (asyncio ä»£ç å¿…é¡»ä½¿ç”¨ @asyncio.coroutine) å¯ä»¥ yield from ä¸€ä¸ªåŸç”Ÿåç¨‹ã€‚ å¯¹åŸç”Ÿåç¨‹å¯¹è±¡å’ŒåŸç”Ÿåç¨‹å‡½æ•°è°ƒç”¨ inspect.isgenerator() å’Œ inspect.isgeneratorfunction() ä¼šè¿”å› Falseã€‚  åç¨‹å¯¹è±¡æ–¹æ³• åç¨‹å†…éƒ¨åŸºäºç”Ÿæˆå™¨ï¼Œå› æ­¤ä»–ä»¬åŒäº«å®ç°è¿‡ç¨‹ã€‚ç±»ä¼¼äºç”Ÿæˆå™¨å¯¹è±¡ï¼Œåç¨‹åŒ…å« throw()ï¼Œsend() å’Œ close() æ–¹æ³•ã€‚StopIteration å’Œ GeneratorExit åœ¨åç¨‹ä¸­æ‰®æ¼”è€…åŒæ ·çš„è§’è‰²ï¼ˆå°½ç®¡ PEP 479 é»˜è®¤å¯¹åç¨‹å¼€å¯äº†ï¼‰ã€‚å‚è€ƒ PEP-342, PEP-380 å’Œ Python æ–‡æ¡£äº†è§£æ›´å¤šç»†èŠ‚ã€‚\nåç¨‹çš„ throw() å’Œ send() æ–¹æ³•å¯ä»¥ç”¨äºå°†è¿”å›å€¼å’ŒæŠ›å‡ºå¼‚å¸¸æ¨é€åˆ°ç±»ä¼¼äº Future çš„å¯¹è±¡ä¸­ã€‚\nè°ƒè¯•ç‰¹æ€§ ä¸€ä¸ªåˆå­¦è€…æ™®éä¼šçŠ¯çš„é”™è¯¯æ˜¯å¿˜è®°åœ¨åç¨‹ä¸­ä½¿ç”¨ yield fromã€‚\n@asyncio.coroutine def useful(): asyncio.sleep(1) # this will do noting without \u0026#39;yield from\u0026#39; ä¸ºäº†è°ƒè¯•è¿™ç±»é”™è¯¯ï¼Œasycio æä¾›äº†ä¸€ç§ç‰¹æ®Šçš„è°ƒè¯•æ¨¡å¼ï¼šè£…é¥°å™¨ @coroutine å°è£…æ‰€æœ‰çš„å‡½æ•°æˆä¸€ä¸ªç‰¹æ®Šå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„ææ„å‡½æ•°ä¸­è®°å½•è­¦å‘Šã€‚å½“å°è£…çš„ç”Ÿæˆå™¨åƒåœ¾å›æ”¶æ—¶ï¼Œä¼šäº§ç”Ÿè¯¦ç»†çš„è®°å½•ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…·ä½“å®šä¹‰ä¿®é¥°å‡½æ•°ã€å›æ”¶æ—¶çš„æ ˆä¿¡æ¯ç­‰ç­‰ã€‚å°è£…å¯¹è±¡åŒæ ·æä¾›ä¸€ä¸ª __repr__ å‡½æ•°ç”¨äºè¾“å‡ºå…³äºç”Ÿæˆå™¨çš„è¯¦ç»†ä¿¡æ¯ã€‚\nå”¯ä¸€çš„é—®é¢˜æ˜¯å¦‚ä½•å¯ç”¨è¿™äº›è°ƒè¯•åŠŸèƒ½ã€‚è¿™äº›è°ƒè¯•å·¥å…·åœ¨ç”Ÿäº§æ¨¡å¼ä¸­ä»€ä¹ˆéƒ½ä¸åšï¼Œ@coroutine ä¿®é¥°ç¬¦åœ¨ç³»ç»Ÿå˜é‡ PYTHONASYNCIODEBUG  è®¾ç½®åæ‰ä¼šæä¾›è°ƒè¯•åŠŸèƒ½ã€‚è¿™ç§æ–¹å¼å¯ä»¥è®© asyncio ç¨‹åºä½¿ç”¨ asyncio è‡ªå·±çš„å‡½æ•°åˆ†æã€‚EventLoop.set_debug æ˜¯å¦å¤–ä¸€ä¸ªè°ƒè¯•å·¥å…·ï¼Œä»–ä¸ä¼šå½±å“ @coroutine ä¿®é¥°ç¬¦è¡Œä¸ºã€‚\næ ¹æ®æœ¬æè®®ï¼Œåç¨‹æ˜¯åŸç”Ÿçš„ä¸ç”Ÿæˆå™¨ä¸åŒçš„æ¦‚å¿µã€‚å½“æŠ›å‡º RuntimeWarning å¼‚å¸¸çš„åç¨‹æ˜¯ä»æ¥æ²¡æœ‰è¢« awaited è¿‡çš„ã€‚å› æ­¤æ·»åŠ äº†ä¸¤æ¡æ–°çš„å‡½æ•°åˆ° sys æ¨¡å—ï¼šset_coroutine_wrapper å’Œ get_coroutine_wrapperã€‚è¿™ä¸ªç”¨äºå¼€å¯ asyncio æˆ–è€…å…¶ä»–æ¡†æ¶ä¸­çš„é«˜çº§è°ƒè¯• (æ¯”å¦‚æ˜¾ç¤ºåç¨‹åˆ›å»ºçš„ä½ç½®å’Œåƒåœ¾å›æ”¶æ—¶çš„æ ˆä¿¡æ¯)ã€‚\næ–°çš„æ ‡å‡†åº“å‡½æ•°  types.coroutine(gen)ã€‚å‚è€ƒ types.coroutine() èŠ‚ä¸­çš„å†…å®¹ã€‚ inspect.iscoroutine(obj) å½“ obj æ˜¯åŸç”Ÿåç¨‹æ—¶è¿”å› Trueã€‚ inspect.iscoroutinefunction(obj) å½“ obj æ˜¯åŸç”Ÿåç¨‹å‡½æ•°æ—¶è¿”å›ä¸º Trueã€‚ inspect.isawaitable(obj) å½“ obj æ˜¯ awaitable æ—¶è¿”å›ä¸º Trueã€‚ inspect.getcoroutinestate(coro) è¿”å›åŸç”Ÿåç¨‹å¯¹è±¡çš„å½“å‰çŠ¶æ€ï¼ˆæ˜¯ inspect.getfgeneratorstate(gen) çš„é•œåƒï¼‰ã€‚ inspect.getcoroutinelocals(coro) è¿”å›åŸç”Ÿåç¨‹å¯¹è±¡çš„å±€éƒ¨å˜é‡çš„æ˜ å°„ï¼ˆæ˜¯ inspect.getgeneratorlocals(gen) çš„é•œåƒï¼‰ã€‚ sys.set_coroutine_wrapper(wrapper) å…è®¸æ‹¦æˆªåŸç”Ÿåç¨‹å¯¹è±¡çš„åˆ›å»ºã€‚wrapper å¿…é¡»æ˜¯ä¸€ä¸ªæ¥å—ä¸€ä¸ªå‚æ•° callableï¼ˆä¸€ä¸ªåç¨‹å¯¹è±¡ï¼‰ï¼Œæˆ–è€…æ˜¯ Noneã€‚None ä¼šé‡ç½® wrapperã€‚å½“è°ƒç”¨ç¬¬äºŒæ¬¡æ—¶ï¼Œæ–°çš„ wrapper ä¼šæ›¿ä»£ä¹‹å‰çš„å°è£…ã€‚è¿™ä¸ªå‡½æ•°æ˜¯çº¿ç¨‹ä¸“æœ‰çš„ã€‚å‚è€ƒ è°ƒåº¦è°ƒè¯• äº†è§£æ›´å¤šç»†èŠ‚ã€‚ sys.get_coroutine_wrapper() è¿”å›å½“å‰çš„å°è£…å¯¹è±¡ã€‚å¦‚æœå°è£…æœªè®¾ç½®ä¼šè¿”å› Noneã€‚è¿™ä¸ªå‡½æ•°æ˜¯çº¿ç¨‹ä¸“æœ‰çš„ã€‚å‚è€ƒ è°ƒåº¦è°ƒè¯• äº†è§£æ›´å¤šç»†èŠ‚ã€‚  æ–°çš„æŠ½è±¡åŸºç±» ä¸ºäº†å…è®¸æ›´å¥½çš„ä¸ç°æœ‰çš„æ¡†æ¶ï¼ˆæ¯”å¦‚ Tornadoï¼‰å’Œç¼–è¯‘å™¨ï¼ˆæ¯”å¦‚ Cythonï¼‰æ•´åˆï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªæ–°çš„æŠ½è±¡åŸºç±» (ABC)ï¼š\ncollections.abc.Awaitable æ˜¯ Future-like ç±»çš„æŠ½è±¡åŸºç±»ï¼Œå®ƒå®ç°äº† __await__ æ–¹æ³•ã€‚\ncollections.abc.Coroutine æ˜¯åç¨‹å¯¹è±¡çš„æŠ½è±¡åŸºç±»ï¼Œå®ƒå®ç°äº† send(value)ï¼Œthrow(type, exc, tb)ï¼Œclose() å’Œ __await__() æ–¹æ³•ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¸¦æœ‰ CO_ITERABLE_COROUTINE æ ‡è®°çš„åŸºäºç”Ÿæˆå™¨çš„åç¨‹å¹¶æ²¡æœ‰å®ç° __await__ æ–¹æ³•ï¼Œå› æ­¤ä»–ä¸æ˜¯ collections.abc.Coroutine å’Œ collections.abc.Awaitable æŠ½è±¡ç±»çš„å®ä¾‹ï¼š\n@types.coroutine def gencoro(): yield assert not isinstance(gencoro(), collections.abc.Coroutine) # ç„¶è€Œ: assert inspect.isawaitable(gencoro()) ä¸ºäº†æ–¹ä¾¿å¯¹å¼‚æ­¥è¿­ä»£çš„è°ƒè¯•ï¼Œæ·»åŠ äº†å¦å¤–ä¸¤ä¸ªæŠ½è±¡åŸºç±»ï¼š\n collections.abc.AsyncIterable \u0026ndash; ç”¨äºæµ‹è¯• __aiter__ æ–¹æ³• collections.abc.AsyncIterator \u0026ndash; ç”¨äºæµ‹è¯• __aiter__ å’Œ __anext__ æ–¹æ³•ã€‚  ä¸“ç”¨æœ¯è¯­è¡¨ å‡½æ•°ä¸æ–¹æ³•åˆ—è¡¨ ç§»æ¤è®¡åˆ’ å‘åå…¼å®¹æ€§ asyncio asyncio ç§»æ¤ç­–ç•¥ CPython ä»£ç ä¸­çš„ async/await è¯­æ³•æ›´æ–° å¤±æ•ˆè®¡åˆ’ æ€§èƒ½ æ€»ä½“å½±å“ è¿™ä¸ªæè®®å¹¶ä¸ä¼šé€ æˆæ€§èƒ½å½±å“ã€‚è¿™æ˜¯ Python å®˜æ–¹æ€§èƒ½æµ‹è¯•ç»“æœï¼š\npython perf.py -r -b default ../cpython/python.exe ../cpython-aw/python.exe [skipped] Report on Darwin ysmac 14.3.0 Darwin Kernel Version 14.3.0: Mon Mar 23 11:59:05 PDT 2015; root:xnu-2782.20.48~5/RELEASE_X86_64 x86_64 i386 Total CPU cores: 8 ### etree_iterparse ### Min: 0.365359 -\u0026gt; 0.349168: 1.05x faster Avg: 0.396924 -\u0026gt; 0.379735: 1.05x faster Significant (t=9.71) Stddev: 0.01225 -\u0026gt; 0.01277: 1.0423x larger The following not significant results are hidden, use -v to show them: django_v2, 2to3, etree_generate, etree_parse, etree_process, fastpickle, fastunpickle, json_dump_v2, json_load, nbody, regex_v8, tornado_http. ç¼–è¯‘å™¨ä¿®æ”¹ ä¿®æ”¹åçš„ç¼–è¯‘å™¨å¤„ç† Python æ–‡ä»¶æ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½ä¸‹é™ï¼šå¤„ç† 12MB å¤§å°çš„æ–‡ä»¶ï¼ˆLib/test/test_binop.py é‡å¤ 1000 æ¬¡ï¼‰æ¶ˆè€—æ—¶é—´ç›¸åŒã€‚\nasync/await ä¸‹é¢çš„å°æµ‹è¯•ç”¨äºæ£€æµ‹ã€asyncã€å‡½æ•°å’Œç”Ÿæˆå™¨çš„æ€§èƒ½å·®å¼‚ï¼š\nimport sys import time def binary(n): if n \u0026lt;= 0: return 1 l = yield from binary(n - 1) r = yield from binary(n - 1) return l + 1 + r async def abinary(n): if n \u0026lt;= 0: return 1 l = await abinary(n - 1) r = await abinary(n - 1) return l + 1 + r def timeit(func, depth, repeat): t0 = time.time() for _ in range(repeat): o = func(depth) try: while True: o.send(None) except StopIteration: pass t1 = time.time() print(\u0026#39;{}({}) * {}: total {:.3f}s\u0026#39;.format(func.__name__, depth, repeat, t1-t0)) ç»“æœæ˜¾ç¤ºå¹¶æ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½å·®å¼‚ï¼š\nbinary(19) * 30: total 53.321s abinary(19) * 30: total 55.073s binary(19) * 30: total 53.361s abinary(19) * 30: total 51.360s binary(19) * 30: total 49.438s abinary(19) * 30: total 51.047s æ³¨æ„ï¼š19 å±‚æ„å‘³ç€ 1,048,575 è°ƒç”¨ã€‚\nå®ç°å‚è€ƒ å®ç°å‚è€ƒå¯ä»¥åœ¨ è¿™é‡Œ æ‰¾åˆ°ã€‚\nä¸Šå±‚ä¿®æ”¹å’Œæ–°åè®®åˆ—è¡¨  æ–°çš„åç¨‹å®šä¹‰è¯­æ³•ï¼šasync def å’Œæ–°çš„ await å…³é”®å­—ã€‚ Future-like å¯¹è±¡æä¾›æ–°çš„ __await__ æ–¹æ³•å’Œæ–°çš„ PyTypeObject  çš„ tp_as_async.am_awaitã€‚ æ–°çš„å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨è¯­æ³•ï¼š async withï¼Œåè®®æä¾›äº† __aenter__ å’Œ __aexit__ æ–¹æ³•ã€‚ æ–°çš„å¼‚æ­¥è¿­ä»£è¯­æ³•ï¼šasync forï¼Œåè®®æä¾›äº† __aiterã€__aexit å’Œæ–°çš„å†…ç½®å¼‚å¸¸ StopAsyncIterationã€‚PyTypeObject æä¾›äº†æ–°çš„ tp_as_async.am_aiter å’Œ tp_as_async.am_anextã€‚ æ–°çš„ AST èŠ‚ç‚¹ï¼šAsyncFunctionDefï¼ŒAsyncForï¼ŒAsyncWith å’Œ Awaitã€‚ æ–°å‡½æ•° sys.set_coroutine_wrapper(callback)ï¼Œsys.get_coroutine_wrapper()ï¼Œtypes.coroutine(gen)ï¼Œinspect.iscoroutinefunction(func)ï¼Œinspect.iscoroutine(obj)ï¼Œinspect.isawaitable(obj)ï¼Œinspect.getcoroutinestate(coro) å’Œ inspect.getcoroutinelocals(coro)ã€‚ æ–°çš„ä»£ç å¯¹è±¡æ ‡è®° CO_COROUTINE å’Œ CO_ITERABLE_COROUTINEã€‚ æ–°çš„æŠ½è±¡åŸºç±» collections.abc.Awaitableï¼Œcollections.abc.Coroutineï¼Œcollections.abc.AsyncIterable å’Œ collections.abc.AsyncIteratorã€‚ C API å˜æ›´ï¼šæ–°çš„ PyCoro_Typeï¼ˆå°† Python ä½œä¸º types.CoroutineType è¾“å‡ºï¼‰å’Œ PyCoroObjectã€‚PyCoro_CheckExact(*o) ç”¨äºæ£€æµ‹ o æ˜¯å¦ä¸ºåŸç”Ÿåç¨‹ã€‚  è™½ç„¶å˜åŒ–å’Œæ–°å†…å®¹åˆ—è¡¨å¹¶ä¸çŸ­ï¼Œä½†æ˜¯é‡è¦çš„æ˜¯ç†è§£ï¼šå¤§éƒ¨åˆ†ç”¨æˆ·ä¸ä¼šç›´æ¥ä½¿ç”¨è¿™äº›ç‰¹æ€§ã€‚ä»–çš„ç›®çš„æ˜¯åœ¨äºæ¡†æ¶å’Œåº“èƒ½å¤Ÿä½¿ç”¨è¿™äº›ä¸ºç”¨æˆ·æä¾›ä¾¿æ·çš„ä½¿ç”¨å’Œæ˜ç¡®çš„ API ç”¨äº async defï¼Œawaitï¼Œasync for å’Œ async with è¯­æ³•ã€‚\nå¯ä»¥å·¥ä½œçš„å®ä¾‹ æœ¬ PEP æå‡ºçš„æ‰€æœ‰æ¦‚å¿µéƒ½ å·²ç»å®ç°ï¼Œå¹¶ä¸”å¯ä»¥è¢«æµ‹è¯•ã€‚\nimport asyncio async def echo_server(): print(\u0026#39;Serving on localhost:8000\u0026#39;) await asyncio.start_server(handle_connection,\u0026#39;localhost\u0026#39;, 8000) async def handle_connection(reader, writer): print(\u0026#39;New connection...\u0026#39;) while True: data = await reader.read(8192) if not data: break print(\u0026#39;Sending {:.10}... back\u0026#39;.format(repr(data))) writer.write(data) loop = asyncio.get_event_loop() loop.run_until_complete(echo_server()) try: loop.run_forever() finally: loop.close() ","date":"2015-10-31T12:48:15Z","permalink":"https://www.4async.com/2015/10/2015-10-31-coroutines-with-async-and-await-syntax-chinese/","title":"PEP 0492 Coroutines with async and await syntax ä¸­æ–‡ç¿»è¯‘"},{"content":"ä» Call åˆ°å‘½ä»¤ç«¯ åœ¨ç¬¬ä¸€ä¸ªæ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å®ç°ä¸€ä¸ª Call çš„å®¢æˆ·ç«¯åŸºæœ¬æ¨¡å‹ï¼Œä½†åªæ˜¯ Call æ€ä¹ˆèƒ½æ»¡è¶³éœ€æ±‚å‘¢ï¼Ÿæ¯”å¦‚åœ¨ redis-py ä¸­ï¼Œä¸€ä¸ªå®Œæ•´çš„å®¢æˆ·ç«¯åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š\nclient = redis.StrictRedis() client.setex(\u0026#34;key\u0026#34;, 10, \u0026#34;value\u0026#34;) æ¥ä¸‹æ¥ä½œä¸ºä¸€ä¸ªç¨‹åºçš„å®¢æˆ·ç«¯ï¼Œéœ€è¦å»åšçš„å°±æ˜¯å°è£…å‡ºä¸€ä¸ª Redis Clientã€‚æ¯”å¦‚ setex æ–¹æ³•ï¼š\ndef setex(self, key, seconds, value): \u0026#34;\u0026#34;\u0026#34;Set the value and expiration of a key. :raises TypeError: if seconds is neither int \u0026#34;\u0026#34;\u0026#34;if not isinstance(seconds, int): raise TypeError(\u0026#34;milliseconds argument must be int\u0026#34;) fut = self._conn.execute(b\u0026#39;SETEX\u0026#39;, key, seconds, value) return wait_ok(fut) å‰©ä¸‹çš„å°±æ˜¯ä¸€ä¸ªä¸ªæ–¹æ³•é€ä¸ªå®Œå–„ã€‚\nä»€ä¹ˆæ˜¯è¿æ¥æ±  æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œæ— è®ºé‚£ä¸ªæ•°æ®åº“å®¢æˆ·ç«¯ï¼Œæ€»æ˜¯ä¼šæœ‰è¿æ¥æ± æœºåˆ¶ã€‚é‚£ä¹ˆè¿æ¥æ± æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± å‘¢ï¼Ÿ\né¦–å…ˆï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¯¹è¿æ¥è€Œè¨€ï¼Œåˆ›å»ºæ˜¯å¿…è¦é‡å‹çš„æ“ä½œã€‚æ¯”å¦‚è¯´ï¼ŒTCP è¿æ¥ï¼Œæ¥ä¸‹æ¥ä¹‹åæ˜¯ç™»å½•è®¤è¯ç­‰ç­‰è¿‡ç¨‹ï¼Œæœ€åæ‰ä¼šæ‰§è¡Œå‘½ä»¤ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸è®¡ç®—åº“æ€§èƒ½æ—¶ï¼Œå¾ˆå¤šæ—¶å€™ä¼šæŠŠå»ºç«‹è¿æ¥çš„æ—¶å€™å»æ‰ã€‚ä½†æ˜¯è¿™å°±å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå½“ä¸€ä¸ªè¿æ¥è¢«å ç”¨æ—¶ï¼Œå…¶ä»–çš„æ“ä½œä»æ—§æ˜¯ä¸èƒ½å¤Ÿå®Œæˆæ“ä½œäº†ï¼Œåªèƒ½ç­‰å¾…å‰ä¸€ä¸ªæ“ä½œå®Œæˆã€‚ä½†æ˜¯å‡å¦‚æˆ‘ä»¬ä¸€æ¬¡æ€§åˆ›å»ºä¸€å †è¿æ¥å‘¢ï¼Ÿä»ä¸€å †è¿æ¥ä¸­æ‰¾åˆ°ç©ºé—²çš„è¿æ¥ï¼Œä½¿ç”¨å®Œæˆåé‡Šæ”¾æˆç©ºé—²çš„çŠ¶æ€ï¼Œè¿™å°±æ˜¯çº¿ç¨‹æ± çš„æœ¬è´¨ã€‚å› ä¸ºå‡å°‘äº†æ¯æ¬¡åˆ›å»ºè¿æ¥çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å¯¹æ€§èƒ½æå‡ä¹Ÿéå¸¸æœ‰å¸®åŠ©ã€‚\nä»å•è¿æ¥åˆ°è¿æ¥æ±  é¦–å…ˆï¼Œè¿˜æ˜¯åˆ›å»ºä¸€ä¸ª RedisPool ç±»ï¼Œç”¨äºç®¡ç† Redis çš„è¿æ¥æ± ã€‚\nclass RedisPool: \u0026#34;\u0026#34;\u0026#34;Redis connections pool.\u0026#34;\u0026#34;\u0026#34; def __init__(self, address, db=0, password=None, encoding=None, *, minsize, maxsize, commands_factory, loop=None): if loop is None: loop = asyncio.get_event_loop() self._address = address self._db = db self._password = password self._encoding = encoding self._minsize = minsize self._factory = commands_factory self._loop = loop # è¿æ¥æ± æ•°ç»„ self._pool = collections.deque(maxlen=maxsize) self._used = set() self._acquiring = 0 self._cond = asyncio.Condition(loop=loop) def _create_new_connection(self): return create_redis(self._address, db=self._db, password=self._password, encoding=self._encoding, commands_factory=self._factory, loop=self._loop) æ¥ä¸‹æ¥ï¼Œå°±éœ€è¦åˆ›å»ºå¤§é‡çš„è¿æ¥äº†ï¼š\nasync def create_pool(self, *, override_min): # todo: drop closed connections first # åˆ¤æ–­æ˜¯å¦è¾¾åˆ°äº†è¿æ¥æ± æ•°é‡é™åˆ¶ while not self._pool and self.size \u0026lt; self.maxsize: self._acquiring += 1 try: conn = await self._create_new_connection() self._pool.append(conn) finally: self._acquiring -= 1 # connection may be closed at yeild point self._drop_closed() é‚£ä¹ˆæ€ä¹ˆä»è¿™äº›è¿æ¥ä¸­æŠ½å–è¿æ¥å¹¶ä¸”è¿›è¡Œè¿æ¥å‘¢:\n@asyncio.coroutine def acquire(self): \u0026#34;\u0026#34;\u0026#34;Acquires a connection from free pool. Creates new connection if needed. \u0026#34;\u0026#34;\u0026#34; with await self._cond: while True: await self._fill_free(override_min=True) if self.freesize: conn = self._pool.popleft() assert not conn.closed, conn assert conn not in self._used, (conn, self._used) self._used.add(conn) return conn else: await self._cond.wait() æ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨å®Œæˆåè¿›è¡Œé‡Šæ”¾å³å¯ï¼š\ndef release(self, conn): \u0026#34;\u0026#34;\u0026#34;Returns used connection back into pool. When returned connection has db index that differs from one in pool the connection will be closed and dropped. When queue of free connections is full the connection will be dropped. \u0026#34;\u0026#34;\u0026#34;assert conn in self._used,\u0026#34;Invalid connection, maybe from other pool\u0026#34;self._used.remove(conn) if not conn.closed: if conn.in_transaction: logger.warning(\u0026#34;Connection %rin transaction, closing it.\u0026#34;, conn) conn.close() elif conn.db == self.db: if self.maxsize and self.freesize \u0026lt; self.maxsize: self._pool.append(conn) else: # consider this connection as old and close it. conn.close() else: conn.close() # FIXME: check event loop is not closed asyncio.async(self._wakeup(), loop=self._loop) è‡³æ­¤ï¼Œä½ å·²ç»å¯ä»¥å®ç°ä¸€ä¸ªåŸºæœ¬çš„ Redis å®¢æˆ·ç«¯äº†ï¼Œè¿˜åœ¨çŠ¹è±«ä»€ä¹ˆï¼Ÿå¿«è‡ªå·±åŠ¨æ‰‹å§ï¼\næ³¨: æ–‡ä¸­ Redis åº“å‚è€ƒäº† aio-lib/aioredis åº“ã€‚\n","date":"2015-10-30T23:11:15Z","permalink":"https://www.4async.com/2015/10/2015-10-30-write-aio-python-redis-client-as-dummy-2/","title":"ä»é›¶å®ç°ä¸€ä¸ª Redis å®¢æˆ·ç«¯ï¼ˆäºŒï¼‰"},{"content":"ä»€ä¹ˆæ˜¯ AIO AIO æ˜¯ Asynchronous Input/Output çš„ç®€å†™ï¼Œä¹Ÿå°±æ˜¯å¼‚æ­¥ IOã€‚ä¸è¿‡åœ¨è°ˆä»€ä¹ˆæ˜¯ AIO ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½è¦å…ˆä»‹ç»ä¸€ä¸‹ BIOã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯ BIO å‘¢ï¼Ÿç®€å•çš„è¯´ï¼ŒBIO æ˜¯ Blocking Input/Outputï¼Œä¹Ÿå°±æ˜¯é˜»å¡ IOï¼Œä»–å®ç°çš„é€šå¸¸æ˜¯åœ¨çº¿ç¨‹æ± ä¸­æ‰¾å‡ºä¸€ä¸ªçº¿ç¨‹å¤„ç† IOï¼Œåœ¨ IO è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–çº¿ç¨‹éƒ½éœ€è¦ç­‰å¾… IO å®Œæˆåæ‰å¯ä»¥ä»ä¸­é€‰å–ä¸€ä¸ªçº¿ç¨‹å ç”¨ IOã€‚è¿™æ ·æœ€å¤§çš„é—®é¢˜æ˜¯ï¼Œå½“çº¿ç¨‹æ•°é‡è¾ƒå¤šï¼Œå¹¶ä¸”éœ€è¦å¤§é‡çš„ IO æ“ä½œæ—¶ï¼Œå°±ä¼šé€ æˆä¸€ä¸ªå¤§é‡çš„é˜»å¡ï¼Œå› ä¸ºå®é™…ä¸Šæ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å¤„ç† IOã€‚\né‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªæ—¶å€™çš„é—®é¢˜å‘¢ï¼Ÿè¿™æ—¶å€™å°±æå‡ºäº† AIO çš„æ¦‚å¿µã€‚é€šå¸¸åœ¨ IO å¤„ç†è¿‡ç¨‹ä¸­ä¹Ÿä¼šä¼´æœ‰ä¸€äº›å…¶ä»–çš„å¤„ç†æ“ä½œï¼Œå‡å¦‚æŠŠæ‰€æœ‰çš„æ“ä½œéƒ½æµªè´¹åœ¨äº†ç­‰å¾… IO é‡Šæ”¾ä¸Šï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆ©ç”¨ç‡ä¹Ÿå¤ªä½äº†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼ï¼Œåœ¨ç”³è¯· IO å¤„ç†ä¹‹åï¼Œå°±å»ç»§ç»­åšå…¶ä»–çš„äº‹æƒ…ï¼Œç­‰ IO æ“ä½œå®Œæˆäº†ï¼Œç„¶åé€šçŸ¥æˆ‘ä»¬å·²ç» OKï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å¤„ç†äº†ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ AIO çš„åŸå‹ã€‚\nAIO çš„æƒ…å†µä¹Ÿè¯´æ˜äº†å®ƒé€‚ç”¨çš„åœºæ™¯ï¼šé•¿è¿æ¥åœºæ™¯ï¼Œæˆ–è€…é‡åº¦çš„ IO æ“ä½œç­‰ç­‰çš„æƒ…å†µã€‚\nå¦‚æœæ‰¾è½¯ä»¶æ¥åšæ¡ˆä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾ä¸€ä¸ªå¯èƒ½å¤§å®¶ç†ŸçŸ¥çš„ï¼šNGINXã€‚æ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼ŒNGINX é‡‡ç”¨äº† å¼‚æ­¥ã€äº‹ä»¶é©±åŠ¨çš„æ–¹æ³•æ¥å¤„ç†è¿æ¥ã€‚è¿™ç§å¤„ç†æ–¹å¼æ— éœ€ï¼ˆåƒä½¿ç”¨ä¼ ç»Ÿæ¶æ„çš„æœåŠ¡å™¨ä¸€æ ·ï¼‰ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºé¢å¤–çš„ä¸“ç”¨è¿›ç¨‹æˆ–è€…çº¿ç¨‹ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªå·¥ä½œè¿›ç¨‹ä¸­å¤„ç†å¤šä¸ªè¿æ¥å’Œè¯·æ±‚ã€‚ä¸ºæ­¤ï¼ŒNGINX å·¥ä½œåœ¨éé˜»å¡çš„ socket æ¨¡å¼ä¸‹ï¼Œå¹¶ä½¿ç”¨äº† epoll å’Œ kqueue è¿™æ ·æœ‰æ•ˆçš„æ–¹æ³•ã€‚\nè¿™éƒ¨åˆ†çš„å†…å®¹ï¼Œåœ¨ NGINX å¼•å…¥çº¿ç¨‹æ±  æ€§èƒ½æå‡ 9 å€ ä¸­è¿›è¡Œäº†è¯¦ç»†çš„ä»‹ç»ï¼ŒåŒ…å«äº† NGINX çš„å¼‚æ­¥åº”ç”¨ç»éªŒï¼ŒåŒæ—¶ä»‹ç»äº† NGINX ä¸­å¼•å…¥äº†é˜»å¡çš„çº¿ç¨‹æ± ç”¨äºè§£å†³æŸäº›ç‰¹å®šåœºæ™¯é—®é¢˜ä¸‹çš„æ•ˆç‡ã€‚\nå¦‚ä½•å®ç° Python çš„å¼‚æ­¥ IO è¿™ç¯‡æ–‡ç« ä¼šä»¥æœ€æ–°çš„ Python 3.5 ä¸ºåŸºç¡€æ¥ä»‹ç»å®ç°ä¸€ä¸ªå¼‚æ­¥çš„ Python Redis Clientã€‚ä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œæ€ä¹ˆå®ç° Python çš„ aioã€‚\nPython çš„ aio å®˜æ–¹å°è£…äº†ä¸€ä¸ªæ¯”è¾ƒåˆé€‚çš„åŸºç¡€åº“ asyncioã€‚\nä»ä¸€ä¸ªä¾‹å­å¼€å§‹ç®€å•è®¤è¯†ä¸€ä¸‹å¦‚ä½•å®ç°ä¸€ä¸ªå¼‚æ­¥çš„ aio clientã€‚è¿™é‡Œä»¥å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¾‹å­ä¸ºä¾‹ï¼š\nimport asyncio async def tcp_echo_client(message, loop): reader, writer = await asyncio.open_connection(\u0026#39;127.0.0.1\u0026#39;, 8888, loop=loop) print(\u0026#39;Send: %r\u0026#39; % message) writer.write(message.encode()) data = await reader.read(100) print(\u0026#39;Received: %r\u0026#39; % data.decode()) print(\u0026#39;Close the socket\u0026#39;) writer.close() message = \u0026#39;Hello World!\u0026#39; loop = asyncio.get_event_loop() loop.run_until_complete(tcp_echo_client(message, loop)) loop.close() è¿™é‡Œé¢ç”¨åˆ°çš„ Python 3.5 ä¸­å¼•å…¥çš„ async/await å…³é”®å­—ï¼Œè¿˜æœ‰ asyncio åº“ã€‚è¿™é‡Œé¢ asyncio.open_connection ä¼šè¿”å›ä¸€ä¸ª coroutineï¼Œè¿™ä¸ªå¯ä»¥ä½¿ç”¨ await è¿›è¡Œä¸€ä¸ª aio çš„è°ƒç”¨ï¼Œå³ï¼Œåœ¨æ”¶åˆ°è¿”å›ä¿¡å·ä¹‹å‰ï¼Œç¨‹åºå¯ä»¥ç»§ç»­å»å¤„ç†å…¶ä»–çš„ä»»åŠ¡ã€‚è¿™é‡Œé¢çœŸæ­£æ ¸å¿ƒçš„å°±æ˜¯ EventLoopï¼Œå®ƒè´Ÿè´£ç›‘è§†å‘é€è¿™äº›ä¿¡å·ï¼Œå¹¶ä¸”è¿”å›æ•°æ®ï¼Œå®ƒå¯ä»¥é€šè¿‡ asyncio.get_event_loop è·å–åˆ°ã€‚ç„¶åä»–ä¼šçœŸæ­£è¿”å›çš„æ•°æ®æ˜¯ä¸€ä¸ªè¯»å– StreamReader å’Œå†™å…¥ StreamWriter çš„å¯¹è±¡ã€‚\næ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ª reader å’Œ writer è¿›è¡Œæ•°æ®çš„è¯»å–å’Œå†™å…¥ã€‚writer æ˜¯å¯ä»¥ç›´æ¥å†™å…¥çš„ï¼Œå¦‚æœæ˜¯ reader çš„è¯ï¼Œå°±éœ€è¦ aio çš„æ–¹å¼ç­‰å¾…å—åˆ°æ•°æ®åè¿”å›ã€‚è¿™æ ·çœ‹èµ·æ¥æ›´æ¥è¿‘äºæ™®é€šçš„ socket ç¼–ç¨‹ã€‚ä¸è¿‡å…³é—­è¿æ¥æ—¶ï¼Œä»…ä»…éœ€è¦å…³é—­ writer å°±è¶³å¤Ÿäº†ã€‚\nä» socket é€šè®¯åˆ° redis é€šè®¯ æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæ‰€æœ‰çš„ç½‘ç»œè¯·æ±‚éƒ½å¯ä»¥çœ‹æˆæ˜¯ SocketIO çš„è¯·æ±‚ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ Redis çš„è¯·æ±‚å½“åšæ˜¯ä¸€ä¸ª socket çš„é€šè®¯æ¥è¿›è¡Œï¼Œè¿™æ ·å°±å¾ˆæ–¹ä¾¿äº†ã€‚\nä¸è¿‡å…ˆç­‰ä¸€ç­‰ï¼Œé‚£ä¹ˆé€šè®¯çš„æ•°æ®æ ¼å¼æ€ä¹ˆåŠï¼Ÿæ²¡å…³ç³»ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ hiredis-py æ¥è§£å†³åè®®è§£æçš„é—®é¢˜ã€‚ä¸è¿‡ï¼Œä»åº“è®¾è®¡çš„è§’åº¦æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦å°è£…ä¸€ä¸ª RedisConnection çš„ç±»å‡ºæ¥è§£å†³ Redis çš„é€šè®¯åè®®ã€‚å®ƒå¯èƒ½ä¼ å…¥çš„å‚æ•°åŒ…å«ï¼Œä¸€ä¸ª StreamReaderã€ä¸€ä¸ª StreamWriterï¼Œä¸€ä¸ª EventLoopï¼Œå“¦ï¼Œåˆ«å¿˜è®°è¿˜æœ‰ç¼–ç  encodingã€‚å…¶ä»–çš„æˆ‘ä»¬å°±ç”¨ä¸€ä¸ª * æ¥è¡¨ç¤ºå¥½äº†ã€‚\nclass RedisConnection(object): \u0026#39;\u0026#39;\u0026#39;Redis Connection\u0026#39;\u0026#39;\u0026#39; def __init__(self, reader, writer, *, encoding=None, loop=None): if loop is None: loop = asyncio.get_event_loop() self._reader = reader self._writer = writer self._encoding = encoding self._loop = loop self._db = 0 def __repr__(self): return \u0026#39;\u0026lt;RedisConnection [db:{}]\u0026gt;\u0026#39;.format(self._db) è®°å¾—åŠ ä¸Š __repr__ ç”¨æ¥æè¿°è¿™ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚æ¥ä¸‹æ¥å°±éœ€è¦å®Œå–„è¿™ä¸ªç±»äº†ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªå…³é—­è¿æ¥çš„æ–¹æ³•ï¼Œè¿™éœ€è¦è‡³å°‘ä¸€ä¸ªå‚æ•°ç”¨äºæ ‡è®°è¿æ¥æ˜¯å¦å…³é—­ï¼Œä¸€ä¸ªç”¨äºæ‰§è¡Œå…³é—­æ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦è¿™æ ·å­çš„ï¼š\ndef close(self): \u0026#34;\u0026#34;\u0026#34;Close connection.\u0026#34;\u0026#34;\u0026#34; self._do_close(None) def _do_close(self, exc): if self._closed: return self._closed = True self._closing = False # å…³é—­å†™å…¥ self._writer.transport.close() # å–æ¶ˆè¯»å–ä»»åŠ¡ self._reader_task.cancel() self._reader_task = None self._writer = None self._reader = None @property def closed(self): \u0026#34;\u0026#34;\u0026#34;True if connection is closed.\u0026#34;\u0026#34;\u0026#34; closed = self._closing or self._closed if not closed and self._reader and self._reader.at_eof(): self._closing = closed = True self._loop.call_soon(self._do_close, None) return closed è¿æ¥è¿™ç±»çš„æ–¹æ³•å·²ç»å¤„ç†å®Œäº†ï¼Œæ¥ä¸‹æ¥å°±åº”è¯¥æ˜¯æ‰§è¡Œ Redis å‘½ä»¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥å«å®ƒ executeã€‚é‚£ä»–éœ€è¦å‡ ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯æ‰§è¡Œçš„æŒ‡ä»¤ commandï¼Œä¸€ä¸ªæ˜¯æŒ‡ä»¤å‚æ•° *argsï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„ï¼Œæ¯”å¦‚ç¼–ç  encodingã€‚è¿™é‡Œä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œåªæ˜¯è€ƒè™‘ä¸€äº› Set å’Œ Get çš„åŸºæœ¬æ“ä½œã€‚å“¦ï¼Œä¸è¿‡ç­‰ç­‰ï¼Œé‚£ä¹ˆ Redis çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿæˆ‘ä»¬è¿˜éœ€è¦å…ˆæŠŠå®ƒç¼–è¯‘æˆ Redis-server å¯ä»¥è¯†åˆ«çš„å½¢å¼ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ª encode_command æ–¹æ³•ã€‚\n_converters = { bytes: lambda val: val, bytearray: lambda val: val, str: lambda val: val.encode(\u0026#39;utf-8\u0026#39;), int: lambda val: str(val).encode(\u0026#39;utf-8\u0026#39;), float: lambda val: str(val).encode(\u0026#39;utf-8\u0026#39;), } def encode_command(*args): \u0026#34;\u0026#34;\u0026#34;Encodes arguments into redis bulk-strings array. Raises TypeError if any of args not of bytes, str, int or float type. \u0026#34;\u0026#34;\u0026#34;buf = bytearray() def add(data): return buf.extend(data + b\u0026#39;\\r\\n\u0026#39;) add(b\u0026#39;*\u0026#39;+ _bytes_len(args)) for arg in args: if type(arg) in _converters: barg = _converters[type(arg)](arg) add(b\u0026#39;$\u0026#39;+ _bytes_len(barg)) add(barg) else: raise TypeError(\u0026#34;Argument {!r} expected to be of bytes,\u0026#34;\u0026#34;str, int or float type\u0026#34;.format(arg)) return buf è¿™æ ·å¯ä»¥è½¬åŒ–ä¸ºå¯ä»¥è¯†åˆ«çš„å½¢å¼äº†ï¼Œæ¥ä¸‹æ¥è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆæ€ä¹ˆè®©ç¨‹åºå¯ä»¥ç­‰å¾…ä¿¡å·çš„ç”Ÿæ•ˆå‘¢ï¼Ÿè¿™é‡Œä»‹ç»ä¸€ä¸‹ asyncio.Futureã€‚è¿™ä¸ª asyncio.Future ç±»æ˜¯ç”¨äºå°è£…å›è°ƒå‡½æ•°çš„ç±»ï¼ŒåŒ…å«äº†ä¸€äº›æ›´åŠ æ–¹ä¾¿ä½¿ç”¨çš„æ–¹æ³•ã€‚é€šè¿‡è¿™ä¸ªç±»ï¼Œå¯ä»¥å®ç° aio çš„é€šçŸ¥æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å›è°ƒã€‚è¿™ä¸ªç±»å®ä¾‹å¯ä»¥é€šè¿‡ await è¿”å›æˆ‘ä»¬éœ€è¦çš„ç»“æœã€‚ä¸è¿‡è¿™æ ·å°±è¿˜éœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¸€äº›æ›´å¤šçš„å˜é‡ï¼Œæ¯”å¦‚æ‰€æœ‰ç­‰å¾…è¿”å›çš„ self._waitersã€‚\ndef execute(self, command, *args, encoding=None): \u0026#34;\u0026#34;\u0026#34;Executes redis command and returns Future waiting for the answer. Raises: * TypeError if any of args can not be encoded as bytes. * ReplyError on redis \u0026#39;-ERR\u0026#39; resonses. * ProtocolError when response can not be decoded meaning connection is broken. \u0026#34;\u0026#34;\u0026#34;assert self._reader and not self._reader.at_eof(), (\u0026#34;Connection closed or corrupted\u0026#34;) if command is None: raise TypeError(\u0026#34;command must not be None\u0026#34;) if None in set(args): raise TypeError(\u0026#34;args must not contain None\u0026#34;) # è¿™æ ·å°å†™ä¹Ÿæ²¡æœ‰é—®é¢˜äº† command = command.upper().strip() if encoding is None: encoding = self._encoding fut = asyncio.Future(loop=self._loop) self._writer.write(encode_command(command, *args)) self._waiters.append((fut, encoding, cb)) return fut ç°åœ¨æ‰€æœ‰çš„å‘½ä»¤éƒ½å·²ç»å‘é€åˆ°äº† redis-serverï¼Œæ¥ä¸‹æ¥å°±éœ€è¦è¯»å–å¯¹åº”çš„ç»“æœäº†ã€‚\nasync def _read_data(self): \u0026#34;\u0026#34;\u0026#34;Response reader task.\u0026#34;\u0026#34;\u0026#34; while not self._reader.at_eof(): try: data = await self._reader.read(65536) except asyncio.CancelledError: break except Exception as exc: # XXX: for QUIT command connection error can be received # before response logger.error(\u0026#34;Exception on data read %r\u0026#34;, exc, exc_info=True) break self._parser.feed(data) while True: try: obj = self._parser.gets() except ProtocolError as exc: # ProtocolError is fatal # so connection must be closed self._closing = True self._loop.call_soon(self._do_close, exc) if self._in_transaction: self._transaction_error = exc return else: if obj is False: break else: self._process_data(obj) self._closing = True self._loop.call_soon(self._do_close, None) def _process_data(self, obj): \u0026#34;\u0026#34;\u0026#34;Processes command results.\u0026#34;\u0026#34;\u0026#34; waiter, encoding, cb = self._waiters.popleft() if waiter.done(): logger.debug(\u0026#34;Waiter future is already done %r\u0026#34;, waiter) assert waiter.cancelled(), (\u0026#34;waiting future is in wrong state\u0026#34;, waiter, obj) return if isinstance(obj, RedisError): waiter.set_exception(obj) if self._in_transaction: self._transaction_error = obj else: if encoding is not None: try: obj = decode(obj, encoding) except Exception as exc: waiter.set_exception(exc) return waiter.set_result(obj) if cb is not None: cb(obj) æœ‰äº†è¿™äº›ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç®€å•åˆ›å»ºä¸€ä¸ªè¿æ¥äº†ï¼š\nasync def create_connection(address, *, db=None, password=None, encoding=None, loop=None): \u0026#34;\u0026#34;\u0026#34;Creates redis connection. Opens connection to Redis server specified by address argument. Address argument is similar to socket address argument, ie: * when address is a tuple it represents (host, port) pair; * when address is a str it represents unix domain socket path. (no other address formats supported) Encoding argument can be used to decode byte-replies to strings. By default no decoding is done. Return value is RedisConnection instance. This function is a coroutine. \u0026#34;\u0026#34;\u0026#34;assert isinstance(address, (tuple, list, str)), \u0026#34;tuple or str expected\u0026#34; if isinstance(address, (list, tuple)): host, port = address reader, writer = await asyncio.open_connection(host, port, loop=loop) else: reader, writer = await asyncio.open_unix_connection(address, loop=loop) conn = RedisConnection(reader, writer, encoding=encoding, loop=loop) try: if password is not None: yield from conn.auth(password) if db is not None: yield from conn.select(db) except Exception: conn.close() return conn è¿™æ ·ï¼Œè¿æ¥éƒ¨åˆ†çš„ä»£ç åŸºæœ¬ä¸Šå·²ç»å¤„ç†å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯å®ç°åŸºäºè¿™ä¸ªè¿æ¥çš„å‘½ä»¤æ‰§è¡Œäº†ï¼Œä¸‹é¢çš„å†…å®¹ä¼šä¸‹ä¸€ä¸ªæ–‡ç« ä¸­ç»§ç»­ä»‹ç»ï¼Œæ•¬è¯·æœŸå¾…ã€‚\n","date":"2015-10-10T18:11:15Z","permalink":"https://www.4async.com/2015/10/2015-10-10-write-aio-python-redis-client-as-dummy-1/","title":"é›¶åŸºç¡€ç¼–å†™ Python Redis Clientï¼ˆä¸€ï¼‰"},{"content":"åœ¨æ–°ç‰ˆ Python3.5 ä¸­ï¼Œå¼•å…¥äº†ä¸¤ä¸ªæ–°å…³é”®å­— async å’Œ awaitï¼Œç”¨äºè§£å†³åœ¨ Python å¼‚æ­¥ç¼–ç¨‹ä¸­æ— æ³•æœ‰æ•ˆ åŒºåˆ† yield ç”Ÿæˆå™¨ä¸å¼‚æ­¥çš„å…³ç³»çš„é—®é¢˜ã€‚\nå¼‚æ­¥æ˜¯ä¸€ä¸ªä»€ä¹ˆä¸œè¥¿ å¼‚æ­¥çš„ä½œç”¨åœ¨äºï¼Œå¯¹äº Python è¿™ç§æ‹¥æœ‰ GIL çš„è¯­è¨€ï¼ŒæŸä¸ªçº¿ç¨‹åœ¨å¤„ç†å•ä¸ªè€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡æ—¶ï¼ˆå¦‚ I/O è¯»å–ï¼ŒRESTful API è°ƒç”¨ï¼‰ç­‰æ“ä½œæ—¶ï¼Œä¸èƒ½æœ‰æ•ˆçš„é‡Šæ”¾ CPU èµ„æºï¼Œå¯¼è‡´å…¶ä»–çº¿ç¨‹çš„ç­‰å¾…æ—¶é—´éšä¹‹å¢åŠ ã€‚ å¼‚æ­¥çš„ä½œç”¨æ˜¯ï¼Œåœ¨ç­‰å¾…è¿™ç§èŠ±è´¹å¤§é‡æ—¶é—´çš„æ“ä½œæ•°ï¼Œå…è®¸é‡Šæ”¾ CPU èµ„æºæ‰§è¡Œå…¶ä»–çš„çº¿ç¨‹ä»»åŠ¡ï¼Œä»è€Œæ é«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚\n3.4 ä¹‹å‰å¦‚ä½•å®ç°å¼‚æ­¥ åœ¨ 3.5 ç‰ˆæœ¬ä»¥å‰çš„ç¨‹åºä¸­ï¼ŒPython ç¨‹åºé€šå¸¸æ˜¯ä½¿ç”¨ yield ä½œä¸ºä¸€ä¸ªåˆ¤æ–­æ˜¯å¦è¿›å…¥å¼‚æ­¥æ“ä½œçš„å…³é”®è¯ã€‚ æ¯”å¦‚åœ¨ 3.4.x ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™æ ·çš„ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸€ä¸‹ (æˆ–è€…ä½ ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ª Tornado çš„ä¾‹å­ï¼Œè¿™ æ ·ä½ çš„ç¨‹åºå°±ä¹Ÿå¯ä»¥è¿è¡Œåœ¨ 2.7.x ç‰ˆæœ¬çš„ Python ä¸­äº†)ï¼š\nimport time import asyncio @asyncio.coroutine def slow_operation(n): yield from asyncio.sleep(1) print(\u0026#34;Slow operation {} complete\u0026#34;.format(n)) @asyncio.coroutine def main(): start = time.time() yield from asyncio.wait([slow_operation(1), slow_operation(2), slow_operation(3), ]) end = time.time() print(\u0026#39;Complete in {} second(s)\u0026#39;.format(end-start)) loop = asyncio.get_event_loop() loop.run_until_complete(main()) æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š\nâœ Desktop pyenv shell 3.4.3 âœ Desktop python 3.4_asyncio.py âœ Desktop python 3.4_asyncio.py Slow operation 2 complete Slow operation 1 complete Slow operation 3 complete Complete in 1.0008249282836914 second(s) å¦‚æœä½ äº†è§£è¿‡ yieldï¼Œä½ ä¼šçŸ¥é“ yield å…¶å®ä½œç”¨æ˜¯ç”¨æ¥ç”Ÿæˆä¸€ä¸ªç”Ÿæˆå™¨ï¼Œè€Œç”Ÿæˆå™¨çš„ä½œç”¨æ˜¯ç”¨äºè¾“å‡ºä¸€ç³»åˆ—çš„ç»“æœã€‚æ¯”å¦‚è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼š\ndef fab(max): n, a, b = 0, 0, 1 while n \u0026lt; max: yield b a, b = b, a + b n = n + 1 for n in fab(5): print n å…¶å®è¿™ä¸ªåœ¨å®é™…æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆå™¨å¹¶æœªå®é™…æ‰§è¡Œï¼Œåªæœ‰å½“è°ƒç”¨. next() æ—¶æ‰å¼€å§‹æ‰§è¡Œï¼Œå¹¶è¿”å›å½“å‰çš„è¿­ä»£å€¼ã€‚æœ€åæ‰§è¡Œå®Œæˆä¹‹åï¼Œåˆ™ä¼šæŠ›å‡º StopIteration å¼‚å¸¸ï¼Œè¡¨ç¤ºè¿­ä»£å®Œæˆã€‚å½“ç„¶ï¼Œè¿™ä¸ªå¼‚å¸¸åœ¨å¤§å¤šæ•°å¾ªç¯æƒ…å†µä¸‹ (æ¯”å¦‚ for) å¹¶ä¸éœ€è¦æ‰‹å·¥å¤„ç†ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸‹é¢æ‰‹å·¥çš„æ–¹æ³•ï¼ˆæ³¨æ„ï¼šnext æ˜¯ Python3 ä¸­çš„å†…ç½®å‡½æ•°ï¼Œå¦‚æœæ˜¯ Python2ï¼Œè¯·ä½¿ç”¨ f.next()ï¼‰:\nâœ Desktop python Python 3.4.3 (default, Aug 14 2015, 11:21:11) [GCC 4.2.1 Compatible Apple LLVM 6.1.0 (clang-602.0.53)] on darwin Type \u0026quot;help\u0026quot;, \u0026quot;copyright\u0026quot;, \u0026quot;credits\u0026quot; or \u0026quot;license\u0026quot; for more information. \u0026gt;\u0026gt;\u0026gt; def fab(max): ... n, a, b = 0, 0, 1 ... while n \u0026lt; max: ... yield b ... a, b = b, a + b ... n = n + 1 ... \u0026gt;\u0026gt;\u0026gt; f = fab(5) \u0026gt;\u0026gt;\u0026gt; next(f) 1 \u0026gt;\u0026gt;\u0026gt; next(f) 1 \u0026gt;\u0026gt;\u0026gt; next(f) 2 \u0026gt;\u0026gt;\u0026gt; next(f) 3 \u0026gt;\u0026gt;\u0026gt; next(f) 5 \u0026gt;\u0026gt;\u0026gt; next(f) Traceback (most recent call last): File \u0026quot;\u0026lt;stdin\u0026gt;\u0026quot;, line 1, in \u0026lt;module\u0026gt; StopIteration ä¸Šé¢çš„æ–¹æ³•å¦‚æœä¸ä½¿ç”¨ yieldï¼Œåˆ™æ¢æˆä¸€ä¸ªæ”¯æŒ iterable çš„å¯èƒ½æ›´ç›´è§‚ç†è§£ä¸€ç‚¹ï¼š\nclass Fab(object): def __init__(self, max): self.max = max self.n, self.a, self.b = 0, 0, 1 def __iter__(self): return self def next(self): if self.n \u0026lt; self.max: r = self.b self.a, self.b = self.b, self.a + self.b self.n = self.n + 1 return r raise StopIteration() åœ¨å¼‚æ­¥ä¸­ï¼Œç¨‹åºçš„ ioloop ä¼šè‡ªåŠ¨å¤„ç†è¿™ä¸€ç±»çš„ç”Ÿæˆå™¨ï¼Œè¿™ä¸€ä¸ªæ ·ä¾‹å¯ä»¥å‚è€ƒä¸€ä¸‹ Tornado çš„å¤„ç†æ–¹å¼: tornado.gen.coroutineã€‚\n3.5 ç‰ˆæœ¬å¼‚æ­¥åŠŸèƒ½ åœ¨ 3.5 ä¹‹åçš„ç‰ˆæœ¬é‡Œï¼Œç¨‹åºæä¾›äº† async å’Œ await å…³é”®å­—ï¼Œè¿™ä¸¤ä¸ªå…³é”®å­—å¯ä»¥æ›¿ä»£ç±»ä¼¼ tornado ä¸­çš„ gen.coroutine/yield æˆ–è€…æ˜¯ asyncio.coroutine/yield çš„ä½œç”¨ã€‚\næ¯”å¦‚åœ¨ä¸Šä¸€èŠ‚ä¸­çš„ä¾‹å­æ”¹é€ æˆä¸º:\nimport asyncio import time async def slow_operation(n): await asyncio.sleep(1) print(\u0026quot;Slow operation {} complete\u0026quot;.format(n)) async def main(): start = time.time() await asyncio.wait([slow_operation(1), slow_operation(2), slow_operation(3), ]) end = time.time() print('Complete in {} second(s)'.format(end-start)) loop = asyncio.get_event_loop() loop.run_until_complete(main()) æ–°çš„å…³é”®å­—ä¼šè®©æˆ‘ä»¬çš„ç¨‹åºçœ‹ä¸Šå»æ›´åŠ æ¸…æ™°ã€‚ä¸è¿‡ä»æ‰§è¡Œæ•ˆç‡ä¸Šçœ‹ï¼Œç°åœ¨è¿˜æ˜¯ç›¸è¾ƒ 3.4.3 æœ‰ä¸€äº›é€€æ­¥ï¼š\nâœ Desktop pyenv shell 3.5.0rc1 âœ Desktop python 3.5_asyncio.py Slow operation 1 complete Slow operation 3 complete Slow operation 2 complete Complete in 1.0012218952178955 second(s) âœ Desktop python 3.4_asyncio.py Slow operation 1 complete Slow operation 3 complete Slow operation 2 complete Complete in 1.0060911178588867 second(s) ä¸è¿‡ç°åœ¨è¿˜åªæ˜¯ RC ç‰ˆæœ¬ï¼Œç›¸ä¿¡ä¹‹åè¿˜æ˜¯ä¼šæœ‰ä¸€äº›æ€§èƒ½è°ƒä¼˜çš„å¯èƒ½æ€§ã€‚\næ›´å¤šçš„å¼€å‘åœºæ™¯ ç°åœ¨ Tornado æ­£åœ¨å¼€å‘çš„ 4.3 ç‰ˆæœ¬å·²ç»æ”¯æŒäº† Python3.5 çš„ async/await å…³é”®å­—ï¼Œåœ¨ä¹‹åçš„å¼€å‘ä¸­ï¼Œå¯ä»¥æ›¿ä»£ @gen.coroutine å’Œ yield ç”¨äºå¼€å‘ã€‚æ ¹æ®ä½œè€…çš„æè¿°ï¼Œå¦‚æœæ˜¯è¿è¡Œåœ¨ 3.5 ç‰ˆæœ¬çš„ Python ä¸Šï¼Œå»ºè®®ä½¿ç”¨å…³é”®å­—è€Œä¸æ˜¯ yield æ–¹å¼ï¼Œè¿™æ ·å¯ä»¥æœ‰æ›´å¥½çš„æ‰§è¡Œæ•ˆç‡ã€‚å½“ç„¶ï¼Œå¦‚æœ 3.5 åªæ˜¯ä¸€ä¸ªå¯é€‰ç‰ˆæœ¬ï¼Œç›¸ä¿¡åœ¨ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´ä¹‹å†…ï¼Œä½ è¿˜æ˜¯éœ€è¦ä½¿ç”¨åŸæœ‰çš„æ‰§è¡Œæ–¹å¼ã€‚\næ½œåœ¨çš„å‘ async å’Œ await åœ¨ Python 3.5 ä¸ 3.6 ç‰ˆæœ¬ä¸­å¹¶ä¸æ˜¯å…³é”®å­—ï¼ŒPython 3.7 ä¸­ä¼šä½œä¸ºå…³é”®å­—ã€‚å› æ­¤éœ€è¦åœ¨ç°æœ‰çš„ç¨‹åºä¸­æ›¿ä»£æ‰å·²æœ‰çš„å¯èƒ½å¯¼è‡´å†²çªçš„å…³é”®å­—ã€‚\n","date":"2015-08-14T18:11:15Z","permalink":"https://www.4async.com/2015/08/2015-08-14-introduction-to-async-and-await/","title":"Python async/await å…¥é—¨"},{"content":"JWT æ˜¯ä»€ä¹ˆ JWT å…¨ç§°æ˜¯ JSON Web Tokensï¼Œæ˜¯ RFC 7519 æ ‡å‡†ï¼Œç”¨äºå®‰å…¨æ ¡éªŒä¸¤æ–¹å¯ä¿¡æ€§çš„å®‰å…¨æªæ–½ã€‚\nJWT è§£å†³äº†å“ªäº›é—®é¢˜ï¼Ÿ JWT æœ¬èº«è®¾è®¡æ˜¯ç”¨äºè§£å†³ Session æœºåˆ¶ä¸èƒ½å¤Ÿå¾ˆå¥½çš„åœ¨ SPA/API ç±»å‹ (restful) åº”ç”¨ä¸­å¤„ç†èº«ä»½è®¤è¯é—®é¢˜ã€‚é€šå¸¸ API çš„è°ƒç”¨æ˜¯æ— çŠ¶æ€ï¼ˆstatelessï¼‰çš„ï¼Œä½¿ç”¨ Session ç­‰å½¢å¼ä¼šæœ‰ä¸Šä¸‹æ–‡è¦æ±‚ã€‚å¦‚å½“ç”¨æˆ·ç™»å½•å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä¸‹å‘ JWT çš„å½¢å¼è¿›è¡Œæ— çŠ¶æ€çš„ API è°ƒç”¨ã€‚åœ¨æ­¤ä¹‹å‰é€šå¸¸æ˜¯ä½¿ç”¨çš„æ–¹å¼åŒ…æ‹¬ä¸é™äºå¦‚ Basic Authã€Oauth2 æˆ– Token å½¢å¼è¿›è¡Œã€‚\nJWT ç›¸æ¯”æ˜¯é¢å¤–æ·»åŠ äº†ç­¾åæ ¡éªŒæ–¹å¼ï¼Œæœ¬è´¨ä¸Šæ¥è¯´å¯¹æŠ—å¦‚æš´åŠ›ç¢°æ’ç­‰å½¢å¼æœ‰ä¸€äº›ä½œç”¨ã€‚ä½†æ˜¯ç”±äºæœ¬èº«é•¿åº¦çš„é™åˆ¶ï¼Œå­˜å‚¨çš„ä¿¡æ¯é‡æœ‰é™ã€‚\nJWT å¤„ç†æ–¹å¼ JWT å†…å®¹ä¸»è¦åˆ†ä¸ºä¸‰æ®µï¼Œåˆ†åˆ«å¯¹åº”å¤´éƒ¨ä¿¡æ¯ï¼Œå­˜å‚¨æ•°æ®å’Œç­¾åä¿¡æ¯ä¸‰éƒ¨åˆ†ï¼Œä¸­é—´ä½¿ç”¨ã€.ã€ç¬¦å·è¿æ¥ï¼Œä¸‰æ®µä¿¡æ¯å‡è¿›è¡Œ Base64 ç¼–ç ã€‚\nå…·ä½“å®ç°æ–¹å¼å¯å‚è€ƒå¦‚ä¸‹ä¼ªä»£ç å®ç°ï¼š\nencodeBase64(header) + '.' + encodeBase64(payload) + '.' + Sign(key + encodeBase64(header) + '.' + encodeBase64(payload)) å…¶ä¸­ Sign çš„ç®—æ³•æ˜¯å¯ä»¥åœ¨ header ä¸­è¿›è¡Œå®šä¹‰ï¼Œæ”¯æŒå¦‚ HMAC-SHA256 å’Œ RSA-SHA256 ç­‰æ–¹å¼ã€‚key åˆ™æ˜¯ç”¨äºéªŒè¯çš„ key ä¿¡æ¯ã€‚\nå…¶ä¸­ header æ ¼å¼å¦‚ä¸‹:\n{\u0026quot;alg\u0026quot;: \u0026quot;HS256\u0026quot;, // æŒ‡å®šåŠ å¯†ç®—æ³•ï¼Œå¯ä»¥é€‰æ‹© RS256 ç­‰ã€‚ \u0026quot;typ\u0026quot;: \u0026quot;JWT\u0026quot; } payload ä¸ºå­˜å‚¨çš„æ•°æ®åŒºå—ï¼Œç”±äºæ­¤éƒ¨åˆ†æœªè¿›è¡ŒåŠ å¯†ï¼Œä¸å»ºè®®å­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚å†…å®¹ä¸ºå­—å…¸ç»“æ„ã€‚\nJWT å­˜åœ¨çš„å®‰å…¨é—®é¢˜ JWT æŠ«éœ²äº†ä¸€ä¸ªæ¯”è¾ƒ ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼šJWT ä¸­å…è®¸è®¾ç½®åŠ å¯†æ–¹æ³•ã€algã€ä¸º noneï¼Œè¿™æ ·ç­¾åä¿¡æ¯å¯è®¾ç½®ä¸º \u0026ldquo;\u0026quot;ï¼Œè¿™æ ·å°±ç»™æ¶æ„ç”¨æˆ·ä¼ªé€  JWT çš„å¯èƒ½ã€‚å¹¶ä¸”è¯¥éªŒè¯æ˜¯åœ¨éªŒè¯ç­¾åä¹‹å‰ï¼ˆå†³å®šç­¾åä½¿ç”¨ç®—æ³•ï¼‰ï¼Œæ‰€ä»¥åœ¨å®‰å…¨å®ç° JWT æ—¶éœ€è¦å¯¹éªŒè¯ç®—æ³•è¿›è¡Œå¯ä¿¡å®‰å…¨æ ¡éªŒã€‚\nè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ JWT æœ¬èº«å¹¶ä¸ä¼šåŠ å¯† payload ä¸­çš„ä¿¡æ¯ï¼Œå› æ­¤åœ¨ä¼ é€’æ•æ„Ÿä¿¡æ¯æ—¶éœ€è¦å•ç‹¬å¯¹æ•°æ®è¿›è¡Œä¸ªåˆ«å¤„ç†ã€‚\nå‚è€ƒè¿æ¥  JWT.io http://jwt.io/  ","date":"2015-08-07T18:11:15Z","permalink":"https://www.4async.com/2015/08/2015-08-07-jwt-basic/","title":"JWT ä»‹ç»"},{"content":"æœ€è¿‘åœ¨å®ç°å¤§å‹ B2B ç³»ç»Ÿä¹‹åï¼Œæœ‰å¾ˆå¤šç»†èŠ‚éœ€è¦è€ƒè™‘ï¼Œå…¶ä¸­ä¸€ç¯å°±æ˜¯æƒé™æ§åˆ¶ã€‚ä¹‹å‰è€ƒè™‘çš„æ¯”è¾ƒå°‘ï¼Œè®¤ä¸ºè¿™ä¸€å—æ¡†æ¶å¯ä»¥ handle é—®é¢˜ä¸å¤§ï¼Œåæ¥å‘ç° Tornado ç›®å‰æ²¡æœ‰ä¸€ä¸ªæ¯”è¾ƒå®Œå–„çš„æƒé™ç®¡ç†æ¨¡å—ï¼Œç”šè‡³è¿ä¸ªåŒ…éƒ½æ²¡æœ‰\u0026hellip; äºæ˜¯åªèƒ½è‡ªå·±åŠ¨æ‰‹ï¼Œä¸°è¡£è¶³é£Ÿäº†ã€‚å‚è€ƒçš„æ–¹å¼ä¹Ÿæ˜¯é€šè¿‡ Flask-Principal çš„ç±»ä¼¼å®ç°æ–¹å¼ã€‚\nåŸå‹ ä¸€ä¸ªæƒé™ç®¡ç†æ¨¡å—åº”è¯¥æœ‰çš„åŠŸèƒ½åº”è¯¥æœ‰å“ªäº›å‘¢ï¼Ÿä»åŸºæœ¬è§’åº¦å‡ºå‘ï¼Œåº”è¯¥åŒ…å«ç”¨æˆ·èº«ä»½ (Identity)ã€ç”¨æˆ·è§’è‰²ï¼ˆRoleNeedï¼‰ã€ç”¨æˆ·æƒé™ï¼ˆPermissionï¼‰è¿™ä¸‰ä¸ªæœ€åŸºæœ¬çš„åˆ†ç±»ç»„æˆã€‚é‚£ä¹ˆä»æœ€å¼€å§‹ï¼Œå°±éœ€è¦å®šä¹‰è¿™å‡ ä¸ªç±»ï¼š\nclass RoleNeed(object): pass class Identity(object): pass class Permission(object): pass å†è€ƒè™‘ä¸€ä¸‹ï¼Œå…¶å® RoleNeed æ›´åƒä¸€ä¸ªæƒé™çš„æšä¸¾æ•°ç»„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæ¯”å¦‚ç”¨æˆ·å¯èƒ½å­˜åœ¨çš„æƒé™ä¸åˆ†ç»„å’Œå•ç‹¬çš„ç”¨æˆ·æƒé™éƒ½æœ‰å…³ç³»ï¼Œè¿™é‡Œéœ€è¦æ›´åŠ æŠ½è±¡ä¸€ä¸‹ã€‚å…·ä½“çš„å¯ä»¥åˆ†æˆ UserNeed å’Œ RoleNeedï¼Œåˆ†åˆ«å¯¹åº”ç”¨æˆ·æƒé™ä¸ç”¨æˆ·ç»„æƒé™ã€‚è¿™æ ·å¦‚æœé€šè¿‡ç±»å®ç°è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦ç»§æ‰¿ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¹Ÿåªæ˜¯ä¸€ä¸ªå…ƒç»„è€Œå·²ã€‚æ‰€ä»¥å¯ä»¥é€‰æ‹©ä¸‹é¢çš„æ–¹å¼ï¼š\nfrom functools import partialã€‚ from collections import namedtuple Need = namedtuple(\u0026#39;Need\u0026#39;, [\u0026#39;method\u0026#39;, \u0026#39;value\u0026#39;]) UserNeed = partial(Need,\u0026#39;user\u0026#39;) RoleNeed = partial(Need,\u0026#39;role\u0026#39;) namedtuple æ˜¯ Python é«˜çº§æ•°æ®ç»“æ„ä¸­çš„ä¸€ä¸ªå†…å®¹ï¼Œåœ¨ collections åŒ…ä¸­ï¼Œå…¶å®å®ç°çš„æ•ˆæœæ˜¯ç”Ÿæˆå¸¦åç§°çš„å…ƒç»„ã€‚æ¯”å¦‚ Need = namedtuple(\u0026lsquo;Need\u0026rsquo;, [\u0026lsquo;method\u0026rsquo;, \u0026lsquo;value\u0026rsquo;]) å®é™…ä¸Šå°±æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªåå­—å«åš Need çš„å…ƒç»„ï¼Œä½ å¯ä»¥é€šè¿‡ Need(\u0026lsquo;a\u0026rsquo;, \u0026lsquo;b\u0026rsquo;) çš„æ–¹å¼è®¾ç½®å¯¹åº”çš„ method å’Œ value çš„å€¼ã€‚\næ¥ä¸‹æ¥çš„ partial æ˜¯å’Œä¹‹å‰æˆ‘å¦ä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»çš„ wraps åœ¨ä¸€ä¸ªåŒ…ä¸­çš„åŠŸèƒ½ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºæ–¹ä¾¿å¡«å…¥ä¸€ä¸ªåˆå§‹åŒ–å‚æ•°çš„æ–¹æ³•ï¼Œæ¯”å¦‚ partial(Need,\u0026lsquo;user\u0026rsquo;) ç­‰åŒäº Need(\u0026lsquo;user\u0026rsquo;, x)ï¼Œä½†æ˜¯ x çš„è¿™ä¸ªå‚æ•°éœ€è¦åœ¨è°ƒç”¨ parial çš„è¿”å›å€¼çš„æ—¶å€™æ‰ä¼šä¼ å…¥ï¼Œå¯ä»¥ç”¨æ¥é¢„å®šä¹‰ä¸€éƒ¨åˆ†çš„ç¯å¢ƒå‚æ•°ã€‚\nç°åœ¨ç›¸å½“äºæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªä»¥ç”¨æˆ·ä¸ºç»´åº¦èº«ä»½æƒé™è¦æ±‚å’Œä»¥ç”¨æˆ·ç»„ä¸ºç»´åº¦çš„èº«ä»½è¦æ±‚ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥å®ç°ç”¨æˆ·èº«ä»½çš„ä¸€äº›åŠŸèƒ½äº†ã€‚\nç”¨æˆ·èº«ä»½æˆ–è€…æƒé™ä¿å­˜æˆ‘ä»¬åº”è¯¥äº¤ç”±ä¸Šå±‚çš„ä¸šåŠ¡é€»è¾‘æ¥å®ç°ï¼Œä»¥ä¿è¯æœ€å¤§çš„æ¨¡å—å¤ç”¨æ€§ï¼Œé‚£ä¹ˆç”¨æˆ·èº«ä»½å°±å‰©ä¸‹äº†ï¼Œå£°æ˜ç”¨æˆ·èº«ä»½å’Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ‰§è¡ŒæŸé¡¹æƒé™æ“ä½œçš„å†…å®¹ã€‚\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š\nclass Identity(object): \u0026quot;\u0026quot;\u0026quot; A set of needs provided by this user example: identity = Identity('ali') identity.provides.add(('role', 'admin')) \u0026quot;\u0026quot;\u0026quot;def __init__(self, name): self.name = name self.provides = set() def can(self, permission): return permission.allows(self) è¿™é‡Œçš„ provides æ˜¯ä½œä¸ºç”¨æˆ·æƒé™çš„å£°æ˜ï¼Œæ˜¯ä¸€ä¸ªæ¯ä¸ªæƒé™çš„é›†åˆã€‚å¯ä»¥åœ¨æœ€å¼€å§‹ç™»å½•ç­‰ç­‰æ—¶é—´è¿›è¡ŒåŠ è½½ã€‚è€Œ can æ–¹æ³•åˆ™æ˜¯åˆ¤æ–­æŸä¸ªæƒé™æ˜¯å¦å¯ä»¥è¢«æ‰§è¡Œã€‚\n","date":"2015-07-22T11:00:15Z","permalink":"https://www.4async.com/2015/07/2015-07-22-howto-make-your-own-permission-plugin/","title":"å¦‚ä½•ç”¨ Python å®ç°ä¸€ä¸ªæƒé™ç®¡ç†ç³»åˆ— (ä¸€)"},{"content":"å¾ˆä¹…æ²¡æœ‰å†™æŠ€æœ¯å­˜æ¡£äº†ï¼Œå¤ªè¿‡äºç½ªæ¶ã€‚æœ€è¿‘åœ¨æ™ºèƒ½ç¡¬ä»¶åˆ›ä¸šå…¬å¸æ‹…ä»»æ¶æ„å¸ˆï¼Œæ¨å¹¿ä¸€äº›æ›´æ–°æ›´é…·çš„æŠ€æœ¯åº”ç”¨åœ¨å„ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬ Golang/Python/Docker ç­‰ï¼Œå¦‚æœä½ æœ‰å…´è¶£ï¼Œä¹Ÿæ¬¢è¿åŠ å…¥æˆ‘ä»¬: kevin[at yeeuu[dot]comã€‚å¹¿å‘Šæ—¶é—´ç»“æŸã€‚\nPython çš„ä¿®é¥°å™¨æ˜¯æ¯”è¾ƒå¸¸è§çš„å¼€å‘åº”ç”¨å¸®åŠ©å·¥å…·ï¼Œä»–å¯ä»¥å®ç°ä¸€äº›æ‰¹é‡çš„ä¿®é¥°å·¥ä½œï¼Œæ¯”å¦‚ç»Ÿä¸€æ¥æ·»åŠ ä¸€äº›å°åŠŸèƒ½ç­‰ç­‰ã€‚ä½†æ˜¯è¿™äº›åŠŸèƒ½å¯¹åŸæœ‰çš„å‡½æ•°ä¸äº§ç”Ÿä¾µå…¥ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥å®ç°å¿«é€Ÿçš„ä¿®æ”¹å’Œæ›¿æ¢ã€ç§»é™¤ã€‚\nå¦‚æœä½ ä½¿ç”¨è¿‡ Python çš„ Web æ¡†æ¶ï¼Œç›¸ä¿¡ä½ å¯¹ä¿®é¥°å™¨åº”è¯¥å¹¶ä¸é™Œç”Ÿï¼šDjangoã€Flaskã€Tornado ç­‰å¸¸è§çš„æ¡†æ¶ä¸­éƒ½åŒ…å«äº†ä¿®é¥°å™¨çš„ä½¿ç”¨ã€‚\né‚£ä¹ˆ decorators æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿè¿˜æ˜¯å…ˆä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å¼€å§‹ã€‚å…ˆçœ‹ä¸‹ Tornado ä¸­çš„ tornado.web.authenticated ä½¿ç”¨ã€‚\nclass IndexHandler(tornado.web.RequestHandler): @tornado.web.authenticated def get(self): self.render(\u0026#39;index.html\u0026#39;) tornado.web.authenticated çš„ä½œç”¨å°±æ˜¯åˆ¤æ–­ self.current_user æ˜¯å¦ä¸º None æˆ–è€…ä¸ºç©ºï¼Œå¦åˆ™è·³è½¬åˆ°ä¹‹å‰è®¾ç½®çš„ login_url åœ°å€å»ã€‚è‡³äºè·å– current_user çš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡é‡è½½ get_current_user å‡½æ•°å®ç°ã€‚\nåœ¨æŸ¥çœ‹ä¿®é¥°å™¨çš„å…·ä½“ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ Python ä¿®é¥°å™¨çš„åŸç†ã€‚Python çš„ä¿®é¥°å™¨å…¶å®æ˜¯å®ç°äº†ä¸‹é¢çš„ä¸€ä¸ªç®€å•åŠŸèƒ½ï¼š\n@decorator def func(): pass ç­‰ä»·äº\nfunc = decorator(func) å¤šå±‚çš„ä¿®é¥°å™¨åˆ™æ˜¯å®ç°äº†å¤šå±‚çš„å›è°ƒè°ƒç”¨ã€‚åŒæ—¶åœ¨åº•å±‚å±‚é¢ï¼Œæä¾›äº† functools åŒ… ç”¨äºå®ç°ç›¸å…³åŠŸèƒ½ï¼Œæ³¨æ„ï¼Œè¯¥åŒ…æ˜¯ 2.5 ä¹‹åç‰ˆæœ¬ä¸­å¼•å…¥ï¼Œå¦‚æœä½ è¿˜åœ¨ä½¿ç”¨å¤è€çš„ Python ç‰ˆæœ¬ï¼Œåˆ™å¯ä»¥æ‰‹å·¥å®ç°åŒç­‰åŠŸèƒ½ã€‚\nå…·ä½“åŠŸèƒ½ å®ç°ä»£ç  å¦‚ä¸‹ï¼š\ndef authenticated(method): \u0026#34;\u0026#34;\u0026#34;Decorate methods with this to require that the user be logged in. If the user is not logged in, they will be redirected to the configured `login url \u0026lt;RequestHandler.get_login_url\u0026gt;`. If you configure a login url with a query parameter, Tornado will assume you know what you\u0026#39;re doing and use it as-is. If not, it will add a `next` parameter so the login page knows where to send you once you\u0026#39;re logged in.\u0026#34;\u0026#34;\u0026#34; # method ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå®é™…ä¸Šä¸ºç±»ä¸­çš„ get ç­‰å‡½æ•°ã€‚ @functools.wraps(method) def wrapper(self, *args, **kwargs): # åˆ¤æ–­å½“å‰ç”¨æˆ· if not self.current_user: # æ²¡æœ‰æƒé™æ“ä½œ if self.request.method in (\u0026#34;GET\u0026#34;, \u0026#34;HEAD\u0026#34;): # getã€head è¯·æ±‚è·³è½¬åˆ°ç™»å½•é¡µé¢ url = self.get_login_url() if \u0026#34;?\u0026#34; not in url: if urlparse.urlsplit(url).scheme: # if login url is absolute, make next absolute too next_url = self.request.full_url() else: next_url = self.request.uri url += \u0026#34;?\u0026#34; + urlencode(dict(next=next_url)) self.redirect(url) return # 403 æ— æƒé™æ“ä½œ raise HTTPError(403) # é€šè¿‡éªŒè¯ return method(self, *args, **kwargs) # å‡½æ•°å¼ç¼–ç¨‹çš„å…¸å‹èŒƒä¾‹ :) return wrapper æ ¹æ®è¿™ä¸ªï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•å†™ä¸€ä¸ªè‡ªå·±çš„ä¿®é¥°å™¨:\n#!/usr/bin/python # -*- coding: utf-8 -*- import functools def print_hello(method): @functools.wraps(method) def wrapper(*args, **kwargs): print \u0026#34;hello!\u0026#34; return method(*args, **kwargs) return wrapper @print_hello def main(): print \u0026#39;in main\u0026#39; if __name__ == \u0026#39;__main__\u0026#39;: main() è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\nâœ Desktop python test_decorator.py hello! in main ç°åœ¨çœ‹èµ·æ¥å·²ç»å¾ˆä¸é”™äº†ï¼Œä½†æ˜¯ä¸èƒ½ä¿®æ”¹å‚æ•°çœ‹èµ·æ¥æœ‰äº›éœ€æ±‚è¿˜æ˜¯æ— æ³•å®ç°ã€‚é‚£ä¹ˆèƒ½å¤Ÿé€šè¿‡ä¿®é¥°å™¨ä¼ é€’ä¿®æ”¹ä¸€äº›å‚æ•°ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚\nä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬è¯•ç€ç”¨ä¿®é¥°å™¨å‘å‡½æ•°ä¸­ä¼ é€’å‚æ•°ï¼š\n#!/usr/bin/python # -*- coding: utf-8 -*- import functools def print_hello(method): @functools.wraps(method) def wrapper(*args, **kwargs): kwargs[\u0026#39;name\u0026#39;] = \u0026#39;Pythonic\u0026#39; return method(*args, **kwargs) return wrapper @print_hello def main(name): print \u0026#34;Hello, {}\u0026#34;.format(name) if __name__ == \u0026#39;__main__\u0026#39;: main() è¾“å‡ºç»“æœä¸º:\nâœ Desktop python test_decorator.py Hello, Pythonic é‚£ä¹ˆèƒ½ä¸èƒ½å‘ä¿®é¥°å™¨é‡Œé¢ä¼ é€’å‚æ•°å‘¢ï¼Ÿå½“ç„¶ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡ç›¸å¯¹æ¥è¯´æ›´å¤æ‚ä¸€ç‚¹ï¼š\n#!/usr/bin/python # -*- coding: utf-8 -*- import functools def print_hello(name): def real_wrapper(method): @functools.wraps(method) def wrapper(*args, **kwargs): kwargs[\u0026#39;name\u0026#39;] = name return method(*args, **kwargs) return wrapper return real_wrapper @print_hello(name=\u0026#39;Pythonic\u0026#39;) def main(name): print \u0026#34;Hello, {}\u0026#34;.format(name) if __name__ == \u0026#39;__main__\u0026#39;: main() è¾“å‡ºç»“æœä¸º:\nâœ Desktop python test_decorator.py Hello, Pythonic ä¸Šé¢çš„å®ç°æ–¹æ³•æ˜¯å‡½æ•°å¼çš„å®ç°ï¼ŒPython åŒæ ·æ”¯æŒç±»æ¨¡å¼çš„ä¿®é¥°å™¨æ”¯æŒï¼Œæ¯”å¦‚ï¼š\nclass function_wrapper(object): def __init__(self, wrapped): self.wrapped = wrapped def __call__(self, *args, **kwargs): return self.wrapped(*args, **kwargs) @function_wrapper def function(): pass è™½ç„¶ä¿®é¥°å™¨å¾ˆå¥½ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜çš„ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ä¹‹åï¼Œæƒ³è¦è·å–è¢«åŒ…è£…å‡½æ•°çš„å‚æ•°ï¼ˆargumentï¼‰æˆ–æºä»£ç ï¼ˆsource codeï¼‰æ—¶å¹¶ä¸èƒ½å–åˆ°æ­£ç¡®çš„ç»“æœã€‚ä¸è¿‡è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ä½¿ç”¨åå°„æ¥è§£å†³ï¼š\ndef get_true_argspec(method): argspec = inspect.getargspec(method) args = argspec[0] if args and args[0] == \u0026#39;self\u0026#39;: return argspec if hasattr(method,\u0026#39;__func__\u0026#39;): method = method.__func__ if not hasattr(method,\u0026#39;func_closure\u0026#39;) or method.func_closure is None: raise Exception(\u0026#34;No closure for method.\u0026#34;) method = method.func_closure[0].cell_contents return get_true_argspec(method) ä¸è¿‡è¯´å®è¯ï¼Œå¾ˆå°‘åœ¨é¡¹ç›®ä¸­è·å–è¿™äº›ä¸œè¥¿ï¼Œåªæ˜¯æä¾›ä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œå®é™…ä¸Š functools.wraps å¯ä»¥è§£å†³ç»å¤§å¤šæ•°çš„é—®é¢˜ã€‚\næœ€åä»‹ç»ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„ä¿®é¥°å™¨ä½¿ç”¨æ–¹æ³•ï¼Œæ¯”å¦‚ï¼Œè¿›è¡Œæ€§èƒ½æµ‹è¯•ï¼š\nimport cProfile, pstats, StringIO def run_profile(func): def wrapper(*args, **kwargs): datafn = func.__name__ + \u0026#34;.profile\u0026#34; # Name the data file prof = cProfile.Profile() retval = prof.runcall(func, *args, **kwargs) s = StringIO.StringIO() sortby = \u0026#39;cumulative\u0026#39; ps = pstats.Stats(prof, stream=s).sort_stats(sortby) ps.print_stats() print s.getvalue() return retval return wrapper è¿˜æœ‰ä¸€äº›æ¡ˆä¾‹å¯ä»¥çœ‹ä¹‹å‰æä¾›çš„å‡ ä¸ªæ¡†æ¶çš„ APIï¼Œæ¯”å¦‚è·¯ç”±ç»„ç»‡ï¼Œå¼‚æ­¥å¤„ç†ç­‰ç­‰éƒ½æ˜¯é€šè¿‡ä¿®é¥°å™¨å®ç°çš„ã€‚\n","date":"2015-06-17T18:00:15Z","permalink":"https://www.4async.com/2015/06/2015-06-17-something-about-python-decorator/","title":"Python Decorator ä¿®é¥°å™¨ç®€ä»‹"},{"content":"æ³¨ï¼šrust ç›®å‰æ›´æ–°ä»æ—§å¾ˆé¢‘ç¹ï¼Œè¯­æ³•å˜åŒ–æ¯”è¾ƒå¤§ï¼Œå­¦ä¹ ä¸»è¦åŸºäº Rust 1.0 Alpha ç‰ˆæœ¬ï¼Œä¹‹åå¯èƒ½ä¼šæœ‰éƒ¨åˆ†å˜åŒ–ã€‚\nè¡¥å……ä¸‹ç¬”è®°ä¸€ä¸­çš„å†…å®¹ï¼šåœ¨ Rust ä¸­å˜é‡é»˜è®¤æ˜¯ä¸èƒ½æ”¹å˜çš„ï¼Œåªæœ‰å£°æ˜ä¸º mutï¼Œæ‰å¯ä»¥è¿›è¡Œæ”¹å˜ã€‚\næ¯”å¦‚ï¼š\nlet x = 5; x = 7; ä¼šæŠ¥é”™  re-assignment of immutable variableï¼Œä¸è¿‡ä¸‹é¢çš„æ–¹æ³•å°±å¯ä»¥æ­£å¸¸æ‰§è¡Œäº†ï¼š\nlet mut x = 5; x = 7; é€»è¾‘æ§åˆ¶ ä¸€èˆ¬é€»è¾‘æ§åˆ¶åˆ†ä¸ºåˆ¤æ–­åˆ†æ”¯ã€å¾ªç¯ç­‰ç­‰. if åœ¨ rust ä¸­åŒºåˆ«ä¸æ˜¯ç‰¹åˆ«å¤§ï¼š\nlet x = 5; if x == 5 {println!(\u0026quot;x is five!\u0026quot;);} else {println!(\u0026quot;x is not five :(\u0026quot;);} ä¸è¿‡è¿˜å¯ä»¥è¿™æ ·å†™ï¼š\nlet x = 5; let y = if x == 5 {10} else {15}; // y: i32 å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸‹é¢çš„å†™æ³•æ˜¯ä¸æ­£ç¡®çš„ï¼š\nlet x = 5; let y: i32 = if x == 5 {10;} else {15;}; ä½†æ˜¯ for å¾ªç¯åŒºåˆ«å°±æ¯”è¾ƒå¤§äº†ï¼š\nfor x in range(0, 10) {println!(\u0026quot;{}\u0026quot;, x); // x: i32 } while å¾ªç¯åˆ™å¯ä»¥æ›´åŠ ç®€å•ï¼š\nlet mut x = 5u; // mut x: uint let mut done = false; // mut done: bool while !done { x += x - 3; println!(\u0026quot;{}\u0026quot;, x); if x % 5 == 0 {done = true;} } å¦‚æœæ˜¯è¦æ±‚æ­»å¾ªç¯ï¼Œä½¿ç”¨ loop{} æ›´åŠ æ–¹ä¾¿ã€‚åœ¨å¾ªç¯ä¸­å¯ä»¥ä½¿ç”¨ break å’Œ continue æ§åˆ¶æµç¨‹è¿›åº¦ï¼Œè¿™ä¸ªæ²¡ä»€ä¹ˆåŒºåˆ«å°±ä¸å†è¯´äº†ã€‚\nå¤æ‚ç±»å‹ Rust ä½œä¸ºæ›´å…ˆè¿›çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸€äº›å¤æ‚å˜é‡ç±»å‹è‚¯å®šæ˜¯æ”¯æŒçš„ï¼Œæ¯”å¦‚ Tuplesã€Structsã€Enums ç­‰ç­‰ã€‚\nlet x = (1,\u0026quot;hello\u0026quot;); // or let x: (i32, \u0026amp;str) = (1,\u0026quot;hello\u0026quot;); struct Point { x: i32, y: i32, } let mut point = Point {x: 0, y: 0}; enum Ordering { Less, Equal, Greater, } Ordering::Less let a = [1, 2, 3]; println!(\u0026quot;a has {} elements\u0026quot;, a.len()); for e in a.iter() {println!(\u0026quot;{}\u0026quot;, e); } println!(\u0026quot;{}\u0026quot;, a[0]); å€¼å¾—ä¸€æçš„æ˜¯ :: è¡¨ç¤ºçš„å‘½åç©ºé—´ï¼Œè¿™ç‚¹å’Œ c æœ‰ä¸€äº›åŒºåˆ«ã€‚\né™¤æ­¤ä¹‹å¤–ï¼ŒRust è‡ªå®šä¹‰äº†ä¸€äº›ç±»å‹ï¼Œä¸€ç§æ˜¯ä»‹äº tuple å’Œ struct ä¹‹é—´çš„ç±»å‹ï¼Œæ¯”å¦‚ï¼š\nstruct Color(i32, i32, i32); struct Point(i32, i32, i32); let black = Color(0, 0, 0); let origin = Point(0, 0, 0); è¿˜æœ‰ä¸€ç§å«å‘é‡ï¼š\nlet mut nums = vec![1, 2, 3]; nums.push(4); æœ‰ç‚¹åƒé˜Ÿåˆ—ï¼Œå¯å˜å•†éƒ½ï¼Œå¯ä»¥ push è¿›è¡Œæ·»åŠ ã€‚\nè¿˜æœ‰ä¸€ç§åˆ‡ç‰‡ï¼š\nlet a = [0, 1, 2, 3, 4]; let middle = a.slice(1, 4); // A slice of a: just the elements [1,2,3] for e in middle.iter() {println!(\u0026quot;{}\u0026quot;, e); // Prints 1, 2, 3 } Match è¿™ä¸ªä¹Ÿæ˜¯ Rust ç‰¹æœ‰çš„ï¼Œæœ‰ç‚¹ç±»ä¼¼ switch çš„æ„Ÿè§‰ï¼š\nlet x = 5; match x {1 =\u0026gt; println!(\u0026quot;one\u0026quot;), 2 =\u0026gt; println!(\u0026quot;two\u0026quot;), 3 =\u0026gt; println!(\u0026quot;three\u0026quot;), 4 =\u0026gt; println!(\u0026quot;four\u0026quot;), 5 =\u0026gt; println!(\u0026quot;five\u0026quot;), _ =\u0026gt; println!(\u0026quot;something else\u0026quot;), } ä½†æ˜¯ Rust ä¸€å®šè¦æœ‰æœ€åä¸€è¡Œï¼Œå¦åˆ™ä¼šç¼–è¯‘æŠ¥é”™ã€‚\nå­—ç¬¦ä¸²ç±»å‹ Rust çš„å­—ç¬¦ä¸²é»˜è®¤æ˜¯ UTF-8 ç¼–ç ï¼Œä½†æ˜¯æœ‰ä¸¤ç§ç±»å‹çš„å­—ç¬¦ä¸² \u0026amp; str å’Œ Stringã€‚è¿™ä¸¤ç§ç±»å‹ä¸‹é¢çš„æ–¹å¼æ¯”è¾ƒï¼š\nlet a = \u0026quot;aaa\u0026quot;; //a: \u0026amp;str let b = a.to_string(); // b: String let c = b.to_slice(); //c: \u0026amp;str \u0026amp;str å’Œ String çš„åŒºåˆ«æ˜¯ï¼Œ\u0026amp;str æ›´åƒæ˜¯ sliceï¼Œè€Œ String åˆ™æ˜¯åƒä¸€ä¸ªåˆ†é…è¿‡çš„å†…å­˜ç©ºé—´å­—ç¬¦ä¸²ï¼Œä¸èƒ½å¤Ÿè¢«ä¿®æ”¹é•¿åº¦ï¼ˆå¾…ç¡®è®¤ï¼‰ã€‚String-\u0026gt;\u0026amp;str ä¼šæ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯ \u0026amp; str-\u0026gt;String æ¶ˆè€—åˆ™ä¼šæ¯”è¾ƒå¤§ã€‚ è¾“å…¥è¾“å‡º è¾“å…¥æ˜¯å®˜æ–¹åº“ std::io::stdin()ã€‚:: ä¹‹å‰ä»‹ç»è¿‡ï¼Œæ˜¯å‘½åç©ºé—´ï¼Œç›¸å½“äº std::io åº“é‡Œçš„ stdin å‡½æ•°ã€‚\næ¯”å¦‚ï¼š\nuse std::io; fn main() {println!(\u0026quot;Type something!\u0026quot;); let input = io::stdin().read_line().ok().expect(\u0026quot;Failed to read line\u0026quot;); println!(\u0026quot;{}\u0026quot;, input); } ","date":"2015-01-12T20:46:15Z","permalink":"https://www.4async.com/2015/01/2015-01-12-rust-note-2/","title":"Rust å­¦ä¹ ç¬”è®°äºŒ"},{"content":"æ³¨ï¼šrust ç›®å‰æ›´æ–°ä»æ—§å¾ˆé¢‘ç¹ï¼Œè¯­æ³•å˜åŒ–æ¯”è¾ƒå¤§ï¼Œå­¦ä¹ ä¸»è¦åŸºäº Rust 1.0 Alpha ç‰ˆæœ¬ï¼Œä¹‹åå¯èƒ½ä¼šæœ‰éƒ¨åˆ†å˜åŒ–ã€‚\nå…ˆæ¥è¯´ä¸‹ Rust çš„ä¼˜ç‚¹ï¼š\n RAII(Resource Acquisition Is Initialization) ï¼šåƒåœ¾å›æ”¶ GC æ˜¯è§£å†³å†…å­˜å®‰å…¨çš„æœ€æ™®é€šæ–¹å¼ï¼Œä½†æ˜¯ Rust ç³»ç»Ÿå¹¶ä¸ä¾é  GCï¼Œè€Œæ˜¯åœ¨ç¼–è¯‘æ—¶é€šè¿‡ RAII å®ç°èµ„æºè‡ªåŠ¨é‡Šæ”¾ã€‚ ** å®‰å…¨ä¾¿æ·çš„å¹¶å‘å¼€å‘ ** ï¼šè¿™ä¸ªåé¢å­¦ä¹ é‡Œé¢ä¼šè®²åˆ°ï¼Œè¿™ä¸ªå’Œ Golang åº”è¯¥ç®—ç«äº‰äº†å§ã€‚ ** é«˜æ•ˆçš„æ‰§è¡Œæ•ˆç‡ **ï¼šæ ¹æ®æµ‹è¯•ï¼Œrust çš„æ€§èƒ½åº”è¯¥æ˜¯è¶…è¿‡äº† Java äº†ã€‚ï¼ˆä¸€æ—¶åŠä¼šæ‰¾ä¸åˆ°äº†ï¼Œæ‰¾åˆ°è¡¥ä¸Šï¼‰ ç¼ºç‚¹æˆ‘æ„Ÿè§‰å¦‚ä¸‹ï¼š ** å­¦ä¹ å¤æ‚åº¦ä¸ä½ **ï¼šç›¸å¯¹ go æˆ–è€…å…¶ä»–è¯­è¨€ï¼Œè¿˜æ˜¯å¤æ‚å¾ˆå¤šï¼Œå­¦ä¹ é—¨æ§›æ¯”è¾ƒé«˜ã€‚ **GC çš„é—®é¢˜ **ï¼šGC å¥½å¤„æ˜¯å±è”½äº†å¾ˆå¤šé—®é¢˜ï¼Œä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚ Goï¼ŒRust éœ€è¦äº†è§£æ›´å¤šçš„ç¼–è¯‘å™¨ç»†èŠ‚ã€‚  Rust åŸºç¡€ Rust åŸæ–‡ä»¶æ‰©å±•åæ˜¯. rsï¼Œç¼–è¯‘ç¨‹åºåå­—å«åš rustcã€‚å¯ä»¥ä½¿ç”¨ rustc xxx.rs ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚é¦–å…ˆè¿˜æ˜¯ç®¡ç”¨çš„ hello world:\nfn main(){println!(\u0026quot;hello world!\u0026quot;);} println æ˜¯ä¸€ä¸ªå®å®šä¹‰ï¼Œåé¢ä¼šå†è¯¦ç»†å†™ä¸€ä¸‹ã€‚fn æœ‰ç‚¹ç±»ä¼¼è¡¨ç¤ºå‡½æ•°çš„ function çš„å®šä¹‰ï¼Œè¯´èµ·æ¥ï¼Œrust æ˜¯ Javascript ä¹‹çˆ¶æçš„ï¼Œå“ä½å˜›ï¼Œå‘µå‘µã€‚\nRust å®‰è£…ç¨‹åºå¸¦ä¸€ä¸ªå«åš cargo çš„å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·æ˜¯ç”¨äºé¡¹ç›®ç¼–è¯‘çš„ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„è·¯å¾„ç»„ç»‡æ–‡ä»¶ï¼š\n|__Cargo.toml |__src |__main.rs Cargo.toml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n[package] name = \u0026quot;hello_world\u0026quot; version = \u0026quot;0.0.1\u0026quot; authors = [\u0026quot;Your name \u0026lt;you@example.com\u0026gt;\u0026quot; ] [[bin]] name = \u0026quot;main\u0026quot; ä½¿ç”¨ cargo build å‘½ä»¤å¯ä»¥åœ¨ src åŒçº§ç›®å½•ä¸‹ç”Ÿæˆ target ç›®å½•ï¼Œä¸‹é¢å°±åŒ…å«äº†ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æ‰§è¡Œå®Œæˆä¹‹åï¼Œåœ¨ Cargo.toml åŒçº§ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª Cargo.lock æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨äºè·Ÿè¸ªç¨‹åºç‰ˆæœ¬çš„ã€‚\nå‚æ•°èµ‹å€¼ å‚æ•°èµ‹å€¼ä¸»è¦æ˜¯ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ï¼š\nlet x = 5; let (y, z) = (2, 3); let i:i32 = 4; println!(\u0026quot;The value of x is: {}, y is: {}, z is: {}, i is: {}\u0026quot;, x, y, z, i); Rust ä¼šè‡ªåŠ¨å®šä¹‰ç±»å‹ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å˜é‡åé¢åŠ ä¸Š : ç±»å‹  å®šä¹‰ç±»å‹ï¼Œæ¯”å¦‚ï¼šlet j:i32ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ Rust ä¼šä¸¥æ ¼æ£€æŸ¥ä¸€äº›è¿™æ ·çš„æœªåˆå§‹åŒ–å˜é‡ï¼Œå¦‚æœä¸èµ‹å€¼çš„è¯ï¼Œä¸€å®šä¼šç¼–è¯‘æŠ¥é”™çš„ã€‚\n","date":"2015-01-11T22:00:15Z","permalink":"https://www.4async.com/2015/01/2015-01-11-rust-note-1/","title":"Rust å­¦ä¹ ç¬”è®°ä¸€"},{"content":"Phonegap ä¸»è¦æ˜¯æ–¹ä¾¿ç”¨äºç§»åŠ¨å¼€å‘çš„å¹³å°ï¼Œå¯¹äºæ²¡æœ‰å¤ªå¤šåŠŸèƒ½éœ€æ±‚çš„ç»„å»ºæ¥è¯´ï¼Œå¯ä»¥å®ç°å¿«é€Ÿçš„åŠŸèƒ½å¼€å‘ã€‚å‹ç›Ÿæ˜¯ä¸€å¥—é’ˆå¯¹ç¨‹åºä½¿ç”¨è€…åˆ†æçš„å·¥å…·ï¼Œè¿™ä¸¤è€…é›†æˆå¯ä»¥æ–¹ä¾¿å¯¹ä½¿ç”¨ç¨‹åºçš„ç”¨æˆ·è¿›è¡Œåˆ†æã€‚ç°é˜¶æ®µè‡ªå·±è¿˜æ²¡æ—¶é—´æ­å»ºä¸€ä¸ªè‡ªå·±ç”¨çš„å¹³å°å‡ºæ¥ï¼Œåªå¥½å°†å°±ç€ç”¨ä¸€äº›å¼€æºå’Œå•†ä¸šæ–¹æ¡ˆå®ç°ã€‚\né›†æˆå‡†å¤‡ é¦–å…ˆéœ€è¦æœ‰ä¸€ä¸ªå·¥ç¨‹ï¼Œå¦‚æœä½ å·²ç»æœ‰äº†ï¼Œåˆ™å¯ä»¥è·³è¿‡è¿™ä¸ªæ­¥éª¤ã€‚åŒæ—¶ï¼Œè¿˜éœ€è¦ä½ æœ‰ä¸€ä¸ª App Keyï¼ˆiOS ä¸ Android ä¸åŒï¼‰ï¼Œå¯ä»¥åœ¨ç®¡ç†ä¸­æ‰¾åˆ° keyã€‚\nå‡è®¾ä½ å·²ç»å®‰è£…äº† cordovaï¼Œå¹¶ä¸”å·²ç»æœ‰ iOS å’Œ Android å¼€å‘ç¯å¢ƒã€‚è¿™æ ·ä¸€èˆ¬éƒ½æ˜¯ Mac ç³»ç»Ÿäº†ã€‚\n cordova create hello com.example.hello HelloWorld cd hello cordova platform add android cordova platform add ios\n iOS é›†æˆ ios é›†æˆæ–¹å¼æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆï¼Œæ‰¾åˆ°é¡¹ç›®ç›®å½•çš„ platform/ios ä¸­çš„é¡¹ç›®ï¼Œæ‰“å¼€ã€‚\nè¯·åœ¨ä½ çš„å·¥ç¨‹ç›®å½•ç»“æ„ä¸­ï¼Œå³é”®é€‰æ‹© Add-\u0026gt;Existing Filesâ€¦ï¼Œé€‰æ‹© SDK å‹ç¼©åŒ…ä¸­çš„ libMobClickLibrary.a å’Œ MobClick.hã€‚æˆ–è€…å°†è¿™ä¸¤ä¸ªæ–‡ä»¶æ‹–å…¥ XCode å·¥ç¨‹ç›®å½•ç»“æ„ä¸­ï¼Œåœ¨å¼¹å‡ºçš„ç•Œé¢ä¸­å‹¾é€‰ Copy items into destination group's folder(if needed), å¹¶ç¡®ä¿ Add To Targets å‹¾é€‰ç›¸åº”çš„ targetã€‚\næ·»åŠ ä¾èµ–æ¡†æ¶ (Framework) å’Œç¼–è¯‘å™¨é€‰é¡¹ TARGETS\u0026ndash;\u0026gt;Build Phases\u0026ndash;\u0026gt;Link Binary With Libraries\u0026ndash;\u0026gt; + \u0026ndash;\u0026gt;libz.dylib åœ¨ AppDelegate.m ä¸­å¡«å†™ Appkeyï¼Œè®¾ç½®å‘é€ç­–ç•¥å’Œå¡«å†™æ¸ é“ id ä¸‰éƒ¨åˆ†ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š\n- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions { ...... [MobClick startWithAppkey:@\u0026#34; ä½ çš„ AppKey\u0026#34;];} Android é›†æˆ å¾…è¡¥å……ã€‚\n","date":"2014-12-27T20:20:15Z","permalink":"https://www.4async.com/2014/12/2014-12-27-integrate-umeng-into-phonegap-app/","title":"Phonegap ä¸­æ•´åˆå‹ç›Ÿåˆ†æ"},{"content":"è¿™æ˜¯ä¸€ç¯‡å¦‚ä½•ç¼–å†™é«˜æ•ˆ Golang è¯­è¨€ç¨‹åºçš„æ–‡ç« ã€‚è¿™æ˜¯ä»ä¸€äº›å¼€å‘è€…çš„ç»éªŒæ€»ç»“ä¸­æ•´ç†å‡ºæ¥çš„ã€‚æ ¹æ®è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯ä»¥ç¼–å†™å‡ºä¸€ç¯‡æ›´é«˜æ•ˆçš„ Golang ç¨‹åºã€‚\nå°½é‡ä½¿ç”¨ç›´æ¥çš„ç±»å‹ interface{} æä¾›äº† golang ä¸­çš„ interface ç±»ä¼¼äº java çš„ interfaceã€PHP çš„ interface æˆ– C++ çš„çº¯è™šåŸºç±»ã€‚é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥æä¾›æ›´å¿«æ·çš„ç¼–ç ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼Œæœ€å¤§çš„é—®é¢˜è¿˜æ˜¯æ€§èƒ½é—®é¢˜ã€‚\n// method 1 a.AA() // method 2 v.(InterfaceA).AA() // method 3 switch v.(type) { case InterfaceA: v.(InterfaceA).AA()} è¿™ä¸‰ç»„æ–¹æ³•æ€§èƒ½é€ä¸ªä¸‹é™ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯ç›´æ¥è¿›è¡Œç±»å‹å¼•ç”¨ã€‚\næŒ‡é’ˆä¼ å‚æ•ˆç‡æ›´é«˜ æŒ‡é’ˆä¼ å‚ä¼šå‡å°‘å¯¹è±¡å¤åˆ¶è¿‡ç¨‹ï¼Œæ•ˆç‡æ›´é«˜ã€‚\nfunc Call(a *Struct) uint64 {return a.Ba} åˆ›å»ºå¯¹è±¡æ—¶é¿å…åˆ›å»ºå¼•ç”¨ ä¸Šé¢çš„æ–¹æ³•æ•ˆç‡è¦æ¯”ä¸‹é¢çš„æ–¹æ³•æ•ˆç‡æ›´é«˜ï¼š\n// method 1 new(Struct) Struct{} // method 2 \u0026amp;BigStruct{} range éå† å¸¸è§çš„ range æ–¹å¼é€šå¸¸æ˜¯å¦‚ä¸‹çš„æ–¹å¼ï¼š\nfor k,v := range slices {log.Println(v) } æˆ–è€…æ˜¯çœç•¥ kï¼Œä½¿ç”¨ v å°±å¯ä»¥éå†æ•´ä¸ª slicesã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šä¸‹é¢è¿™ä¸ªæ–¹æ³•ä¼šæ›´å¿«ï¼ŒåŸå› æ˜¯è¿™é‡Œé¢èŠ‚çœäº† v çš„æ‹·è´ï¼Œé€Ÿåº¦è¦æ¯”æ‹·è´æ›´å¿«ï¼š\nfor k,_ := range slices {log.Println(slices[k]) } æ›´å¿«çš„è¿ç®— é™¤æ³•è¿ç®—æ›´æ…¢ï¼Œå°è¯•å˜æˆä¹˜æ³•å§ã€‚å—¯ï¼Œå°±æ˜¯è¿™æ ·ã€‚\næ›´å¿«çš„ç»“æ„ä½“ map æ–¹å¼çš„ç»“æ„ä½“ï¼Œå…¶ä»–çš„æ•°æ®æ–¹å¼ï¼Œæ€§èƒ½æ–¹å¼ç›¸å·®ä¸å¤§ã€‚æ•ˆç‡ä¸Šï¼Œç¡¬ç¼–ç  \u0026gt; æŒ‡é’ˆ slice çš„ range å¾ªç¯ \u0026gt; for å¾ªç¯ï¼Œéœ€è¦æ ¹æ®å…·ä½“ç¯å¢ƒé€‰æ‹©ï¼Œæ¯•ç«Ÿç›¸å·®ä¸å¤§ã€‚\nåå°„ä¼šå½±å“æ€§èƒ½ é™¤éå¿…è¦æƒ…å†µä¸‹ï¼Œå‡å°‘åå°„å¯ä»¥æå‡ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚\né¿å…å¤§é‡é‡å¤åˆ›å»ºå¯¹è±¡ ä¼šå¯¹ GC é€ æˆè´Ÿæ‹…ï¼Œç›®å‰ Golang çš„ GC ä¼šå¯¼è‡´ç¨‹åºæš‚åœã€‚è¿ç»­å°å†…å­˜åˆ†é…ä¼šå¯¼è‡´å¤§é‡çš„ cpu æ¶ˆè€—åœ¨ scanblock è¿™ä¸ªå‡½æ•°ä¸Šï¼›è¿ç»­ make([]T, size) æ¥åˆ†é… slice è¿˜ä¼šé¢å¤–å¯¼è‡´ cpu æ¶ˆè€—åœ¨ runtime.memclr å‡½æ•°ä¸Šã€‚\n","date":"2014-12-18T23:27:15Z","permalink":"https://www.4async.com/2014/12/2014-12-18-golang-optimizing/","title":"Golang é«˜æ•ˆç¼–å†™ï¼ˆæ•´ç†ï¼‰"},{"content":"è¿™ä¸ªå‘ç°æ˜¯ logger æˆ–è€… traceback æ˜¯æœ‰è¿™ä¸ªåŠŸèƒ½çš„ï¼Œæ‰€ä»¥ç®€å•çš„ç ”ç©¶äº†ä¸€ä¸‹ï¼Œå…¶å®å¾ˆç®€å•ï¼š\n#!/usr/bin/env python # -*- coding: utf-8 -*- import sys print sys._current_frames().values()[0].f_code.co_filename, print sys._current_frames().values()[0].f_lineno æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š\nprintno.py 7 ","date":"2014-10-22T12:21:15Z","permalink":"https://www.4async.com/2014/10/2014-10-22-python-get-current-line-and-filename/","title":"Python è·å–å½“å‰æ‰§è¡Œæ–‡ä»¶åå’Œè¡Œæ•°"},{"content":"è¿™ä¸ªæ˜¯åœ¨ OS X ä¸ŠæŠ˜è…¾ cubieboard çš„ç¬”è®°ã€‚é¦–å…ˆï¼Œæ— è®ºæ˜¯æ ‘è“æ´¾è¿˜æ˜¯ cubieboard ä¹‹ç±»çš„å¼€å‘æ¿ï¼Œéƒ½æ˜¯éœ€è¦è£…ä¸€ä¸ª usb2tty çš„é©±åŠ¨ï¼Œé€šè¿‡ console è¿æ¥åˆ°å¼€å‘æ¿ä¸Šã€‚\næ­¥éª¤å‚è€ƒï¼šhttp://pbxbook.com/other/mac-tty.htmlï¼Œç®€å•å¤è¿°ä¸€ä¸‹ï¼š\n é¦–å…ˆï¼Œéœ€è¦å®‰è£… tty2usb çš„é©±åŠ¨ï¼Œç‚¹å‡»ä¸‹é¢ä¸¤ä¸ªè¿æ¥ä¸‹è½½åï¼Œå®‰è£… pkg æ–‡ä»¶ã€‚  PL2303_MacOSX_v1_5_1.zip FTDI Driver   é‡å¯ä¹‹åï¼Œå°† usb è¿æ¥è‡³ Macï¼Œé€šè¿‡æ‰§è¡Œ ls /dev/cu.* æŸ¥çœ‹å·²ç»è¿æ¥çš„è®¾å¤‡ï¼Œé»˜è®¤ä¸€èˆ¬åç§°æ˜¯ / dev/cu.usbserial æ‰§è¡Œ screen /dev/cu.usbserial æ³¢ç‰¹ç‡  ç™»å½• consoleï¼Œæ³¢ç‰¹ç‡éœ€è¦æŸ¥ä¸€ä¸‹å®˜æ–¹æ‰‹å†Œçœ‹ä¸‹å…·ä½“å¤šå°‘ï¼Œä¸€èˆ¬æ˜¯ 9600 æˆ–è€… 115400 çš„å¤šä¸€äº›ã€‚ å¦‚æœ screen è¿›å»å‘ç°æ²¡ååº”ï¼ŒæŒ‰æŒ‰å›è½¦çœ‹çœ‹ã€‚ å¦‚æœæƒ³ç»“æŸæ­¤æ¬¡ä¼šè¯ï¼ŒæŒ‰ ctrl-a ç„¶å ctril-\\ ç»“æŸä¼šè¯ã€‚  cubieboard æ‹¿åˆ°æ˜¯ Android ç³»ç»Ÿï¼Œå»ºè®®ç›´æ¥æ¢æˆå®˜æ–¹æ”¯æŒçš„ Lubuntu ç³»ç»Ÿå§ï¼Œæ¯•ç«Ÿæ–¹ä¾¿ä¸€äº›ã€‚\næ›´æ¢æ­¥éª¤è¿™é‡Œä¸å¤šè¯´äº†ï¼Œä¸»è¦æ˜¯ä¸‹è½½é•œåƒï¼Œå®˜æ–¹æä¾›å·¥å…·ï¼Œç›´æ¥åˆ·è¿›å»å°±å¥½äº†ã€‚\n","date":"2014-09-10T14:49:15Z","permalink":"https://www.4async.com/2014/09/2014-09-10-trying-cubieboard-on-mac-os-x/","title":"æŠ˜è…¾æ—¥è®° ---cubieboard(Mac OS X ç¯‡)"},{"content":"ä»Šå¤©æœ‰ä¸ªé¡¹ç›®å‡ºäº†ç‚¹é—®é¢˜ï¼Œå…³äºåŸºäº MobileSubstrateï¼ˆç°åœ¨å« Cydia Substrate äº†ï¼‰çš„ tweak çš„é—®é¢˜ã€‚\nå…¶å®æœ¬æ¥é—®é¢˜ä¸å¤§çš„ï¼Œä¸»è¦æœ‰å‡ ä¸ªæŠ€å·§å¯ä»¥è®°å½•ä¸€ä¸‹ã€‚\n Hook çš„æ—¥å¿—æ‰“å°  è¿™ä¸ªç®—æ˜¯ä¸ªå°æŠ€å·§å§ï¼Œæ¥è‡ªäºåŠä»™ï¼Œæ˜¯ä¸€ä¸ª MS çš„è°ƒè¯•æ¨¡å¼ã€‚\nextern bool MSDebug MSDebug = true è¿™ä¸ªæ¨¡å¼ä½œç”¨æ˜¯ä¸“é—¨ç”¨æ¥æŸ¥çœ‹ä¸€äº›ç»†èŠ‚çš„ï¼Œæ¯”å¦‚ MSHookFunction å‡½æ•°ï¼Œä¼šæ‰“å°è¢« hook çš„å‡½æ•°çš„å‰ 16 å­—èŠ‚å’Œè¢« hook ä¹‹åçš„ 10 å­—èŠ‚ï¼Œå¯ä»¥è¾…åŠ©åˆ¤æ–­è¿™ä¸ª hook çš„ hook ç»†èŠ‚ã€‚\n MSHookFunction å‡½æ•° old ä¸º nil  è¿™ä¸ªåŸå› å¾ˆç®€å•ï¼Œå‡½æ•°å®šä¹‰å®šä¹‰ä¸å¯¹\u0026hellip;..= =|||\n","date":"2014-08-13T22:00:15Z","permalink":"https://www.4async.com/2014/08/2014-08-13-diagnostics-ios-tweak-based-on-mobile-substrate/","title":"CydiaSubstrate æ•…éšœè¯Šæ–­"},{"content":"ollvm çš„é¡¹ç›®æˆ‘å†è¿™é‡Œå°±ä¸åšä»‹ç»äº†ã€‚æ•´åˆè¿›å…¥é¡¹ç›®çš„ä¸è¿‡ä¸¤ç§ï¼šä¸€ç§æ˜¯ Theosï¼Œå¦å¤–ä¸€ç§æ˜¯ Xcodeã€‚\nä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯ ollvm ä¸»è¦æœ‰æ•ˆçš„è¿˜æ˜¯ c çš„å‡½æ•°ï¼Œå¯¹ OC å¯¹æŠ—æ•ˆæœä¸æ˜æ˜¾ã€‚å¯¹æŠ—åˆ†æçš„é—®é¢˜ï¼Œè¯·å‚è€ƒåŠä»™çš„ã€Šè½¯ä»¶ååˆ†æã€‹ã€‚\nTheos æ•´åˆ Theos ä¸»è¦ä¾èµ–äº Makefileï¼Œå› æ­¤éœ€è¦ Makefile æ–‡ä»¶æ¥å®ç°åŠŸèƒ½äº†ã€‚é¦–å…ˆåœ¨æ–‡ä»¶é‡Œæ·»åŠ ï¼š\nTARGET_CC = path_to_clang/clang TARGET_CXX = path_to_clang/clang++ TARGET_LD = path_to_clang/clang++ ç„¶åä¿®æ”¹ (é¡¹ç›®å)_CFLAGS å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ ï¼š\nxxx_CFLAGS = -fobjc-arc -mllvm -fla è¿™æ ·å°±å¯ä»¥åœ¨é¡¹ç›®ä¸­åº”ç”¨ ollvm äº†ã€‚\nXcode æ•´åˆ é›†æˆè¿›å…¥ Xcode éœ€è¦ä¿®æ”¹å‡ ä¸ªæ–‡ä»¶ï¼Œæ ¹æ®ç°æœ‰çš„æ’ä»¶è¿›è¡Œä¿®æ”¹ã€‚\nå…·ä½“ä¿®æ”¹æ­¥éª¤å¦‚ä¸‹ï¼š\n$ cd /Applications/Xcode.app/Contents/PlugIns/Xcode3Core.ideplugin/Contents/SharedSupport/Developer/Library/Xcode/Plug-ins/ $ sudo cp -r Clang\\ LLVM\\ 1.0.xcplugin/ Obfuscator.xcplugin $ cd Obfuscator.xcplugin/Contents/ $ sudo plutil -convert xml1 Info.plist $ sudo vim Info.plist ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼ˆä¿®æ”¹å‰ -\u0026gt; ä¿®æ”¹åï¼‰\n\u0026lt;string\u0026gt;com.apple.compilers.clang\u0026lt;/string\u0026gt; -\u0026gt; \u0026lt;string\u0026gt;com.apple.compilers.obfuscator\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;Clang LLVM 1.0 Compiler Xcode Plug-in\u0026lt;/string\u0026gt; -\u0026gt; \u0026lt;string\u0026gt;Obfuscator Xcode Plug-in\u0026lt;/string\u0026gt; æ¥ä¸‹æ¥ä¿®æ”¹ Info.plist\n$ sudo plutil -convert binary1 Info.plist $ cd Resources/ $ sudo mv Clang\\ LLVM\\ 1.0.xcspec Obfuscator.xcspec $ sudo vim Obfuscator.xcspec ä¿®æ”¹ä¸ºï¼š\nIdentifier = \u0026quot;com.apple.compilers.llvm.clang.1_0\u0026quot;; -\u0026gt; Identifier = \u0026quot;com.apple.compilers.llvm.obfuscator.3_4\u0026quot;; Name = \u0026quot;Apple LLVM 5.1\u0026quot;; -\u0026gt; Name = \u0026quot;Obfuscator 3.4\u0026quot;; Description = \u0026quot;Apple LLVM 5.1 compiler\u0026quot;; -\u0026gt; Description = \u0026quot;Obfuscator 3.4\u0026quot;; Vendor = Apple; -\u0026gt; Vendor = HEIG-VD; Version = \u0026quot;5.0\u0026quot;; -\u0026gt; Version = \u0026quot;3.4\u0026quot;; ExecPath = \u0026quot;clang\u0026quot;; -\u0026gt; ExecPath = \u0026quot;/path/to/obfuscator_bin/clang\u0026quot;; æ¥ä¸‹æ¥ä¿®æ”¹æ˜¾ç¤ºï¼š\n$ cd English.lproj/ $ sudo mv Apple\\ LLVM\\ 5.1.strings \u0026quot;Obfuscator 3.4.strings\u0026quot; $ sudo vim Obfuscator\\ 3.4.strings ä¿®æ”¹ä¸ºï¼š\n\u0026quot;Name\u0026quot; = \u0026quot;Apple LLVM 5.0\u0026quot;; -\u0026gt; \u0026quot;Name\u0026quot; = \u0026quot;Obfuscator 3.4\u0026quot;; \u0026quot;Description\u0026quot; = \u0026quot;Apple LLVM 5.0 Compiler\u0026quot;; -\u0026gt; \u0026quot;Description\u0026quot; = \u0026quot;Obfuscator 3.4\u0026quot;; \u0026quot;Version\u0026quot; = \u0026quot;5.0\u0026quot;; -\u0026gt; \u0026quot;Version\u0026quot; = \u0026quot;3.4\u0026quot;; \u0026quot;Vendor\u0026quot; = \u0026quot;Apple\u0026quot;; -\u0026gt; \u0026quot;Vendor\u0026quot; = \u0026quot;HEIG-VD\u0026quot;; é‡å¯ä¸€ä¸‹ä½ çš„ Xcodeï¼Œç„¶åå† Build Options é‡Œé¢ï¼Œå¯ä»¥è®¾ç½® Compiler for C/C++/Objective-C ä¸º Obfuscator 3.4ã€‚\nå¦‚æœæƒ³è¦æ·»åŠ  cflagï¼Œå¯ä»¥åœ¨ CustomFlags ä¸­è‡ªè¡Œæ·»åŠ ã€‚\nç›®å‰çš„é—®é¢˜ å¦‚æœä½ ç”¨èµ·æ¥ï¼Œç°åœ¨ ARM64 è§£å†³è¿˜æœ‰é—®é¢˜ï¼Œæˆ‘æ­£åœ¨ç ”ç©¶ï¼Œå¦‚æœä½ çŸ¥é“å¦‚ä½•è§£å†³ï¼Œæ¬¢è¿æŒ‡å‡ºã€‚\nâœ xxx make Making all for tweak xxx... Preprocessing xxx.x... Compiling xxx.x... clang-3.4: error: invalid arch name '-arch arm64' make[2]: *** [xxx.x.585e736e.o] Error 1 make[1]: *** [internal-library-all_] Error 2 make: *** [xxx.all.tweak.variables] Error 2 ","date":"2014-08-01T15:52:15Z","permalink":"https://www.4async.com/2014/08/2014-08-01-migrate-ollvm-into-ios-project/","title":"æ•´åˆ ollvm è¿›å…¥é¡¹ç›®"},{"content":"Docker æ˜¯ä¸€ä¸ªæœ€è¿‘éå¸¸é£è¡Œçš„è½»é‡çº§åº”ç”¨å®¹å™¨ã€‚å¦‚æœä¸çŸ¥é“çš„åŒå­¦è‡ªè¡Œæœç´¢å»å§ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿°äº†ã€‚é’ˆå¯¹äº Dockerï¼Œæœ‰ä¸ªåˆåˆ›å…¬å¸æ¨å‡ºäº†é€‚ç”¨äº Docker ä¸“ç”¨çš„ Linuxï¼šCoreOSã€‚ä¸€ä¸ªå·ç§°ç³»ç»Ÿè¿è¡Œå†…å­˜åªå ç”¨ 161MB çš„ç²¾ç®€ç³»ç»Ÿã€‚è¿™ä¸ª CoreOS åªæä¾›äº† Docker éœ€è¦çš„å¿…é¡»ç¯å¢ƒå’Œç®¡ç†åŠŸèƒ½ï¼Œå› æ­¤å¾ˆè½»é‡çº§ï¼Œéå¸¸é€‚åˆæ‰¹é‡éƒ¨ç½²å’Œæˆ‘ä»¬è¿™ç§ç”¨æ¥ç ”ç©¶å­¦ä¹ ç›®çš„çš„ã€‚\nå€¼å¾—ä¸€æçš„æ˜¯é‡Œé¢çš„ç®¡ç†å·¥å…·ä¹Ÿæ˜¯ç”± Golang å¼€å‘çš„ï¼Œæä¾› json api æ¥å£ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹æºä»£ç ã€‚\nå®‰è£…å¿…é¡»è½¯ä»¶ å¿…é¡»è½¯ä»¶éœ€è¦ Vargrant å’Œ VirtualBoxã€‚Vargrant å¯ä»¥å½“ä½œæ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºå’Œé•œåƒç®¡ç†å™¨ï¼ŒVirtualBox æˆ‘å°±ä¸ç”¨è¯´äº†å§ã€‚å®‰è£…ä¸‹è½½å°±ä¸è¯´ç«‹åˆ»ï¼Œä¸‹è½½å®‰è£…åœ°å€è§ä¸‹ï¼š\nhttp://www.vagrantup.com/downloads.html https://www.virtualbox.org/wiki/Downloads CoreOS é…ç½® CoreOS çš„ Vargrant è„šæœ¬å¯ä»¥åœ¨ https://github.com/coreos/coreos-vagrant/ æ‰¾åˆ°ï¼Œä¸‹è½½ä¸‹æ¥çš„æ–¹æ³•å¾ˆç®€å•ï¼š\ngit clone https://github.com/coreos/coreos-vagrant/ cd coreos-vagrant ç„¶åæ‰§è¡Œå‘½ä»¤ç›´æ¥å¼€å¯è™šæ‹Ÿæœºäº†ï¼š\nvagrant up å¦‚æœç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œä¼šä¸‹è½½ CoreOS çš„é•œåƒï¼Œç«™ç‚¹åœ¨å›½å¤–ï¼Œéš¾å…ä¼šæ…¢ä¸€ç‚¹ï¼Œä¸è¿‡ä¹Ÿæ²¡å•¥å…³ç³»ï¼Œç¨å¾®ç­‰ä¸€ä¸‹å§ï¼Œå¦‚æœå‡ºç°é—®é¢˜äº†ï¼Œå°±é‡æ–°æ‰§è¡Œä¸€ä¸‹ã€‚\nå¦‚æœå‡ºç°ä¸‹é¢é”™è¯¯ï¼š\nYou specified a box version constraint with a direct box file path. Box version constraints only work with boxes from Vagrant Cloud or a custom box host. Please remove the version constraint and try again. æ³¨é‡Šæ‰ Vagrantfile æ–‡ä»¶ä¸­çš„ config.vm.box_version è¿™è¡Œã€‚\næ‰§è¡Œå®Œæˆä¸Šé¢çš„æŒ‡ä»¤ä¹‹åï¼ŒCoreOS å°±è¿è¡Œäº†ï¼ŒåŒæ—¶ä½ ä¹Ÿæ³¨æ„åˆ°æœ‰ä¸€äº›å…³äº ssh çš„ä¿¡æ¯ã€‚è¿™ä¸ªæ—¶å€™æ€ä¹ˆç™»é™†åˆ° CoreOS å‘¢ï¼Ÿ\nvagrant ssh ç„¶åå°±ç™»å½•åˆ°äº† CoreOS ç³»ç»Ÿäº†ã€‚\nå¦‚æœä½ æœ‰ä»£ç†æƒ³è¦ä¸‹è½½åŠ é€Ÿï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ (Windows)ï¼š\nset all_proxy=socks5://127.0.0.1:1080 Docker è¯•ç”¨ å…ˆæ¥ä¸€ä¸ªç®€å•çš„ hello worldï¼š\ndocker run ubuntu /bin/echo hello world å—¯ï¼Œæ®è¯´å›½å†…ä»¥åä¼šæœ‰æºï¼Œä¸è¿‡ç°åœ¨è¿˜æ²¡æœ‰ï¼Œæ‰€ä»¥é•œåƒåˆå¾—ä»å›½å¤–ä¸‹è½½ï¼Œåˆæ˜¯ä¸€ä¸ªæ¼«é•¿çš„ç­‰å¾…\u0026hellip;. ç»è¿‡ä¸€å¤©ä¸€å¤œçš„ä¸‹è½½ï¼Œæˆ‘çš„ repo ç»ˆäºä¸‹è½½æˆåŠŸäº†\u0026hellip;.\ncore@core-01 / $ docker run ubuntu /bin/echo hello world hello world è¿™æ ·å°±è¡¨ç¤ºä¸€ä¸ª docker æ¨¡ç‰ˆå®‰è£…æˆåŠŸäº†ã€‚ä¸è¿‡è¿™è¿˜æ—©ï¼Œæ€ä¹ˆåˆ©ç”¨ docker éƒ¨ç½² python åº”ç”¨å‘¢ï¼Ÿ\né¦–å…ˆæ˜¯åˆ›å»ºä¸€ä¸ª Docker å®¹å™¨ï¼š\nsudo docker run -i -t -p 80:80 ubuntu /bin/bash æ‰§è¡Œå®Œæˆä¹‹åï¼Œä½ ä¸ä»…ä¼šåˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶ä¸”ä¼šç™»å½•åˆ°è¿™ä¸ªå®¹å™¨å†…äº†ã€‚è¿™æ ·å°±å¯ä»¥å½“ä½œä¸€ä¸ªç®€å•çš„ç³»ç»Ÿæ¥åº”ç”¨äº†ã€‚é€€å‡ºå®¹å™¨çš„æ–¹æ³•æ˜¯æŒ‰å¿«æ·é”® CTRL+P å’Œ CTRL+Qã€‚åˆ—ä¸¾è¿è¡Œçš„ docker å¯ä»¥ä½¿ç”¨ sudo docker ps å‘½ä»¤ï¼Œç„¶å docker attach [id] æ–¹å¼è¿›å…¥å®¹å™¨ã€‚\næ ¹æ®ä¹‹å‰æåˆ°çš„å†…å®¹ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ‰§è¡Œ coreos é‡Œé¢æ²¡æœ‰çš„å‘½ä»¤äº†ï¼Œæ¯”å¦‚è¯´ apt-get:\napt-get update apt-get upgrade æ¥ä¸‹æ¥æ˜¯å®‰è£…å¿…é¡»çš„å·¥å…·äº†ï¼š\napt-get install -y tar git curl nano wget dialog net-tools vim build-essential zlib1g-dev apt-get install -y python python-dev python-setuptools python-pip libxml2-dev libxslt-dev libffi-dev æ¥ä¸‹æ¥å®‰è£…ä¸€äº› python ä¾èµ–åº“ï¼š\npip install cython gevent flask falcon sqlalchemy lxml cffi somplejson pip install --allow-external mysql-connector-python mysql-connector-python ä¸‹é¢å°±æ˜¯å¼€å‘ä¸€äº›çš„ä¸œè¥¿å•¦ï¼Œæ¯ä¸ªäººéƒ½ä¸åŒï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚docker è‡ªåŠ¨åŒ–éƒ¨ç½²ä¹‹ç±»çš„ä¸œè¥¿å°±æ”¾åœ¨ä¸‹ä¸ªæ—¥å¿—æ¥è®²å¥½äº†ã€‚\n","date":"2014-06-10T11:52:15Z","permalink":"https://www.4async.com/2014/06/2014-06-01-try-docker-with-coreos/","title":"åˆè¯† Docker"},{"content":"å¥½å§ï¼Œè¿™ä¸ªé—®é¢˜ç¡®å®æ¯”è¾ƒè›‹ç–¼çš„ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿæ˜¯æœ€è¿‘ç»å¸¸é‡åˆ°çš„é—®é¢˜ã€‚å…·ä½“çš„åŸå› æ˜¯è¿™æ ·çš„ï¼Œæœ€è¿‘ä½¿ç”¨äº†ä¸€ä¸ªå¼€æºçš„åº“å®ç°åŠŸèƒ½ï¼Œå®ç°æ–¹æ³•æ˜¯ä½¿ç”¨çš„å›è°ƒæ–¹å¼ã€‚è¿™æ ·å°±å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå›è°ƒè¿‡æ¥çš„å¯¹è±¡æ˜¯ä»€ä¹ˆæ ¼å¼çš„æˆ‘å¹¶ä¸çŸ¥é“å…·ä½“ç»†èŠ‚ã€‚æœ‰äººè¯´ï¼Œçœ‹çœ‹æ–‡æ¡£ä¸å°±è¡Œäº†ä¹ˆï¼Œé—®é¢˜æ˜¯è¿™ä¸ªé¡¹ç›®ä»–å°±æ²¡ä¸ªè¯¦ç»†æ–‡æ¡£ã€‚å…¶å®è¯»ä»£ç ä¹Ÿæ˜¯å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªæ—¶é—´çš„å·¥ä½œï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“ä¼šæŠŠè‡ªå·±ä¹Ÿç»•è¿›å»ã€‚é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿåˆ«æ€¥ï¼Œå¾€ä¸‹çœ‹ã€‚\n ç›´æ¥ dir è¾“å‡ºå±æ€§   è¿™ä¸ªå¾ˆç®€å•äº†ï¼Œç›´æ¥ print dir(å¯¹è±¡å) å°±å¯ä»¥æ‰“å°å¯¹è±¡çš„å±æ€§åç§°äº†ã€‚ä¸è¿‡è¿™ä¸ªå¾—æ¥å›æµ‹è¯•ä¸€ä¸‹ï¼Œä¸èƒ½ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰çš„æƒ³è¦çš„éƒ½èƒ½å¾—åˆ°ã€‚\nåˆ©ç”¨ pdb å¿«é€Ÿå®šä½   pdb æ˜¯å®˜æ–¹åº“ä¸­çš„ Python Debuggerï¼Œä½¿ç”¨æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼šåœ¨ Python ä»£ç ä¸­ import pdb åº“ï¼Œç„¶ååœ¨æŒ‡å®šçš„ä½ç½®æ·»åŠ ä¸€å¥ï¼špdb.set_trace()ã€‚ä»¥æˆ‘çš„ä»£ç ä¸ºä¾‹ï¼Œæˆ‘éœ€è¦äº†è§£ msg çš„ç»“æ„ï¼š\nclass StickyMaster(controller.Master): ...... def handle_request(self, msg): pdb.set_trace() ...... ç„¶åæ­£å¸¸æ‰§è¡Œè¿™ä¸ªç¨‹åºï¼Œåœ¨æ‰§è¡Œåˆ°è¿™å¥æ—¶ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š\nâœ— python pdbtest.py ...... \u0026gt; pdbtest.py(63)handle_request() -\u0026gt; if allow_check(msg) is False: (Pdb) æ˜¯ä¸æ˜¯çœ‹èµ·æ¥å¾ˆåƒ gdb ä¸€ç±»çš„å·¥å…·ï¼Ÿè¿™ä¸ªæ—¶å€™è¾“å…¥å‘½ä»¤æŸ¥çœ‹å¯¹è±¡äº†ï¼Œè¾“å…¥ h å¯ä»¥æŸ¥çœ‹å¸®åŠ©ï¼š\n(Pdb) h Documented commands (type help \u0026lt;topic\u0026gt;): ======================================== EOF bt cont enable jump pp run unt a c continue exit l q s until alias cl d h list quit step up args clear debug help n r tbreak w b commands disable ignore next restart u whatis break condition down j p return unalias where Miscellaneous help topics: ========================== exec pdb Undocumented commands: ====================== retval rv æ¥ä¸‹æ¥æŸ¥çœ‹ä¸‹å½“å‰å˜é‡ï¼š\n(Pdb) a self = \u0026lt;__main__.StickyMaster instance at 0x107884128\u0026gt; msg = \u0026lt;libmproxy.flow.Request instance at 0x1080d5680\u0026gt; ç„¶åç›´æ¥ dir ä¸€ä¸‹è¿™ä¸ªå˜é‡çš„å±æ€§åç§°ï¼Œè¿™ä¸ªæ—¶å€™çš„å¥½å¤„æ˜¯æ–¹ä¾¿è¿›è¡ŒæŸ¥çœ‹å±æ€§å€¼ï¼š\n(Pdb) dir(msg) ['__doc__', '__eq__', '__hash__', '__init__', '__module__', '_assemble', '_assemble_head', '_from_state', '_get_state', '_load_state', '_set_replay', 'anticache', 'anticomp', 'client_conn', 'close', 'constrain_encoding', 'content', 'copy', 'decode', 'encode', 'get_content_type', 'get_cookies', 'get_decoded_content', 'get_form_urlencoded', 'get_header_size', 'get_path_components', 'get_query', 'get_transmitted_size', 'get_url', 'headers', 'host', 'httpversion', 'ip', 'is_live', 'is_replay', 'method', 'path', 'port', 'replace', 'reply', 'rfile', 'scheme', 'set_form_urlencoded', 'set_live', 'set_path_components', 'set_query', 'set_url', 'size', 'ssl_setup_timestamp', 'stickyauth', 'stickycookie', 'tcp_setup_timestamp', 'timestamp_end', 'timestamp_start', 'wfile'] (Pdb) msg.path '/' å€ŸåŠ©å·¥å…·ç›´æ¥ç¡®å®š   è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ WingIDEï¼Œå¾ˆç®€å•æ–¹ä¾¿ã€‚é¦–å…ˆä¸‹ä¸ªæ–­ç‚¹ï¼Œç„¶åè¿è¡Œä¸‹ç¨‹åºï¼Œç»“æœå¦‚ä¸‹å›¾ï¼š\nå°±æ˜¯è¿™ä¹ˆç®€å•ï¼\n","date":"2014-05-30T00:10:15Z","permalink":"https://www.4async.com/2014/05/2014-05-30-quick-identify-python-object-struct/","title":"å¿«é€Ÿç¡®è®¤ Python å¯¹è±¡ç»“æ„"},{"content":"å› ä¸ºç³»ç»Ÿä¸æ–¹ä¾¿ä½¿ç”¨åŒ…å‡çº§ï¼Œå› æ­¤ä½¿ç”¨çš„æºç æ–¹å¼å®‰è£…ï¼Œå‘åŸºæœ¬ä¸Šéƒ½è¸©è¿‡äº†ï¼Œåšä¸€ä¸‹è®°å½•å§ã€‚\nzbar çš„å®‰è£…ä¾èµ–äº ImageMagickï¼ŒImageMagick åˆ™ä¾èµ–äº jpeg æä¾› jpeg å›¾ç‰‡æ”¯æŒï¼Œå› æ­¤å®‰è£…é¡ºåºä¸ºååºå®‰è£…ã€‚\nå®‰è£… jpeg åº“ è¿™ä¸ªå®‰è£…æ¯”è¾ƒç®€å•ï¼Œæ²¡ä»€ä¹ˆå‘æ¥çš„ã€‚å…ˆåˆ° http://www.imagemagick.org/download/delegates/ ä¸‹è½½ jpeg çš„åº“ï¼Œæ¯”å¦‚æˆ‘ç”¨çš„æ˜¯ jpegsrc.v9a.tar.gzï¼Œæ‰§è¡Œä¸‹åˆ—æ‰§è¡Œè¿›è¡Œå®‰è£…ï¼š\n/.configure make \u0026amp;\u0026amp; make install  å®‰è£… ImageMagick è¿™ä¸ªå®‰è£…ç¨å¾®éº»çƒ¦ä¸€ç‚¹ï¼Œè¿˜æ˜¯å·®ä¸å¤šå¼€å§‹çš„ï¼š\n./configure make \u0026amp;\u0026amp; make install  ä¸‹é¢æ˜¯éœ€è¦é…ç½®ä¸€äº›å‚æ•°ï¼Œå¦åˆ™ zbar å®‰è£…ä¼šä¸æˆåŠŸï¼š\nexport MAGICK_CFLAGS=\u0026quot;/usr/local/include/ImageMagick-6/\u0026quot; export MAGICK_LIBS=\u0026quot;/usr/local/lib/libMagickWand-6.Q16.so\u0026quot;  å®‰è£… zbar æ¥ä¸‹æ¥ç¼–è¯‘ zbar äº†ï¼Œè¿™ä¸ªä¹‹å‰é…ç½®å¥½äº†ä¼šæ–¹ä¾¿ä¸€ç‚¹ï¼ŒåŒæ—¶ç¦ç”¨ä¸€äº›ä¸ç”¨çš„åŠŸèƒ½ï¼š\n./configure --enable-shared --without-gtk --without-qt --without-python CPPFLAGS=-I/usr/local/include/ImageMagick-6 make \u0026amp;\u0026amp; make install  æ¥ä¸‹æ¥æ·»åŠ  ldconfig æ–‡ä»¶è®© libzbar.so ç”Ÿæ•ˆã€‚\nldconfig  æµ‹è¯•å®‰è£… æµ‹è¯•ä¸€ä¸‹ zbar æ˜¯å¦å®‰è£…æˆåŠŸï¼š\nwget http://i1.hexunimg.cn/2012-03-13/139256375.jpg /usr/local/bin/zbarimg 139256375.jpg QR-Code:http://www.baidu.com QR-Code:http://apk.hiapk.com/m/downloads?id=com.qq.reader\u0026amp;vcode=11 QR-Code:http://apk.hiapk.com/m/downloads?id=cn.ibuka.manga.ui\u0026amp;vcode=16843778 QR-Code:http://apk.hiapk.com/m/downloads?id=com.kugou.android\u0026amp;vcode=4120 QR-Code:http://apk.hiapk.com/m/downloads?id=com.kandian.vodapp4pad7in\u0026amp;vcode=7 scanned 4 barcode symbols from 1 images in 0.05 seconds ","date":"2014-05-20T15:33:35Z","permalink":"https://www.4async.com/2014/05/2014-05-20-build-zbar-on-linux/","title":"Linux ç³»ç»Ÿä¸Šçš„ zbar ç¼–è¯‘å®‰è£…"},{"content":"å…ˆä»ä¸€ä¸ªä¾‹å­æ¥è¯´ï¼Œä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°åˆ—æ•°åˆ—ä¾‹å­è¯´èµ·ï¼š\n# fib.py #!/usr/bin/env python # -*- coding: utf-8 -*- def fib(i): a = 0 b = 1 while i \u0026gt; 0: i -= 1 a, b = b, a+b return True # try_c.py #!/usr/bin/env python # -*- coding: utf-8 -*- import time from fib import fib startTime = time.time() for i in xrange(1,10): fib(10**6) print time.time() - startTime åœ¨ CPython ä¸‹æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š\nâœ cython python try_c.py 429.003911972  æ¢æˆ pypy çš„è¯ï¼Œæ•ˆç‡ä¼šæ›´é«˜ä¸€äº›ï¼š\n(pypy)âœ cython pypy try_c.py 355.186796904  èƒ½ä¸èƒ½æœ‰æ›´å¿«çš„æ•ˆç‡å‘¢ï¼ŸPython çš„æ‰§è¡Œæ•ˆç‡ç¡®å®ä»¤äººè¯Ÿç—…ï¼Œå¦‚æœæœ‰ Python çš„ç¼–å†™é€Ÿåº¦ï¼ŒC çš„æ‰§è¡Œæ•ˆç‡æ›´å¥½äº†ï¼ˆä½ è¯´çš„æ˜¯ Golang å˜›ï¼Ÿï¼‰ã€‚è¿™å°±æ˜¯éœ€è¦ Cython å‡ºåœºäº†ã€‚\næ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥å®‰è£… Cython äº†ï¼š\npip install cython  ç„¶åç¼–å†™ä¸€ä¸ª setup.py æ–‡ä»¶ï¼š\n# setup.py #!/usr/bin/env python # -*- coding: utf-8 -*- from distutils.core import setup from Cython.Build import cythonize setup(name =\u0026#39;cython app\u0026#39;, ext_modules = cythonize(\u0026#34;fib.pyx\u0026#34;), ) å°† fib.py æ–‡ä»¶é‡å‘½åä¸º fib.pyx æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œä¸‹é¢å‘½ä»¤å°±å¯ä»¥äº†ï¼š\n(pypy)âœ cython pypy setup.py build_ext --inplace running build_ext building 'fib' extension cc -arch x86_64 -O2 -fPIC -Wimplicit -I/Developer/pypy/include -c fib.c -o build/temp.macosx-10.9-x86_64-2.7/fib.o fib.c:58:9: warning: 'Py_OptimizeFlag' macro redefined #define Py_OptimizeFlag 0 ^ /Developer/pypy/include/pypy_macros.h:613:9: note: previous definition is here #define Py_OptimizeFlag PyPy_OptimizeFlag ^ 1 warning generated. cc -shared -undefined dynamic_lookup -arch x86_64 build/temp.macosx-10.9-x86_64-2.7/fib.o -o /Desktop/cython/fib.pypy-23.so å…·ä½“æ‰§è¡Œçš„ä»£ç å¦‚ä¸‹ï¼š\ncython fib.pyx cc -arch x86_64 -O2 -fPIC -Wimplicit -I/Users/jetlee/Developer/pypy/include -c fib.c -o build/temp.macosx-10.9-x86_64-2.7/fib.o cc -shared -undefined dynamic_lookup -arch x86_64 build/temp.macosx-10.9-x86_64-2.7/fib.o -o /Users/jetlee/Desktop/cython/fib.pypy-23.so è¿™é‡Œæœ‰ä¸ªå¾ˆå¥‡æ€ªçš„åœ°æ–¹ï¼Œcython ç”Ÿæˆçš„æ˜¯ so æ–‡ä»¶ï¼Œæˆ‘çš„ç³»ç»Ÿæ˜¯ macï¼Œshared library æ˜¯. dylib æ–‡ä»¶ï¼Œä¸è¿‡ cython è¿™é‡Œåªè®¤è¯† so æ–‡ä»¶ï¼Œæ‰€ä»¥è‡ªå·±ä¸è¦è‡ªä»¥ä¸ºæ˜¯çš„æ”¹åäº†\u0026hellip;\n(pypy)âœ cython pypy try_c.py 208.884904146 å†æµ‹è¯•ä¸€ä¸‹ CPython çš„ç»“æœï¼š\n(pypy)âœ cython python try_c.py 215.461463928 ä¸Šé¢çš„ç»“æœä¸æ˜¯åŒæ ·æ¡ä»¶æµ‹è¯•çš„ï¼Œä¼šå¯¹ç»“æœæœ‰ä¸€å®šçš„å½±å“ã€‚å…·ä½“æƒ…å†µä¸‹çš„ç»“æœè¿˜è¯·è‡ªè¡Œæµ‹è¯•ã€‚\né™¤äº†åˆ©ç”¨ Cython å¤–ï¼Œè¿˜æœ‰å…¶ä»–å‡ ç§æ–¹æ³•ç”¨æ¥åŠ é€Ÿï¼Œè¿™ä¸ªå¯ä»¥è‡ªè¡Œæœç´¢ä¸€ä¸‹ï¼Œæ¯”å¦‚ cffiï¼Œå…·ä½“ä¸åœ¨è¿™é‡Œèµ˜è¿°ã€‚æˆ‘ä¸ªäººæ¯”è¾ƒå€¾å‘äº Cython çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥å®ç°æ— éœ€ä¿®æ”¹ä»£ç çš„åŠ é€Ÿï¼ˆå¦‚ä¸Šï¼‰ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥å®ç°æ›´é«˜æ•ˆçš„ä»£ç çº§åˆ«ç¼–è¯‘ï¼Œæ•ˆç‡æ›´é«˜ã€‚ä½†æ˜¯ç¼ºç‚¹æ˜¯ç»•ä¸å¼€ python çš„ GIL é—®é¢˜ï¼Œå…·ä½“çš„å¯ä»¥çœ‹ä¸€ä¸‹ è¿™ç¯‡æ–‡ç«  ä»‹ç» GIL é—®é¢˜ã€‚\n","date":"2014-05-17T17:41:14Z","permalink":"https://www.4async.com/2014/05/2014-05-17-speed-python-code-with-cython/","title":"åˆ©ç”¨ Cython åŠ é€Ÿ Python ä»£ç "},{"content":"channel æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¥å¥‡çš„ä¸œè¥¿ï¼Œä»¥å‰å¾ˆå°‘ç ”ç©¶ï¼Œä¸è¿‡æœ€è¿‘çš„é¡¹ç›®æœ‰è¿™æ–¹é¢çš„éœ€æ±‚å°±çœ‹äº†ä¸€ä¸‹ã€‚ä¸‹é¢ä¸»è¦ä» channel çš„åŠŸèƒ½è°ˆèµ·ã€‚\nchannel çš„è¯»å–å’Œå†™å…¥é—®é¢˜ channel çš„è¯»å–å†™å…¥å–å†³äºå½“å‰çš„ channel çš„çŠ¶æ€ï¼Œå¤§å®¶åº”è¯¥éƒ½çŸ¥é“ä¸‹é¢çš„æƒ…å†µæ˜¯ä¸€å®šä¼šäº§ç”Ÿæ­»é”ï¼š\nch := make(chan int) \u0026lt;-ch ä½†æ˜¯é’ˆå¯¹äº close æ‰çš„ channelï¼Œåˆ™æ˜¯ä¸€å®šå¯ä»¥è¯»å–æˆåŠŸçš„ï¼š\nch := make(chan int) close(ch) i:=\u0026lt;-ch\t//i=0 å¯¹äºè¿™ç§æƒ…å†µï¼Œgolang æ·»åŠ äº†ä¸€ä¸ªç»“æœç±»å‹åˆ¤æ–­ i, succ :=\u0026lt;-ch\t//i=0,succ=falseï¼Œè‹¥ç»“æœä¸º falseï¼Œè¯´æ˜è¯¥ channel å·²ç»å…³é—­äº†ã€‚ä½†æ˜¯ close è¿‡çš„ channel å†å†™å…¥ï¼Œæ˜¯ä¼š panic çš„ã€‚\næœ‰æ—¶å¯èƒ½è¿˜æœ‰ä¸€äº›æ—¶é—´ä¸Šçš„è¦æ±‚ï¼Œæ¯”å¦‚è¯´åˆ¤æ–­æ˜¯å¦è¶…æ—¶ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ç»“åˆä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„ select æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šcase \u0026lt;- time.After(time.Second*2): è¿™æ ·å°±å¯ä»¥è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜æˆ‘ä»¬ä¹‹å‰æœ‰æ¢è®¨è¿‡ï¼Œselect ä¼šåˆ¤æ–­ channel çš„çŠ¶æ€æ˜¯å¦ readyã€‚è¶…æ—¶æ—¶ï¼Œéœ€è¦å–å¾—æ•°æ®çš„ channel åº”è¯¥æ˜¯æœªå®Œæˆçš„ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥è¿›å…¥è¶…æ—¶ blockã€‚\nä½†æ˜¯å¯¹äºåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„å¦å¤–ä¸€ç§æƒ…å†µï¼Œè¿˜éœ€è¦åœ¨è§£å†³é—®é¢˜æ—¶æ ¹æ®å…·ä½“æƒ…å†µç¡®å®šå…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚\nåˆ©ç”¨ channel å®ç°å»å¼‚æ­¥åŒ– æ¯”å¦‚ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼š\npackage main import (\u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; ) // ç”Ÿäº§è€… func Producer(id int, item chan int) { for i:=0; i\u0026lt;10; i++ { item \u0026lt;- i fmt.Printf(\u0026#34;Producer %d produces data: %d\\n\u0026#34;, id, i) time.Sleep(10 * 1e6) } } // æ¶ˆè´¹è€… func Consumer(id int, item chan int) { for i:=0; i\u0026lt;20; i++ { c_item := \u0026lt;-item fmt.Printf(\u0026#34;Consumer %d get data: %d\\n\u0026#34;, id, c_item) time.Sleep(10 * 1e6) } } func main() {item := make(chan int, 6) go Producer(1, item) go Producer(2, item) go Consumer(1, item) time.Sleep(5 * time.Second) } åœ¨å†™æ³•ä¸Šï¼Œgolang é€šè¿‡ channel å®ç°äº†ä¸€ä¸ªå¿½ç•¥å¼‚æ­¥ç­‰å¾…çš„ä»£ç ï¼Œchannel å…¶å®ç›¸å½“äºä¸€ä¸ªé˜Ÿåˆ—ï¼Œå½“é˜Ÿåˆ—ä¸­ä¸ºç©ºæ—¶ï¼Œä¼šé˜»å¡åœ¨å–é˜Ÿåˆ—çš„æ“ä½œä¸Šï¼Œç›´åˆ°å¯ä»¥ä»ä¸­å–åˆ°å†…å®¹ã€‚è€Œåœ¨ä»£ç ä¸­ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å…±ç”¨äº†ä¸€ä¸ª channel itemï¼Œåœ¨ç”Ÿäº§åæ”¾å…¥ item ä¸­ï¼Œæ¶ˆè´¹è€…ä»ä¸­è¯»å–æ¶ˆè´¹ã€‚\næ‰§è¡Œç»“æœä¸ºï¼š\nProducer 1 produces data: 0 Producer 2 produces data: 0 Consumer 1 get data: 0 Producer 1 produces data: 1 Producer 2 produces data: 1 Consumer 1 get data: 0 Producer 1 produces data: 2 Consumer 1 get data: 1 Producer 2 produces data: 2 .... å†è°ˆ goroutines çš„æ§åˆ¶ æœ€åä¸€ä¸ªä¾‹å­ç”¨ golang è‡ªå·±æä¾›çš„ä¸€ä¸ª ä¾‹å­ æ¥æ¢è®¨ä¸‹ channel çš„ä½¿ç”¨ã€‚\nè¿™ä¸ªä¾‹å­ä¹Ÿåœ¨å®˜æ–¹åšå®¢ä¸­è¿›è¡Œäº†æ¢è®¨ï¼ˆå‚è€ƒé“¾æ¥ 1ï¼‰ï¼Œå…¶ä¸­ result çš„æ˜¯ç”¨æ¥ä¿å­˜ç»“æœçš„ç»“æ„ä½“ï¼ŒsumFiles å‡½æ•°çš„åŠŸèƒ½æ˜¯éå†ç›®å½•ï¼Œè®¡ç®—æ–‡ä»¶çš„ MD5 hash å€¼ï¼ŒMD5All åˆ™æ˜¯ sumFiles çš„ä¸Šå±‚è°ƒç”¨å‡½æ•°ï¼Œå¯¹å¤–æä¾›åŠŸèƒ½ï¼Œå¹¶ä¸”å°è£…ç»“æœ channel æ•°æ®æˆå­—å…¸ç±»å‹ã€‚\nsumFiles å‡½æ•°ä¼ å…¥å‚æ•°æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªæ˜¯ doneï¼Œè¿™ä¸ªæ˜¯ç”¨äºå®šä¹‰ç»“æŸï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ rootï¼ŒæŒ‡å®šéå†çš„è·¯å¾„ï¼›ä¼ å‡ºæ•°æ®ä¸ºä¸€ä¸ª channel å’Œ errorã€‚sumFiles ä¼šå°†æ¯ä¸ªæ–‡ä»¶æ”¾åˆ°ä¸€ä¸ª goroutine ä¸­è®¡ç®— hash å€¼ï¼Œå¹¶ä¸”å°†ç»“æœä¿å­˜åˆ° result channel ä¸­ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ£€æŸ¥æ˜¯å¦ç»ˆæ­¢éå†æ—¶ï¼Œä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥è¿›è¡Œäº†ä¸€ä¸ªæ£€æŸ¥ï¼š\nselect { case \u0026lt;-done: // HL  return errors.New(\u0026#34;walk canceled\u0026#34;) default: return nil } æ ¹æ® MD5All ä¸­çš„ defer close(done)ï¼Œå½“å‡½æ•° MD5All è¿”å›æ—¶ï¼Œä¼šå…³é—­ done è¿™ä¸ª channelï¼Œè¿™æ ·ä» done ä¸­å–å€¼å°±å¯ä»¥å§‹ç»ˆæˆåŠŸï¼Œselect åœ¨æ‰§è¡Œæ—¶å°±å¯ä»¥ä¸€ç›´æˆåŠŸï¼Œè¿™ä¹Ÿå¯¹æˆ‘ä¹‹å‰æƒ³æ³•ä¸­é€€å‡º channel å¡«å€¼æœ‰å¯èƒ½æ¯”å–å€¼å°‘å¯¼è‡´é˜»å¡çš„æƒ…å†µåšäº†ä¸€ä¸ªæ¯”è¾ƒå®Œç¾çš„è§£ç­”ã€‚\nå‚è€ƒé“¾æ¥ [1]. Go Concurrency Patterns: Pipelines and cancellation\n","date":"2014-04-29T15:57:46Z","permalink":"https://www.4async.com/2014/04/2014-04-29-more-about-golang-channel/","title":"æ›´å¤šå…³äº channel çš„æ‰¯æ·¡"},{"content":"æœ€è¿‘æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯åœ¨ä¸€ä¸ªå¸¸é©»å†…å­˜çš„ç¨‹åºä¸­ç»“æŸç›¸å…³ä»»åŠ¡ã€‚åœ¨ Go ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª goroutine éå¸¸ç®€å•ï¼Œåªéœ€è¦ go ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¦‚æœæˆ‘åˆ›å»ºäº†å¾ˆå¤š goroutineï¼Œæƒ³è¦ç»“æŸæ€ä¹ˆåŠï¼Ÿ\næ¯”å¦‚è¯´æˆ‘æœ‰ä¸€ä¸ªæ­»å¾ªç¯çš„ä¾‹å­\npackage main import (\u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;time\u0026#34; ) func main() {queue := make(chan int, 20) var wg sync.WaitGroup for { // å°±æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ \tqueue \u0026lt;- 1 \u0026lt;-queue for i := 0; i \u0026lt;10; i++ {wg.Add(1) go func(i int) {time.Sleep(5 * time.Second) fmt.Println(\u0026#34;Sleep\u0026#34;) wg.Done()}(i) } wg.Wait()} } å¦‚ä½•åœ¨ä¸€ä¸ª goroutine é‡Œé¢æ§åˆ¶æ‰€æœ‰çš„ goroutineï¼Œè®©æ‰€æœ‰çš„ goroutine ç»“æŸå‘¢ï¼Ÿè¿™å°±éœ€è¦ select å‡ºåœºäº†ã€‚æœ‰äººå‘Šè¯‰æˆ‘ï¼Œè¿™æ ·å­å®ç°ä¼šæ›´å¥½ä¸€äº›ï¼š\npackage main import (\u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;time\u0026#34; ) func main() { // å®šä¹‰ä¸€ä¸ªç”¨äºæŒ‡å®šé€€å‡ºçš„ channel \tEXIT := make(chan int, 1) queue := make(chan int, 20) var wg sync.WaitGroup // å¯åŠ¨æ–°çš„ goroutine \tgo func() {time.Sleep(10 * time.Second) // ä¼‘æ¯äº†ä¹‹åï¼Œè¯¥ç»“æŸäº† \tEXIT \u0026lt;- 1}() for { // è¿›å…¥æ­»å¾ªç¯ \tqueue \u0026lt;- 1 select { case \u0026lt;-EXIT: // æ”¶åˆ°äº†é€€å‡ºæ¶ˆæ¯ \tfmt.Println(\u0026#34;KILLED\u0026#34;) return case \u0026lt;-queue: for i := 0; i \u0026lt;10; i++ {wg.Add(1) go func(i int) {time.Sleep(5 * time.Second) fmt.Println(\u0026#34;Sleep\u0026#34;) wg.Done()}(i) } wg.Wait()} } } ä½†æ˜¯è¾“å‡ºå´æ˜¯æ¯”è¾ƒè®©äººå›°æƒ‘ï¼š\nF:\\\u0026gt;go run dada.go Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep Sleep KILLED çœ‹èµ·æ¥åœæ­¢çš„æ—¶é—´æœ‰ 15sï¼Œæ¯”é¢„æƒ³çš„ 10s æ—¶é—´è¦é•¿ä¸€äº›ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\nè¿™é‡Œ select çš„ä½œç”¨æ˜¯ï¼Œåœ¨é‡åˆ° channel case æ—¶ï¼Œå°è¯•æ‰€æœ‰çš„ channel æ˜¯å¦ä¸º readyï¼›è‹¥æœ‰ä¸€ä¸ªä¸º readyï¼Œåˆ™æ‰§è¡Œè¯¥ caseï¼Œå¤šä¸ª case æ—¶ä¼šéšæœºæ‰§è¡Œå…¶ä¸­ä¸€ä¸ª caseï¼›å¦‚æœæœ‰ defaultï¼Œåˆ™ä¼šåœ¨æ‰€æœ‰éƒ½ not ready æ—¶æ‰§è¡Œï¼›æ²¡æœ‰ default çš„è¯å°± wait ç­‰å¾… readyã€‚\nå…³äº select çš„éšæœºæ€§ï¼Œç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜æ›´æ–¹ä¾¿ä¸€äº›ï¼š\npackage main import (\u0026#34;time\u0026#34; \u0026#34;fmt\u0026#34; ) func main() { // å®šä¹‰ä¸€ä¸ªç”¨äºæŒ‡å®šé€€å‡ºçš„ channel \tc1 := make(chan int, 1) c2 := make(chan int, 1) for { c1 \u0026lt;- 1 c2 \u0026lt;- 1 select{ case \u0026lt;-c1: fmt.Println(\u0026#34;c1\u0026#34;) // é˜²æ­¢å‡ºç° panic \t\u0026lt;-c2 time.Sleep(1*time.Second) case \u0026lt;-c2: fmt.Println(\u0026#34;c2\u0026#34;) \u0026lt;-c1 time.Sleep(1*time.Second) } } } è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\ngo run dada.go c1 c1 c2 c1 c1 c2 c1 .... é‚£è¿™æ ·ä¸Šé¢è¿˜æ˜¯ä¼šå‡ºç°é‚£ç§æœ‰å¯èƒ½æ²¡é€€å‡ºçš„æƒ…å†µï¼Œè¿™æ ·æ€ä¹ˆåšå‘¢ï¼Ÿä¸‹é¢æˆ‘ä¸ªäººæ„Ÿè§‰ä¼šæ˜¯ä¸€ç§æ›´å¥½çš„åšæ³•ï¼š\npackage main import (\u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;time\u0026#34; ) func main() { // å®šä¹‰ä¸€ä¸ªç”¨äºæŒ‡å®šé€€å‡ºçš„ channel \tEXIT := make(chan int, 1) var wg sync.WaitGroup // å¯åŠ¨æ–°çš„ goroutine \tgo func() {time.Sleep(10 * time.Second) // ä¼‘æ¯äº†ä¹‹åï¼Œè¯¥ç»“æŸäº† \tEXIT \u0026lt;- 1}() for { select { case \u0026lt;-EXIT: // æ”¶åˆ°äº†é€€å‡ºæ¶ˆæ¯ \tfmt.Println(\u0026#34;KILLED\u0026#34;) return default: for i := 0; i \u0026lt;10; i++ {wg.Add(1) go func(i int) {time.Sleep(5 * time.Second) fmt.Println(\u0026#34;Sleep\u0026#34;) wg.Done()}(i) } wg.Wait()} } } è¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„äº‹æƒ…å°±æ˜¯ï¼Œå¯¹ select æ¥è¯´ï¼Œæ•´ä½“çš„è¿è¡Œç›¸å½“äºä¸€ä¸ªå¾ªç¯åˆ†æ”¯å¤„ç†çš„è¿‡ç¨‹ã€‚å¯¹ case æ¥è¯´ï¼Œè¿‡ç¨‹æ˜¯ä¸€ä¸ª block çš„è¿‡ç¨‹ï¼Œæ¯”å¦‚è¯´åœ¨æ‰§è¡Œ default è¿‡ç¨‹ä¸­ï¼Œå³ä½¿æ”¶åˆ°äº†æ¥è‡ª EXIT çš„ä¿¡æ¯ï¼Œä¹Ÿä¸ä¼šä¸­æ–­æ‰§è¡Œ default å»è·³è½¬æ‰§è¡Œ EXITï¼Œè€Œæ˜¯åœ¨ default å®Œæˆä¹‹åï¼Œè¿›å…¥æ¡ä»¶åˆ†æ”¯é€‰æ‹©ä½¿ä¼˜å…ˆè¿›å…¥ channel å·²ç» ready çš„ caseã€‚\n","date":"2014-04-28T20:57:20Z","permalink":"https://www.4async.com/2014/04/2014-04-28-control-goroutines-by-channel-select/","title":"channel å’Œ select æ§åˆ¶ goroutines"},{"content":"Github æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œæœ€æ—©æ¥è§¦ Gitï¼Œå°±æ˜¯å› ä¸º Github æ¥è§¦çš„ã€‚ä¸Šæ‰‹ç®€å•ï¼Œä¸°å¯Œçš„å¼€æºåº“ï¼Œäº’åŠ¨æ€§ç­‰ç­‰åŠŸèƒ½éƒ½è®© Github å……æ»¡é­…åŠ›ã€‚\nå½“ç„¶äº†ï¼Œä¸€äº›ç§å¯†çš„ä»£ç æ˜¯ä¸é€‚åˆæ”¾åœ¨ Github ä¸Šçš„ï¼ˆæ¯”å¦‚å·¥ä½œä»£ç ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¸æ–¹ä¾¿ä¸Šä¼ ä»£ç åˆ° Github äº†ã€‚å½“ç„¶äº†ï¼Œå¦‚æœ è´­ä¹° Github çš„ Micro Plan å°±å¯ä»¥åˆ›å»ºç§å¯†çš„ repo äº†ã€‚\nä¸èŠ±é’±æœ‰æ²¡æœ‰ä»€ä¹ˆå¥½æ–¹æ³•ï¼Ÿä»¥å‰æœ‰ä¸€ä¸ª Github åŠŸèƒ½å¤§è‡´ç›¸åŒçš„ç¤¾åŒºç‰ˆ Gitlabï¼ŒåŸºäº Ruby å¼€å‘ï¼Œå¯æ˜¯é…ç½®å®åœ¨æ˜¯å¤ªè¿‡äºå¤æ‚ï¼Œä¹Ÿä¸é€‚åˆä¸€ä¸ªäººå•ç‹¬æ‰“åŒ…ä½¿ç”¨ã€‚ä¸è¿‡åæ¥é‡åˆ°äº† gogsï¼Œè¿™ä¸ªé—®é¢˜å°±è§£å†³äº†ã€‚å…¶å®åˆšå¼€å§‹çŸ¥é“ gogs çš„æ—¶å€™ï¼Œè¿˜ä¸æ”¯æŒ SQLite3ï¼Œæœ€æ–°çš„ä¸€ä¸ªç‰ˆæœ¬å·²ç»æ”¯æŒäº†ï¼Œä¸è¿‡åªæœ‰ x64 ä½ç‰ˆæœ¬ï¼ŒåŸºäº golang æ„å»ºï¼Œå› æ­¤ä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¾èµ–éœ€è¦å®‰è£…ï¼Œåªéœ€è¦ç®€å•çš„ï¼šä¸‹è½½ã€è§£å‹ã€æ‰“å¼€ã€é…ç½®ï¼Œç„¶åä½ å°±å¯ä»¥ä½¿ç”¨ git æœåŠ¡äº†ã€‚\nä¸‹è½½åœ°å€ï¼šhttps://github.com/gogits/gogs/wiki/Install-from-binary\næ‰“å¼€å‹ç¼©åŒ…ï¼Œä»¥ Windows/SQLite3 ä¸ºä¾‹æ¼”ç¤ºå®‰è£…æ­¥éª¤ï¼š\n è§£å‹å‹ç¼©åŒ…ï¼ŒåŒå‡»æ‰§è¡Œ start.bat æ–‡ä»¶ï¼ˆLinux/Mac ä¸‹æ˜¯ start.shï¼‰ æ‰“å¼€æµè§ˆå™¨ï¼Œæµè§ˆ http://127.0.0.1:3000 æ‰“å¼€è‡ªåŠ¨è·³è½¬è‡³å®‰è£…ç•Œé¢ï¼Œå†…å®¹ä¸€å…±åªæœ‰ä¸‹å›¾è¿™ä¹ˆå¤šï¼å¾ˆç®€å•ï¼Œæˆ‘å°±ä¸è¯´å•¥äº†ã€‚å¦‚æœä½ æƒ³å¤šæœºåŒæ­¥ï¼Œå»ºè®®ä½ å°† SQLite æ•°æ®åº“å’Œ repo åœ°å€æ”¾åœ¨ç½‘ç›˜å†…ï¼Œæ¯”å¦‚æˆ‘å°±æ”¾åœ¨ Dropbox ä¸‹äº†ã€‚  ç‚¹å‡» Install Gogsï¼Œå®‰è£…å®Œæˆï½  æ¯”å¦‚æˆ‘ç°åœ¨æ˜¯è‡ªå·±åœ¨ç”¨ï¼Œå¯èƒ½éœ€è¦ä¸€äº›å•ç‹¬çš„é…ç½®ï¼š\n æ‰“å¼€ gogs çš„ç›®å½•ï¼Œcustom/conf/app.ini æ–‡ä»¶ï¼Œä½¿ç”¨ SublimeText ä¹‹ç±»çš„ç¼–è¾‘å™¨æ‰“å¼€ï¼Œä¸è¦ä½¿ç”¨è®°äº‹æœ¬ï¼Œè¿™æ˜¯ä¸ªæ•™è®­\u0026hellip; æŒ‰ç…§ä¸‹é¢ä¿®æ”¹ä¹‹åå°±åªå…è®¸æœ¬æœºè®¿é—®äº†ï¼ˆåæ­£åªæœ‰æˆ‘è‡ªå·±ç”¨ï¼‰ï¼Œæ³¨æ„ Mac å’Œ Linux ä¸‹å¼€ 80 éœ€è¦ rootï¼š  [server] PROTOCOL = http DOMAIN = localhost ROOT_URL = `http://localhost/` HTTP_ADDR = 127.0.0.1 HTTP_PORT = 80 é‡æ–°æ‰§è¡Œ start.batï¼Œçœ‹çœ‹è‡ªå·±çš„æˆæœå§ï¼é…åˆ SourceTreee ä¹‹ç±»çš„ç¨‹åºï¼Œæ•ˆæœæ›´ä½³ï¼šï¼‰çœ‹ä¸‹æˆ‘çš„ gogs å§ã€‚\nå¦‚æœæƒ³ä¿®æ”¹æ ·å¼æˆ–è€…ç¿»è¯‘ä¹‹ç±»çš„ï¼Œåœ¨ template ç›®å½•ä¸‹çš„ä¸º gogs çš„æ¨¡æ¿æ–‡ä»¶ï¼Œå¯ä»¥è¿›è¡Œä¿®æ”¹ï¼Œæˆ‘æƒ³è¦çš„å¯æ˜¯å’Œ Github åŒæ ·çš„æ•ˆæœï¼šï¼‰\n","date":"2014-04-22T20:09:46Z","permalink":"https://www.4async.com/2014/04/2014-04-22-build-your-private-git-serivce/","title":"åŸºäº Gogs å®ç°çš„ç§å¯† Git æœåŠ¡"},{"content":"æ­£å¥½ç¾¤é‡Œé¢æœ‰äººåœ¨è®¨è®ºè¿™ä¸ªï¼Œå°±å•ç‹¬æ‹¿å‡ºæ¥è®°å½•ä¸€ä¸‹ï¼Œä¸‹æ¬¡å°±ä¸ç”¨å•ç‹¬è·‘äº†ã€‚ç»“æœåªæ˜¯åŒ…å«å¸¸è§çš„ç®—æ³•æ€§èƒ½ã€‚\nè¯´åˆ°å¸¸ç”¨çš„ç®—æ³•ï¼Œä¹‹å‰ QQ çš„åè®®ä¸­æœ€æ—©ä½¿ç”¨çš„æ˜¯ xxTEA ç®—æ³• [^1]ï¼Œè¿ç®—æ•ˆç‡é«˜ï¼Œä½†æ˜¯åŒæ ·çš„ï¼Œè¢«ç ´è§£çš„å‡ ç‡éšç€ç³»ç»Ÿç¡¬ä»¶æ€§èƒ½çš„æå‡å’Œæ‰‹æ®µçš„è¿›åŒ–ç ´è§£éš¾åº¦å¤§å¹…é™ä½ï¼Œæ‰€ä»¥åæ¥æ›´æ¢æˆäº† blowfish çš„ç®—æ³• [^2]ï¼Œä»æ•ˆç‡ä¸Šæ¥è¯´å¯ä»¥æ¥å—ï¼Œå¹¶ä¸”å¼ºåº¦ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„èŒƒå›´ã€‚å½“ç„¶äº†ï¼Œè‡³äºå¯†é’¥ï¼Œé‚£æ˜¯å¦å¤–ä¸€ä¸ªè¯é¢˜äº†ã€‚\nOpenSSL 1.0.1g 7 Apr 2014 built on: Mon Apr 7 19:24:10 BST 2014 options:bn(64,64) rc4(ptr,char) des(idx,cisc,16,int) aes(partial) idea(int) blowfish(idx) compiler: clang -fPIC -fno-common -DOPENSSL_PIC -DZLIB_SHARED -DZLIB -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -arch x86_64 -O3 -DL_ENDIAN -Wall -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM The 'numbers' are in 1000s of bytes per second processed. type 16 bytes 64 bytes 256 bytes 1024 bytes 8192 bytes md5 27012.47k 83668.96k 193662.90k 288870.40k 339611.95k hmac(md5) 22436.27k 72562.60k 176476.05k 277375.28k 337510.40k sha1 30214.31k 86946.66k 183855.45k 259266.33k 297429.61k rc4 196157.50k 211073.87k 232483.09k 233261.75k 235103.97k des cbc 36183.51k 37559.07k 38393.90k 38166.10k 38460.60k des ede3 14248.36k 14433.49k 14513.37k 14586.23k 14629.00k idea cbc 29515.76k 30455.99k 30819.81k 30886.49k 30909.05k seed cbc 42818.52k 46288.05k 47289.80k 47466.82k 47201.72k blowfish cbc 61676.43k 64869.07k 66887.52k 66720.19k 66823.31k aes-128 cbc 53756.63k 58966.27k 59666.27k 126935.19k 127531.60k aes-192 cbc 46063.28k 50037.52k 50891.14k 109122.65k 109760.48k aes-256 cbc 40039.57k 42316.96k 43542.15k 93052.84k 93731.72k sha256 24619.03k 53308.64k 90030.81k 109692.87k 117423.88k sha512 19076.43k 74213.38k 114250.08k 162023.40k 183772.75k whirlpool 15034.42k 31777.43k 52066.33k 61904.05k 56250.74k aes-128 ige 53897.17k 56852.04k 57523.48k 57741.98k 57742.06k aes-192 ige 45658.29k 47596.69k 48166.72k 48698.26k 48257.35k aes-256 ige 40110.70k 41541.96k 41726.01k 41792.81k 41839.56k sign verify sign/s verify/s rsa 512 bits 0.000169s 0.000015s 5921.3 64569.3 rsa 1024 bits 0.000554s 0.000035s 1805.6 28181.2 rsa 2048 bits 0.003531s 0.000112s 283.2 8923.1 rsa 4096 bits 0.025068s 0.000405s 39.9 2466.8 sign verify sign/s verify/s dsa 512 bits 0.000145s 0.000153s 6890.8 6518.5 dsa 1024 bits 0.000338s 0.000393s 2961.0 2547.0 dsa 2048 bits 0.001081s 0.001332s 925.1 750.6 åˆšåˆšå¼€å§‹é‚£ç³»ç»Ÿè‡ªå¸¦çš„å»è·‘ï¼Œå‘ç°å¹²è„†å‡çº§åˆ°æœ€æ–°çš„ OpenSSL è·‘ä¸€ä¸‹å§ã€‚ç»“æœè·‘äº†ä¸¤éä¹‹åï¼ŒAir ç›´æ¥çƒ«æ‰‹äº†ï¼Œè¿™ç§æµ‹è¯•ä¹Ÿå°±åšä¸€æ¬¡å°±å¤Ÿäº†å§ã€‚\n[^1] http://bbs.pediy.com/showthread.php?t=11312\n[^2] http://blog.csdn.net/qinggebuyao/article/details/7814499\n","date":"2014-04-11T13:19:46Z","permalink":"https://www.4async.com/2014/04/2014-04-11-openssl-algorithm-speed-result/","title":"å‡ ç§å¸¸è§åŠ å¯† / hash ç®—æ³•æ•ˆç‡ (OpenSSL)"},{"content":"æœ€è¿‘å‡çº§äº†ä¸€ä¸‹ simplejsonï¼Œå‘ç° simplejson çš„ speedup æ¨¡å—æŠ¥äº†ä¸€ä¸ªé”™è¯¯ï¼š\nInstalling collected packages: simplejson Found existing installation: simplejson 3.3.1 Uninstalling simplejson: Successfully uninstalled simplejson Running setup.py install for simplejson building 'simplejson._speedups' extension cc -fno-strict-aliasing -fno-common -dynamic -arch x86_64 -arch i386 -g -Os -pipe -fno-common -fno-strict-aliasing -fwrapv -mno-fused-madd -DENABLE_DTRACE -DMACOSX -DNDEBUG -Wall -Wstrict-prototypes -Wshorten-64-to-32 -DNDEBUG -g -fwrapv -Os -Wall -Wstrict-prototypes -DENABLE_DTRACE -arch x86_64 -arch i386 -pipe -I/System/Library/Frameworks/Python.framework/Versions/2.7/include/python2.7 -c simplejson/_speedups.c -o build/temp.macosx-10.9-intel-2.7/simplejson/_speedups.o clang: error: unknown argument: '-mno-fused-madd' [-Wunused-command-line-argument-hard-error-in-future] clang: note: this will be a hard error (cannot be downgraded to a warning) in the future *************************************************************************** WARNING: The C extension could not be compiled, speedups are not enabled. Failure information, if any, is above. I'm retrying the build without the C extension now. *************************************************************************** *************************************************************************** WARNING: The C extension could not be compiled, speedups are not enabled. Plain-Python installation succeeded. *************************************************************************** Successfully installed simplejson Cleaning up... æ³¨æ„çœ‹ error è¿™é‡Œï¼Œæœ‰ä¸€ä¸ª unknown argument: '-mno-fused-madd' çš„é”™è¯¯ï¼Œåº”è¯¥æ˜¯ Xcode å‡çº§æœ€æ–°çš„ç‰ˆæœ¬ä¹‹åï¼Œclang æ›¿æ¢å¸¦æ¥çš„é—®é¢˜ã€‚\nè§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨ç¼–è¯‘ä¹‹å‰ export ä¸¤ä¸ªå‚æ•°å³å¯ï¼š\n$ export CFLAGS=-Qunused-arguments $ export CPPFLAGS=-Qunused-arguments $ pip install simplejson Downloading/unpacking simplejson Downloading simplejson-3.4.0.tar.gz (68kB): 68kB downloaded Running setup.py egg_info for package simplejson Installing collected packages: simplejson Running setup.py install for simplejson building 'simplejson._speedups' extension cc -DNDEBUG -g -fwrapv -Os -Wall -Wstrict-prototypes -Qunused-arguments -Qunused-arguments -arch x86_64 -arch i386 -pipe -I/System/Library/Frameworks/Python.framework/Versions/2.7/include/python2.7 -c simplejson/_speedups.c -o build/temp.macosx-10.9-intel-2.7/simplejson/_speedups.o cc -bundle -undefined dynamic_lookup -arch x86_64 -arch i386 -Wl,-F. -Qunused-arguments -Qunused-arguments build/temp.macosx-10.9-intel-2.7/simplejson/_speedups.o -o build/lib.macosx-10.9-intel-2.7/simplejson/_speedups.so Successfully installed simplejson Cleaning up... åæ¥æŸ¥äº†ä¸€ä¸‹å…·ä½“çš„åŸå› ï¼Œåœ¨ Xcode5.1 çš„ release note ä¸­æœ‰æåŠï¼š\nThe Apple LLVM compiler in Xcode 5.1 treats unrecognized command-line options as errors. This issue has been seen when building both Python native extensions and Ruby Gems, where some invalid compiler options are currently specified. Projects using invalid compiler options will need to be changed to remove those options. To help ease that transition, the compiler will temporarily accept an option to downgrade the error to a warning: -Wno-error=unused-command-line-argument-hard-error-in-future å®˜æ–¹æ¨èçš„æ–¹æ³•æ˜¯ï¼š\n$ ARCHFLAGS=-Wno-error=unused-command-line-argument-hard-error-in-future pip install simplejson Downloading/unpacking simplejson Downloading simplejson-3.4.0.tar.gz (68kB): 68kB downloaded Running setup.py egg_info for package simplejson Installing collected packages: simplejson Running setup.py install for simplejson building 'simplejson._speedups' extension cc -fno-strict-aliasing -fno-common -dynamic -g -Os -pipe -fno-common -fno-strict-aliasing -fwrapv -mno-fused-madd -DENABLE_DTRACE -DMACOSX -DNDEBUG -Wall -Wstrict-prototypes -Wshorten-64-to-32 -DNDEBUG -g -fwrapv -Os -Wall -Wstrict-prototypes -DENABLE_DTRACE -Wno-error=unused-command-line-argument-hard-error-in-future -pipe -Wno-error=unused-command-line-argument-hard-error-in-future -I/System/Library/Frameworks/Python.framework/Versions/2.7/include/python2.7 -c simplejson/_speedups.c -o build/temp.macosx-10.9-intel-2.7/simplejson/_speedups.o clang: warning: unknown argument: '-mno-fused-madd' [-Wunused-command-line-argument-hard-error-in-future] clang: note: this will be a hard error (cannot be downgraded to a warning) in the future clang: warning: argument unused during compilation: '-mno-fused-madd' cc -bundle -undefined dynamic_lookup -Wl,-F. -Wno-error=unused-command-line-argument-hard-error-in-future -Wno-error=unused-command-line-argument-hard-error-in-future build/temp.macosx-10.9-intel-2.7/simplejson/_speedups.o -o build/lib.macosx-10.9-intel-2.7/simplejson/_speedups.so Successfully installed simplejson Cleaning up... æœ€åæ¥ä¸ªè½»é‡çº§çš„æ€§èƒ½æµ‹è¯• (python 2.7.5)ï¼š\n#!/usr/bin/env python # -*- coding: utf-8 -*- from timeit import Timer import json import simplejson def by_json(): a = {\u0026#34;a\u0026#34;: 1, \u0026#34;b\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;c\u0026#34;: [1, 2, 3], \u0026#34;d\u0026#34;: [\u0026#34;1\u0026#34;, \u0026#34;2\u0026#34;, \u0026#34;3\u0026#34;]} b = json.dumps(a) a = json.loads(b) def by_simplejson(): a = {\u0026#34;a\u0026#34;: 1, \u0026#34;b\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;c\u0026#34;: [1, 2, 3], \u0026#34;d\u0026#34;: [\u0026#34;1\u0026#34;, \u0026#34;2\u0026#34;, \u0026#34;3\u0026#34;]} b = simplejson.dumps(a) a = simplejson.loads(b) if __name__ == \u0026#39;__main__\u0026#39;: t = Timer(stmt=\u0026#34;by_json()\u0026#34;, setup=\u0026#34;from __main__ import by_json\u0026#34;) print \u0026#39;by json: %sseconds\u0026#39; % t.timeit(number=3) t = Timer(stmt=\u0026#34;by_simplejson()\u0026#34;, setup=\u0026#34;from __main__ import by_simplejson\u0026#34;) print \u0026#39;by simplejson: %sseconds\u0026#39; % t.timeit(number=3) æµ‹è¯•ç»“æœè¡¨æ˜ï¼šæ©ï¼Œå®é™…ä¸Šä¸ç”¨ simplejson ä¹Ÿå¯ä»¥ï¼Œä¸ä¼šæœ‰å¾ˆå¤§æ€§èƒ½å·®å¼‚ï¼š\n$ python json_speed.py by json: 0.000191926956177 seconds by simplejson: 0.000169992446899 seconds ","date":"2014-04-08T11:43:52Z","permalink":"https://www.4async.com/2014/04/2014-04-08-fix-build-python-ext-on-mac-os-x-mavericks-with-error-mno-fused-madd/","title":"è§£å†³ Mavericks ç³»ç»Ÿä¸Š Python åº“ - mno-fused-madd é”™è¯¯"},{"content":"ä¹‹å‰ä¸€ç›´æ˜¯ Flask çš„å¿ å®ç²‰ä¸ï¼Œç„¶åå˜²è®½ä¸‹ Django å…šï¼›ç»“æœè¢« falcon æ‰“è„¸ï¼Œæ©ï¼Œä¸‹é¢æ˜¯æˆ‘çš„çœŸæœºå®é™…æµ‹è¯•ï¼ˆi5-3230M 2.6G 8G RAM, SSDã€‚ä¹±ç çš„æ˜¯ä»€ä¹ˆå‘¢\u0026hellip;.ï¼‰ï¼š\nBenchmarking, Trial 1 of 3......done. Benchmarking, Trial 2 of 3......done. Benchmarking, Trial 3 of 3......done. Results: 1. falcon.........34,165 req/sec or 29.27 æ¸­ s/req (9x) 2. falcon-ext.....25,752 req/sec or 38.83 æ¸­ s/req (7x) 3. bottle.........17,043 req/sec or 58.67 æ¸­ s/req (5x) 4. pecan...........7,915 req/sec or 126.34 æ¸­ s/req (2x) 5. werkzeug........6,241 req/sec or 160.24 æ¸­ s/req (2x) 6. flask...........3,762 req/sec or 265.81 æ¸­ s/req (1x) è¿™æ ·çœ‹èµ·æ¥ï¼Œå®Œå…¨å¯ä»¥ flask åšå‰å°ï¼Œapi ä½¿ç”¨ falcon æ¥å®ç°ï¼ˆæˆ–è€… Beegoï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯å¼€å‘æ•ˆç‡ï¼‰ã€‚\nFalcon å®åœ¨æ˜¯å¤ªå°å·§äº†ï¼Œæ²¡å•¥å¥½è®²çš„ï¼Œä¸€ä¸ªä¾‹å­å°±è¶³å¤Ÿäº†ï¼š\nimport falcon from gevent.wsgi import WSGIServer class URLApi(object): def on_get(self, req, resp): \u0026#34;\u0026#34;\u0026#34;Handles GET requests\u0026#34;\u0026#34;\u0026#34; result = {\u0026#34;errno\u0026#34;: 0, \u0026#34;details\u0026#34;: \u0026#34;hello\u0026#34;} resp.status = falcon.HTTP_200 resp.body = json.dumps(result) def on_post(self, req, resp): \u0026#34;\u0026#34;\u0026#34;Handles POST requests\u0026#34;\u0026#34;\u0026#34; data = json.load(req.stream,\u0026#39;utf-8\u0026#39;) result = {\u0026#34;errno\u0026#34;: 0, \u0026#34;details\u0026#34;: \u0026#34;hello\u0026#34;} resp.status = falcon.HTTP_200 resp.body = json.dumps(result) app = falcon.API() api = URLApi() app.add_route(\u0026#39;/url/\u0026#39;, api) if __name__ == \u0026#39;__main__\u0026#39;: server = WSGIServer((\u0026#39;0.0.0.0\u0026#39;, 5000), app) server.serve_forever() è¿™ä¸ªæ¡†æ¶ç›®æ ‡æ˜¯æä¾›é«˜æ•ˆçš„ API æ¥å£ï¼Œéå¸¸åˆé€‚å¤§é‡å¹¶å‘çš„ API æ¥å£å¼€å‘ï¼ŒåŒæ—¶å€ŸåŠ© Python çš„å¼€å‘æ•ˆç‡ï¼Œè¿˜æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚\n","date":"2014-04-02T19:47:51Z","permalink":"https://www.4async.com/2014/04/2014-04-02-falcon-web-framework/","title":"çŸ­å°ç²¾æ‚ Falcon"},{"content":"Beego æ¡†æ¶ä¸é”™ï¼Œä¸ªäººæ¯”è¾ƒå–œæ¬¢ï¼Œå…³é”®æ˜¯è¿˜æœ‰ä¸€äº›å¼€å‘å·¥å…·å¾ˆå®ç”¨ï¼Œå°è£…äº†å¾ˆå¤šå®ç°ï¼Œä¸éœ€è¦è‡ªå·±åšå¾ˆå¤šå·¥ä½œï¼Œåœ¨ä¸è€ƒè™‘æ•ˆç‡çš„å‰æä¸‹ï¼Œéƒ½æ˜¯å¯ä»¥æ¥å—çš„èŒƒç•´ã€‚\nè‡ªå®šä¹‰é”™è¯¯é¡µé¢ Beego é»˜è®¤è‡ªå·±å¸¦äº†ä¸€äº›é”™è¯¯é¡µé¢ï¼Œåœ¨ error.go æ–‡ä»¶ä¸­è¿›è¡Œäº†å®šä¹‰ã€‚ä»¥ 404 ä¸ºä¾‹ï¼š\n// show 404 notfound error. func NotFound(rw http.ResponseWriter, r *http.Request) {t, _ := template.New(\u0026#34;beegoerrortemp\u0026#34;).Parse(errtpl) data := make(map[string]interface{}) data[\u0026#34;Title\u0026#34;] = \u0026#34;Page Not Found\u0026#34; data[\u0026#34;Content\u0026#34;] = template.HTML(\u0026#34;\u0026lt;br\u0026gt;The page you have requested has flown the coop.\u0026#34;+\u0026#34;\u0026lt;br\u0026gt;Perhaps you are here because:\u0026#34;+\u0026#34;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;ul\u0026gt;\u0026#34; + \u0026#34;\u0026lt;br\u0026gt;The page has moved\u0026#34;+\u0026#34;\u0026lt;br\u0026gt;The page no longer exists\u0026#34;+\u0026#34;\u0026lt;br\u0026gt;You were looking for your puppy and got lost\u0026#34;+\u0026#34;\u0026lt;br\u0026gt;You like 404 pages\u0026#34;+\u0026#34;\u0026lt;/ul\u0026gt;\u0026#34;) data[\u0026#34;BeegoVersion\u0026#34;] = VERSION //rw.WriteHeader(http.StatusNotFound) t.Execute(rw, data) } å…¶å®è‡ªå·±åšä¸€ä¸ªä¿®æ”¹ä¹Ÿå¾ˆå®¹æ˜“ï¼š\nfunc page_not_found(rw http.ResponseWriter, r *http.Request){t,_:= template.New(\u0026#34;404.html\u0026#34;).ParseFiles(beego.ViewsPath+\u0026#34;/404.html\u0026#34;) data :=make(map[string]interface{}) data[\u0026#34;content\u0026#34;] = \u0026#34;page not found\u0026#34; t.Execute(rw, data) } func main() {beego.Errorhandler(\u0026#34;404\u0026#34;,page_not_found) beego.Router(\u0026#34;/\u0026#34;, \u0026amp;controllers.MainController{}) beego.Run()} Server å­—æ®µçš„ä¿®æ”¹ HTTP è¿”å›å¤´ä¸­çš„ Server æ€»æ˜¯æ˜¾ç¤ºçš„æ˜¯ BeegoServerï¼Œå¤ªä¸ä¸“ä¸šäº†ï¼Œå®šä¹‰åœ¨ config.go æ–‡ä»¶ä¸­ï¼š\nBeegoServerName = \u0026quot;beegoServer\u0026quot;  æˆ‘æœ€åˆæ˜¯ fork äº†ä¸€ä¸ª repo æ”¹ï¼Œåæ¥å‘ç°ï¼Œåªéœ€è¦åœ¨ app.conf æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸‹å°±å¯ä»¥äº†ï¼š\nBeegoServerName = ACGSOSERVER  è¿™æ · Server è¿™ä¸ªå­—æ®µå°±æ›´æ”¹æ‰äº†ï¼Œå…¶ä»–çš„å±æ€§ä¹Ÿå¯ä»¥ç”¨è¿™ç§æ–¹å¼å®šä¹‰æ‰ã€‚\n","date":"2014-04-01T18:46:51Z","permalink":"https://www.4async.com/2014/04/2014-04-01-beego-tips/","title":"Beego çš„å‡ ä¸ªå° Tips"},{"content":"ä¹‹å‰æˆ‘åœ¨ Python å¼€å‘å®è·µ ä¸­æ›¾ç»æåˆ°è¿‡é€šè¿‡ python distribute å®ç°åŒ…åˆ†å‘ã€‚ä½†æ˜¯ä¸€ç›´æ²¡æœ‰æœºä¼šç ”ç©¶å¦‚ä½•å®ç° (æ²¡é”™\u0026hellip;)ï¼Œä»Šå¤©å°±ç²—ç•¥çš„é€šè¿‡ä¸€ä¸ªä¾‹å­ç®€å•æè¿°ä¸€ä¸‹ä¸€ä¸ªåŒ…çš„åˆ¶ä½œï¼š\n# setup.py #!/usr/bin/env python # -*- coding: utf-8 -*- from setuptools import setup, find_packages import sys # å…¼å®¹æ—§ç‰ˆæœ¬ setuptools extra = {} if sys.version_info \u0026gt;= (3,): extra[\u0026#39;use_2to3\u0026#39;] = True extra[\u0026#39;convert_2to3_doctests\u0026#39;] = [\u0026#39;src/your/module/README.txt\u0026#39;] extra[\u0026#39;use_2to3_fixers\u0026#39;] = [\u0026#39;your.fixers\u0026#39;] setup( # åŒ…åç§° name=\u0026#39;your.module\u0026#39;, # ç‰ˆæœ¬å· version = \u0026#39;1.0\u0026#39;, # åŒ…æè¿° description=\u0026#39;This is your awesome module\u0026#39;, # ä½œè€…åç§° author=\u0026#39;You\u0026#39;, # ä½œè€… URL author_email=\u0026#39;your@email\u0026#39;, # å¦‚æœæœ‰éœ€è¦ license = \u0026#34;PSF\u0026#34;, # å¦‚æœæœ‰éœ€è¦ url = \u0026#34;\u0026#34;, # ä¾èµ–åŒ… install_requires=[], # æºä»£ç ç›®å½• package_dir = {\u0026#39;\u0026#39;:\u0026#39;src\u0026#39;}, # åŒ…æ–‡ä»¶ packages = find_packages(), # åŒ…å«å…¶ä»–å¿…é¡»æ–‡ä»¶ï¼Œå‰é¢æ˜¯æ–‡ä»¶å¤¹ï¼Œåé¢æ˜¯æ‰©å±•åï¼Œå°†ä¼šæŒ‰æ­¤æ ¼å¼æ’åˆ—æ–‡ä»¶ package_data = {# include them:\u0026#39;\u0026#39;: [\u0026#39;*.txt\u0026#39;, \u0026#39;*.rst\u0026#39;], }, # å•å…ƒæµ‹è¯• test_suite = \u0026#39;your.module.tests\u0026#39;, **extra ) åœ¨ setuptools \u0026gt;= 0.7 çš„ç‰ˆæœ¬ä¸Šï¼Œdistribute çš„åŠŸèƒ½å·²ç»è¢«æ•´åˆè¿›å…¥ Setuptoolsï¼Œä¾‹å­ä¹Ÿæ˜¯é€‚åˆäº 0.7 ä»¥ä¸Šç‰ˆæœ¬çš„é…ç½®ã€‚ä¸Šé¢è¿™ä¸ªä¾‹å­é€‚ç”¨äºçº¯ Python çš„åŒ…ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦åšä¸€äº›å¯¹ Python çš„æ€§èƒ½æå‡ (æ¯”å¦‚åŠ¨æ€åº“ binding)ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿè¿™æ˜¯ä¸‹ä¸€ç¯‡æ–‡è¦å†™çš„äº†\u0026hellip;\n","date":"2014-03-28T11:33:51Z","permalink":"https://www.4async.com/2014/03/2014-03-28-python-distribute-building-part-one/","title":"Python åˆ†å‘åŒ…åˆ¶ä½œï¼ˆä¸€ï¼‰"},{"content":"è¯ä¸å¤šè¯´ï¼Œè‡ªå·±çœ‹å§ï¼Œæ¯”è¾ƒæ˜ç™½ã€‚\npackage main import (\u0026#34;crypto\u0026#34; \u0026#34;crypto/rand\u0026#34; \u0026#34;crypto/rsa\u0026#34; \u0026#34;crypto/sha256\u0026#34; \u0026#34;crypto/x509\u0026#34; \u0026#34;encoding/base64\u0026#34; \u0026#34;encoding/pem\u0026#34; \u0026#34;errors\u0026#34; \u0026#34;fmt\u0026#34; ) func main() {signer, err := loadPrivateKey(\u0026#34;private.pem\u0026#34;) if err != nil {fmt.Errorf(\u0026#34;signer is damaged: %v\u0026#34;, err) } toSign := \u0026#34;date: Thu, 05 Jan 2012 21:31:40 GMT\u0026#34; signed, err := signer.Sign([]byte(toSign)) if err != nil {fmt.Errorf(\u0026#34;could not sign request: %v\u0026#34;, err) } sig := base64.StdEncoding.EncodeToString(signed) fmt.Printf(\u0026#34;Signature: %v\\n\u0026#34;, sig) parser, perr := loadPublicKey(\u0026#34;public.pem\u0026#34;) if perr != nil {fmt.Errorf(\u0026#34;could not sign request: %v\u0026#34;, err) } err = parser.Unsign([]byte(toSign), signed) if err != nil {fmt.Errorf(\u0026#34;could not sign request: %v\u0026#34;, err) } fmt.Printf(\u0026#34;Unsign error: %v\\n\u0026#34;, err) } // loadPrivateKey loads an parses a PEM encoded private key file. func loadPublicKey(path string) (Unsigner, error) {return parsePublicKey([]byte(`-----BEGIN PUBLIC KEY----- MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCFENGw33yGihy92pDjZQhl0C3 6rPJj+CvfSC8+q28hxA161QFNUd13wuCTUcq0Qd2qsBe/2hFyc2DCJJg0h1L78+6 Z4UMR7EOcpfdUE9Hf3m/hs+FUR45uBJeDK1HSFHD8bHKD6kv8FPGfJTotc+2xjJw oYi+1hqp1fIekaxsyQIDAQAB -----END PUBLIC KEY-----`)) } // parsePublicKey parses a PEM encoded private key. func parsePublicKey(pemBytes []byte) (Unsigner, error) {block, _ := pem.Decode(pemBytes) if block == nil {return nil, errors.New(\u0026#34;ssh: no key found\u0026#34;)} var rawkey interface{} switch block.Type {case\u0026#34;PUBLIC KEY\u0026#34;: rsa, err := x509.ParsePKIXPublicKey(block.Bytes) if err != nil {return nil, err} rawkey = rsa default: return nil, fmt.Errorf(\u0026#34;ssh: unsupported key type %q\u0026#34;, block.Type) } return newUnsignerFromKey(rawkey) } // loadPrivateKey loads an parses a PEM encoded private key file. func loadPrivateKey(path string) (Signer, error) {return parsePrivateKey([]byte(`-----BEGIN RSA PRIVATE KEY----- MIICXgIBAAKBgQDCFENGw33yGihy92pDjZQhl0C36rPJj+CvfSC8+q28hxA161QF NUd13wuCTUcq0Qd2qsBe/2hFyc2DCJJg0h1L78+6Z4UMR7EOcpfdUE9Hf3m/hs+F UR45uBJeDK1HSFHD8bHKD6kv8FPGfJTotc+2xjJwoYi+1hqp1fIekaxsyQIDAQAB AoGBAJR8ZkCUvx5kzv+utdl7T5MnordT1TvoXXJGXK7ZZ+UuvMNUCdN2QPc4sBiA QWvLw1cSKt5DsKZ8UETpYPy8pPYnnDEz2dDYiaew9+xEpubyeW2oH4Zx71wqBtOK kqwrXa/pzdpiucRRjk6vE6YY7EBBs/g7uanVpGibOVAEsqH1AkEA7DkjVH28WDUg f1nqvfn2Kj6CT7nIcE3jGJsZZ7zlZmBmHFDONMLUrXR/Zm3pR5m0tCmBqa5RK95u 412jt1dPIwJBANJT3v8pnkth48bQo/fKel6uEYyboRtA5/uHuHkZ6FQF7OUkGogc mSJluOdc5t6hI1VsLn0QZEjQZMEOWr+wKSMCQQCC4kXJEsHAve77oP6HtG/IiEn7 kpyUXRNvFsDE0czpJJBvL/aRFUJxuRK91jhjC68sA7NsKMGg5OXb5I5Jj36xAkEA gIT7aFOYBFwGgQAQkWNKLvySgKbAZRTeLBacpHMuQdl1DfdntvAyqpAZ0lY0RKmW G6aFKaqQfOXKCyWoUiVknQJAXrlgySFci/2ueKlIE1QqIiLSZ8V8OlpFLRnb1pzI 7U1yQXnTAEFYM560yJlzUpOb1V4cScGd365tiSMvxLOvTA== -----END RSA PRIVATE KEY-----`)) } // parsePublicKey parses a PEM encoded private key. func parsePrivateKey(pemBytes []byte) (Signer, error) {block, _ := pem.Decode(pemBytes) if block == nil {return nil, errors.New(\u0026#34;ssh: no key found\u0026#34;)} var rawkey interface{} switch block.Type {case\u0026#34;RSA PRIVATE KEY\u0026#34;: rsa, err := x509.ParsePKCS1PrivateKey(block.Bytes) if err != nil {return nil, err} rawkey = rsa default: return nil, fmt.Errorf(\u0026#34;ssh: unsupported key type %q\u0026#34;, block.Type) } return newSignerFromKey(rawkey) } // A Signer is can create signatures that verify against a public key. type Signer interface { // Sign returns raw signature for the given data. This method // will apply the hash specified for the keytype to the data. Sign(data []byte) ([]byte, error) } // A Signer is can create signatures that verify against a public key. type Unsigner interface { // Sign returns raw signature for the given data. This method // will apply the hash specified for the keytype to the data. Unsign(data[]byte, sig []byte) error } func newSignerFromKey(k interface{}) (Signer, error) { var sshKey Signer switch t := k.(type) { case *rsa.PrivateKey: sshKey = \u0026amp;rsaPrivateKey{t} default: return nil, fmt.Errorf(\u0026#34;ssh: unsupported key type %T\u0026#34;, k) } return sshKey, nil } func newUnsignerFromKey(k interface{}) (Unsigner, error) { var sshKey Unsigner switch t := k.(type) { case *rsa.PublicKey: sshKey = \u0026amp;rsaPublicKey{t} default: return nil, fmt.Errorf(\u0026#34;ssh: unsupported key type %T\u0026#34;, k) } return sshKey, nil } type rsaPublicKey struct {*rsa.PublicKey} type rsaPrivateKey struct {*rsa.PrivateKey} // Sign signs data with rsa-sha256 func (r *rsaPrivateKey) Sign(data []byte) ([]byte, error) {h := sha256.New() h.Write(data) d := h.Sum(nil) return rsa.SignPKCS1v15(rand.Reader, r.PrivateKey, crypto.SHA256, d) } // Unsign verifies the message using a rsa-sha256 signature func (r *rsaPublicKey) Unsign(message []byte, sig []byte) error {h := sha256.New() h.Write(message) d := h.Sum(nil) return rsa.VerifyPKCS1v15(r.PublicKey, crypto.SHA256, d, sig) } ","date":"2014-03-23T20:25:52Z","permalink":"https://www.4async.com/2014/03/2014-03-23-golang-rsa/","title":"Golang çš„ RSA å…¬ç§é’¥æ–¹æ³•å®ç°"},{"content":"ä»¥å‰ä¸€ç›´å†™çš„æ˜¯åå°çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œæ•°æ®ä¸éœ€è¦ç›´æ¥çš„å®æ—¶è¿”å›ï¼Œç»å¸¸ä¸ä¼šæœ‰ä»€ä¹ˆé˜Ÿåˆ—æ–¹é¢çš„éœ€æ±‚ã€‚æœ€è¿‘æœ‰ä¸ªå…³äºäº¤äº’çš„æ¼”ç¤ºé¡¹ç›®éœ€è¦å®æ—¶è¿”å›ç»“æœï¼Œä½†æ˜¯ä¸­é—´å‡ ä¸ªè¿‡ç¨‹éƒ½éœ€è¦å¤§é‡çš„äº¤äº’ï¼ˆç½‘ç»œé€šè®¯ï¼‰ï¼Œå› æ­¤è¿™ä¸ªæ—¶å€™å°±éœ€è¦å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚ç›¸å¯¹æ¥è¯´ï¼Œæœ€ç®€å•çš„ Python é˜Ÿåˆ—å®ç°å°±æ˜¯ Celeryã€‚\nCelery çš„ä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯éœ€è¦åç«¯çš„æ•°æ®åº“åšæ¶ˆæ¯é˜Ÿåˆ—å­˜å‚¨æœºåˆ¶ï¼Œè¿™ä¸ªä¸€ç›´æ²¡æƒ³æ˜ç™½ï¼Œçœ‹æ–‡æ¡£çš„æ—¶å€™æƒ³å½“ç„¶çš„ä»¥ä¸ºä¸éœ€è¦åç«¯ä¹Ÿè¡Œçš„ã€‚å‡å¦‚æ²¡æœ‰åç«¯çš„è¯ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šä¸èƒ½å®ç°åŠŸèƒ½ã€‚\næ¯”å¦‚æˆ‘æœ‰ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„è¦æ±‚ï¼š\nr = requests.post(url, files=fh) è¿™ä¸ªè¯·æ±‚å¯èƒ½éœ€è¦å¤§é‡çš„æ—¶é—´å®ç°ä¸Šä¼ ï¼Œåº”ç”¨åˆæœ‰ä½“éªŒçš„åŸå› éœ€è¦å®æ—¶è¿”å›ç»“æœï¼Œå› æ­¤å®ç°çš„æ–¹å¼å°±å¯ä»¥é€‰æ‹©é˜Ÿåˆ—å®ç°ã€‚æ›´åŠ æ™®éçš„åœºæ™¯è¿˜æœ‰å‘é€é‚®ä»¶ã€çŸ­ä¿¡ç­‰ç­‰çš„åœºæ™¯ã€‚\né¦–å…ˆæ˜¯ç¼–å†™ Celery çš„ Worker è¿›ç¨‹ã€‚è¿™ä¸ªè¿›ç¨‹æ˜¯ä½œä¸ºé˜Ÿåˆ—çš„åç«¯å¤„ç†ç¨‹åºå­˜åœ¨çš„ï¼Œæˆ‘åœ¨é€‰æ‹©åç«¯æ—¶ä½¿ç”¨çš„æ˜¯ Redisï¼Œä¸»è¦æ˜¯æ¯”è¾ƒæ–¹ä¾¿ï¼Œamq å®‰è£…ç›¸å¯¹éº»çƒ¦ã€‚æœ‰äººæ›¾ç»ååº”è¯´ Redis çš„æ”¯æŒå¹¶ä¸æ˜¯ååˆ†å®Œå–„ï¼Œä½†æ˜¯æˆ‘çœ‹æ–‡æ¡£ä¸­å¹¶æœªæåˆ°ï¼Œå› æ­¤åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒçš„æ—¶å€™æ³¨æ„ä¸€ä¸‹è¿™ä¸ªå‘ï¼Œå¦‚æœå‘ç° Redis æœ‰é—®é¢˜ï¼Œå¯ä»¥æœæ–­è¿ç§»è‡³ amqï¼Œæˆ–è€…ç›´æ¥ç”¨å®ƒåšåç«¯ã€‚\n# tasks.py from celery import Celery redis_url = \u0026#39;redis://localhost:6379/0\u0026#39; app = Celery(\u0026#39;tasks\u0026#39;, backend=redis_url, broker=redis_url) # Celery ç¬¬ä¸€ä¸ªå‚æ•°åŒæ–‡ä»¶å # æ–°å¼‚æ­¥ä»»åŠ¡ @app.task def upload_file(url, fh): r = requests.post(url, files=fh) ç¼–å†™å®Œæˆåå°±å¯ä»¥è¿è¡Œ Celery çš„ Worker è¿›ç¨‹ï¼š\ncelery -A tasks worker  å°±å¯ä»¥æ‰§è¡Œ Worker è¿›ç¨‹ï¼Œè®°å¾—åŒæ—¶å¯åŠ¨æ•°æ®åº“ï¼šï¼‰\nç„¶åå†™ä¸€ä¸‹å‰æ®µå¤„ç†æ¨¡å—ï¼š\nfrom task import upload_file result = upload_file.delay(url, fh) # å»¶è¿Ÿæ‰§è¡Œ print result.ready() # è·å–è¿è¡ŒçŠ¶æ€ print result.get(timeout=10) # è·å–è¿è¡Œç»“æœ ","date":"2014-03-23T19:58:42Z","permalink":"https://www.4async.com/2014/03/2014-03-23-python-celery-queue-first-step/","title":"åˆè¯† Celery"},{"content":"ç¬¬ä¸€æ¬¡ç”¨ python encode utf-8 çš„ä¸­æ–‡ï¼Œç»“æœå‘ç°äº†ä¸€ä¸ªè›‹ç–¼çš„é—®é¢˜\nimport base64 base64.b64encode(u\u0026#39; ä½ å¥½ä¸–ç•Œ \u0026#39;) Traceback (most recent call last): File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; File \u0026#34;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/base64.py\u0026#34;, line 53, in b64encode encoded = binascii.b2a_base64(s)[:-1] UnicodeEncodeError: \u0026#39;ascii\u0026#39; codec can\u0026#39;t encode characters in position 0-3: ordinal not in range(128) è¿™ä¸ªé—®é¢˜åœ¨ 2008 å¹´å°±æå‡ºæ¥è¿‡ï¼Œè¿™ä¸ª Base64 çš„è¿™ä¸ªåº“çš„å®ç°æ˜¯æŒ‰ç…§ RFC 3548 å®ç°çš„ï¼Œä»…æŒ‰ç…§ byte å’Œ ascii å­—ç¬¦ï¼Œæ‰€ä»¥ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœä¿®å¤è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œå°±æ˜¯æŠŠ unicode å­—ç¬¦æ¢æˆ byte å°±å¯ä»¥æ­£å¸¸äº†ã€‚\n_str = u\u0026#34;ä½ å¥½ä¸–ç•Œ\u0026#34; encoded = base64.b64encode(_str.encode(\u0026#39;utf-8\u0026#39;)) print encoded print base64.b64decode(encoded).decode(\u0026#39;utf-8\u0026#39;) ","date":"2014-03-13T21:50:29Z","permalink":"https://www.4async.com/2014/03/2014-03-13-python-base64-encode-utf-8error/","title":"Python ä¸­æ–‡ UTF-8 ç¼–ç  base64 æŠ¥é”™"},{"content":"åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æåˆ°è¿‡ cProfile å¯¹ Python è¿›è¡Œè°ƒä¼˜ï¼Œä½†æ˜¯ä»…ä»…åªæ˜¯ç®€å•çš„ä¸€ç¬”å¸¦è¿‡ï¼Œè¿™ç¯‡æ–‡ç« å°±é’ˆå¯¹è¿™ä¸ªå†…å®¹ï¼Œå•ç‹¬æ‰©å±•ä¸€ä¸‹ã€‚cProfile æ˜¯ Python çš„æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œå¦å¤–ä¸€ä¸ªåŒç±»å·¥å…·æ˜¯ python å®ç°çš„ profileï¼Œä¸è¿‡ cProfile æ˜¯ C è¯­è¨€æ‰©å±•çš„å®ç°ã€‚\nå®˜æ–¹æ–‡æ¡£é¡µé¢ï¼šhttp://docs.python.org/2/library/profile.html#module-cProfileã€‚\nå…ˆä»ä¸€ä¸ªä¾‹å­å¼€å§‹ï¼š\n#!/usr/bin/env python # -*- coding: utf-8 -*- import time def delay(): time.sleep(10) def main(): delay() print \u0026#34;123\u0026#34; if __name__ == \u0026#39;__main__\u0026#39;: main() ä½¿ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥å¿«é€Ÿè¯Šæ–­ï¼š\npython -m cProfile profile_run.py  è¾“å‡ºå¦‚ä¸‹ï¼š\n 5 function calls in 10.002 seconds Ordered by: standard name ncalls tottime percall cumtime percall filename:lineno(function) 1 0.002 0.002 10.002 10.002 profile_run.py:11(main) 1 0.000 0.000 10.002 10.002 profile_run.py:4(\u0026lt;module\u0026gt;) 1 0.000 0.000 10.000 10.000 profile_run.py:7(delay) \u0026lt;-- è°ƒç”¨è€…è¿™é‡Œ 1 0.000 0.000 0.000 0.000 {method'disable'of'_lsprof.Profiler'objects} 1 10.000 10.000 10.000 10.000 {time.sleep} \u0026lt;--- å…ƒå‡¶åœ¨è¿™é‡Œ  å¦‚æœæƒ³è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ª - o å‚æ•°å³å¯ï¼š\npython -m cProfile -o profile_output profile_run.py  è‹¥æƒ³æŒ‰ç…§æŸåˆ—æ’åºï¼Œåˆ™å¯ä»¥æ·»åŠ è¿™ä¸ªå‚æ•°ï¼š\npython -m cProfile -o profile_output -s tottime profile_run.py  é‚£ä¹ˆç­‰ç­‰ï¼Œè¿™ä¸ªç»“æœæ–‡ä»¶å¦‚ä½•è¯†åˆ«å‘¢ï¼š\nncalls: è¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨çš„æ¬¡æ•°\ntottimeï¼šå‡½æ•°çš„å…·ä½“æ‰§è¡Œæ—¶é—´ï¼Œä¸åŒ…å«å…¶ä»–å‡½æ•°æ¶ˆè€—çš„æ—¶é—´\npercallï¼šæ¯æ¬¡è°ƒç”¨çš„æ¶ˆè€—ï¼ˆåŒ…å«å…¶ä»–å‡½æ•°æ¶ˆè€—å’Œä¸åŒ…å«çš„æ—¶é—´ï¼‰\ncumtimeï¼šç¨‹åºæ¶ˆè€—çš„æ€»æ—¶é—´\nç„¶åçœ‹ä¸€ä¸ªå®é™…çš„æˆæœçœ‹ä¸€ä¸‹ç»“æœå¦‚ä½•ï¼Œå…·ä½“çš„è¯Šæ–­æ•°æ®ï¼š\nå‘ç°æœ€æ…¢çš„æ‰§è¡Œæ¨¡å—æ˜¯ not_operation è¿™ä¸ªå‡½æ•°ï¼š\ndef not_operation(operand, dictionary, pfile): \u0026#34;\u0026#34;\u0026#34;Performs the operation `NOT operand`.\u0026#34;\u0026#34;\u0026#34; # A list of all the documents (sorted) all_docs = dictionary.all_docs() # A list of the documents matching `operand` (sorted) results = get_results(operand, dictionary, pfile, force_list=True) return [doc for doc in all_docs if doc not in results] æ¥ä¸‹æ¥æ˜¯æ€ä¹ˆä¿®å¤äº†ï¼š\n# the fix. def not_operation(operand, dictionary, pfile): \u0026#34;\u0026#34;\u0026#34;Performs the operation `NOT operand`.\u0026#34;\u0026#34;\u0026#34; # A list of all the documents (sorted) all_docs = dictionary.all_docs() # A list of the documents matching `operand` (sorted) results = get_results(operand, dictionary, pfile, force_list=True) return list_a_and_not_list_b(all_docs, results) def list_a_and_not_list_b(a, b): \u0026#34;\u0026#34;\u0026#34;Returns `a AND NOT b`. Both a and b are expected to be sorted lists. \u0026#34;\u0026#34;\u0026#34;results = [] idx_a = 0 idx_b = 0 while idx_a \u0026lt;len(a) and idx_b \u0026lt;len(b): if a[idx_a] \u0026lt;b[idx_b]: results.append(a[idx_a]) idx_a += 1 elif b[idx_b] \u0026lt;a[idx_a]: idx_b += 1 else: idx_a += 1 idx_b += 1 while idx_a \u0026lt;len(a): results.append(a[idx_a]) idx_a += 1 å¯¹äº†ï¼Œè¯´èµ·æ¥ï¼Œä¸Šé¢å›¾ç‰‡æŸ¥çœ‹å·¥å…·æ˜¯ cprofilevï¼Œæ˜¯é’ˆå¯¹ cProfile çš„æŸ¥çœ‹å·¥å…·ï¼Œä½¿ç”¨å‘½ä»¤å®‰è£…ï¼š\npip install bottle cprofilev cprofilev profile_output  å¦‚æœåœ¨ Windows å®‰è£…é»˜è®¤æœ‰ç‚¹é—®é¢˜ï¼Œä½ å¦‚æœæƒ³è§£å†³ï¼Œå¯ä»¥è‡ªå·±çœ‹ä¸€ä¸‹:)\n","date":"2014-03-09T23:04:00Z","permalink":"https://www.4async.com/2014/03/2014-03-09-python-profile-using-cprofile/","title":"åˆ©ç”¨ cProfile è¿›è¡Œ Python ç¨‹åºæ€§èƒ½è°ƒä¼˜"},{"content":"æœ¬æ¥è¿˜æƒ³ç»§ç»­ç¿»è¯‘ï¼šhttps://wiki.python.org/moin/PythonSpeed/PerformanceTipsï¼Œä½†æ˜¯äº‹æƒ…å¤ªå¤šçœŸçš„æ²¡æ—¶é—´ï¼Œé‚£ä¹ˆå°±ç®€å•çš„æ€»ç»“ä¸€ä¸‹å§ã€‚\nå­—ç¬¦ä¸²æ‹¼æ¥ åº”è¯¥é¿å…ä½¿ç”¨ï¼š\ns = \u0026#34;\u0026#34; for substring in list: s += substring é€‰æ‹©ä½¿ç”¨ï¼š\ns = \u0026#34;\u0026#34;.join(list) å¯¹äºå¤§å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œé¿å…ä½¿ç”¨ï¼š\ns = \u0026#34;\u0026#34; for x in list: s += some_function(x) ä½¿ç”¨ï¼š\nslist = [some_function(elt) for elt in somelist] s = \u0026#34;\u0026#34;.join(slist) é¿å…ä½¿ç”¨ï¼š\nout = \u0026#34;\u0026lt;html\u0026gt;\u0026#34; + head + prologue + query + tail + \u0026#34;\u0026lt;/html\u0026gt;\u0026#34; ä½¿ç”¨ï¼š\nout = \u0026#34;\u0026lt;html\u0026gt;%s%s%s%s\u0026lt;/html\u0026gt;\u0026#34; % (head, prologue, query, tail) å½“ç„¶äº†ï¼Œè¿™ç§æ›´å®¹æ˜“è¯»ï¼š\nout = \u0026#34;\u0026lt;html\u0026gt;%(head)s%(prologue)s%(query)s%(tail)s\u0026lt;/html\u0026gt;\u0026#34; % locals() å¾ªç¯ åˆ—è¡¨é‡Œé¢çš„æ¯ä¸ªå­—ç¬¦ä¸²éƒ½å˜æˆå¤§å†™ï¼Ÿ\nnewlist = [] for word in oldlist: newlist.append(word.upper()) è¯•è¯•è¿™ç§æ–¹æ³•ï¼š\nnewlist = map(str.upper, oldlist)) æˆ–è€…æ˜¯ï¼š\niterator = (s.upper() for s in oldlist) é¿å…ç‚¹å· æ¯”å¦‚è¯´æˆ‘ä»¬æƒ³æŠŠä¸€ä¸ªåˆ—è¡¨ä¸€ä¸ªå¤§å†™ä¹‹ååˆ°ä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œè¯•è¯•ä¸‹é¢çš„ï¼š\nupper = str.upper newlist = [] append = newlist.append for word in oldlist: append(upper(word)) æœ¬åœ°å˜é‡ Python åœ¨è®¿é—®æœ¬åœ°å˜é‡æ—¶çš„é€Ÿåº¦è¦æ¯”å…¨å±€å˜é‡é€Ÿåº¦æ›´å¿«ï¼Œæ¯”å¦‚ï¼š\ndef func(): upper = str.upper newlist = [] append = newlist.append for word in oldlist: append(upper(word)) return newlist åˆå§‹åŒ–å­—å…¸å…ƒç´  æ¯”å¦‚ä½ åœ¨åˆå§‹åŒ–ä¸€ä¸ªå­—å…¸ï¼Œå­—å…¸ä¸­æ¯ä¸ªå…ƒç´ æ˜¯å•è¯å’Œæ ‡å·ï¼š\nwdict = {} for word in words: if word not in wdict: wdict[word] = 0 wdict[word] += 1 é‚£ä¹ˆè¯•è¯• try-except å§ï¼š\nwdict = {} for word in words: try: wdict[word] += 1 except KeyError: wdict[word] = 1 æˆ–è€…å†æ¢ä¸€ç§æ–¹å¼ï¼š\nwdict = {} get = wdict.get for word in words: wdict[word] = get(word, 0) + 1 å¤´éƒ¨å¼•å…¥ def doit1(): import string ###### import statement inside function string.lower(\u0026#39;Python\u0026#39;) for num in range(100000): doit1() import string ###### import statement outside function def doit2(): string.lower(\u0026#39;Python\u0026#39;) for num in range(100000): doit2() doit2 è¦å¿«ä¸€äº›ã€‚\næ•°æ®èšåˆ import time x = 0 def doit1(i): global x x = x + i list = range(100000) t = time.time() for i in list: doit1(i) print \u0026#34;%.3f\u0026#34; % (time.time()-t) vs import time x = 0 def doit2(list): global x for i in list: x = x + i list = range(100000) t = time.time() doit2(list) print \u0026#34;%.3f\u0026#34; % (time.time()-t) å¯¹æ¯”ä¸€ä¸‹æ€§èƒ½ï¼Œç¬¬äºŒç§æ–¹æ³•è¦æ›´å¿«ä¸€ç‚¹\nxrange æ›¿ä»£ range æ©ï¼Œxrage æ›´å¿«ä¸€äº›ã€‚\nå–„ç”¨ cProfile æ€§èƒ½è¯Šæ–­çš„å¥½å·¥å…·\n","date":"2014-03-03T20:30:00Z","permalink":"https://www.4async.com/2014/03/2014-02-18-benchmark-python-2/","title":"Python æ€§èƒ½æŠ€å·§ (äºŒ)"},{"content":"ç¿»è¯‘è‡ªï¼šhttps://wiki.python.org/moin/PythonSpeed/PerformanceTips\nè¯¥é¡µé¢è‡´åŠ›äºæä¾›å¸®åŠ©æé«˜ä½ çš„ Python ç¨‹åºçš„æ€§èƒ½å„ç§æŠ€å·§å’Œçªé—¨ã€‚æ— è®ºä¿¡æ¯æ¥è‡ªä½•äºº, æˆ‘è¯•å›¾é‰´åˆ«æ¥æºã€‚\nPython åœ¨æˆ‘ 1996 å¹´å†™è¿‡ â€œfast pythonâ€ é¡µé¢åå·²ç»å‘ç”Ÿäº†å¾ˆå¤šé‡è¦å˜åŒ–ï¼Œè¿™æ„å‘³ç€ä¸€äº›å‘½ä»¤ä¼šå‘ç”Ÿå˜åŒ–ã€‚æˆ‘å°†è¿™ä¸ªé¡µé¢è¿ç§»åˆ° Python wiki, å¸Œæœ›å…¶ä»–äººä¼šå¸®åŠ©ç»´æŠ¤å®ƒã€‚\nåœ¨ä½¿ç”¨è¿™äº›æŠ€å·§æ—¶ä½ ä»éœ€è¿›è¡Œé’ˆå¯¹ç‰¹å®šç‰ˆæœ¬ Python å’Œä½ ç¨‹åºçš„æµ‹è¯•ï¼Œè€Œä¸æ˜¯ç›²ç›®çš„æ¥å—ä¸€ä¸ªæ–¹æ³•å¿«äºå¦å¤–ä¸€ç§ã€‚åœ¨åˆ†ææ—¶ä½ ä¼šçœ‹åˆ°æ›´å¤šçš„ç»†èŠ‚ã€‚\né€šåŒæ ·æ›´æ–°çš„ä½ å¯ä»¥ç”¨ç±»ä¼¼ Cythonã€Pyrexã€Psycoã€Weaveã€Shed Skin å’Œ PyInline ä¹‹ç±»ç¼–å†™åŒ…ï¼Œé€šè¿‡å°†æ€§èƒ½å…³é”®ä»£ç è½¬æ¢ä¸º C æˆ–æœºå™¨è¯­è¨€æå¤§æå‡åº”ç”¨æ€§èƒ½ã€‚\næ¦‚è¿°ï¼š ä¼˜åŒ–ä½ éœ€è¦ä¼˜åŒ–çš„ ä½ åªèƒ½åœ¨è·å–ç¬¬ä¸€ä¸ªæ­£ç¡®ç»“æœè¿è¡Œè·å–è¾“å‡ºæ—¶çŸ¥é“ä½ çš„ç¨‹åºæ˜¯å¦è¿è¡Œå¾ˆæ…¢ã€‚å½“å‘ç°è¿è¡Œç¼“æ…¢, åˆ†æå¯ä»¥æ˜¾ç¤ºç¨‹åºçš„å“ªäº›éƒ¨åˆ†æ¶ˆè€—çš„å¤§éƒ¨åˆ†æ—¶é—´ã€‚å…¨é¢çš„å¿«é€Ÿæµ‹è¯•å¥—ä»¶å¯ä»¥ç¡®ä¿æœªæ¥çš„ä¼˜åŒ–ä¸æ”¹å˜ç¨‹åºçš„æ­£ç¡®æ€§ã€‚ç®€å•æ¥è¯´ï¼š\n æ­£å¸¸è·å–ç»“æœ æµ‹è¯•æ˜¯å¦æ­£ç¡® å¦‚æœæ…¢åˆ™è¿›è¡Œåˆ†æ ä¼˜åŒ– é‡å¤æ­¥éª¤ 2  ä¸€äº›ä¼˜åŒ–æ–¹æ³•æ˜¯è‰¯å¥½çš„ç¼–ç¨‹é£æ ¼, å› æ­¤ä½ åº”è¯¥å­¦ä¹ å­¦ä¹ ä»–ä»¬çš„æ–¹å¼ã€‚ä¸€ä¸ªä¾‹å­å°†æ˜¯ä¸é€šè¿‡å¾ªç¯ç§»åŠ¨è®¡ç®—çš„å€¼ã€‚\né€‰æ‹©æ­£ç¡®çš„æ•°æ®ç»“æ„ TBD\n","date":"2014-02-18T21:07:00Z","permalink":"https://www.4async.com/2014/02/2014-02-18-benchmark-python/","title":"Python æ€§èƒ½æŠ€å·§ (ä¸€)"},{"content":"ä½œä¸ºä¸€ä¸ªåœŸé€¼ï¼Œæˆ‘ä¹‹å‰å†™ä¸ªç¨‹åºéƒ½æ˜¯è‡ƒè‚¿çš„ï¼Œåæ¥è¿˜è¢«äººå˜²ç¬‘çœŸä¸æ˜¯ä¸€ä¸ªé‚£å•¥çš„ç¨‹åºã€‚æ¯”å¦‚è¯´å…³äºç®—ç­¾åçš„é—®é¢˜ï¼Œè¿™ä¸ªåœ¨å¾ˆå¤š Oauth ç¯å¢ƒä¸‹éƒ½ä¼šå¾ˆå¸¸è§çš„ç®—æ³•æˆ‘å†™èµ·æ¥å°±å¾ˆæŒ«ã€‚åæ¥æ‰¾äº†ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š\n# å‡è®¾æ‰€æœ‰çš„éƒ½åœ¨ä¸€ä¸ª dict ä¸­ items = adict.items() items.sort() sha1=hashlib.sha1() map(sha1.update, items) hashcode=sha1.hexdigest() if hashcode == signature: return True ä¸çŸ¥é“ Map çš„ç”¨æ³•ï¼ŒçœŸçš„å¾ˆæŒ«\u0026hellip;.\n","date":"2014-02-17T17:12:00Z","permalink":"https://www.4async.com/2014/02/2014-02-17-create-sign-quickly-python/","title":"Python ä¸‹å¿«é€Ÿåˆ›å»ºç­¾å"},{"content":"ä¹‹å‰ä¸€ç›´æ²¡æœ‰å¤ªè¿‡äºå…³æ³¨è¿‡å•å…ƒæµ‹è¯•ï¼Œæ„Ÿè§‰è‡ªå·±ç¨‹åºä»£ç å†™äº†è¶³å¤Ÿçš„å®ç°é€»è¾‘å’Œå¤„ç†æµç¨‹å°±åº”è¯¥å®Œå…¨å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Œä½†æ˜¯äº‹å®ä¸Šåœ¨å®ç°å…·ä½“åŠŸèƒ½æ—¶ï¼Œè¿˜æ˜¯å­˜åœ¨ä¸€äº›è¿™æ ·é‚£æ ·çš„é—®é¢˜ï¼Œç”šè‡³é€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯åœ¨ä»£ç å†™å®Œå¯ä»¥è·‘é€šè¿è¡Œæ—¶å‘ç°çš„é—®é¢˜ï¼Œé€šå¸¸è¿™ä¸ªæ—¶å€™å·²ç»å¾ˆæ™šäº†ã€‚å¤§å®¶å¯ä»¥ç¿»ä¸‹æˆ‘åœ¨ Github ä¸Šå¼€æ”¾å‡ºæ¥çš„å¤§éƒ¨åˆ†ä»£ç åº”è¯¥éƒ½å­˜åœ¨ä¸€äº›æˆ–å¤šæˆ–å°‘çš„å°é—®é¢˜ï¼Œè¿™äº›é—®é¢˜è™½ä¸è‡´å‘½ï¼Œä½†æ˜¯å´æ˜¯ä¹Ÿæ˜¯å¾ˆçƒ¦èºçš„äº‹æƒ…ã€‚\nä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯• å•å…ƒæµ‹è¯•ï¼ˆunit testingï¼‰ï¼Œæ˜¯æŒ‡å¯¹è½¯ä»¶ä¸­çš„æœ€å°å¯æµ‹è¯•å•å…ƒè¿›è¡Œæ£€æŸ¥å’ŒéªŒè¯ã€‚å¯¹äºå•å…ƒæµ‹è¯•ä¸­å•å…ƒçš„å«ä¹‰ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¦æ ¹æ®å®é™…æƒ…å†µå»åˆ¤å®šå…¶å…·ä½“å«ä¹‰ï¼Œå¦‚ C è¯­è¨€ä¸­å•å…ƒæŒ‡ä¸€ä¸ªå‡½æ•°ï¼ŒJava é‡Œå•å…ƒæŒ‡ä¸€ä¸ªç±»ï¼Œå›¾å½¢åŒ–çš„è½¯ä»¶ä¸­å¯ä»¥æŒ‡ä¸€ä¸ªçª—å£æˆ–ä¸€ä¸ªèœå•ç­‰ã€‚æ€»çš„æ¥è¯´ï¼Œå•å…ƒå°±æ˜¯äººä¸ºè§„å®šçš„æœ€å°çš„è¢«æµ‹åŠŸèƒ½æ¨¡å—ã€‚å•å…ƒæµ‹è¯•æ˜¯åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­è¦è¿›è¡Œçš„æœ€ä½çº§åˆ«çš„æµ‹è¯•æ´»åŠ¨ï¼Œè½¯ä»¶çš„ç‹¬ç«‹å•å…ƒå°†åœ¨ä¸ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ç›¸éš”ç¦»çš„æƒ…å†µä¸‹è¿›è¡Œæµ‹è¯•ã€‚(via ç™¾åº¦ç™¾ç§‘)\næˆ‘å¯¹å•å…ƒæµ‹è¯•çš„ç†è§£ï¼Œå•å…ƒæµ‹è¯•åº”è¯¥æ˜¯ä¿è¯ç¨‹åºåŠŸèƒ½æ¨¡å—çš„ä»£ç å®‰å…¨æ€§å’Œå¥å£®æ€§çš„ä¿éšœæ€§æµ‹è¯•ï¼Œä¸»è¦æ˜¯å¼€å‘äººå‘˜åœ¨å¯¹è‡ªå·±å¼€å‘çš„ä»£ç è¿›è¡Œæµ‹è¯•ã€‚è¢«æµ‹è¯•æ¨¡å—å¯èƒ½åŒ…æ‹¬å¤šä¸ªåŠŸèƒ½ç‚¹ï¼Œåœ¨åšæµ‹è¯•æ—¶ï¼Œè®¾è®¡æµ‹è¯•ç”¨ä¾‹è¦è¦†ç›–è¿™äº›åŠŸèƒ½ç‚¹ï¼Œä»¥ä¿è¯è¿™äº›åŠŸèƒ½ç‚¹ç»è¿‡æµ‹è¯•ã€‚å¾ˆå¤šæ–‡ç« åœ¨ä»‹ç»å•å…ƒæµ‹è¯•å¸¸å¸¸ä¼šä»‹ç»ä¸€äº› 100% çš„è¦†ç›–ï¼Œè€ƒè™‘åˆ°ä¸€äº›å¼‚å¸¸æƒ…å†µæƒ…å†µçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä¸ªäººè§‰å¾—åº”è¯¥æ˜¯è¦†ç›–å¼‚å¸¸çš„æƒ…å†µæ›´å¤šä¸€ç‚¹ï¼Œåˆ†æ”¯è¦†ç›–ä¸€èˆ¬å¸¸è§å‚æ•°ä¼ å…¥æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Œå¦å¤–è¿˜æ˜¯éœ€è¦ä¿è¯ä¸€äº›ä»¥å‰çš„ Bug å¹¶ä¸ä¼šå‡ºç°çš„æµ‹è¯•ç”¨ä¾‹ã€‚\nå‡ ç§å¸¸è§è¯­è¨€çš„ Unit Test å…ˆè¯´å³ç§çš„ï¼Œä¸€ç§æ˜¯ Python çš„ï¼Œä¸€ç§æ˜¯ Golangï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ Objective-C çš„ã€‚\nPython Python æä¾›äº†unittest åº“ï¼Œç”¨äºè¿›è¡Œå•å…ƒæµ‹è¯•ã€‚è¿™ä¸ªè¯¦ç»†è¯´ä¸€ä¸‹ï¼Œå‰©ä¸‹çš„ä¸¤ä¸ªéƒ½æœ‰ç°æˆçš„ä»£ç  :)ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªå¯¹ random æ¨¡å—çš„å•å…ƒæµ‹è¯•ä»£ç ï¼Œæµ‹è¯•äº† shuffle, choice å’Œ sample å‡½æ•°åŠŸèƒ½ï¼Œæµ‹è¯•å‡½æ•°ä»¥ test å¼€å¤´ï¼Œå¹¶ä¸”æ²¡æœ‰è¿”å›å’Œä¼ å…¥å‚æ•°ã€‚\nimport random #è¢«æµ‹è¯•æ¨¡å— import unittest class TestSequenceFunctions(unittest.TestCase): def setUp(self): ``` æµ‹è¯•åˆå§‹åŒ– ``` self.seq = range(10) pass def tearDown(self): ``` æµ‹è¯•æ¸…ç† ``` pass def test_shuffle(self): # make sure the shuffled sequence does not lose any elements random.shuffle(self.seq) self.seq.sort() self.assertEqual(self.seq, range(10)) # should raise an exception for an immutable sequence self.assertRaises(TypeError, random.shuffle, (1,2,3)) def test_choice(self): element = random.choice(self.seq) self.assertTrue(element in self.seq) def test_sample(self): with self.assertRaises(ValueError): random.sample(self.seq, 20) for element in random.sample(self.seq, 5): self.assertTrue(element in self.seq) if __name__ == \u0026#39;__main__\u0026#39;: unittest.main() Golang Go è¯­è¨€æä¾›äº† testing åŒ… å’Œ go test å‘½ä»¤ ç”¨äºå•å…ƒæµ‹è¯•ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ Golang çš„å•å…ƒæµ‹è¯•æ˜¯å’Œè¢«æµ‹å•å…ƒåœ¨ç›¸åŒæ–‡ä»¶å¤¹ä¸‹ï¼Œä½¿ç”¨ xxxx_test.go æ–¹å¼å‘½åæ–‡ä»¶ï¼Œå¹¶ä¸”è¦æ±‚æµ‹è¯•æ–¹æ³•ä»¥ Test å¼€å¤´ã€‚\næ¯”å¦‚ md5 å®˜æ–¹åº“çš„å•å…ƒæµ‹è¯•å°±å¯ä»¥åœ¨ http://golang.org/src/pkg/crypto/md5/ æ‰¾åˆ°ã€‚\nObjective-C Xcode åŸç”Ÿå†…ç½®äº†ä¸€ä¸ªå•å…ƒæµ‹è¯•å·¥å…·ï¼Œåœ¨åˆ›å»ºå·¥ç¨‹æ—¶å‹¾é€‰å³å¯ã€‚åªè¯´è¯´è¿™ä¸ªå§ã€‚ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹æ˜¯ä¹Ÿæ˜¯å·² test å¼€å¤´çš„å‡½æ•°ï¼Œåœ¨ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨è¿›è¡Œã€‚\nå¦å¤–ï¼Œä¹Ÿæœ‰äººåˆ†äº«äº†ä¸€äº› å•å…ƒæµ‹è¯•çš„ä¾‹å­ å¯ä¾›å‚è€ƒã€‚\n","date":"2014-01-26T16:21:00Z","permalink":"https://www.4async.com/2014/01/2014-01-26-unit-test/","title":"å…³äºå†™ç¨‹åºçš„ä¸€ç‚¹æƒ³æ³•ï¼šå•å…ƒæµ‹è¯•"},{"content":"OSX ä¸‹é¢æ·»åŠ å¼€æœºé€‰é¡¹æ€ä¹ˆåŠ å‘¢ï¼Ÿè¿™æ˜¯ä¸ªé—®é¢˜ã€‚ç³»ç»Ÿæä¾›äº†ä¸€ä¸ª LaunchDaemon çš„ç©æ„ï¼Œç”¨äºæä¾›è¿™ä¸ªåŠŸèƒ½ã€‚ç›¸å…³çš„å‘½ä»¤æ˜¯ launchd å’Œ launchctl ä¸¤ä¸ªå‘½ä»¤ã€‚\nlaunch daemon çš„é…ç½®æ–‡ä»¶æ˜¯ä¿å­˜åœ¨ / System/Library/LaunchDaemons / å’Œ / Library/LaunchDaemons / æ–‡ä»¶å¤¹ä¸‹ã€‚å¦‚æœéœ€è¦æŒ‡å®šç‰¹å®šç”¨æˆ·çš„é…ç½®ï¼Œåˆ™å¯ä»¥æ”¾åœ¨~/Library/LaunchAgentsã€/Library/LaunchAgents æˆ–è€… / System/Library/LaunchAgents ä¸‹ã€‚åŒºåˆ«ä¸ºï¼Œæ˜¯å¦ç”¨æˆ·ç™»å½•ä¹‹åæ‰§è¡Œè¿˜æ˜¯å†…æ ¸åˆå§‹åŒ–å®Œæˆåæ‰§è¡Œã€‚\nå…·ä½“çš„æ‰§è¡Œå‘½ä»¤å¾ˆç®€å•\n sudo launchctl load \u0026lt;plist file\u0026gt; #åŠ è½½é…ç½® sudo launchctl unload \u0026lt;file\u0026gt; sudo launchctl start \u0026lt;bundleid\u0026gt; sudo launchctl stop \u0026lt;bundleid\u0026gt; ä¸‹é¢æ˜¯ä¸€ä¸ªé…ç½®çš„å…·ä½“ç¤ºä¾‹ï¼Œç”¨ shadowsocks ä¸ºä¾‹ï¼š\n \u0026lt;?xml version=\u0026quot;1.0\u0026quot;encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE plist PUBLIC\u0026quot;-//Apple//DTD PLIST 1.0//EN\u0026quot;\u0026quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd\u0026quot;\u0026gt; \u0026lt;plist version=\u0026quot;1.0\u0026quot;\u0026gt; \u0026lt;dict\u0026gt; \u0026lt;key\u0026gt;Label\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;com.example.shadowsocks\u0026lt;/string\u0026gt;\u0026lt;!-- è¿™ä¸ªåå­—å¿…é¡»å’Œæ–‡ä»¶åä¸€è‡´ --\u0026gt; \u0026lt;key\u0026gt;ProgramArguments\u0026lt;/key\u0026gt; \u0026lt;array\u0026gt; \u0026lt;string\u0026gt;/usr/local/bin/sslocal\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;-c\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;/Users/charles/Projects/shadowsocks-config/config.json\u0026lt;/string\u0026gt; \u0026lt;/array\u0026gt; \u0026lt;key\u0026gt;KeepAlive\u0026lt;/key\u0026gt;\u0026lt;!-- åå°ä¿æŒè¿è¡Œ --\u0026gt; \u0026lt;true/\u0026gt; \u0026lt;key\u0026gt;RunAtLoad\u0026lt;/key\u0026gt;\u0026lt;!-- åŠ è½½æ—¶å€™è¿è¡Œ --\u0026gt; \u0026lt;true/\u0026gt; \u0026lt;key\u0026gt;UserName\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;charles\u0026lt;/string\u0026gt;\u0026lt;!-- æ‰§è¡Œç”¨æˆ· --\u0026gt; \u0026lt;/dict\u0026gt; \u0026lt;/plist\u0026gt; è¿™ä¸ªæˆ‘ä»¬è‡ªå·±ç”¨æˆ·ç”¨çš„ï¼Œæ”¾åœ¨~/Library/LaunchAgents è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œã€‚æ‰§è¡Œ\nlaunchctl load ~/Library/LaunchAgents/com.example.shadowsocks.plist  å³å¯ã€‚\nå¦‚æœå‡ºç°é”™è¯¯ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ plutil -lint å…ˆåˆ¤æ–­æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚\nå‚è€ƒæ–‡æ¡£\n[1] Daemons and Services Programming Guide\n","date":"2014-01-23T15:00:00Z","permalink":"https://www.4async.com/2014/01/2014-01-23-launch-daemons-configure-mac-os-x/","title":"é€šè¿‡ LaunchDaemon å®ç° OSX ä¸‹çš„è‡ªåŠ¨å¯åŠ¨"},{"content":"[UPDATE 2014-01-23]\nè§£å†³ pyOpenSSL çš„é—®é¢˜ä¹Ÿä¸ä¸€å®šéå¾—ä½¿ç”¨å‡çº§ OpenSSL çš„æ–¹å¼ï¼Œç”±äº OpenSSL å…³è”é¢å¤ªå¹¿ï¼Œå®é™…ä¸Šå¯ä»¥é‡‡ç”¨å®‰è£…æ–°ç‰ˆ OpenSSLï¼Œåœ¨å®‰è£… pyOpenSSL çš„æ—¶å€™æŒ‡å®š include å’Œ libs çš„æ–¹å¼æ¥æŒ‡å®šä½¿ç”¨ç‰ˆæœ¬çš„ OpenSSLã€‚å…·ä½“æ”¹ä¸€ä¸‹ setup.py ä¸­çš„å…·ä½“å¯¹åº”å‚æ•°å³å¯ã€‚\nPSS: é‡è¦çš„æ”¾åœ¨å¼€å¤´ï¼Œå‡çº§ OpenSSL å¯¹ç³»ç»Ÿå½±å“è¾ƒå¤§ï¼Œæ¯”å¦‚ OpenSSH æ— æ³•æ­£å¸¸å·¥ä½œï¼Œç®—æ˜¯å¾—åˆ°çš„ä¸€ä¸ªæ•™è®­ï¼Œè®°å¾—åŒæ­¥æ›´æ–°ç›¸å…³ä½¿ç”¨åˆ° OpenSSL çš„è½¯ä»¶\nä¹‹å‰æ¯”è¾ƒæŒ«çš„å¾ˆå°‘åœ¨ 64 ä½ç³»ç»Ÿä¸Šç¼–è¯‘ä¸œè¥¿ï¼Œç»å¸¸ç”¨çš„æœåŠ¡å™¨éƒ½æ˜¯ x86 çš„ VPSã€‚ä»Šå¤©å› ä¸ºé¡¹ç›®éœ€è¦å®‰è£… mitmproxyã€‚è¿™ç©æ„å¯¹ pyOpenSSL çš„éœ€æ±‚æ˜¯ 0.13 ä»¥ä¸Šç‰ˆæœ¬ï¼Œéšæ€§è¦æ±‚ OpenSSL ä¸º 0.9.8f åŠä»¥ä¸Šç‰ˆæœ¬ã€‚æ€å¥ˆä½•æœåŠ¡å™¨ä¸Šæ˜¯ 0.9.8e ç‰ˆæœ¬ã€‚å› æ­¤éœ€è¦å¯¹ OpenSSL è¿›è¡Œå‡çº§ã€‚å› ä¸ºå„ç§åŸå› ï¼Œå‡çº§æ˜¯åœ¨æºç ç¼–è¯‘çŠ¶æ€ä¸‹è¿›è¡Œçš„ã€‚\nç¼–è¯‘å€’æ˜¯æŒºé¡ºç•…çš„ï¼Œ./config ä¸€ä¸‹ï¼Œç„¶åç›´æ¥ make \u0026amp;\u0026amp; make installï¼Œæ›¿æ¢ä¸‹ç³»ç»Ÿçš„å¤´æ–‡ä»¶å’Œ lib æ–‡ä»¶ã€‚\nç„¶åå¼€å§‹å®‰è£… pyOpenSSLã€‚è¿™æ­¥ä¹Ÿæ²¡ä»€ä¹ˆé”™è¯¯æç¤ºï¼Œå¦‚æœå®‰è£…å‡ºé”™ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯ OpenSSL çš„ç‰ˆæœ¬ä¸å¯¹ã€‚\nç„¶åæ‰§è¡Œä»¥ä¸‹ mitmproxyï¼Œæç¤º pyOpenSSL çš„ SSL.so æ— æ³•æ‰¾ â€œSSL_get_servernameâ€ çš„å¼•ç”¨ã€‚Whatï¼Ÿç¼–è¯‘æ²¡é—®é¢˜è¿è¡Œå´æç¤ºå‡ºé”™äº†ï¼Œorzã€‚\nldd SSL.so çœ‹ä¸‹è¯¥æ–‡ä»¶çš„å¼•ç”¨å…³ç³»ï¼Œå‘ç°å¼•ç”¨äº† lib64 çš„ libssl.so.6 å’Œ libcrypto.so.6 æ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯ openssl çš„ shared libraryã€‚åˆ‡æ¢åˆ°é»˜è®¤çš„ OpenSSL ç›®å½•ä¸‹ / usr/local/ssl/lib / æ–‡ä»¶ä¸‹ï¼Œå‘ç°å¹¶æ²¡æœ‰ç”Ÿæˆ so æ–‡ä»¶ã€‚åŸå› å¾ˆæ˜æ˜¾äº†ï¼Œæ˜¯å› ä¸ºç”Ÿæˆ OpenSSL çš„æ–¹å¼æ˜¯é‡‡ç”¨é»˜è®¤çš„ static æ–¹å¼ã€‚\n./config shared è¿™æ ·å°±æ²¡æœ‰é—®é¢˜äº†ã€‚\nå¦å¤–è¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹æ˜¯åœ¨ 64 ä½ç³»ç»Ÿä¸‹é»˜è®¤çš„ lib ç›®å½•æ˜¯ lib64 è€Œä¸æ˜¯ libï¼Œæœ€å¼€å§‹æˆ‘è¿˜æ›¿æ¢é”™äº†ï¼Œè¿˜å¥½åŠæ—¶å‘ç°äº†ã€‚\nPS: æ¯æ¬¡ Markdown å†™æ–‡ç« ï¼Œå¸¦ä¸‹åˆ’çº¿çš„æ€»æ˜¯å¿˜è®°è¯¥ï¼Œè¦å›æ¥ä¿®ä¸€ä¸‹ï¼Œè›‹ç–¼ã€‚\n","date":"2014-01-15T18:05:00Z","permalink":"https://www.4async.com/2014/01/2014-01-15-openssl-and-pyopenssl/","title":"OpenSSL å’Œ pyOpenSSL é‚£ç‚¹äº‹"},{"content":"æƒé™çš„é‚£ç‚¹äº‹å„¿ æ£€æŸ¥ç¨‹åºé—®é¢˜ï¼Œé™¤äº†é…ç½®æ–‡ä»¶æœ‰æ²¡æœ‰é”™ä»¥å¤–ï¼Œè¿˜éœ€è¦æ£€æŸ¥ä¸€ä¸‹æƒé™ä»€ä¹ˆçš„åŸå› ã€‚é™¤äº†ç”¨æˆ·ç»„ä»¥å¤–ï¼Œè¿˜éœ€è¦å…³æ³¨æ–‡ä»¶æè¿°çš„é…ç½®ã€‚ä¸¤ä¸ªå‘½ä»¤åˆ†åˆ«æ˜¯\nchown chmod å¤šç•™ç‚¹å¿ƒçœ¼æ€»æ²¡åå¤„\nldconfig çš„é—®é¢˜ ç»å¸¸ä¼šç¼–è¯‘ä¸€äº›å¸¸ç”¨çš„åº“æ–‡ä»¶ä¾›å…¶ä»–çš„æ–‡ä»¶ä½¿ç”¨ã€‚æ¯”å¦‚ luajitï¼Œä»Šå¤©å®‰è£…å®Œæˆä¹‹åï¼Œç¼–è¯‘äº†ä¸€ä¸ªä¾èµ–çš„ç¨‹åºï¼Œä½†æ˜¯æ‰§è¡Œç¨‹åºå´å‘ç°æç¤ºå¯¹åº”çš„ so æ–‡ä»¶æ— æ³•æ‰¾åˆ°ã€‚\nåæ¥æˆ‘çµæœºä¸€åŠ¨ï¼Œè™½ç„¶ so æ–‡ä»¶åœ¨ ldcache ä¸­äº†ï¼Œä½†æ˜¯é‡æ–°ä½¿ç”¨ ldconfig å‘½ä»¤å°±é‡æ–° recache ä¸€ä¸‹å°±è¡Œäº†ã€‚\nçœ‹æ¥ä¸è§å¾—æ‰€æœ‰çš„éƒ½é‚£ä¹ˆé è°±å°±æ˜¯äº†ã€‚ä¹‹å‰ç¼–è¯‘ zmap ä¹Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œä¸€ç›´å¾ˆå¥‡æ€ª json åº“çš„ so æ–‡ä»¶åœ¨ ldconf æ–‡ä»¶ä¸­ï¼Œä¸ºä»€ä¹ˆæ‰§è¡Œ zmap å´æç¤ºæ— æ³•æ‰¾åˆ°ï¼Œçœ‹æ¥ä¹Ÿæ˜¯ç›¸åŒçš„åŸå› äº†ã€‚\n","date":"2014-01-12T00:20:00Z","permalink":"https://www.4async.com/2014/01/2014-01-12-something-details/","title":"ä»Šå¤©å­¦åˆ°çš„å‡ ä»¶äº‹"},{"content":"ç°åœ¨æ¥å†™ cross_fuzz ä¼¼ä¹æ˜¯æœ‰ç‚¹æ™šäº†ï¼Œæ¯•ç«ŸåŸºæœ¬ä¸Šå¾ˆå¤šæ—¶å€™ cross_fuzz å·²ç»å¹¿æ³›åº”ç”¨äº DOM fuzz ä¸­äº†ã€‚æ¯”å¦‚ Chromium ä¸­å°±å†…ç½®äº† cross_fuzz å·¥å…·ã€‚ä¸è¿‡è¯´å›æ¥ï¼Œæ¯•ç«Ÿå°±æ˜¯ Google è‡ªå·±äººåšçš„ä¸æ˜¯ã€‚\næœ€æ–°çš„ä»£ç  (2011 å¹´æ›´æ–°) å¯ä»¥åœ¨ï¼šhttp://lcamtuf.coredump.cx/cross_fuzz/ æ‰¾åˆ°ã€‚\nåŸºæœ¬è®¾è®¡é€»è¾‘ cross_fuzz å°±æ˜¯ä¸€ä¸ª HTML æ–‡ä»¶ï¼Œå› æ­¤çœ‹èµ·æ¥å…¶å®å¹¶ä¸éº»çƒ¦ï¼šç®€å•çš„è¯´ï¼Œå°±æ˜¯ä¸åœçš„æ‰“å¼€ä¸¤ä¸ªçª—å£æ˜¾ç¤ºä¸åŒçš„ HTML/XHTML/SVG/swf ç­‰ç­‰å†…å®¹ï¼ˆå½“ç„¶ï¼Œå¯ä»¥è‡ªå·±æ·»åŠ ï¼‰ï¼Œé€šè¿‡ä¸åŒçš„ DOM æ“ä½œï¼ˆè®¿é—®å¯¹è±¡ã€å›æ”¶æ“ä½œï¼‰ç­‰ç­‰å°è¯•å‡ºå‘ UAF ä¹‹ç±»çš„é—®é¢˜ã€‚\n 1. Open two windows with documents of any (DOM-enabled) type. Simple HTML, XHTML, and SVG documents are randomly selected as targets by default â€“ although any other, possibly plugin-supported formats could be targeted instead. 2. Crawl DOM hierarchy of the first document, collecting encountered object references for later reuse. Visited objects and collected references are tagged using an injected property to avoid infinite recursion; a secondary blacklist is used to prevent navigating away or descending into the master window. Critically, random shuffling and recursion fanout control are used to ensure good coverage. 3. Repeat DOM crawl, randomly tweaking encountered object properties by setting them to a one of the previously recorded references (or, with some probability, to one of a handful of hardcoded â€œinterestingâ€ values). 4. Repeat DOM crawl, randomly calling encountered object methods. Call parameters are synthesized using collected references and â€œinterestingâ€ values, as noted above. If a method returns an object, its output is subsequently crawled and tweaked in a similar manner. 5. Randomly destroy first document using one of the several possible methods, toggle garbage collection. 6. Perform the same set of crawl \u0026amp; tweak operations for the second document, but use references collected from the first document for overwriting properties and calling methods in the second one. 7. Randomly destroy document windows, carry over a percentage of collected references to the next fuzzing cycle. ä½¿ç”¨æ–¹æ³• ä½¿ç”¨å¾ˆç®€å•ï¼Œä»¥ chrome ä¸ºä¾‹ï¼š\nchrome --disable-popup-blocking --no-first-run --user-data-dir=$TEMPDIR --allow-file-access-from-files --noerrdialogs --disable-hang-monitor file://`pwd`/third_party/cross_fuzz/cross_fuzz_randomized_20110105_seed.html#1234  å…¶ä¸­ 1234 æ˜¯éšæœºçš„ seedï¼Œå¯ä»¥è‡ªè¡Œæ›´æ¢ã€‚ie ä¹Ÿæ˜¯ç›¸åŒçš„ä½¿ç”¨æ–¹æ³•ï¼Œè®°å¾—å…è®¸å¼¹å‡ºçª—å£å³å¯ã€‚\nå®é™…è¿è¡Œæ•ˆæœ ç®€å•æ‹¿ç€è·‘äº†ä¸€ä¸‹ XP/IE8ï¼Œè¿˜æ˜¯æœ‰ä¸€äº›å°‘é‡ crashï¼Œå¹¶ä¸æ˜¯å•çº¯çš„ IE é—®é¢˜ï¼Œä½†æ˜¯è¯´æ˜å‘ç°æ•ˆæœè¿˜æ˜¯ä¸é”™çš„ï¼Œå¯¹æ¯”äº†ä¸€ä¸‹ä¹‹å‰çš„ IE7 xdayï¼Œæ©ï¼Œæ•ˆæœè¿˜æ˜¯å·®ä¸€äº›æ‰æ˜¯ã€‚\n","date":"2014-01-07T15:00:00Z","permalink":"https://www.4async.com/2014/01/2014-01-07-web-browser-cross-fuzz/","title":"æµè§ˆå™¨ fuzz å·¥å…· cross_fuzz"},{"content":"å‰é¢çœ‹è¿‡çš„ NSConcreteGobalBlock å…¶å®åœ¨å®é™…åº”ç”¨é‡Œæ˜¯å¹¶ä¸æ˜¯å¤ªå¤šçš„æƒ…å†µï¼Œç›¸å¯¹æ¥è¯´ï¼Œæ¥ä¸‹æ¥è¦æåˆ°çš„ NSConcreteStackBlock åˆ™æ˜¯ä¼šç»å¸¸é‡åˆ°çš„æƒ…å†µã€‚\nä»æºç çœ‹ NSConcreteStackBlock è¿˜æ˜¯å…ˆä»ä»£ç æ¥çœ‹ï¼š\n #include \u0026lt;stdio.h\u0026gt; int main(){ int a = 1; int (^block)(void) = ^{printf(\u0026quot;%d\\n\u0026quot;, a); return a; }; int b = block(); printf(\u0026quot;%d\\n\u0026quot;, b); return 0; } ç¿»è¯‘æˆ C++ ä»£ç åˆ™æ˜¯ï¼š\n struct __block_impl { void *isa; int Flags; int Reserved; void *FuncPtr; }; struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; int a; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int _a, int flags=0) : a(_a) { impl.isa = \u0026amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; } }; static int __main_block_func_0(struct __main_block_impl_0 *__cself) {int a = __cself-\u0026gt;a; // bound by copy printf(\u0026quot;%d\\n\u0026quot;, a); return a; } static struct __main_block_desc_0 { size_t reserved; size_t Block_size; } __main_block_desc_0_DATA = {0, sizeof(struct __main_block_impl_0)}; int main(){ int a = 1; int (*block)(void) = (int (*)())\u0026amp;__main_block_impl_0((void *)__main_block_func_0, \u0026amp;__main_block_desc_0_DATA, a); int b = ((int (*)(__block_impl *))((__block_impl *)block)-\u0026gt;FuncPtr)((__block_impl *)block); printf(\u0026quot;%d\\n\u0026quot;, b); return 0; } ä»£ç å…·ä½“å’Œ NSConcreteGobalBlock ç›¸æ¯”è¿˜æ˜¯æœ‰ä¸€äº›å˜åŒ–ï¼Œå¦‚ï¼Œç”±äºä½¿ç”¨å±€éƒ¨å˜é‡ aï¼Œåœ¨ block ä¸­åˆ™æ˜¯å¯¹ a å˜é‡è¿›è¡Œäº†æ‹·è´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ block ä¸­ä¿®æ”¹æŸä¸€å˜é‡å¹¶ä¸ä¼šå½±å“ block ä¹‹å¤–çš„ç›¸åŒå˜é‡ã€‚å¦å¤–ä¸€ä¸ªæ˜¯å…³äºè¿”å›å€¼çš„å®šä¹‰ï¼Œå¯¹å‡½æ•°çš„å¼ºåˆ¶ç±»å‹è½¬åŒ–è€Œæ¥ï¼Œå…³äºè¿™ä¸€å—çš„ä¸œè¥¿ï¼Œä¼šåœ¨é€†å‘åˆ†ææ—¶åœ¨è¿›è¡Œå¯¹æ¯”ã€‚å¯¹äºè°ƒç”¨ä¼ å…¥çš„æŒ‡é’ˆ cselfï¼Œåˆ™æ˜¯åœ¨å¯¹ main_block_impl_0 ç»“æ„çš„è½¬åŒ–ï¼Œæ³¨æ„åœ¨å®šä¹‰æ—¶ï¼Œæ·»åŠ äº† a çš„ä¼ å…¥å‚æ•°ï¼Œä»è€Œè·å–åˆ°å‚æ•°å†…å®¹ã€‚\nä»é€†å‘çœ‹ NSConcreteStackBlock x86_64:\n __text:0000000100000E60 _main proc near __text:0000000100000E60 __text:0000000100000E60 var_4C = dword ptr -4Ch __text:0000000100000E60 var_48 = qword ptr -48h __text:0000000100000E60 var_3C = dword ptr -3Ch __text:0000000100000E60 var_38 = qword ptr -38h __text:0000000100000E60 var_30 = dword ptr -30h __text:0000000100000E60 var_2C = dword ptr -2Ch __text:0000000100000E60 var_28 = qword ptr -28h __text:0000000100000E60 var_20 = qword ptr -20h __text:0000000100000E60 var_18 = dword ptr -18h __text:0000000100000E60 var_10 = qword ptr -10h __text:0000000100000E60 var_8 = dword ptr -8 __text:0000000100000E60 var_4 = dword ptr -4 __text:0000000100000E60 __text:0000000100000E60 push rbp __text:0000000100000E61 mov rbp, rsp __text:0000000100000E64 sub rsp, 50h __text:0000000100000E68 lea rdi, aD ; \u0026quot;%d\\n\u0026quot; __text:0000000100000E6F lea rax, [rbp+var_38] __text:0000000100000E73 lea rcx, ___block_descriptor_tmp __text:0000000100000E7A lea rdx, ___main_block_invoke __text:0000000100000E81 mov rsi, cs:__NSConcreteStackBlock_ptr __text:0000000100000E88 mov [rbp+var_4], 0 __text:0000000100000E8F mov [rbp+var_8], 1 __text:0000000100000E96 mov [rbp+var_38], rsi __text:0000000100000E9A mov [rbp+var_30], 40000000h __text:0000000100000EA1 mov [rbp+var_2C], 0 __text:0000000100000EA8 mov [rbp+var_28], rdx __text:0000000100000EAC mov [rbp+var_20], rcx __text:0000000100000EB0 mov r8d, [rbp+var_8] __text:0000000100000EB4 mov [rbp+var_18], r8d __text:0000000100000EB8 mov [rbp+var_10], rax __text:0000000100000EBC mov rax, [rbp+var_10] __text:0000000100000EC0 mov rcx, rax __text:0000000100000EC3 mov [rbp+var_48], rdi __text:0000000100000EC7 mov rdi, rcx __text:0000000100000ECA call qword ptr [rax+10h] __text:0000000100000ECD mov [rbp+var_3C], eax __text:0000000100000ED0 mov esi, [rbp+var_3C] __text:0000000100000ED3 mov rdi, [rbp+var_48] ; char * __text:0000000100000ED7 mov al, 0 __text:0000000100000ED9 call _printf __text:0000000100000EDE mov esi, 0 __text:0000000100000EE3 mov [rbp+var_4C], eax __text:0000000100000EE6 mov eax, esi __text:0000000100000EE8 add rsp, 50h __text:0000000100000EEC pop rbp __text:0000000100000EED retn __text:0000000100000EED _main endp ARM:\n __text:00002F0C _main __text:00002F0C __text:00002F0C var_34 = -0x34 __text:00002F0C var_30 = -0x30 __text:00002F0C var_2C = -0x2C __text:00002F0C var_28 = -0x28 __text:00002F0C var_24 = -0x24 __text:00002F0C var_20 = -0x20 __text:00002F0C var_1C = -0x1C __text:00002F0C var_18 = -0x18 __text:00002F0C var_14 = -0x14 __text:00002F0C var_10 = -0x10 __text:00002F0C var_C = -0xC __text:00002F0C var_8 = -8 __text:00002F0C __text:00002F0C PUSH {R4,R7,LR} __text:00002F0E ADD R7, SP, #4 __text:00002F10 SUB SP, SP, #0x30 __text:00002F12 MOV R0, #(aD - 0x2F1E) ; \u0026quot;%d\\n\u0026quot; __text:00002F1A ADD R0, PC ; \u0026quot;%d\\n\u0026quot; __text:00002F1C ADD R1, SP, #0x34+var_28 __text:00002F1E MOV R2, #(___block_descriptor_tmp - 0x2F2A) ; ___block_descriptor_tmp __text:00002F26 ADD R2, PC ; ___block_descriptor_tmp __text:00002F28 MOV R3, #(___main_block_invoke+1 - 0x2F34) ; ___main_block_invoke __text:00002F30 ADD R3, PC ; ___main_block_invoke __text:00002F32 MOV R9, #0 __text:00002F3A MOV R12, #0x40000000 __text:00002F42 MOV LR, #(__NSConcreteStackBlock_ptr - 0x2F4E) ; __NSConcreteStackBlock_ptr __text:00002F4A ADD LR, PC ; __NSConcreteStackBlock_ptr __text:00002F4C LDR.W LR, [LR] ; __NSConcreteStackBlock __text:00002F50 MOVS R4, #1 __text:00002F56 STR.W R9, [SP,#0x34+var_8] __text:00002F5A STR R4, [SP,#0x34+var_C] __text:00002F5C STR.W LR, [SP,#0x34+var_28] __text:00002F60 STR.W R12, [SP,#0x34+var_24] __text:00002F64 STR.W R9, [SP,#0x34+var_20] __text:00002F68 STR R3, [SP,#0x34+var_1C] __text:00002F6A STR R2, [SP,#0x34+var_18] __text:00002F6C LDR R2, [SP,#0x34+var_C] __text:00002F6E STR R2, [SP,#0x34+var_14] __text:00002F70 STR R1, [SP,#0x34+var_10] __text:00002F72 LDR R1, [SP,#0x34+var_10] __text:00002F74 MOV R2, R1 __text:00002F76 LDR R1, [R1,#0xC] __text:00002F78 STR R0, [SP,#0x34+var_30] __text:00002F7A MOV R0, R2 __text:00002F7C BLX R1 __text:00002F7E STR R0, [SP,#0x34+var_2C] __text:00002F80 LDR R1, [SP,#0x34+var_2C] __text:00002F82 LDR R0, [SP,#0x34+var_30] ; char * __text:00002F84 BLX _printf __text:00002F88 MOVS R1, #0 __text:00002F8E STR R0, [SP,#0x34+var_34] __text:00002F90 MOV R0, R1 __text:00002F92 ADD SP, SP, #0x30 __text:00002F94 POP {R4,R7,PC} __text:00002F94 ; End of function _main ","date":"2014-01-03T15:00:00Z","permalink":"https://www.4async.com/2014/01/2014-01-03-something-about-block-part-two/","title":"è°ˆè°ˆ block Part 2"},{"content":"Block æ¦‚è¿° Block æ˜¯ Apple æä¾›çš„ä¸€ç§é—­åŒ…å®ç°ï¼Œæ¯”è¾ƒæ–¹ä¾¿å®ç°ä¸€äº›å‡½æ•°åµŒå¥—å®ç°çš„åŠŸèƒ½ã€‚Block åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š\n NSConcreteGlobalBlock NSConcreteStackBlock NSConcreteMallocBlock  è¿™ä¸‰ç§ç±»å‹åˆ†åˆ«å¯¹åº”äº†ä¸‰ç§ä¸åŒçš„ Block ç±»å‹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨å¯ç”¨äº† ARC ä¹‹åï¼ŒNSConcreteStackBlock ä¼šè½¬æ¢ç±»å‹ä¸º NSConcreteMallocBlockã€‚\næ¢ç§æ¯”è¾ƒå®¹æ˜“çš„ç†è§£çš„è¯´æ³•ï¼š\n  åœ¨é ARC ä¸‹ï¼ŒLLVM ç¼–è¯‘ä¸‹æ²¡æœ‰è®¿é—®å±€éƒ¨å˜é‡çš„ Block åº”è¯¥æ˜¯ NSConcreteGlobalBlock ç±»å‹çš„ï¼Œè®¿é—®äº†å±€éƒ¨å˜é‡çš„ Block æ˜¯ NSConcreteStackBlock ç±»å‹çš„ã€‚\n  åœ¨ ARC ä¸‹ï¼Œè®¿é—®äº†å±€éƒ¨å˜é‡çš„ Block æ˜¯ NSConcreteMallocBlock ç±»å‹çš„ï¼Œæœªè®¿é—®å±€éƒ¨å˜é‡çš„ Block æ˜¯ NSConcreteGlobalBlock ç±»å‹çš„ã€‚\n  å…·ä½“çš„å®ç°ä»£ç å¯ä»¥å‚è€ƒ llvm çš„ BlockRuntimeã€‚\nå¯¹äºç ”ç©¶ block çš„å…·ä½“ä»£ç ç¿»è¯‘ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ clang çš„ rewrite-objc åŠŸèƒ½ï¼Œå°† OC æ–‡ä»¶è½¬æ¢æˆ cpp æ–‡ä»¶ã€‚æ¯”å¦‚ï¼š\nclang -rewrite-objc blocktest.c è¿™æ ·å°±å¯ä»¥ç”Ÿæˆå¯¹åº”çš„ blocktest.cpp æ–‡ä»¶ã€‚\nä»æºç çœ‹ NSConcreteGlobalBlock é¦–å…ˆå…ˆçœ‹ä¸€ä¸‹ NSConcreteGlobalBlock çš„ä»£ç ï¼Œä»ç®€å•çš„å¼€å§‹ï¼š\n#include \u0026lt;stdio.h\u0026gt; int main() {^{printf(\u0026#34;Hello World!\\n\u0026#34;);}(); return 0; } ç¿»è¯‘ä¹‹åçš„ä»£ç ï¼ˆç²¾ç®€ä»…åŒ…å«æ‰€æœ‰å¿…é¡»ä»£ç ï¼‰ï¼š\nstruct __block_impl { void *isa; int Flags; int Reserved; void *FuncPtr; }; struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int flags=0) { impl.isa = \u0026amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; } }; static void __main_block_func_0(struct __main_block_impl_0 *__cself) {printf(\u0026#34;Hello World!\\n\u0026#34;);} static struct __main_block_desc_0 { size_t reserved; size_t Block_size; } __main_block_desc_0_DATA = {0, sizeof(struct __main_block_impl_0)}; int main() {(void (*)())\u0026amp;__main_block_impl_0((void *)__main_block_func_0, \u0026amp;__main_block_desc_0_DATA)(); return 0; } ä¸»è¦çš„ Block ä»£ç è¢«ç¿»è¯‘æˆä¸ºäº†ä¸€ä¸ªæŒ‡é’ˆå‡½æ•°è°ƒç”¨ï¼Œ__main_block_impl_0 æ˜¯ä¸€ä¸ªå®šä¹‰è¿‡çš„ç»“æ„ï¼Œæ¯ä¸ª Block çš„ç±»å‹æ˜¯å›ºå®šçš„ã€‚å…¶ä¸­ isa æ˜¯æŒ‡æ˜çš„ Block ç±»å‹ï¼ŒFuncPtr åˆ™æ˜¯å‡½æ•°æŒ‡é’ˆã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ impl.isa å¡«å†™çš„æ˜¯ NSConcreteStackBlockï¼Œä½†æ˜¯å®é™…åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œè¿™é‡Œè¿˜æ˜¯ä¼šè¢«å¤„ç†æˆä¸º NSConcreteGlobalBlockã€‚\nä»åæ±‡ç¼–çœ‹ NSConcreteGlobalBlock (x86_64):\n __text:0000000100000EC0 _main proc near __text:0000000100000EC0 __text:0000000100000EC0 var_8 = dword ptr -8 __text:0000000100000EC0 var_4 = dword ptr -4 __text:0000000100000EC0 __text:0000000100000EC0 push rbp __text:0000000100000EC1 mov rbp, rsp __text:0000000100000EC4 sub rsp, 10h __text:0000000100000EC8 mov eax, 0 __text:0000000100000ECD lea rcx, ___block_literal_global __text:0000000100000ED4 mov [rbp+var_4], 0 __text:0000000100000EDB mov rdi, rcx __text:0000000100000EDE mov [rbp+var_8], eax __text:0000000100000EE1 call cs:off_100001050 __text:0000000100000EE7 mov eax, [rbp+var_8] __text:0000000100000EEA add rsp, 10h __text:0000000100000EEE pop rbp __text:0000000100000EEF retn __text:0000000100000EEF _main endp (ARM):\n __text:00002F70 PUSH {R7,LR} __text:00002F72 MOV R7, SP __text:00002F74 SUB SP, SP, #8 __text:00002F76 MOVS R0, #0 __text:00002F7C MOV R1, #(___block_literal_global - 0x2F88) ; ___block_literal_global __text:00002F84 ADD R1, PC ; ___block_literal_global __text:00002F86 MOV R2, R1 __text:00002F88 STR R0, [SP,#0x10+var_C] __text:00002F8A LDR R1, [R1,#(off_3028 - 0x301C)] __text:00002F8C STR R0, [SP,#0x10+var_10] __text:00002F8E MOV R0, R2 __text:00002F90 BLX R1 ; ___main_block_invoke __text:00002F92 LDR R0, [SP,#0x10+var_10] __text:00002F94 ADD SP, SP, #8 __text:00002F96 POP {R7,PC} ä¼šå‘ç°åœ¨è°ƒç”¨ block æ—¶æ˜¯é‡‡ç”¨çš„ç›´æ¥è°ƒç”¨çš„æ–¹å¼ (call/blx)ï¼Œç”±äº NSConcreteGlobalBlock æ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œå› æ­¤è¿™ä¸ªä¹Ÿå°±æ˜¯å…³é”®åœ¨å‚æ•°å¤„ç†æ–¹å¼ä¸Šã€‚\nåœ¨ X64 å¹³å°ä¸Šï¼Œoff_100001050 ä¸­ä¿å­˜çš„å°±æ˜¯ main_block_invokeï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„ blockï¼‰çš„åœ°å€ï¼Œè€Œåœ¨ ARM å¹³å°ä¸Šï¼ŒR1ï¼ˆmain_block_invokeï¼‰åœ°å€æ˜¯åœ¨ LDR R1, [R1,#(off_3028 - 0x301C)] è¿™ä¸€å¥èµ‹å€¼è€Œæ¥ï¼Œå…¶ä¸­ off_3028 æŒ‡å‘çš„å°±æ˜¯ main_block_invoke çš„åœ°å€ã€‚\n\u0026lt;æœªå®Œå¾…ç»­\u0026gt;\n","date":"2014-01-02T14:31:00Z","permalink":"https://www.4async.com/2014/01/2014-01-02-something-about-block-part-one/","title":"è°ˆè°ˆ block Part 1"},{"content":"å¾ˆæ—©ä¹‹å‰å°±å†™è¿‡ä¸€ä¸ª lnmp çš„é…ç½®ï¼Œåæ¥å› ä¸ºå‘ç°äº†æ›´å¥½çš„ lnmp.orgï¼Œå› æ­¤å°±æ”¹ç”¨äº† lnmp å·¥å…·ã€‚ä¸è¿‡å·²ç»å¾ˆé•¿æ—¶é—´å†›å“¥è±†æ²¡æ›´æ–°è¿™ä¸ªå·¥å…·äº†ï¼Œå¾ˆå¤šéœ€è¦è¿›è¡Œæ›´æ–°ï¼Œå› æ­¤è¿™ä¹Ÿæ˜¯æœ¬æ–‡è¯ç”Ÿçš„åŸå› äº†ã€‚å…¨å½“åšè‡ªå·±çš„è®°å½•å§ã€‚\n{% gist 8206547 %}\né€‚ç”¨äº Debian ç³»ç»Ÿï¼Œæ²¡å‡† Ubuntu ç³»ç»Ÿä¹Ÿæ˜¯é€‚ç”¨çš„ã€‚\n","date":"2014-01-01T18:31:00Z","permalink":"https://www.4async.com/2014/01/2014-01-01-build-lnmp-on-debian/","title":"Debian ç³»ç»Ÿä¸‹é…ç½® lnmp"},{"content":"ä¸€ç›´ä»¥æ¥ï¼Œçœ‹ç€ SecureCRT æœ‰ä¸€ä¸ªååˆ†æœ‰ç”¨çš„åŠŸèƒ½ï¼Œclone session å¯ä»¥å…è¾“å…¥å¸å·å¯†ç é‡æ–°å¼€å¯ä¸€ä¸ª ssh çª—å£ï¼Œè¿™æ ·å°±åœ¨ä¸æ–¹ä¾¿ä½¿ç”¨å…¬é’¥ç™»å½•çš„æ—¶å€™éå¸¸æœ‰ç”¨ã€‚\nåœ¨ Mac ä¸‹é¢å¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½å‘¢ï¼Ÿä¹Ÿæ˜¯ååˆ†çš„ç®€å•ï¼š\nè¿›å…¥~/.ssh ç›®å½•ï¼Œåˆ›å»ºåä¸º config çš„æ–‡ä»¶ï¼ˆæœ‰åˆ™ç¼–è¾‘ï¼‰ï¼š\næ·»åŠ ä»¥ä¸‹å†…å®¹\nhost * ControlMaster auto ControlPath ~/.ssh/master-%r@%h:%p è¿™æ ·åœ¨åˆ›å»ºä¸€ä¸ªè¿æ¥ä¹‹åï¼Œå†æ¬¡è¿æ¥å°±å¯ä»¥å®ç°å…è¾“å…¥å¸å·äº†ã€‚\nä½†æ˜¯ç¼ºç‚¹æ˜¯ï¼Œç¬¬ä¸€ä¸ªè¿æ¥ä¸€æ—¦å…³é—­ï¼Œæ‰€æœ‰çš„è¿æ¥éƒ½ä¼šè¢«å…³é—­ã€‚\nå…·ä½“çš„ config æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥å‚è€ƒ http://linux.die.net/man/5/ssh_configã€‚\n","date":"2013-12-27T19:06:00Z","permalink":"https://www.4async.com/2013/12/2013-12-27-mac-ssh-scurecrt-clone-session/","title":"Mac ä¸‹å®ç°ç±» SecureCRT çš„ session clone åŠŸèƒ½"},{"content":"ç¬¬ä¸€æ¬¡è¯•ç”¨ Github Pages æ¥åšé¡µé¢ï¼Œæ„Ÿè§‰æŒºä¸é”™çš„ï¼Œå…ˆè¯•è¯•å’¯ã€‚\ndef print_hi(name) print \u0026#34;hi\u0026#34; print_hi() ","date":"2013-12-27T15:28:30Z","permalink":"https://www.4async.com/2013/12/2013-12-27-first-post/","title":"æµ‹è¯•é¡µé¢"}]