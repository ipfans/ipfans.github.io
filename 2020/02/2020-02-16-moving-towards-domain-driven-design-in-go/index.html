<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="ipfans's Blog" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://www.4async.com').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: true,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="åŸæ–‡ï¼šMoving Towards Domain Driven Design in Go æœ¬æ–‡çš„ç›®çš„æ˜¯å¸®åŠ©æ¼”ç¤ºå½“åº”ç”¨ç¨‹åºéšç€æ—¶é—´ä¸æ–­æ¨ç§»ä¸æ–­æ¼”åŒ–æ—¶ï¼Œæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡å¸®æˆ‘ä»¬è§£å†³å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ä¸€ä¸ªçç¢çš„é¡¹ç›®ç ”ç©¶é¡¹ç›®æ˜¯å¦‚ä½•éšç€æ—¶é—´ä¸€æ­¥æ­¥æ¼”åŒ–çš„ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ï¼Œç¤ºä¾‹ä»£ç å¹¶ä¸èƒ½å¤Ÿç›´æ¥ç¼–è¯‘ï¼Œç”šè‡³æœ‰äº›å¯¼å…¥ä»¥æ¥æ²¡æœ‰å…¨éƒ¨åˆ—å‡ºã€‚è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå‡ºç°ä»€ä¹ˆé—®">
<meta name="keywords" content="Golang">
<meta property="og:type" content="article">
<meta property="og:title" content="è¯‘ï¼šåœ¨Goä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡">
<meta property="og:url" content="https://www.4async.com/2020/02/2020-02-16-moving-towards-domain-driven-design-in-go/index.html">
<meta property="og:site_name" content="ipfans&#39;s Blog">
<meta property="og:description" content="åŸæ–‡ï¼šMoving Towards Domain Driven Design in Go æœ¬æ–‡çš„ç›®çš„æ˜¯å¸®åŠ©æ¼”ç¤ºå½“åº”ç”¨ç¨‹åºéšç€æ—¶é—´ä¸æ–­æ¨ç§»ä¸æ–­æ¼”åŒ–æ—¶ï¼Œæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡å¸®æˆ‘ä»¬è§£å†³å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ä¸€ä¸ªçç¢çš„é¡¹ç›®ç ”ç©¶é¡¹ç›®æ˜¯å¦‚ä½•éšç€æ—¶é—´ä¸€æ­¥æ­¥æ¼”åŒ–çš„ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ï¼Œç¤ºä¾‹ä»£ç å¹¶ä¸èƒ½å¤Ÿç›´æ¥ç¼–è¯‘ï¼Œç”šè‡³æœ‰äº›å¯¼å…¥ä»¥æ¥æ²¡æœ‰å…¨éƒ¨åˆ—å‡ºã€‚è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå‡ºç°ä»€ä¹ˆé—®">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-02-16T13:53:52.970Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="è¯‘ï¼šåœ¨Goä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡">
<meta name="twitter:description" content="åŸæ–‡ï¼šMoving Towards Domain Driven Design in Go æœ¬æ–‡çš„ç›®çš„æ˜¯å¸®åŠ©æ¼”ç¤ºå½“åº”ç”¨ç¨‹åºéšç€æ—¶é—´ä¸æ–­æ¨ç§»ä¸æ–­æ¼”åŒ–æ—¶ï¼Œæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡å¸®æˆ‘ä»¬è§£å†³å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ä¸€ä¸ªçç¢çš„é¡¹ç›®ç ”ç©¶é¡¹ç›®æ˜¯å¦‚ä½•éšç€æ—¶é—´ä¸€æ­¥æ­¥æ¼”åŒ–çš„ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ï¼Œç¤ºä¾‹ä»£ç å¹¶ä¸èƒ½å¤Ÿç›´æ¥ç¼–è¯‘ï¼Œç”šè‡³æœ‰äº›å¯¼å…¥ä»¥æ¥æ²¡æœ‰å…¨éƒ¨åˆ—å‡ºã€‚è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå‡ºç°ä»€ä¹ˆé—®">

<link rel="canonical" href="https://www.4async.com/2020/02/2020-02-16-moving-towards-domain-driven-design-in-go/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>è¯‘ï¼šåœ¨Goä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡ | ipfans's Blog</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b9862358b198078f40d7e1596b7c5968";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ipfans's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-fw fa-sitemap"></i>ç«™ç‚¹åœ°å›¾</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.4async.com/2020/02/2020-02-16-moving-towards-domain-driven-design-in-go/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/363344?v=3&s=460">
      <meta itemprop="name" content="ipfans">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ipfans's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          è¯‘ï¼šåœ¨Goä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-02-16 21:52:00 / ä¿®æ”¹æ—¶é—´ï¼š21:53:52" itemprop="dateCreated datePublished" datetime="2020-02-16T21:52:00+08:00">2020-02-16</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2020/02/2020-02-16-moving-towards-domain-driven-design-in-go/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/02/2020-02-16-moving-towards-domain-driven-design-in-go/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>åŸæ–‡ï¼š<a href="https://www.calhoun.io/moving-towards-domain-driven-design-in-go/" target="_blank" rel="noopener">Moving Towards Domain Driven Design in Go</a></p>
<p>æœ¬æ–‡çš„ç›®çš„æ˜¯å¸®åŠ©æ¼”ç¤ºå½“åº”ç”¨ç¨‹åºéšç€æ—¶é—´ä¸æ–­æ¨ç§»ä¸æ–­æ¼”åŒ–æ—¶ï¼Œæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡å¸®æˆ‘ä»¬è§£å†³å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ä¸€ä¸ªçç¢çš„é¡¹ç›®ç ”ç©¶é¡¹ç›®æ˜¯å¦‚ä½•éšç€æ—¶é—´ä¸€æ­¥æ­¥æ¼”åŒ–çš„ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ï¼Œç¤ºä¾‹ä»£ç å¹¶ä¸èƒ½å¤Ÿç›´æ¥ç¼–è¯‘ï¼Œç”šè‡³æœ‰äº›å¯¼å…¥ä»¥æ¥æ²¡æœ‰å…¨éƒ¨åˆ—å‡ºã€‚è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½ å¯ä»¥éšæ—¶ä¸æˆ‘è”ç³»ï¼Œæˆ‘ä»¬å°†å¯¹é—®é¢˜è¿›è¡Œè°ƒæ•´æˆ–è€…ä½ çš„é—®é¢˜åŠæ—¶è§£ç­”ï¼ˆå¦‚æœå¯ä»¥çš„è¯ï¼‰ã€‚</p>
<a id="more"></a>

<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„èƒŒæ™¯ã€‚æƒ³è±¡ä¸€ä¸‹ä½ åœ¨å·¥ä½œï¼Œè€æ¿è¦æ±‚ä½ åˆ›å»ºä¸€ç§é€šè¿‡GitHub APIå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯çš„æ–¹æ³•ã€‚å…·ä½“ä¸Šè¯´ï¼Œä½ éœ€è¦åˆ©ç”¨ç”¨æˆ·ä¸ªäººè®¿é—®ä»¤ç‰Œï¼ŒæŸ¥æ‰¾è¯¥ç”¨æˆ·åŠå…¶æ‰€æœ‰ç»„ç»‡ã€‚ è¿™æ ·ï¼Œä½ ä»¥åå°±å¯ä»¥æ ¹æ®ä»–ä»¬æ‰€å±çš„ç»„ç»‡æ¥é™åˆ¶ä»–ä»¬çš„è®¿é—®ã€‚</p>
<p><em>æ³¨æ„ï¼šæˆ‘ä»¬è¿™é‡Œä½¿ç”¨è®¿é—®ä»¤ç‰Œæ¥ç®€åŒ–ç¤ºä¾‹ã€‚</em></p>
<p>è¿™å¬èµ·æ¥å¾ˆå®¹æ˜“ï¼Œæ‰€ä»¥ä½ å¯åŠ¨ç¼–è¾‘å™¨å¹¶å®ç°æä¾›æ­¤åŠŸèƒ½çš„<code>github</code>åŒ…ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> github</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  ID    <span class="keyword">string</span></span><br><span class="line">  Email <span class="keyword">string</span></span><br><span class="line">  OrgIDs []<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Client <span class="keyword">struct</span> &#123;</span><br><span class="line">  Key   <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Client)</span> <span class="title">User</span><span class="params">(token <span class="keyword">string</span>)</span> <span class="params">(User, error)</span></span> &#123;</span><br><span class="line">  <span class="comment">// ä¸Github APIè¿›è¡Œäº¤äº’ï¼Œå¹¶è¿”å›ç”¨æˆ·ã€‚å¦‚æœä»–ä»¬åœ¨ä¸€ä¸ªç»„ç»‡ä¸­ï¼Œè¿”å›ç»„ç»‡çš„c.OrgID</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„ï¼šè¿™é‡Œä¸æ˜¯ä½¿ç”¨çœŸå®çš„Github API - è¿™åªæ˜¯ä¸€ä¸ªæ¼”ç¤ºä¾‹å­ã€‚</em></p>
<p>æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦ç»™<code>github</code>åŒ…ç¼–å†™ä¸€äº›ä¸­é—´ä»¶ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨éœ€è¦ä¿æŠ¤çš„HTTP handlerä¸­ä½¿ç”¨è¿™ä¸ªåŒ…ã€‚åœ¨ä¸­é—´ä»¶ä¸­ï¼Œä½ é€šè¿‡å¤´éƒ¨ä¸­çš„basic authä¸­è·å¾—ç”¨æˆ·çš„è®¿é—®ä»¤ç‰Œï¼Œç„¶åè°ƒç”¨Githubçš„ä»£ç æŸ¥æ‰¾ç”¨æˆ·ï¼Œæ£€æŸ¥ä»–ä»¬æ˜¯å¦æ˜¯æ‰€æä¾›ç»„ç»‡çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åç›¸åº”åœ°æˆäºˆæƒé™æˆ–æ‹’ç»è®¿é—®ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mw</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AuthMiddleware</span><span class="params">(client *github.Client, reqOrgID <span class="keyword">string</span>, next http.Handler)</span> <span class="title">http</span>.<span class="title">Handler</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    token, _, ok := r.BasicAuth()</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">      http.Error(w, â€œUnauthorizedâ€, http.StatusUnauthorized)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    user, err := client.User(token)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      http.Error(w, â€œUnauthorizedâ€, http.StatusUnauthorized)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    permit := <span class="literal">false</span></span><br><span class="line">    <span class="keyword">for</span> _, orgID := <span class="keyword">range</span> user.OrgIDs &#123;</span><br><span class="line">      <span class="keyword">if</span> orgId == reqOrgID &#123;</span><br><span class="line">        permit = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> !permit &#123;</span><br><span class="line">      http.Error(w, â€œUnauthorizedâ€, http.StatusUnauthorized)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç”¨æˆ·å·²è®¤è¯ï¼Œæ”¾ä»–ä»¬è¿›æ¥</span></span><br><span class="line">    next.ServeHTTP(w, r)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ å°†è¿™äº›ä»£ç ç»™ä½ çš„åŒäº‹çœ‹ï¼Œä»–ä»¬æ‹…å¿ƒç¼ºä¹æµ‹è¯•ã€‚å…·ä½“çš„è¯´ï¼Œæ²¡æœ‰ä¸€ç§æ–¹æ³•èƒ½å¤ŸéªŒè¯<code>AuthMiddleware</code>èƒ½å¦æŒ‰ç…§é¢„æœŸå·¥ä½œã€‚â€œæ²¡æœ‰é—®é¢˜â€ï¼Œä½ è¯´ï¼Œâ€œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨interfaceä¿è¯æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„æµ‹è¯•å®ƒï¼â€</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mw</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserService <span class="keyword">interface</span> &#123;</span><br><span class="line">  User(token <span class="keyword">string</span>) (github.User, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AuthMiddleware</span><span class="params">(us UserService, reqOrgID <span class="keyword">string</span>, next http.Handler)</span> <span class="title">http</span>.<span class="title">Handler</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    token, _, ok := r.BasicAuth()</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">      http.Error(w, â€œUnauthorizedâ€, http.StatusUnauthorized)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    user, err := us.User(token)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      http.Error(w, â€œUnauthorizedâ€, http.StatusUnauthorized)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    permit := <span class="literal">false</span></span><br><span class="line">    <span class="keyword">for</span> _, orgID := <span class="keyword">range</span> user.OrgIDs &#123;</span><br><span class="line">      <span class="keyword">if</span> orgId == reqOrgID &#123;</span><br><span class="line">        permit = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> !permit &#123;</span><br><span class="line">      http.Error(w, â€œUnauthorizedâ€, http.StatusUnauthorized)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// user is authenticated, let them in</span></span><br><span class="line">    next.ServeHTTP(w, r)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿç”¨æˆ·æœåŠ¡æµ‹è¯•æ­¤ä»£ç ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mock</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserService <span class="keyword">struct</span> &#123;</span><br><span class="line">  UserFn <span class="function"><span class="keyword">func</span><span class="params">(token <span class="keyword">string</span>)</span> <span class="params">(github.User, error)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(us *UserService)</span> <span class="title">Authenticate</span><span class="params">(token <span class="keyword">string</span>)</span> <span class="params">(github.User, error)</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> us.UserFn(token)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºæ¨¡æ‹Ÿç”¨æˆ·æœåŠ¡æœ‰å¾ˆå¤šæ–¹å¼ï¼Œä½†æ˜¯è¿™ä¸ªé€šå¸¸éœ€è¦æµ‹è¯•è®¤è¯æ­£å¸¸é€šè¿‡æ—¶å’Œè®¤è¯å‡ºç°é—®é¢˜æ—¶çš„ä¸åŒæƒ…å†µã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯¹è®¤è¯ä¸­é—´ä»¶å®Œæˆæµ‹è¯•ã€å‘å¸ƒï¼Œç”Ÿæ´»ä¼¼ä¹å¾ˆæ„‰å¿«ã€‚</p>
<p>ç„¶åï¼Œæ‚²å‰§å‘ç”Ÿäº†ã€‚ä½ çš„CEOå¬è¯´å“¥æ–¯æ‹‰ï¼ˆè¯‘è€…æ³¨ï¼šå“¥æ–¯æ‹‰æ¯ç­ä¸–ç•Œï¼Ÿï¼‰æ­£åœ¨å‰å¾€æ—§é‡‘å±±ï¼Œä½ çš„å…¬å¸æ— æ³•åœ¨æœªæ¥ä¸ç¡®å®šçš„æƒ…å†µä¸‹ç»§ç»­ä¾èµ–Githubã€‚å¦‚æœGithubæ•´ä¸ªåŠå…¬å®¤è¢«æ‘§æ¯äº†ï¼Œæ²¡æœ‰å·¥ç¨‹å¸ˆç»§ç»­ç»´æŠ¤è¯¥äº§å“æ€ä¹ˆåŠï¼Ÿä¸ï¼Œå®Œå…¨ä¸èƒ½æ¥å—ï¼</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œè¿˜æœ‰ä¸€å®¶åä¸ºGitLabçš„æ›¿ä»£å…¬å¸ï¼Œä¼¼ä¹åšäº†å¾ˆå¤šç±»ä¼¼GitHubçš„åŠŸèƒ½ï¼Œä¸åŒçš„æ˜¯ä»–ä»¬æ˜¯ä¸€ä¸ªè¿œç¨‹å·¥ä½œå›¢é˜Ÿã€‚è¿™æ„å‘³ç€å“¥æ–¯æ‹‰æ°¸è¿œæ— æ³•åŒæ—¶æ¶ˆç­æ‰€æœ‰å·¥ç¨‹å¸ˆï¼Œå¯¹å—ï¼Ÿ ğŸ‰</p>
<p>é«˜å±‚ä¼¼ä¹è®¤åŒè¿™ä¸ªé€»è¾‘ï¼Œä»–ä»¬å¼€å§‹è¿›è¡Œè¿ç§»ã€‚ä½ çš„å·¥ä½œï¼Ÿä½ çš„ä»»åŠ¡æ˜¯ä¿è¯æ‰€æœ‰è®¤è¯ä»£ç èƒ½å¤Ÿåœ¨æ–°ç³»ç»Ÿä¸Šæ­£å¸¸è¿è¡Œï¼</p>
<p>ä½ èŠ±äº†ä¸€äº›æ—¶é—´æŸ¥çœ‹GitLab APIæ–‡æ¡£ï¼Œå¥½æ¶ˆæ¯æ˜¯ï¼Œçœ‹èµ·æ¥ä»–ä»¬é‡‡ç”¨äº†å’ŒGithubç±»ä¼¼çš„ç­–ç•¥ã€‚GitLabåŒæ ·ä¹Ÿæœ‰ä¸ªäººè®¿é—®ä»¤ç‰Œï¼Œç»„ç»‡ï¼Œä½ åªéœ€è¦é‡æ–°å®ç°å®¢æˆ·ç«¯å³å¯ã€‚ä¸­é—´ä»¶ä¸­çš„ä»£ç å®Œå…¨ä¸éœ€è¦æ›´æ”¹ï¼Œå› ä¸ºä½ æ˜¯ä¸€ä¸ªèªæ˜äººï¼Œä½ ä½¿ç”¨äº†æ¥å£ï¼ ğŸ˜ ç°åœ¨ä½ åªéœ€è¦åˆ›å»ºä¸€ä¸ªGithubå®¢æˆ·ç«¯â€¦</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gitlab</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  ID    <span class="keyword">string</span></span><br><span class="line">  Email <span class="keyword">string</span></span><br><span class="line">  OrgIDs []<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Client <span class="keyword">struct</span> &#123;</span><br><span class="line">  Key   <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Client)</span> <span class="title">User</span><span class="params">(token <span class="keyword">string</span>)</span> <span class="params">(User, error)</span></span> &#123;</span><br><span class="line">  <span class="comment">// ä¸Gitlab APIäº¤äº’ï¼Œè¿”å›ç”¨æˆ·å’Œå¯¹åº”çš„ç»„ç»‡c.OrgID</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼ŒæŠŠè¿™ä¸ªåŠŸèƒ½æ”¾å…¥<code>AuthMiddleware</code>ä¸­ï¼Œä½†æ˜¯ï¼Œå®ƒå´ä¸èƒ½æ­£å¸¸å·¥ä½œäº†ï¼</p>
<p>äº‹å®è¯æ˜ï¼Œå³ä½¿æ¥å£ä¹Ÿå¯èƒ½æˆä¸ºè€¦åˆçš„å—å®³è€…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ˜¯å› ä¸ºä½ çš„æ¥å£æœŸæœ›é€šè¿‡<code>User</code>æ–¹æ³•è¿”å›<code>github.User</code> ã€‚ </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UserService <span class="keyword">interface</span> &#123;</span><br><span class="line">  User(token <span class="keyword">string</span>) (github.User, error)</span><br><span class="line">                      ^^^^^^^^^^^</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€ä¹ˆåŠï¼Ÿè€æ¿å¸Œæœ›æ˜å¤©å°±è¦å‘å¸ƒäº†ï¼</p>
<p>ç°åœ¨ï¼Œä½ æœ‰å‡ ç§é€‰æ‹©ï¼š</p>
<ol>
<li>ä¿®æ”¹ä¸­é—´ä»¶ï¼Œä»¥ä¾¿<code>UserService</code>æ¥å£è¿”å›<code>gitlab.User</code>è€Œä¸æ˜¯<code>github.User</code>ï¼›</li>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸“é—¨ç”¨äºGitLabçš„èº«ä»½éªŒè¯ä¸­é—´ä»¶ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªé€šç”¨çš„ç”¨æˆ·ç±»å‹ï¼Œèƒ½å¤Ÿåœ¨<code>AuthMiddleware</code>ä¸­å¯ä»¥è‡ªç”±åˆ‡æ¢ä½ çš„githubå’Œgitlabå®ç°ã€‚</li>
</ol>
<p>å¦‚æœä½ ç¡®ä¿¡è‡ªå·±çš„å…¬å¸ä»¥åç»§ç»­ä½¿ç”¨GitLabï¼Œåˆ™æ–¹æ¡ˆ1å°±æœ‰æ„ä¹‰ã€‚å½“ç„¶ï¼Œä½ éœ€è¦åŒæ—¶æ›´æ”¹ç”¨æˆ·æœåŠ¡æ¥å£å’Œmockï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸€æ¬¡æ€§çš„ä¿®æ”¹ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ¡ˆå¹¶ä¸åã€‚</p>
<p>å½“ç„¶ï¼Œä½ å¹¶ä¸çœŸæ­£çŸ¥é“ä½ ä»¬æ˜¯å¦ä¼šåšæŒä½¿ç”¨GitLabã€‚ä¹Ÿè®¸å“¥æ–¯æ‹‰ä¼šæ”¹å˜å®ƒçš„æ”»å‡»è®¡åˆ’ï¼Ÿ</p>
<p>å¦‚æœç¨‹åºä¸­å¾ˆå¤šä»£ç éƒ½ä¾èµ–æ­¤ç¨‹åºåŒ…è¿”å›çš„<code>github.User</code>ç±»å‹ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¹Ÿä¼šå¸¦æ¥å¾ˆå¤šéº»çƒ¦ã€‚</p>
<p>æ–¹æ¡ˆ2ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å®ƒçœ‹èµ·æ¥æœ‰ç‚¹å‚»å‚»çš„ã€‚å½“é€»è¾‘ä¸å˜æ—¶ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é‡å†™ä¸€éæ‰€æœ‰çš„ä»£ç å’Œæµ‹è¯•ï¼Ÿå½“ç„¶ï¼Œä¸€å®šæœ‰ä¸€ç§æ¥å£å¯ä»¥æŒ‰ç…§ä½ æœ€åˆçš„æ„å›¾å®ç°åŠŸèƒ½ã€‚æ¯•ç«Ÿï¼Œä¸­é—´ä»¶ä¸å…³å¿ƒæŸ¥è¯¢çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬åªæ˜¯éœ€è¦å¤„ç†å…¶ä¸­ä¸€äº›é‡è¦ä¿¡æ¯ã€‚</p>
<p>ç°åœ¨ï¼Œä½ å†³å®šå°è¯•ä¸€ä¸‹æ–¹æ¡ˆ3ã€‚ä½ åˆ›å»ºäº†ä¸€ä¸ª<code>mw</code>åŒ…ï¼Œå®šä¹‰äº†ä¸€ä¸ª<code>User</code>ç±»å‹ï¼Œç„¶åå‡†å¤‡ç¼–å†™ä¸€ä¸ªé€‚é…å™¨å°†å…¶ä¸Githubå’ŒGitlabå®¢æˆ·ç«¯è¿æ¥ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mw</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  OrgIDs []<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserService <span class="keyword">interface</span> &#123;</span><br><span class="line">  User(token <span class="keyword">string</span>) (User, error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ä½ ç¼–å†™ä»£ç æ—¶ï¼Œä½ æ„è¯†åˆ°ï¼Œä½ å®é™…ä¸Šå¹¶ä¸å…³å¿ƒç”¨æˆ·IDæˆ–è€…ç”µå­é‚®ä»¶ç­‰ç­‰å…¶ä»–ä¿¡æ¯ï¼Œå› æ­¤ä½ å®Œå…¨å¯ä»¥ä»<code>mw.User</code>ä¸­åˆ é™¤è¿™äº›å­—æ®µï¼Œä½ åªéœ€è¦åˆ¶å®šä½ å…³å¿ƒçš„å­—æ®µï¼Œè¿™æ ·å°±å¯ä»¥è®©ä»£ç æ›´å®¹æ˜“ç»´æŠ¤å’Œæµ‹è¯•ã€‚æ£’æäº†ï¼</p>
<p>æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªé€‚é…å™¨ï¼Œä»¥ä¾¿ä½ å¯ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package adapter probably isnâ€™t a great package name, but this is a</span></span><br><span class="line"><span class="comment">// demo so deal with it.</span></span><br><span class="line"><span class="keyword">package</span> adapter</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> GitHubUserService <span class="keyword">struct</span> &#123;</span><br><span class="line">  Client *github.Client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(us *GitHubUserService)</span> <span class="title">User</span><span class="params">(token <span class="keyword">string</span>)</span> <span class="params">(mw.User, error)</span></span> &#123;</span><br><span class="line">  ghUser, err := us.Client.User(token)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mw.User&#123;&#125;, err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> mw.User&#123;</span><br><span class="line">    OrgIDs: ghUser.OrgIDs,</span><br><span class="line">  &#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> GitLabUserService <span class="keyword">struct</span> &#123;</span><br><span class="line">  Client *gitlab.Client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(us *GitLabUserservice)</span> <span class="title">User</span><span class="params">(token <span class="keyword">string</span>)</span> <span class="params">(mw.User, error)</span></span> &#123;</span><br><span class="line">  glUser, err := us.Client.User(token)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mw.User&#123;&#125;, err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> mw.User&#123;</span><br><span class="line">    OrgIDs: glUser.OrgIDs,</span><br><span class="line">  &#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ ä¹Ÿéœ€è¦æ›´æ–°ä½ çš„mockï¼Œä¸è¿‡è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¿«çš„ä¿®æ”¹ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mock</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserService <span class="keyword">struct</span> &#123;</span><br><span class="line">  UserFn <span class="function"><span class="keyword">func</span><span class="params">(token <span class="keyword">string</span>)</span> <span class="params">(mw.User, error)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(us *UserService)</span> <span class="title">Authenticate</span><span class="params">(token <span class="keyword">string</span>)</span> <span class="params">(mw.User, error)</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> us.UserFn(token)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå¦‚æœä½ æƒ³å°†æˆ‘ä»¬çš„<code>AuthMiddleware</code>ä¸GitHubæˆ–GitLabä¸€èµ·ä½¿ç”¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œæ“ä½œï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myHandler http.Handler</span><br><span class="line"><span class="keyword">var</span> us mw.UserService</span><br><span class="line">us = &amp;GitLabUserservice&#123;</span><br><span class="line">  Client: &amp;gitlab.Client&#123;</span><br><span class="line">    Key: â€œabc<span class="number">-123</span>â€,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// This protects your handler</span></span><br><span class="line">myHandler = mw.AuthMiddleware(us, â€œmy-org-idâ€, myHandler)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç»ˆäºæœ‰äº†ä¸€ä¸ªå®Œå…¨è§£è€¦çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åœ¨GitHubå’ŒGitLabä¹‹é—´åˆ‡æ¢ï¼Œå¹¶ä¸”å½“æ–°çš„æºç ç®¡ç†å…¬å¸å‡ºç°æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå¿«è·Ÿä¸Šæ½®æµã€‚</p>
<h2 id="å¯»æ‰¾ä¸­é—´æ–¹æ¡ˆ"><a href="#å¯»æ‰¾ä¸­é—´æ–¹æ¡ˆ" class="headerlink" title="å¯»æ‰¾ä¸­é—´æ–¹æ¡ˆ"></a>å¯»æ‰¾ä¸­é—´æ–¹æ¡ˆ</h2><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥çœ‹åˆ°äº†ä»£ç ä»ç´§å¯†è€¦åˆåˆ°å®Œå…¨è§£è€¦çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬ä½¿ç”¨<code>adapter</code>åŒ…æ¥å®Œæˆå¤„ç†è¿™äº›è§£è€¦åçš„<code>mw</code>å’Œ<code>github/gitlab</code>åŒ…ä¹‹é—´çš„è½¬æ¢ã€‚</p>
<p>è¿™æ ·åšçš„ä¸»è¦å¥½å¤„æ˜¯æˆ‘ä»¬åœ¨æœ€åçš„æ—¶å€™çœ‹åˆ°çš„ï¼šæˆ‘ä»¬å¯ä»¥åœ¨è‡ªç”±é€‰æ‹©ä½¿ç”¨GitHubæˆ–GitLabè®¤è¯ç­–ç•¥ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹handlerså’Œè®¤è¯ä¸­é—´ä»¶ã€‚</p>
<p>å°½ç®¡è¿™äº›å¥½å¤„éå¸¸æ£’ï¼Œä½†åœ¨ä¸è€ƒè™‘æˆæœ¬çš„æƒ…å†µä¸‹æ¢ç´¢è¿™äº›å¥½å¤„æ˜¯ä¸å…¬å¹³çš„ã€‚ æ‰€æœ‰è¿™äº›æ›´æ”¹æä¾›äº†è¶Šæ¥è¶Šå¤šçš„ä»£ç ï¼Œå¦‚æœä½ å›è¿‡å¤´å»æŸ¥çœ‹<code>gitlab</code>å’Œ<code>mw</code>è½¯ä»¶åŒ…çš„åŸå§‹ç‰ˆæœ¬ï¼Œä½ ä¼šå‘ç°å®ƒä»¬æ¯”éœ€è¦ä½¿ç”¨adapterè½¯ä»¶åŒ…çš„æœ€ç»ˆç‰ˆæœ¬è¦ç®€å•å¾—å¤šã€‚è¿™æ ·ä¹Ÿä¼šä¹Ÿå¯èƒ½å¯¼è‡´æ›´å¤šçš„è®¾ç½®é¡¹ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬ä»£ç çš„æŸä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–æ‰€æœ‰è¿™äº›é€‚é…å™¨å¹¶å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ã€‚</p>
<p>å¦‚æœæ²¿è¿™æ¡è·¯çº¿ç»§ç»­æ¼”è¿›ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¾ˆå¿«å‘ç°æˆ‘ä»¬ä¹Ÿéœ€è¦è®¸å¤šä¸åŒçš„Userç±»å‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨GitHubï¼ˆæˆ–GitLabï¼‰ç­‰æœåŠ¡ä¸­å°†å†…éƒ¨ç”¨æˆ·ç±»å‹ä¸å¤–éƒ¨ç”¨æˆ·IDå…³è”ã€‚ è¿™å¯èƒ½å¯¼è‡´åœ¨æˆ‘ä»¬çš„æ•°æ®åº“åŒ…ä¸­å®šä¹‰ä¸€ä¸ª<code>ExternalUser</code> ï¼Œç„¶åç¼–å†™ä¸€ä¸ªé€‚é…å™¨å°†<code>github.User</code>è½¬æ¢ä¸ºè¿™ç§ç±»å‹ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„æ•°æ®åº“ä»£ç ä¸æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„æœåŠ¡è§£è€¦ã€‚</p>
<p>I actually tried doing this on one project with my HTTP handlers just to see how it turned out. Specifically, I isolated every endpoint in my web application to its own package with no external dependencies specific to my web application and ended up with packages like this:<br>å®é™…ä¸Šï¼Œä¸ºäº†è¯æ˜è¿™ä¸ªç»“æœï¼Œæˆ‘åœ¨ä¸€ä¸ªé¡¹ç›®ä¸Šçš„HTTPå¤„ç†ç¨‹åºä¸Šè¿›è¡Œè¿‡å°è¯•ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘å°†Webåº”ç”¨ç¨‹åºä¸­çš„æ¯ä¸ªç«¯ç‚¹éš”ç¦»åˆ°å…¶è‡ªå·±çš„ç¨‹åºåŒ…ä¸­ï¼Œè€Œæ²¡æœ‰ç‰¹å®šäºWebåº”ç”¨ç¨‹åºçš„å¤–éƒ¨ä¾èµ–å…³ç³»ï¼Œæœ€ç»ˆå¾—åˆ°äº†åƒè¿™æ ·çš„ç¨‹åºåŒ…ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package enroll provides HTTP handlers for enrolling a user into a new</span></span><br><span class="line"><span class="comment">// course.</span></span><br><span class="line"><span class="comment">// This package is entirely for demonstrative purposes and hasnâ€™t been tested,</span></span><br><span class="line"><span class="comment">// but if you do see obvious bugs feel free to let me know and Iâ€™ll address</span></span><br><span class="line"><span class="comment">// them.</span></span><br><span class="line"><span class="keyword">package</span> enroll</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  â€œioâ€</span><br><span class="line">	â€œnet/httpâ€</span><br><span class="line"></span><br><span class="line">	â€œgithub.com/gorilla/schemaâ€</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Data defines the data that will be provided to the HTML template when it is</span></span><br><span class="line"><span class="comment">// rendered.</span></span><br><span class="line"><span class="keyword">type</span> Data <span class="keyword">struct</span> &#123;</span><br><span class="line">  Form    Form</span><br><span class="line">  <span class="comment">// Map of form fields with errors and their error message</span></span><br><span class="line">  Errors  <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">  User    User</span><br><span class="line">	License License</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// License is used to show the user more info about what they are enrolling in.</span></span><br><span class="line"><span class="comment">// Eg if they URL query params have a valid key, we might show them:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   â€œYou are about to enroll in Gophercises - FREE using the key `abc-123`â€</span></span><br><span class="line"><span class="comment">//                               ^             ^                   ^</span></span><br><span class="line"><span class="comment">//                             Course       Package               Key</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">type</span> License <span class="keyword">struct</span> &#123;</span><br><span class="line">  Key     <span class="keyword">string</span></span><br><span class="line">  Course  <span class="keyword">string</span></span><br><span class="line">  Package <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// User defines a user that can be enrolled in courses.</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  ID <span class="keyword">string</span></span><br><span class="line">  <span class="comment">// Email is used when rendering a navbar with the userâ€™s email address, among</span></span><br><span class="line">  <span class="comment">// other areas of an HTML page.</span></span><br><span class="line">  Email <span class="keyword">string</span></span><br><span class="line">  Avatar <span class="keyword">string</span></span><br><span class="line">  <span class="comment">// â€¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Form defines all of the HTML form fields. It assumes the Form will be</span></span><br><span class="line"><span class="comment">// rendered using struct tags and a form package I created</span></span><br><span class="line"><span class="comment">// (https://github.com/joncalhoun/form), but it isnâ€™t really mandatory as</span></span><br><span class="line"><span class="comment">// long as the form field names match the `schema` part here.</span></span><br><span class="line"><span class="keyword">type</span> Form <span class="keyword">struct</span> &#123;</span><br><span class="line">	License  <span class="keyword">string</span> <span class="string">`form:"name=license;label=License key;footer=You can find this in an email sent over by Gumroad after purchasing a course. Or in the case of Gophercises it will be in an email from me (jon@calhoun.io)." schema:"license"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Handler provides GET and POST http.Handlers</span></span><br><span class="line"><span class="keyword">type</span> Handler <span class="keyword">struct</span> &#123;</span><br><span class="line">  <span class="comment">// Interfaces and function types here serve roughly the same purpose. funcs</span></span><br><span class="line">  <span class="comment">// just tend to be easier to write adapters for since you donâ€™t need a</span></span><br><span class="line">  <span class="comment">// struct type with a method.</span></span><br><span class="line">  UserFn    <span class="function"><span class="keyword">func</span><span class="params">(r *http.Request)</span> <span class="params">(User, error)</span></span></span><br><span class="line"><span class="function">  <span class="title">LicenseFn</span> <span class="title">func</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="params">(License, error)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  // <span class="title">Interface</span> <span class="title">because</span> <span class="title">this</span> <span class="title">one</span> <span class="title">is</span> <span class="title">the</span> <span class="title">least</span> <span class="title">likely</span> <span class="title">to</span> <span class="title">need</span> <span class="title">an</span> <span class="title">adapter</span></span></span><br><span class="line"><span class="function">  <span class="title">Enroller</span> <span class="title">interface</span></span> &#123;</span><br><span class="line">    Enroll(userID, licenseKey <span class="keyword">string</span>) error</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Typically satisfied with an HTML template</span></span><br><span class="line">  Executor <span class="keyword">interface</span> &#123;</span><br><span class="line">    Execute(wr io.Writer, data <span class="keyword">interface</span>&#123;&#125;) error</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get handles rendering the Form for a user to enroll in a new course.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Handler)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">http</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    user, err := h.UserFn(r)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="comment">// redirect or render an error</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> data Data</span><br><span class="line">    data.User = user</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> form Form</span><br><span class="line">    err := r.ParseForm()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="comment">// maybe log this? We can still render</span></span><br><span class="line">    &#125;</span><br><span class="line">    dec := schema.NewDecoder()</span><br><span class="line">    dec.IgnoreUnknownKeys(<span class="literal">true</span>)</span><br><span class="line">    err = dec.Decode(&amp;form, r.Form)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="comment">// maybe log this? We can still render</span></span><br><span class="line">    &#125;</span><br><span class="line">    data.Form = form</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> form.License != â€œâ€ &#123;</span><br><span class="line">      lic, err := h.LicenseFn(form.License)</span><br><span class="line">      data.License = lic</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        data.Errors = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">          â€œlicenseâ€: â€œis not validâ€,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    h.Executor.Execute(r, data)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Post handles processing the form and enrolling a user.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Handler)</span> <span class="title">Post</span><span class="params">()</span> <span class="title">http</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    user, err := h.UserFn(r)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="comment">// redirect or render an error</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> data Data</span><br><span class="line">    data.User = user</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> form Form</span><br><span class="line">    err := r.ParseForm()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="comment">// maybe log this? We can still render</span></span><br><span class="line">    &#125;</span><br><span class="line">    dec := schema.NewDecoder()</span><br><span class="line">    dec.IgnoreUnknownKeys(<span class="literal">true</span>)</span><br><span class="line">    err = dec.Decode(&amp;form, r.Form)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="comment">// maybe log this? We can still render</span></span><br><span class="line">    &#125;</span><br><span class="line">    data.Form = form</span><br><span class="line"></span><br><span class="line">    err = h.Enroller.Enroll(user.ID, form.License)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      data.Errors = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">        â€œlicenseâ€: â€œis not validâ€,</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// Re-render the form</span></span><br><span class="line">      h.View.Execute(r, data)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    http.Redirect(w, r, â€œ/coursesâ€, http.StatusFound)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ç†è®ºä¸Šè®²ï¼Œè¿™ä¸ªæƒ³æ³•å¬èµ·æ¥å¾ˆé…·ã€‚ ç°åœ¨ï¼Œæˆ‘å¯ä»¥å•ç‹¬å®šä¹‰æ‰€æœ‰HTTPå¤„ç†ç¨‹åºï¼Œä¸å¿…æ‹…å¿ƒåº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†çš„å½±å“ã€‚ æ¯ä¸ªåŒ…éƒ½å¯ä»¥è½»æ¾æµ‹è¯•ï¼Œå½“æˆ‘ç¼–å†™è¿™äº›ç‹¬ç«‹çš„ä½œå“æ—¶ï¼Œæˆ‘å‘ç°è‡ªå·±çš„å·¥ä½œæ•ˆç‡éå¸¸é«˜ã€‚ æˆ‘ç”šè‡³æœ‰ä¸€ä¸ªåä¸º<code>Executor</code>çš„æ¥å£ï¼Œè°ä¸æƒ³åœ¨ä»–ä»¬çš„ä»£ç ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„æ‰§è¡Œå™¨ï¼Ÿï¼</p>
<p>åœ¨å®è·µä¸­ï¼Œè¿™ä¸ªæƒ³æ³•å¯¹æˆ‘çš„ç‰¹å®šç”¨ä¾‹è€Œè¨€å¤ªç³Ÿç³•äº†ã€‚æ˜¯çš„ï¼Œè¿™ç§æ–¹æ³•ç¡®å®æœ‰å¥½å¤„ï¼Œä½†æ˜¯å®ƒä»¬å¹¶æ²¡æœ‰è¶…è¿‡ç¼–å†™æ‰€æœ‰è¿™äº›ä»£ç çš„æˆæœ¬ã€‚ åœ¨åˆ›å»º<code>enroll</code>å’Œç±»ä¼¼è½¯ä»¶åŒ…çš„å†…éƒ¨ç»„ä»¶æ—¶ï¼Œæˆ‘çš„å·¥ä½œæ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯æˆ‘èŠ±äº†å¾ˆå¤šæ—¶é—´ç¼–å†™é€‚é…å™¨å¹¶å°†å„ä¸ªéƒ¨åˆ†è¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™ä½¿æˆ‘çš„æ•´ä½“ç”Ÿäº§ç‡ä¸‹é™äº†ã€‚ æˆ‘æ‰¾ä¸åˆ°ä¸€ç§æ— éœ€ç¼–å†™è‡ªå®šä¹‰<code>UserFn</code> ï¼Œ <code>LicenseFn</code>çš„å¿«é€Ÿæ–¹æ³•å°±å¯ä»¥å°†å…¶å¼•å…¥åˆ°ä»£ç ä¸­çš„æ–¹æ¡ˆï¼Œè€Œä¸”æˆ‘å‘ç°è‡ªå·±ä¸ºå¸¦æœ‰HTTPå¤„ç†ç¨‹åºçš„æ¯ä¸ªç¨‹åºåŒ…ç¼–å†™äº†ä¸€å †å‡ ä¹ç›¸åŒçš„<code>UserFn</code>å˜ç§ã€‚</p>
<p>è¿™å¼•å‡ºäº†æœ¬èŠ‚çš„ä¸»é¢˜- <strong>æ˜¯å¦æœ‰åŠæ³•å®ç°å¯æ¥å—çš„ä¸­é—´æ–¹æ¡ˆï¼Ÿ</strong></p>
<p>æˆ‘å–œæ¬¢å°†æˆ‘çš„ä»£ç ä¸ç¬¬ä¸‰æ–¹ä¾èµ–é¡¹è§£è€¦ã€‚æˆ‘ä¹Ÿå–œæ¬¢ç¼–å†™å¯æµ‹è¯•çš„ä»£ç ã€‚ä½†æ˜¯æˆ‘ä¸å–œæ¬¢é€šè¿‡åŠ å€çš„ç¼–ç å·¥ä½œæ¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚å½“ç„¶ï¼Œè¿™é‡Œå¿…ç„¶æœ‰ä¸€ä¸ªä¸­é—´æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨æ²¡æœ‰æ‰€æœ‰é¢å¤–ä»£ç çš„æƒ…å†µä¸‹ä¸ºæˆ‘ä»¬æä¾›å¤§å¤šæ•°å¥½å¤„ï¼Œå¯¹å—ï¼Ÿ</p>
<p><strong>æ˜¯çš„ï¼Œæ˜¯æœ‰ä¸­é—´æ–¹æ¡ˆçš„</strong>ï¼Œæ‰¾åˆ°å®ƒçš„å…³é”®ä¸æ˜¯æ¶ˆé™¤æ‰€æœ‰è€¦åˆï¼Œè€Œæ˜¯æœ‰æ„åœ°é€‰æ‹©ä»£ç æ‰€è€¦åˆçš„å†…å®¹ã€‚</p>
<p>è®©æˆ‘ä»¬å›åˆ°<code>github</code>å’Œ<code>gitlab</code>åŒ…çš„åŸå§‹ç¤ºä¾‹ã€‚åœ¨æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼ˆç´§å¯†è€¦åˆç‰ˆæœ¬ï¼‰ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª<code>mw</code>åŒ…æ‰€ä¾èµ–çš„<code>github.User</code>ç±»å‹ã€‚ å®ƒæ»¡è¶³ä½¿ç”¨ï¼Œå¹¶ä¸”æˆ‘ä»¬ç”šè‡³å¯ä»¥å›´ç»•å®ƒæ„å»ºæ¥å£ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶ä¸<code>github</code>åŒ…ç´§å¯†è€¦åˆã€‚</p>
<p>åœ¨ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼ˆè§£è€¦ç‰ˆæœ¬ï¼‰ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª<code>github.User</code> ï¼Œ<code>gitlab.User</code>å’Œ<code>mw.User</code>ã€‚ è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè§£è€¦æ‰€æœ‰å†…å®¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»åˆ›å»ºå°†è¿™äº›è§£è€¦çš„ä»£ç è¿æ¥åœ¨ä¸€èµ·çš„é€‚é…å™¨ã€‚</p>
<p>The middle ground, and the third version we will explore, is to intentionally define a User type that every package is allowed to be tightly coupled to. By doing this, we are intentionally choosing where that coupling happens and can make that decision in a way that still makes it easy to test, swap implementations, and do everything else we desire from decoupled code.<br>æˆ‘ä»¬å³å°†æ¢ç´¢çš„ç¬¬ä¸‰ç§ä¸­é—´æ–¹æ¡ˆï¼Œæ˜¯æœ‰æ„å…è®¸å®šä¹‰æ¯ä¸ªåŒ…ç´§å¯†è€¦åˆçš„<code>User</code>ç±»å‹ã€‚é€šè¿‡è¿™ç§æ“ä½œï¼Œæˆ‘ä»¬åˆ»æ„é€‰æ‹©å‘ç”Ÿè€¦åˆçš„ä½ç½®ï¼Œå¹¶ä¸”ä¿è¯æ˜“äºæµ‹è¯•ã€æ–¹ä¾¿å®ç°äº¤æ¢å’Œæ˜“äºå…¶ä»–ä¸ºè§£è€¦ä»£ç å®ç°çš„ä¸€åˆ‡æ–¹å¼ã€‚</p>
<p>é¦–å…ˆæ˜¯æˆ‘ä»¬çš„<code>User</code>ç±»å‹ã€‚ è¿™å°†åœ¨<code>domain</code>åŒ…ä¸­åˆ›å»ºï¼Œæˆ‘ä»¬åº”ç”¨ä¸­çš„ä»»ä½•å…¶ä»–åŒ…éƒ½å¯ä»¥å¯¼å…¥ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> domain</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  ID    <span class="keyword">string</span></span><br><span class="line">  Email <span class="keyword">string</span></span><br><span class="line">  OrgIDs []<span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é‡å†™<code>github</code>å’Œ<code>gitlab</code>è½¯ä»¶åŒ…ä»¥åˆ©ç”¨æ­¤<code>domain.User</code>ç±»å‹ã€‚ è¿™äº›åŸºæœ¬ç›¸åŒï¼Œå› ä¸ºæˆ‘å»é™¤äº†æ‰€æœ‰çš„çœŸå®é€»è¾‘ï¼Œåªå±•ç¤ºå…¶ä¸­ä¸€ä¸ªã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gitlab <span class="comment">// github is the same basically</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Client <span class="keyword">struct</span> &#123;</span><br><span class="line">  Key   <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Note the return type is domain.User here - this code is now coupled to our</span></span><br><span class="line"><span class="comment">// domain.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Client)</span> <span class="title">User</span><span class="params">(token <span class="keyword">string</span>)</span> <span class="params">(domain.User, error)</span></span> &#123;</span><br><span class="line">  <span class="comment">// â€¦ interact with the gitlab API, and return a user if they are in an org with the c.OrgID</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œæˆ‘ä»¬æœ‰äº†<code>mw</code>è½¯ä»¶åŒ…ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mw</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserService <span class="keyword">interface</span> &#123;</span><br><span class="line">  User(token <span class="keyword">string</span>) (domain.User, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AuthMiddleware</span><span class="params">(us UserService, reqOrgID <span class="keyword">string</span>, next http.Handler)</span> <span class="title">http</span>.<span class="title">Handler</span></span> &#123;</span><br><span class="line">  <span class="comment">// unchanged</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥ä½¿ç”¨æ­¤ç¼–å†™ä¸€ä¸ªæ¨¡æ‹ŸåŒ…ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mock</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserService <span class="keyword">struct</span> &#123;</span><br><span class="line">  UserFn <span class="function"><span class="keyword">func</span><span class="params">(token <span class="keyword">string</span>)</span> <span class="params">(domain.User, error)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(us *UserService)</span> <span class="title">Authenticate</span><span class="params">(token <span class="keyword">string</span>)</span> <span class="params">(domain.User, error)</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> us.UserFn(token)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é¢†åŸŸé©±åŠ¨è®¾è®¡"><a href="#é¢†åŸŸé©±åŠ¨è®¾è®¡" class="headerlink" title="é¢†åŸŸé©±åŠ¨è®¾è®¡"></a>é¢†åŸŸé©±åŠ¨è®¾è®¡</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä¸€ç›´åŠªåŠ›é¿å…ä½¿ç”¨ä»»ä½•ä»¤äººå›°æƒ‘çš„æœ¯è¯­ï¼Œå› ä¸ºæˆ‘å‘ç°å®ƒä»¬é€šå¸¸ä¼šä½¿é—®é¢˜å˜å¾—å¤æ‚è€Œä¸æ˜¯ç®€åŒ–å®ƒä»¬ã€‚å¦‚æœä½ ä¸ç›¸ä¿¡æˆ‘ï¼Œè¯·å°è¯•é˜…è¯»æœ‰å…³åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„ä»»ä½•æ–‡ç« ï¼Œä¹¦ç±æˆ–å…¶ä»–èµ„æºã€‚ä»–ä»¬å‡ ä¹æ€»æ˜¯ä½¿ä½ åœ¨ä»£ç ä¸­å®é™…å®ç°æƒ³æ³•å¸¦æ¥æ›´å¤šçš„ç–‘é—®å’Œæ›´å°‘çš„æ˜ç¡®ç­”æ¡ˆã€‚</p>
<p>æˆ‘ä¸æ˜¯åœ¨è¯´æ˜DDDæ²¡æœ‰ç”¨ï¼Œä¹Ÿä¸æ˜¯åœ¨å»ºè®®ä½ ä¸è¦è¯»é‚£äº›ä¹¦ã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œæˆ‘çš„å¾ˆå¤šï¼ˆå¤§å¤šæ•°ï¼‰è¯»è€…åœ¨è¿™é‡Œæ˜¯ä¸ºäº†å¯»æ±‚æœ‰å…³å¦‚ä½•æ”¹è¿›å…¶ä»£ç çš„æ›´å®ç”¨å»ºè®®ï¼Œè€Œä¸æ˜¯è®¨è®ºè½¯ä»¶å¼€å‘ç†è®ºã€‚</p>
<p>ä»å®é™…çš„æ‰§è¡Œè§’åº¦æ¥çœ‹ï¼Œé¢†åŸŸé©±åŠ¨è®¾è®¡çš„ä¸»è¦å¥½å¤„æ˜¯ç¼–å†™å¯ä»¥éšæ—¶é—´å˜åŒ–è€Œå˜åŒ–çš„è½¯ä»¶ã€‚æˆ‘å‘ç°åœ¨Goä¸­å®ç°æ­¤ç›®æ ‡çš„æœ€ä½³æ–¹æ³•æ˜¯æ¸…æ¥šåœ°å®šä¹‰ä½ çš„é¢†åŸŸç±»å‹ï¼Œç„¶åç¼–å†™ä¾èµ–äºè¿™äº›ç±»å‹çš„å®ç°ã€‚è¿™ä»ç„¶ä¼šå¯¼è‡´ä»£ç è€¦åˆï¼Œä½†æ˜¯ç”±äºä½ çš„é¢†åŸŸä¸é—®é¢˜ç´§å¯†ç›¸å…³ï¼Œå› æ­¤ä½ è§£å†³è¿™ç§è€¦åˆå¹¶ä¸å›°éš¾ã€‚å®é™…ä¸Šï¼Œæˆ‘ç»å¸¸å‘ç°ï¼Œéœ€è¦å¯¹é¢†åŸŸæ¨¡å‹è¿›è¡Œæ¸…æ™°çš„å®šä¹‰æ˜¯æœ‰å¯å‘æ€§çš„ï¼Œè€Œä¸æ˜¯éº»çƒ¦çš„ã€‚</p>
<p><em>æ³¨æ„ï¼šå®šä¹‰å…·ä½“é¢†åŸŸç±»å‹å¹¶å°†ä»£ç è€¦åˆåˆ°å®ƒä»¬çš„æƒ³æ³•å¹¶ä¸æ˜¯ç‹¬åˆ›çš„æˆ–æ–°é¢–çš„ã€‚æœ¬Â·çº¦ç¿°é€Šåœ¨<a href="https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1" target="_blank" rel="noopener">2016å¹´æ’°å†™çš„</a> è¿™ç¯‡æ–‡ç« ï¼Œå¯¹äºä»»ä½•æ–°å…¥é—¨çš„Gopheræ¥è¯´ä»ç„¶æ˜¯éå¸¸æœ‰ä»·å€¼çš„æ–‡ç« ã€‚</em></p>
<p>å›åˆ°å‰é¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨<code>domain</code>åŒ…ä¸­å®šä¹‰äº†æˆ‘ä»¬çš„é¢†åŸŸ ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> domain</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  ID    <span class="keyword">string</span></span><br><span class="line">  Email <span class="keyword">string</span></span><br><span class="line">  OrgIDs []<span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å¼€å§‹å®šä¹‰åŸºæœ¬çš„æ„å»ºå—ï¼Œè€Œæˆ‘ä»¬çš„å…¶ä½™åº”ç”¨å¯ä»¥å®ç°æˆ–è€…åœ¨ä¸ä¸å®ç°ç»†èŠ‚è€¦åˆçš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚ ä¾‹å¦‚æˆ‘ä»¬çš„UserService ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> domain</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123; â€¦ &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserService <span class="keyword">interface</span> &#123;</span><br><span class="line">  User(token <span class="keyword">string</span>) (User, error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ç”±<code>github</code>å’Œ<code>gitlab</code>åŒ…å®ç°çš„æ¥å£ï¼Œå¹¶åœ¨<code>mw</code>åŒ…ä¸­ä½¿ç”¨ã€‚ å®ƒä¹Ÿå¯ä»¥è¢«æˆ‘ä»¬ä»£ç ä¸­çš„å…¶ä»–è½¯ä»¶åŒ…æ‰€ä½¿ç”¨ï¼Œè€Œä¸ç”¨å…³å¿ƒå®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚è€Œä¸”ç”±äºå®ƒæ˜¯åœ¨é¢†åŸŸä¸­å®šä¹‰çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒæ¯ä¸ªå®ç°çš„è¿”å›ç±»å‹éƒ½ä¼šæœ‰æ‰€å˜åŒ–-å®ƒä»¬éƒ½åŸºäºä¸€ä¸ªé€šç”¨çš„å®šä¹‰å¯ä»¥æ„å»ºã€‚</p>
<p>éšç€åº”ç”¨ç¨‹åºçš„å‘å±•å’Œå˜åŒ–ï¼Œè¿™ç§å®šä¹‰é€šç”¨æ¥å£çš„æƒ³æ³•å˜å¾—æ›´åŠ å¼ºå¤§ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç¨å¾®å¤æ‚çš„UserService ï¼šä¹Ÿè®¸å®ƒä¼šå¤„ç†åˆ›å»ºç”¨æˆ·ï¼ŒéªŒè¯ç”¨æˆ·ï¼Œé€šè¿‡ä»¤ç‰ŒæŸ¥æ‰¾ç”¨æˆ·ï¼Œé€šè¿‡å¯†ç é‡ç½®ä»¤ç‰Œï¼Œæ›´æ”¹å¯†ç ç­‰æ“ä½œã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> domain</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserStore <span class="keyword">interface</span> &#123;</span><br><span class="line">	Create(NewUser) (*User, RememberToken, error)</span><br><span class="line">	Authenticate(email, pw <span class="keyword">string</span>) (*User, RememberToken, error)</span><br><span class="line">	ByToken(RememberToken) (*User, error)</span><br><span class="line">	ResetToken(email <span class="keyword">string</span>) (ResetToken, error)</span><br><span class="line">	UpdatePw(pw <span class="keyword">string</span>, tok ResetToken) (RememberToken, error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯èƒ½é¦–å…ˆä½¿ç”¨çº¯SQLä»£ç å’Œæœ¬åœ°æ•°æ®åº“æ¥å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sql</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserStore <span class="keyword">struct</span> &#123;</span><br><span class="line">  DB *sql.DB</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(us *UserStore)</span> <span class="title">Create</span><span class="params">(newUser domain.NewUser)</span> <span class="params">(*domain.User, domain.RememberToken, error)</span></span> &#123;</span><br><span class="line">  <span class="comment">// â€¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// â€¦ and more methods</span></span><br></pre></td></tr></table></figure>

<p>å³ä¾¿å½“æˆ‘ä»¬åªæœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œä½†æ˜¯ä¹Ÿè®¸æˆ‘ä»¬ä¼šæˆé•¿ä¸ºå¦ä¸€ä¸ªGoogleï¼Œæˆ‘ä»¬å†³å®šä¸€ä¸ªé›†ä¸­çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œè¿™æ ·æˆ‘ä»¬æ‰€æœ‰å•ç‹¬çš„åº”ç”¨éƒ½å¯ä»¥ä½¿ç”¨è¿™å¥—ç³»ç»Ÿã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å°†ä»£ç è€¦åˆåˆ°sqlå®ç°ï¼Œè¿™åŸºæœ¬å¾ˆéš¾å®ç°ï¼Œä½†æ˜¯ç”±äºå¤§å¤šæ•°ä»£ç éƒ½è€¦åˆåˆ°domain.UserServiceæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªæ–°çš„å®ç°å¹¶ä½¿ç”¨ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> userapi</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserStore <span class="keyword">struct</span> &#123;</span><br><span class="line">  HTTPClient *http.Client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(us *UserStore)</span> <span class="title">Create</span><span class="params">(newUser domain.NewUser)</span> <span class="params">(*domain.User, domain.RememberToken, error)</span></span> &#123;</span><br><span class="line">  <span class="comment">// interact with a third party API instead of a local SQL database</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// â€¦</span></span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬è€Œè¨€ï¼Œè€¦åˆåˆ°é¢†åŸŸè€Œä¸æ˜¯ç‰¹å®šçš„å®ç°æ–¹å¼ä½¿æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒè¯¸å¦‚ä»¥ä¸‹çš„ç»†èŠ‚ï¼š</p>
<ul>
<li><strong>æˆ‘ä»¬æ­£åœ¨ä¸å¾®æœåŠ¡æˆ–æœ¬åœ°æ•°æ®åº“è¿›è¡Œäº¤äº’å—ï¼Ÿ</strong> æ— è®ºæˆ‘ä»¬çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿæ˜¯æœ¬åœ°SQLæ•°æ®åº“è¿˜æ˜¯å¾®æœåŠ¡ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åœ¨åˆç†çš„æ—¶é—´å†…å®Œæˆä»£ç ç¼–å†™ã€‚</li>
<li><strong>æˆ‘ä»¬æ˜¯å¦é€šè¿‡JSONï¼ŒGraphQLï¼ŒgRPCæˆ–å…¶ä»–æ–¹å¼ä¸ç”¨æˆ·APIé€šä¿¡ï¼Ÿ</strong> å°½ç®¡æˆ‘ä»¬çš„å®ç°éœ€è¦çŸ¥é“å¦‚ä½•ä¸ç”¨æˆ·APIè¿›è¡Œé€šä¿¡ï¼Œä½†æ˜¯æ— è®ºæˆ‘ä»¬ä½¿ç”¨å“ªç§ç‰¹å®šæŠ€æœ¯ï¼Œæˆ‘ä»¬å…¶ä½™çš„ä»£ç éƒ½å°†ç»§ç»­ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œã€‚</li>
<li>å…¶ä»–æ›´å¤šâ€¦</li>
</ul>
<p>ä»æ ¹æœ¬ä¸Šè®²ï¼Œè¿™å°±æ˜¯æˆ‘è®¤ä¸ºé¢†åŸŸé©±åŠ¨è®¾è®¡çš„ä¸»è¦å¥½å¤„ã€‚è¿™ä¸æ˜¯èŠ±å“¨çš„æœ¯è¯­ï¼Œè‰²å½©é²œè‰³çš„å›¾å½¢ï¼Œä¹Ÿä¸æ˜¯åœ¨åŒäº‹é¢å‰ç‚«è€€èªæ˜ã€‚çº¯ç²¹æ˜¯è®¾è®¡èƒ½å¤Ÿä¸æ–­å‘å±•ä»¥æ»¡è¶³ä¸æ–­å˜åŒ–çš„éœ€æ±‚çš„è½¯ä»¶ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä»é¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å§‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä»é¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å§‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä»é¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å§‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä»é¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å§‹ï¼Ÿ</h2><p>æ˜¾è€Œæ˜“è§çš„åç»­é—®é¢˜æ˜¯ï¼šâ€œå¦‚æœå®ƒæ˜¯å¦‚æ­¤å‡ºè‰²ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸åªæ˜¯ä»é¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å§‹å‘¢ï¼Ÿâ€</p>
<p>ä»»ä½•æœ‰ä½¿ç”¨æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰ç»éªŒçš„äººéƒ½ä¼šå‘Šè¯‰ä½ ï¼Œå®ƒå¾ˆå®¹æ˜“å‘ç”Ÿç´§å¯†è€¦åˆã€‚å‡ ä¹æˆ‘ä»¬æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½å°†éœ€è¦ä¾èµ–äºæˆ‘ä»¬çš„æ¨¡å‹ï¼Œè€Œæˆ‘ä»¬åªæ˜¯æ¢è®¨äº†è¿™å¯èƒ½ä¼šå¸¦æ¥é—®é¢˜ã€‚é‚£æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ä»å…¬ç”¨é¢†åŸŸè¿›è¡Œæ„å»ºè™½ç„¶å¾ˆæœ‰ç”¨ï¼Œä½†å¦‚æœæ»¥ç”¨ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€åœºå™©æ¢¦ã€‚é¢†åŸŸé©±åŠ¨è®¾è®¡å…·æœ‰ç›¸å½“é™¡å³­çš„å­¦ä¹ æ›²çº¿ï¼šå¹¶ä¸æ˜¯å› ä¸ºè¿™äº›æƒ³æ³•ç‰¹åˆ«éš¾äºæŒæ¡ï¼Œè€Œæ˜¯å› ä¸ºåœ¨é¡¹ç›®å‘å±•åˆ°åˆç†è§„æ¨¡ä¹‹å‰ï¼Œä½ å¾ˆå°‘äº†è§£åœ¨åº”ç”¨è¿™äº›æƒ³æ³•æ—¶å“ªé‡Œå‡ºé”™äº†ã€‚ç»“æœæ˜¯å¯èƒ½è¦èŠ±å‡ å¹´çš„æ—¶é—´æ‰èƒ½çœŸæ­£æŒæ¡æ‰€æœ‰æ¶‰åŠçš„åŠ¨æ€æ¼”åŒ–ã€‚æˆ‘å·²ç»å†™äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„è½¯ä»¶äº†ï¼Œä½†æˆ‘ä»ç„¶æ„Ÿè§‰ä¸åˆ°æˆ‘å¯¹æ‰€æœ‰å¯èƒ½å‡ºé”™æˆ–å˜å¾—å¤æ‚çš„æ–¹å¼éƒ½æ‹¥æœ‰å®Œå…¨çš„äº†è§£ã€‚</p>
<p>*æ³¨æ„ï¼šè¿™æ˜¯æˆ‘èŠ±è¿™ä¹ˆé•¿æ—¶é—´å‘å¸ƒæœ¬æ–‡çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚åœ¨å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»ç„¶å¯¹åˆ†äº«ä¿æœ‰ç–‘è™‘ï¼Œæˆ‘ä¸è§‰å¾—è‡ªå·±æ˜¯è¿™ä¸ªä¸»é¢˜çš„ä¸“å®¶ã€‚ä½†æ˜¯ï¼Œæˆ‘æœ€ç»ˆå†³å®šåˆ†äº«ï¼Œå› ä¸ºæˆ‘ç›¸ä¿¡å…¶ä»–äººå¯ä»¥ä»æˆ‘çš„æœ‰é™ç†è§£ä¸­å­¦åˆ°ä¸œè¥¿ï¼Œå¹¶ä¸”æˆ‘ç›¸ä¿¡éšç€ä¸å…¶ä»–å¼€å‘äººå‘˜è¿›è¡Œè®¨è®ºï¼Œæœ¬æ–‡ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå‘å±•å’Œæ”¹è¿›ã€‚å› æ­¤ï¼Œéšæ—¶æ¬¢è¿ä¸æˆ‘è¿›è¡Œè®¨è®º <a href="mailto:jon@calhoun.io" target="_blank" rel="noopener">-jon@calhoun.io</a> *</p>
<p>MVCä¸ºä½ æä¾›äº†ç»„ç»‡ä»£ç çš„åˆç†èµ·ç‚¹ã€‚æ•°æ®åº“äº¤äº’åœ¨æ¨¡å‹å±‚ï¼Œhttpå¤„ç†ç¨‹åºåœ¨æ§åˆ¶å™¨å±‚ï¼Œæ¸²æŸ“ä»£ç åœ¨è§†å›¾å±‚ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ç´§å¯†è€¦åˆï¼Œä½†å¯ä»¥è®©ä½ å¿«é€Ÿå…¥é—¨ã€‚</p>
<p>ä¸MVCä¸åŒï¼Œé¢†åŸŸé©±åŠ¨è®¾è®¡ä¸ä¼šä¸ºä½ æä¾›ç»„ç»‡ä»£ç çš„åˆç†èµ·ç‚¹ã€‚å®é™…ä¸Šï¼Œä»DDDå¼€å§‹ä¸ä»MVCå¼€å§‹å‡ ä¹å®Œå…¨ç›¸åï¼šä¸æ˜¯ç›´æ¥è¿›å…¥æ„å»ºæ§åˆ¶å™¨å¹¶æŸ¥çœ‹æ¨¡å‹å¦‚ä½•å‘å±•ï¼Œç›¸åï¼Œä½ å¿…é¡»èŠ±å¤§é‡æ—¶é—´é¢„å…ˆç¡®å®šé¢†åŸŸåº”è¯¥æ˜¯ä»€ä¹ˆã€‚è¿™å¯èƒ½åŒ…æ‹¬æ¨¡æ‹Ÿä¸€äº›æƒ³æ³•å¹¶è®©åŒäº‹è¿›è¡Œå®¡æŸ¥ï¼Œè®¨è®ºä»€ä¹ˆæ˜¯æ­£ç¡®/ä¸æ­£ç¡®çš„ï¼Œå‡ ä¸ªè¿­ä»£å‘¨æœŸï¼Œç„¶åæ‰å¯ä»¥æŠ•å…¥åˆ°ç¼–å†™ä¸€äº›ä»£ç ä¸­ã€‚ ä½ å¯ä»¥åœ¨ <a href="https://medium.com/wtf-dial/wtf-dial-domain-model-9655cd523182" target="_blank" rel="noopener">Ben Johnsonçš„WTF Dialé¡¹ç›®</a> ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ï¼Œä»–åœ¨è¯¥ <a href="https://medium.com/wtf-dial/wtf-dial-domain-model-9655cd523182" target="_blank" rel="noopener">é¡¹ç›®</a> ä¸­åˆ›å»ºäº†PRï¼Œå¹¶ä¸Peter Bourgonï¼ŒEgon Elbreå’ŒMarcus Olssonè®¨è®ºäº†é¢†åŸŸç›¸å…³å†…å®¹ã€‚</p>
<p>è¿™å¹¶ä¸æ˜¯ä¸€ä»¶åäº‹ï¼Œä½†æ­£ç¡®èµ·æ¥ä¹Ÿä¸å®¹æ˜“ï¼Œå®ƒéœ€è¦å¤§é‡çš„å‰æœŸå·¥ä½œã€‚ å› æ­¤ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæ›´å¤§çš„å›¢é˜Ÿï¼Œæ¯ä¸ªäººéƒ½éœ€è¦åœ¨æŸä¸ªå…±åŒé¢†åŸŸä¸Šè¾¾æˆå…±è¯†ï¼Œç„¶åæ‰èƒ½å¼€å§‹å¼€å‘ï¼Œé‚£ä¹ˆæˆ‘é€šå¸¸ä¼šå‘ç°è¿™ç§æ–¹æ³•æœ€æœ‰æ•ˆã€‚</p>
<p>é‰´äºæˆ‘ç»å¸¸åœ¨è¾ƒå°çš„å›¢é˜Ÿä¸­ï¼ˆæˆ–ç”±æˆ‘è‡ªå·±ï¼‰è¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥æˆ‘å‘ç°ï¼Œå¦‚æœæˆ‘ä»ç®€å•çš„äº‹æƒ…å¼€å§‹ï¼Œæˆ‘çš„é¡¹ç›®å°±ä¼šè‡ªç„¶å‘å±•ã€‚ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ª <a href="https://www.calhoun.io/flat-application-structure/" target="_blank" rel="noopener">å¹³é“ºç»“æ„</a>  ï¼Œä¹Ÿè®¸æ˜¯ <a href="https://www.calhoun.io/using-mvc-to-structure-go-web-applications/" target="_blank" rel="noopener">ä¸€ä¸ªmvcç»“æ„</a>  ï¼Œæˆ–è€…ä¹Ÿè®¸å®Œå…¨æ˜¯å…¶ä»–ä¸œè¥¿ã€‚ åªè¦æˆ‘å¯¹ä»£ç çš„å‘å±•ä¿æŒå¼€æ”¾çš„æ€åº¦ï¼Œæˆ‘å°±ä¸ä¼šå¤ªç€è¿·äºé‚£äº›ç»†èŠ‚ã€‚è¿™ä½¿å®ƒæœ€ç»ˆå¯ä»¥é‡‡ç”¨DDDä¹‹ç±»çš„å½¢å¼ï¼Œä½†æ˜¯ä¸éœ€è¦æˆ‘ä»é‚£é‡Œå¼€å§‹ã€‚å¦‚å‰æ‰€è¿°ï¼Œå¯¹äºå¤§å‹ç»„ç»‡ï¼ˆæ¯ä¸ªäººéƒ½ä¸€èµ·å¼€å‘åŒä¸€åº”ç”¨ç¨‹åºï¼‰è€Œè¨€ï¼Œè¿™æ ·åšå¯èƒ½ä¼šæ¯”è¾ƒå›°éš¾ï¼Œå› æ­¤é€šå¸¸éœ€è¦è¿›è¡Œæ›´å¤šçš„å‰æœŸè®¾è®¡è®¨è®ºã€‚ </p>
<p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬åšäº†ä¸â€œè®©å®ƒä¸æ–­å‘å±•â€çš„æ¦‚å¿µéå¸¸ç›¸ä¼¼çš„äº‹æƒ…ã€‚æ¯ä¸€æ­¥éƒ½æ˜¯ä¸ºç‰¹å®šç›®çš„è€Œé‡‡å–çš„ï¼šæˆ‘ä»¬æ·»åŠ äº†<code>UserService</code>æ¥å£ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æµ‹è¯•èº«ä»½éªŒè¯ä¸­é—´ä»¶ã€‚ å½“æˆ‘ä»¬å¼€å§‹ä»GitHubè¿ç§»åˆ°GitLabæ—¶ï¼Œæˆ‘ä»¬æ„è¯†åˆ°æˆ‘ä»¬çš„æ¥å£ä¸å¤Ÿç”¨ï¼Œå› æ­¤æˆ‘ä»¬æ¢ç´¢äº†å…¶ä»–é€‰æ‹©ã€‚ å›´ç»•è¿™ä¸€ç‚¹ï¼Œæˆ‘è®¤ä¸ºä¸€ç§è®©å˜å¾—æœ‰æ„ä¹‰DDDçš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯çŒœæµ‹<code>User</code>å’Œ<code>UserService</code>æ¥å£ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸€äº›å®é™…çš„å®ç°åŸºç¡€è¿›è¡ŒéªŒè¯ã€‚</p>
<p>ä»¥DDDå¼€å¤´çš„å¦ä¸€ä¸ªæ½œåœ¨é—®é¢˜æ˜¯ç±»å‹å®šä¹‰ä¸è¶³ï¼Œå› ä¸ºæˆ‘ä»¬ç»å¸¸åœ¨æ‹¥æœ‰å…·ä½“ç”¨ä¾‹ä¹‹å‰å°±å®šä¹‰å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½å†³å®šå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UserAuthenticator <span class="keyword">interface</span> &#123;</span><br><span class="line">	Authenticate(email, pw <span class="keyword">string</span>) (error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯åæ¥ï¼Œæˆ‘ä»¬æ„è¯†åˆ°ï¼Œå®é™…ä¸Šï¼Œæ¯å½“æˆ‘ä»¬å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œæˆ‘ä»¬ç¡®å®å¸Œæœ›è¿”å›è¯¥ç”¨æˆ·ï¼ˆæˆ–è®°ä½çš„ä»¤ç‰Œï¼‰ï¼Œå¹¶ä¸”é€šè¿‡é¢„å…ˆå®šä¹‰æ­¤æ¥å£ï¼Œè€Œä¹‹å‰æˆ‘ä»¬é”™è¿‡äº†è¿™ä¸€ç»†èŠ‚ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ç¬¬äºŒç§æ–¹æ³•æ¥æ£€ç´¢æ­¤ä¿¡æ¯ï¼Œæˆ–è€…æˆ‘ä»¬éœ€è¦æ›´æ”¹<code>UserAuthenticator</code>ç±»å‹å¹¶é‡æ„å®ç°åˆ©ç”¨æ­¤åŠŸèƒ½çš„ä»»ä½•ä»£ç ã€‚</p>
<p>åŒæ ·çš„æƒ…å†µé€‚ç”¨äºä½ çš„æ¨¡å‹ã€‚åœ¨å®é™…å®ç°<code>github</code>å’Œ<code>gitlab</code>è½¯ä»¶åŒ…ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè®¤ä¸ºï¼Œæˆ‘ä»¬åœ¨<code>User</code>æ¨¡å‹ä¸Šå”¯ä¸€éœ€è¦çš„è¯†åˆ«ä¿¡æ¯æ˜¯Emailå­—æ®µï¼Œä½†æ˜¯æˆ‘ä»¬ç¨åå¯èƒ½ä¼šåœ¨å®ç°è¿™äº›æœåŠ¡æ—¶æ„è¯†åˆ°ç”µå­é‚®ä»¶åœ°å€å¯ä»¥æ›´æ”¹çš„ï¼Œè€Œæˆ‘ä»¬è¿˜éœ€è¦IDå­—æ®µç”¨äºå”¯ä¸€æ ‡è¯†ç”¨æˆ·ã€‚</p>
<p>åœ¨ä½¿ç”¨é¢†åŸŸæ¨¡å‹ä¹‹å‰å®šä¹‰æ˜¯ä¸€é¡¹æŒ‘æˆ˜ã€‚é™¤éæˆ‘ä»¬å·²ç»éå¸¸äº†è§£æˆ‘ä»¬æ­£åœ¨ç ”ç©¶çš„é¢†åŸŸï¼Œå¦åˆ™æˆ‘ä»¬æä¸å¯èƒ½çŸ¥é“æˆ‘ä»¬éœ€è¦åšä»€ä¹ˆå’Œä¸éœ€è¦åšä»€ä¹ˆã€‚æ˜¯çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»åœ¨ä»¥åé‡æ„ä»£ç ï¼Œä½†æ˜¯å¦‚æœä½ é”™è¯¯å®šä¹‰äº†é¢†åŸŸï¼Œä¸ä½¿ç”¨DDDä¼šå¾ˆå¤šæ¯”é‡æ„æ•´ä¸ªä»£ç åº“æ›´å®¹æ˜“ã€‚ è¿™æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¸ä»‹æ„ä»ç´§å¯†è€¦åˆçš„ä»£ç å¼€å§‹å¹¶åœ¨ä»¥åè¿›è¡Œé‡æ„çš„å¦ä¸€ä¸ªåŸå› ã€‚</p>
<p>æœ€åï¼Œå¹¶éæ‰€æœ‰ä»£ç éƒ½éœ€è¦è¿™ç§è§£è€¦ï¼Œå®ƒå¹¶ä¸èƒ½æ€»æ˜¯èƒ½å¤Ÿå¸¦æ¥å¥½å¤„ï¼Œå¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚DBï¼‰ï¼Œæˆ‘ä»¬å¾ˆå°‘åˆ©ç”¨è¿™ç§è§£è€¦ã€‚</p>
<p>å¯¹äºä¸ç»§ç»­ç ”å‘çš„é¡¹ç›®ï¼Œä½ å¯èƒ½ä¸éœ€è¦èŠ±è´¹æ‰€æœ‰æ—¶é—´æ¥è§£è€¦ä»£ç ã€‚å¦‚æœä»£ç æ²¡æœ‰ç»§ç»­ç ”å‘ï¼Œé‚£ä¹ˆæ›´æ”¹çš„å¯èƒ½æ€§å°†å¤§å¤§é™ä½ï¼Œè€Œä¸ºä»£ç åšå‡†å¤‡è€Œä»˜å‡ºçš„é¢å¤–åŠªåŠ›å¯èƒ½åªæ˜¯æµªè´¹äº†ã€‚</p>
<p>æ­¤å¤–ï¼Œè§£è€¦å¹¶ä¸æ€»æ˜¯èƒ½æä¾›å®ƒæ‰€æ‰¿è¯ºçš„å¥½å¤„ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šæ€»æ˜¯åˆ©ç”¨è¿™ç§è§£è€¦çš„ä¼˜åŠ¿ã€‚ æ­£å¦‚<a href="https://twitter.com/matryer" target="_blank" rel="noopener">Mat Ryer</a>æ‰€æŒ‡å‡ºçš„é‚£æ · ï¼Œæˆ‘ä»¬å¾ˆå°‘ä¼šæ¢æ‰æ•°æ®åº“å®ç°ã€‚ å³ä½¿æˆ‘ä»¬ç¡®å®å®ç°äº†æ‰€æœ‰åŠŸèƒ½çš„åˆ†ç¦»ï¼Œå³ä½¿æˆ‘ä»¬ç¢°å·§åªåœ¨å°‘æ•°æ­£åœ¨è¿ç§»æ•°æ®åº“çš„åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™ç§è¿ç§»é€šå¸¸ä¹Ÿéœ€è¦å½»åº•é‡æ–°è€ƒè™‘æˆ‘ä»¬ä¸æ•°æ®å­˜å‚¨ä¹‹é—´çš„äº¤äº’æ–¹å¼ã€‚ æ¯•ç«Ÿï¼ŒNoSQLæ•°æ®åº“çš„è¡Œä¸ºä¸SQLæ•°æ®åº“å®Œå…¨ä¸åŒï¼Œè¦çœŸæ­£åˆ©ç”¨ä¸¤è€…ï¼Œæˆ‘ä»¬å¿…é¡»ç¼–å†™æ‰€ä½¿ç”¨æ•°æ®åº“çš„ç‰¹å®šä»£ç ã€‚æœ€ç»ˆç»“æœæ˜¯è¿™äº›æŠ½è±¡å¹¶ä¸æ€»æ˜¯ä¸ºæˆ‘ä»¬æä¾›æˆ‘ä»¬æƒ³è¦çš„ç¥å¥‡çš„â€œå®ç°æ— å…³â€çš„ç»“æœã€‚</p>
<p>è¿™å¹¶ä¸æ„å‘³ç€DDDä¸èƒ½æä¾›ä¼˜åŠ¿ï¼Œè€Œæ˜¯æ„å‘³ç€æˆ‘ä»¬ä¸åº”è¯¥ç®€å•åœ° <a href="https://en.wikipedia.org/wiki/Drinking_the_Kool-Aid" target="_blank" rel="noopener">é¡¶ç¤¼è†œæ‹œ</a> å¹¶æœŸå¾…ç¥å¥‡æ•ˆæœã€‚æˆ‘ä»¬éœ€è¦åœä¸‹æ¥è‡ªæˆ‘åæ€ã€‚</p>
<h2 id="ç»¼ä¸Šæ‰€è¿°"><a href="#ç»¼ä¸Šæ‰€è¿°" class="headerlink" title="ç»¼ä¸Šæ‰€è¿°"></a>ç»¼ä¸Šæ‰€è¿°</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ç ”ç©¶äº†ä»£ç ç´§å¯†è€¦åˆæ—¶é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶æ¢è®¨äº†å®šä¹‰é¢†åŸŸç±»å‹å’Œæ¥å£å¦‚ä½•å¸®åŠ©æ”¹å–„è¿™ç§è€¦åˆã€‚ æˆ‘ä»¬è¿˜è®¨è®ºäº†ä¸ºä»€ä¹ˆè®©æˆ‘ä»¬çš„ä»£ç éšç€æ—¶é—´çš„æ¨ç§»è€Œå‘å±•ï¼Œè€Œä¸æ˜¯ä»å¼€å§‹è¿›è¡Œè¿™ç§åˆ†ç¦»çš„è®¾è®¡çš„åŸå› ã€‚</p>
<p>åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å¸Œæœ›å±•å¼€è®²è§£ä½¿ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡ç¼–å†™Goä»£ç çš„æƒ³æ³•ã€‚ å…·ä½“æ¥è¯´ï¼Œæˆ‘æƒ³è®¨è®ºï¼š</p>
<ul>
<li>æ¥å£æµ‹è¯•å¦‚ä½•å¸®åŠ©ç¡®ä¿å®ç°å¯ä»¥æ¯«æ— é—®é¢˜åœ°äº’æ¢ã€‚ </li>
<li>å­åŸŸå¦‚ä½•è¡ç”Ÿè‡ªä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚ </li>
<li>ä½¿ç”¨ä¼ ç»Ÿçš„DDDå…­è¾¹å½¢æ¥å½¢è±¡åŒ–è¿™ä¸€åˆ‡ï¼Œä»¥åŠåƒç¬¬ä¸‰æ–¹åº“è¿™æ ·çš„ä»£ç å¦‚ä½•é€‚é…ã€‚ </li>
</ul>
<p>æˆ‘è¿˜æƒ³å¼ºè°ƒï¼Œæœ¬æ–‡ç»ä¸æ˜¯ç¡¬æ€§è§„å®šã€‚è¿™åªæ˜¯æˆ‘å¾®è–„çš„å°è¯•ï¼Œè¯•å›¾åˆ†äº«ä¸€äº›å¸®åŠ©æˆ‘æ”¹è¿›Goè½¯ä»¶çš„è§è§£å’Œæƒ³æ³•ã€‚</p>
<p>æˆ‘ä¹Ÿä¸æ˜¯ç¬¬ä¸€ä¸ªåœ¨Goä¸­è®¨è®ºæˆ–æ¢ç´¢DDDå’Œè®¾è®¡æ¨¡å¼çš„äººã€‚ ä½ åº”è¯¥æŸ¥çœ‹ä»¥ä¸‹å†…å®¹ä»¥è·å¾—æ›´å…¨é¢çš„ç†è§£ï¼š</p>
<ul>
<li><a href="https://github.com/marcusolsson/goddd" target="_blank" rel="noopener">GoDDD by Marcus Olsen</a> - è¿™æ˜¯ä¸€ä¸ªGitHubå­˜å‚¨åº“ï¼Œå…¶ä¸­åŒ…å«æ–‡ç« å’Œæ¼”è®²ï¼ŒMarcus Olsenè¯•å›¾å°†ä¼ ç»Ÿçš„DDD Javaç¤ºä¾‹åº”ç”¨ç¨‹åºç§»æ¤åˆ°Goä¸­ã€‚ </li>
<li><a href="https://medium.com/wtf-dial" target="_blank" rel="noopener">WTF Dial by Ben Johnson</a> - æˆ‘åœ¨æ–‡ä¸­é“¾æ¥äº†Bençš„Standard Pacakage Layoutæ–‡ç« ï¼› æœ¬ç³»åˆ—åº”ç”¨äº†Benåœ¨è¯¥æ–‡ç« ä¸­è®¨è®ºçš„å†…å®¹ã€‚æˆ‘è¿˜å»ºè®®æŸ¥çœ‹é™„å¸¦çš„PRï¼Œå¹¶ä»”ç»†é˜…è¯»è¯„è®ºã€‚ </li>
<li><a href="https://www.youtube.com/watch?v=oL6JBUk6tj0" target="_blank" rel="noopener">How Do You Structure Your Go Apps by Kat Zien</a> - åœ¨æ¼”è®²ä¸­ï¼ŒKaté€šè¿‡å¤šç§æ–¹æ³•æ„å»ºäº†Goåº”ç”¨ç¨‹åºã€‚é™„å¸¦äº†æ¼”è®²çš„ä»£ç ä»“åº“å’Œå¹»ç¯ç‰‡ã€‚</li>
<li><a href="https://www.ardanlabs.com/blog/2017/02/design-philosophy-on-packaging.html" target="_blank" rel="noopener">Design Philosophy On Packaging by Bill Kennedy</a> - è™½ç„¶ä¸ä¸“é—¨æ¶‰åŠç»“æ„åŒ–åº”ç”¨ç¨‹åºï¼Œä½†æœ¬ç³»åˆ—è®¨è®ºäº†ä¸ç»“æ„ç´§å¯†è”ç³»çš„åŒ…è®¾è®¡ã€‚ </li>
</ul>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    æ‰“èµ
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="https://gocn.oss-cn-shanghai.aliyuncs.com/photo/2020/2836cbcc-6066-42e9-98e7-4063a05473b2.jpeg" alt="ipfans å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>ipfans
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://www.4async.com/2020/02/2020-02-16-moving-towards-domain-driven-design-in-go/" title="è¯‘ï¼šåœ¨Goä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡">https://www.4async.com/2020/02/2020-02-16-moving-towards-domain-driven-design-in-go/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Golang/" rel="tag"># Golang</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/02/2020-02-05-golang-debug-instrumental/" rel="prev" title="ä» Go è¯­è¨€çš„ä¾èµ–åº“è®²èµ·ï¼ˆ2ï¼‰ç›‘æ§ã€åˆ†å¸ƒå¼è¿½è¸ªå’Œæ—¥å¿—">
      <i class="fa fa-chevron-left"></i> ä» Go è¯­è¨€çš„ä¾èµ–åº“è®²èµ·ï¼ˆ2ï¼‰ç›‘æ§ã€åˆ†å¸ƒå¼è¿½è¸ªå’Œæ—¥å¿—
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/2020-03-31-intro-opentelemetry/" rel="next" title="OpenTelemetryå…¥é—¨">
      OpenTelemetryå…¥é—¨ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å¯»æ‰¾ä¸­é—´æ–¹æ¡ˆ"><span class="nav-number">1.</span> <span class="nav-text">å¯»æ‰¾ä¸­é—´æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é¢†åŸŸé©±åŠ¨è®¾è®¡"><span class="nav-number">2.</span> <span class="nav-text">é¢†åŸŸé©±åŠ¨è®¾è®¡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä»é¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å§‹ï¼Ÿ"><span class="nav-number">3.</span> <span class="nav-text">ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä»é¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å§‹ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç»¼ä¸Šæ‰€è¿°"><span class="nav-number">4.</span> <span class="nav-text">ç»¼ä¸Šæ‰€è¿°</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ipfans"
      src="https://avatars0.githubusercontent.com/u/363344?v=3&s=460">
  <p class="site-author-name" itemprop="name">ipfans</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">81</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ipfans" title="GitHub â†’ https://github.com/ipfans" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/janxin" title="Twitter â†’ https://twitter.com/janxin" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2013 â€“ 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ipfans</span>
</div>

        








        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://s1mbily.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://www.4async.com/2020/02/2020-02-16-moving-towards-domain-driven-design-in-go/",
            identifier: "2020/02/2020-02-16-moving-towards-domain-driven-design-in-go/",
            title: "è¯‘ï¼šåœ¨Goä¸­è½¬å‘é¢†åŸŸé©±åŠ¨è®¾è®¡"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://s1mbily.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    window.addEventListener('load', loadComments, false);
</script>

  <script>
  var link = "" ;
  // éå†æ‰€æœ‰çš„imgæ ‡ç­¾
  $("img").each( (i,o) => {
    var o = $(o);
      // åˆ¤æ–­å›¾ç‰‡çš„é“¾æ¥æ˜¯å¦åŒ…å«sinaimgå…³é”®å­—
    if( o.attr("src").indexOf("sinaimg") > 0 ){
          // ç»™è¿™ä¸ªæ ‡ç­¾åŠ ä¸ŠreferrerPlicyå±æ€§
      o.attr("referrerpolicy","no-referrer");
          // å¤‡ä»½å›¾ç‰‡çš„src
      link = o.attr("src");
          // é‡æ–°è®¾ç½®srcï¼Œè®©é¡µé¢é‡æ–°åŠ è½½ä¸€æ¬¡å›¾ç‰‡
      o.attr("src",link);
    }
  });
  </script>
</body>
</html>
